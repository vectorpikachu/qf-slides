<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.7.32">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Topics in Quantitative Finance, Summer 2025 â€“ Topics in QF</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
/* CSS for citations */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
  margin-bottom: 0em;
}
.hanging-indent div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}</style>


<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js" integrity="sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==" crossorigin="anonymous"></script><script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<script src="site_libs/quarto-html/quarto.js" type="module"></script>
<script src="site_libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-37eea08aefeeee20ff55810ff984fec1.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap-b82b626913fb92a8b9be04cecd5320fa.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" integrity="sha512-c3Nl8+7g4LMSTdrm621y7kf9v3SDPnhxLNhcjFJbKECVnmZHTdo+IRO05sNLTH/D3vA6u1X32ehoLC7WFVdheg==" crossorigin="anonymous"></script>

<script type="application/javascript">define('jquery', [],function() {return window.jQuery;})</script>

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

<link rel="stylesheet" href="styles.css">
</head>

<body class="nav-fixed quarto-light">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="./index.html">
    <span class="navbar-title">Topics in QF</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="./index.html"> 
<span class="menu-text">Home</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./about.html"> 
<span class="menu-text">About</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./NSD_Lec01-FinancialEngineering_Summer2025.html"> 
<span class="menu-text">Lecture 01</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./NSD_Lec02-StochCal_Summer2025.html"> 
<span class="menu-text">Lecture 02</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link active" href="./NSD_Lec03-BlackMertonScholes-1_Summer2025.html" aria-current="page"> 
<span class="menu-text">Lecture 03</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./NSD_Lec04_Summer2025/NSD_Lec04-BlackMertonScholes-2_Summer2025.html"> 
<span class="menu-text">Lecture 04</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./NSD_Lec05_Summer2025/NSD_Lec05-Volatility_Summer2025.html"> 
<span class="menu-text">Lecture 05</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./NSD_Lec06-OptimalOrderExecution_Summer2025.html"> 
<span class="menu-text">Lecture 06</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./NSD_Lec07-MathInAMM_Summer2025.html"> 
<span class="menu-text">Lecture 07</span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-full page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#lecture-3-the-black-merton-scholes-model-and-beyond-i" id="toc-lecture-3-the-black-merton-scholes-model-and-beyond-i" class="nav-link active" data-scroll-target="#lecture-3-the-black-merton-scholes-model-and-beyond-i">Lecture 3: The Black-Merton-Scholes model and beyond I</a></li>
  <li><a href="#agenda" id="toc-agenda" class="nav-link" data-scroll-target="#agenda">Agenda</a></li>
  <li><a href="#black-merton-scholes" id="toc-black-merton-scholes" class="nav-link" data-scroll-target="#black-merton-scholes">Black-Merton-Scholes</a></li>
  <li><a href="#the-black-scholes-world" id="toc-the-black-scholes-world" class="nav-link" data-scroll-target="#the-black-scholes-world">The Black-Scholes world</a></li>
  <li><a href="#black-scholes-model" id="toc-black-scholes-model" class="nav-link" data-scroll-target="#black-scholes-model">Black-Scholes model</a></li>
  <li><a href="#pricing-under-the-black-scholes-model" id="toc-pricing-under-the-black-scholes-model" class="nav-link" data-scroll-target="#pricing-under-the-black-scholes-model">Pricing under the Black-Scholes model</a></li>
  <li><a href="#black-scholes-pde" id="toc-black-scholes-pde" class="nav-link" data-scroll-target="#black-scholes-pde">Black-Scholes PDE</a></li>
  <li><a href="#solving-black-scholes-pde" id="toc-solving-black-scholes-pde" class="nav-link" data-scroll-target="#solving-black-scholes-pde">Solving Black-Scholes PDE</a></li>
  <li><a href="#the-black-scholes-formula" id="toc-the-black-scholes-formula" class="nav-link" data-scroll-target="#the-black-scholes-formula">The Black-Scholes formula</a>
  <ul class="collapse">
  <li><a href="#note-3" id="toc-note-3" class="nav-link" data-scroll-target="#note-3">Note</a></li>
  </ul></li>
  <li><a href="#the-greeks" id="toc-the-greeks" class="nav-link" data-scroll-target="#the-greeks">The Greeks</a></li>
  <li><a href="#subtlety-in-self-financing" id="toc-subtlety-in-self-financing" class="nav-link" data-scroll-target="#subtlety-in-self-financing">Subtlety in self-financing</a></li>
  <li><a href="#self-financing-with-traded-price" id="toc-self-financing-with-traded-price" class="nav-link" data-scroll-target="#self-financing-with-traded-price">Self-financing with traded price</a></li>
  <li><a href="#delta-hedging" id="toc-delta-hedging" class="nav-link" data-scroll-target="#delta-hedging">Delta hedging</a>
  <ul class="collapse">
  <li><a href="#an-example-on-delta-hedge" id="toc-an-example-on-delta-hedge" class="nav-link" data-scroll-target="#an-example-on-delta-hedge">An example on delta hedge</a></li>
  </ul></li>
  <li><a href="#an-example-on-delta-gamma-hedge" id="toc-an-example-on-delta-gamma-hedge" class="nav-link" data-scroll-target="#an-example-on-delta-gamma-hedge">An example on delta-gamma hedge</a></li>
  <li><a href="#dynamical-hedging" id="toc-dynamical-hedging" class="nav-link" data-scroll-target="#dynamical-hedging">Dynamical hedging</a>
  <ul class="collapse">
  <li><a href="#an-example-on-dynamical-hedging" id="toc-an-example-on-dynamical-hedging" class="nav-link" data-scroll-target="#an-example-on-dynamical-hedging">An example on dynamical hedging</a></li>
  </ul></li>
  <li><a href="#dynamic-hedge-in-practice" id="toc-dynamic-hedge-in-practice" class="nav-link" data-scroll-target="#dynamic-hedge-in-practice">Dynamic hedge in practice</a></li>
  <li><a href="#deep-hedging" id="toc-deep-hedging" class="nav-link" data-scroll-target="#deep-hedging">Deep hedging</a></li>
  <li><a href="#deep-hedging-in-a-nutshell" id="toc-deep-hedging-in-a-nutshell" class="nav-link" data-scroll-target="#deep-hedging-in-a-nutshell">Deep hedging in a nutshell</a></li>
  <li><a href="#notations" id="toc-notations" class="nav-link" data-scroll-target="#notations">Notations</a></li>
  <li><a href="#settings-in-cao-chen-hull-poulos" id="toc-settings-in-cao-chen-hull-poulos" class="nav-link" data-scroll-target="#settings-in-cao-chen-hull-poulos">Settings in Cao-Chen-Hull-Poulos</a></li>
  <li><a href="#two-alternative-formulations" id="toc-two-alternative-formulations" class="nav-link" data-scroll-target="#two-alternative-formulations">Two alternative formulations</a></li>
  <li><a href="#accounting-pl-formulation" id="toc-accounting-pl-formulation" class="nav-link" data-scroll-target="#accounting-pl-formulation">Accounting P&amp;L formulation</a></li>
  <li><a href="#cashflow-formulation" id="toc-cashflow-formulation" class="nav-link" data-scroll-target="#cashflow-formulation">Cashflow formulation</a></li>
  <li><a href="#accounting-pl-vs-cashflow" id="toc-accounting-pl-vs-cashflow" class="nav-link" data-scroll-target="#accounting-pl-vs-cashflow">Accounting P&amp;L vs cashflow</a></li>
  <li><a href="#objective-functional-and-resulting-control-problem" id="toc-objective-functional-and-resulting-control-problem" class="nav-link" data-scroll-target="#objective-functional-and-resulting-control-problem">Objective functional and resulting control problem</a></li>
  <li><a href="#implementation-of-deep-hedging-in-tensorflow" id="toc-implementation-of-deep-hedging-in-tensorflow" class="nav-link" data-scroll-target="#implementation-of-deep-hedging-in-tensorflow">Implementation of Deep hedging in <code>Tensorflow</code></a></li>
  <li><a href="#deep-hedging-implementation-with-ddpg-algorithm" id="toc-deep-hedging-implementation-with-ddpg-algorithm" class="nav-link" data-scroll-target="#deep-hedging-implementation-with-ddpg-algorithm">Deep-hedging implementation with DDPG Algorithm</a></li>
  <li><a href="#performance-of-deep-hedging-vs-delta-hedging" id="toc-performance-of-deep-hedging-vs-delta-hedging" class="nav-link" data-scroll-target="#performance-of-deep-hedging-vs-delta-hedging">Performance of deep hedging vs delta hedging</a></li>
  <li><a href="#one-month-option-weekly-hedging" id="toc-one-month-option-weekly-hedging" class="nav-link" data-scroll-target="#one-month-option-weekly-hedging">One-month option, weekly hedging</a></li>
  <li><a href="#what-does-the-optimal-action-look-like" id="toc-what-does-the-optimal-action-look-like" class="nav-link" data-scroll-target="#what-does-the-optimal-action-look-like">What does the optimal action look like?</a></li>
  <li><a href="#one-month-option-tridaily-hedging" id="toc-one-month-option-tridaily-hedging" class="nav-link" data-scroll-target="#one-month-option-tridaily-hedging">One-month option, tridaily hedging</a></li>
  <li><a href="#month-option-weekly-hedging" id="toc-month-option-weekly-hedging" class="nav-link" data-scroll-target="#month-option-weekly-hedging">3-month option, weekly hedging</a></li>
  <li><a href="#concluding-remarks-on-deep-hedging" id="toc-concluding-remarks-on-deep-hedging" class="nav-link" data-scroll-target="#concluding-remarks-on-deep-hedging">Concluding remarks on deep hedging</a></li>
  <li><a href="#lecture-notes" id="toc-lecture-notes" class="nav-link" data-scroll-target="#lecture-notes">Lecture Notes</a>
  <ul class="collapse">
  <li><a href="#black-scholes-model-1" id="toc-black-scholes-model-1" class="nav-link" data-scroll-target="#black-scholes-model-1">Black-Scholes Model</a></li>
  <li><a href="#option-pricing-with-the-black-scholes-model" id="toc-option-pricing-with-the-black-scholes-model" class="nav-link" data-scroll-target="#option-pricing-with-the-black-scholes-model">Option Pricing with the Black-Scholes Model</a></li>
  <li><a href="#æœŸæƒå®šä»·ä¸å¯¹å†²" id="toc-æœŸæƒå®šä»·ä¸å¯¹å†²" class="nav-link" data-scroll-target="#æœŸæƒå®šä»·ä¸å¯¹å†²">æœŸæƒå®šä»·ä¸å¯¹å†²</a></li>
  <li><a href="#black-scholes-æ¨¡å‹ä¸éšå«æ³¢åŠ¨ç‡" id="toc-black-scholes-æ¨¡å‹ä¸éšå«æ³¢åŠ¨ç‡" class="nav-link" data-scroll-target="#black-scholes-æ¨¡å‹ä¸éšå«æ³¢åŠ¨ç‡">Black-Scholes æ¨¡å‹ä¸éšå«æ³¢åŠ¨ç‡</a></li>
  <li><a href="#jump-trading" id="toc-jump-trading" class="nav-link" data-scroll-target="#jump-trading">Jump Trading</a></li>
  <li><a href="#åšå¸‚å•†æ ¸å¿ƒèŒèƒ½ä¸ç›ˆåˆ©æœºåˆ¶" id="toc-åšå¸‚å•†æ ¸å¿ƒèŒèƒ½ä¸ç›ˆåˆ©æœºåˆ¶" class="nav-link" data-scroll-target="#åšå¸‚å•†æ ¸å¿ƒèŒèƒ½ä¸ç›ˆåˆ©æœºåˆ¶">åšå¸‚å•†æ ¸å¿ƒèŒèƒ½ä¸ç›ˆåˆ©æœºåˆ¶ ğŸ¦</a></li>
  <li><a href="#é«˜é¢‘äº¤æ˜“å…³é”®è¦ç´ ä¸æŠ€æœ¯åŸºç¡€" id="toc-é«˜é¢‘äº¤æ˜“å…³é”®è¦ç´ ä¸æŠ€æœ¯åŸºç¡€" class="nav-link" data-scroll-target="#é«˜é¢‘äº¤æ˜“å…³é”®è¦ç´ ä¸æŠ€æœ¯åŸºç¡€">é«˜é¢‘äº¤æ˜“å…³é”®è¦ç´ ä¸æŠ€æœ¯åŸºç¡€ ğŸ–¥ï¸</a></li>
  <li><a href="#å…³é”®æ¦‚å¿µæ€»ç»“" id="toc-å…³é”®æ¦‚å¿µæ€»ç»“" class="nav-link" data-scroll-target="#å…³é”®æ¦‚å¿µæ€»ç»“">å…³é”®æ¦‚å¿µæ€»ç»“</a></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content column-page-left" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Topics in Quantitative Finance, Summer 2025</h1>
</div>



<div class="quarto-title-meta column-page-left">

    
  
    
  </div>
  


</header>


<section id="lecture-3-the-black-merton-scholes-model-and-beyond-i" class="level2">
<h2 class="anchored" data-anchor-id="lecture-3-the-black-merton-scholes-model-and-beyond-i">Lecture 3: The Black-Merton-Scholes model and beyond I</h2>
<p><br> <br></p>
<center>
<font size="5," color="darkblue"> Tai-Ho Wang (ç‹ å¤ªå’Œ)</font>
</center>
<p><span class="math display">\[
\newcommand{\bea}{\begin{eqnarray}}
\newcommand{\eea}{\end{eqnarray}}
\newcommand{\supp}{\mathrm{supp}}
\newcommand{\cA}{\mathcal{A} }
\newcommand{\F}{\mathcal{F} }
\newcommand{\cF}{\mathcal{F} }
\newcommand{\E}{\mathbb{E} }
\newcommand{\Eof}[1]{\mathbb{E}\left[ #1 \right]}
\newcommand{\Etof}[1]{\mathbb{E}_t\left[ #1 \right]}
\newcommand{\Sdof}[1]{\mathbb{Sd}\left[ #1 \right]}
\def\Cov{{ \mbox{Cov} }}
\def\Var{{ \text{Var} }}
\newcommand{\1}{\mathbf{1} }
\newcommand{\p}{\partial}
\newcommand{\PP}{\mathbb{P} }
\newcommand{\Pof}[1]{\mathbb{P}\left[ #1 \right]}
\newcommand{\QQ}{\mathbb{Q} }
\newcommand{\R}{\mathbb{R} }
\newcommand{\DD}{\mathbb{D} }
\newcommand{\HH}{\mathbb{H} }
\newcommand{\spn}{\mathrm{span} }
\newcommand{\cov}{\mathrm{cov} }
\newcommand{\HS}{\mathcal{L}_{\mathrm{HS}} }
\newcommand{\Hess}{\mathrm{Hess} }
\newcommand{\trace}{\mathrm{trace} }
\newcommand{\LL}{\mathcal{L} }
\newcommand{\s}{\mathcal{S} }
\newcommand{\ee}{\mathcal{E} }
\newcommand{\ff}{\mathcal{F} }
\newcommand{\hh}{\mathcal{H} }
\newcommand{\bb}{\mathcal{B} }
\newcommand{\dd}{\mathcal{D} }
\newcommand{\g}{\mathcal{G} }
\newcommand{\half}{\frac{1}{2} }
\newcommand{\T}{\mathcal{T} }
\newcommand{\bit}{\begin{itemize}}
\newcommand{\eit}{\end{itemize}}
\newcommand{\beq}{\begin{equation}}
\newcommand{\eeq}{\end{equation}}
\newcommand{\tr}{\mbox{tr}}
\newcommand{\inn}[2]{\left\langle #1, #2 \right\rangle}
\newcommand{\bX}{\boldsymbol X}
\newcommand{\bm}{\boldsymbol m}
\newcommand{\bx}{\boldsymbol x}
\newcommand{\by}{\boldsymbol y}
\newcommand{\bmu}{\boldsymbol\mu}
\newcommand{\bxi}{\boldsymbol\xi}
\]</span></p>
</section>
<section id="agenda" class="level2">
<h2 class="anchored" data-anchor-id="agenda">Agenda</h2>
<ul>
<li>Black-Merton-Scholes model</li>
<li>Black-Merton-Scholes formula for call and put options</li>
<li>Greeks</li>
<li>Subtlety in self-financing</li>
<li>Delta and delta-gamma hedges</li>
<li>Dynamic hedging</li>
<li>Deep hedging</li>
</ul>
<section id="remark" class="level4">
<h4 class="anchored" data-anchor-id="remark">Remark</h4>
<ol type="1">
<li>Black-Merton-Scholes æ¨¡å‹æ˜¯ç”¨äºæœŸæƒå®šä»·çš„ç»å…¸æ¨¡å‹</li>
<li>Call option: çœ‹æ¶¨æœŸæƒ; Put option: çœ‹è·ŒæœŸæƒ</li>
<li>Greeks æ˜¯è¡¡é‡æœŸæƒä»·æ ¼å¯¹å¸‚åœºå˜é‡å˜åŒ–æ•æ„Ÿåº¦çš„æŒ‡æ ‡</li>
<li>è‡ªèèµ„ç­–ç•¥(self-financing)æ˜¯æŒ‡åœ¨ä¸æ³¨å…¥é¢å¤–èµ„é‡‘çš„æƒ…å†µä¸‹è¿›è¡ŒæŠ•èµ„ç»„åˆè°ƒæ•´.</li>
<li>hedging æ˜¯æŒ‡é€šè¿‡å¯¹å†²ç­–ç•¥æ¥é™ä½é£é™©. <font color="red">å¯¹å†²</font>æŒ‡é€šè¿‡è°ƒæ•´æ ‡çš„èµ„äº§çš„æ•°é‡, ä½¿å¾—æŠ•èµ„ç»„åˆçš„ä»·å€¼å¯¹å¸‚åœºå˜é‡çš„å˜åŒ–ä¸æ•æ„Ÿ.
<ol type="a">
<li>Delta å¯¹å†², æŠ•èµ„ç»„åˆå¯¹æ ‡çš„èµ„äº§ä»·æ ¼çš„ä¸€é˜¶å˜åŠ¨å…ç–«</li>
<li>Delta-Gamma å¯¹å†², æŠ•èµ„ç»„åˆå¯¹æ ‡çš„èµ„äº§ä»·æ ¼çš„äºŒé˜¶å˜åŠ¨å…ç–«</li>
</ol></li>
<li>Dynamic Hedging
<ol type="a">
<li>åŠ¨æ€å¯¹å†²æ˜¯æŒ‡åœ¨æœŸæƒåˆ°æœŸå‰, æ ¹æ®å¸‚åœºå˜åŒ–ä¸æ–­è°ƒæ•´æŠ•èµ„ç»„åˆ, ä»¥ä¿æŒå¯¹å†²æ•ˆæœ.</li>
<li>Deep Hedging æ˜¯æŒ‡ä½¿ç”¨æ·±åº¦å­¦ä¹ æ¨¡å‹æ¥ä¼˜åŒ–åŠ¨æ€å¯¹å†²ç­–ç•¥, é€šè¿‡å­¦ä¹ å†å²æ•°æ®ä¸­çš„æ¨¡å¼æ¥æé«˜å¯¹å†²æ•ˆæœ.</li>
</ol></li>
</ol>
</section>
</section>
<section id="black-merton-scholes" class="level2">
<h2 class="anchored" data-anchor-id="black-merton-scholes">Black-Merton-Scholes</h2>
<p>From the <a href="https://en.wikipedia.org/wiki/Black%E2%80%93Scholes_model">Wikipage</a>:</p>
<ul>
<li><p>The Blackâ€“Scholes or Blackâ€“Scholesâ€“Merton model is a mathematical model for the dynamics of a financial market containing derivative investment instruments. From the partial differential equation in the model, known as the Blackâ€“Scholes equation, one can deduce the Blackâ€“Scholes formula, which gives a theoretical estimate of the price of European-style options and shows that the option has a unique price regardless of the <font color="red">risk of the security</font> and its expected return (instead of replacing the securityâ€™s expected return with the risk-neutral rate). The formula led to a boom in options trading and provided mathematical legitimacy to the activities of the Chicago Board Options Exchange and other options markets around the world. It is widely used, although often with adjustments and corrections, by options market participants.</p></li>
<li><p>The key idea behind the model is to hedge the option by buying and selling the underlying asset in just the right way and, as a consequence, to eliminate risk. This type of hedging is called â€œcontinuously revised delta hedgingâ€ and is the basis of more complicated hedging strategies such as those engaged in by investment banks and hedge funds.</p></li>
<li><p>The Blackâ€“Scholes formula has only one parameter that cannot be directly observed in the market: the average future volatility of the underlying asset, though it can be found from the price of other options. Since the option value (whether put or call) is increasing in this parameter, it can be inverted to produce a â€œvolatility surfaceâ€ (<font color="blue">implied volatility</font>) that is then used to calibrate other models (<font color="blue">(exotic) derivatives</font>), e.g.&nbsp;for OTC derivatives.</p></li>
</ul>
</section>
<section id="the-black-scholes-world" class="level2">
<h2 class="anchored" data-anchor-id="the-black-scholes-world">The Black-Scholes world</h2>
<p>The Blackâ€“Scholes model assumes that the market consists of at least one risky asset, usually called the stock, and one riskless asset, usually called the money market, cash, or bond.</p>
<p>Assumptions on the assets:</p>
<ul>
<li>(riskless rate) The rate of return on the riskless asset is constant and thus called the risk-free interest rate.</li>
<li>(Brownian motion) The instantaneous log return of stock price is a Brownian motion with drift; and we will assume its drift and volatility are constant (if they are time-varying, we can deduce a suitably modified Blackâ€“Scholes formula quite simply, as long as the volatility is not random). As a result, the stock price follows a geometric Brownian motion.</li>
<li>The stock does not pay dividend.</li>
</ul>
<p>Assumptions on the market:</p>
<ul>
<li>There exists no arbitrage opportunity.</li>
<li>It is possible to borrow and lend any amount, even fractional, of cash at the riskless rate.</li>
<li>It is possible to buy and sell any amount, even fractional, of the stock, including short selling.</li>
<li>Frictionless market: the transactions do not incur any fees or costs.</li>
</ul>
</section>
<section id="black-scholes-model" class="level2">
<h2 class="anchored" data-anchor-id="black-scholes-model">Black-Scholes model</h2>
<p>Assume the price of the underlying asset follows the stochastic differential equation</p>
<p><span class="math display">\[
\frac{\mathrm{d}S_t}{S_t} = \mu \mathrm{d}t + \sigma \mathrm{d}W_t,
\]</span></p>
<p>where</p>
<ul>
<li><span class="math inline">\(\mu\)</span>: (constant) expected return</li>
<li><span class="math inline">\(\sigma\)</span>: (constant) volatility</li>
<li><span class="math inline">\(W_t\)</span>: standard Brownian motion</li>
</ul>
<p>For each time <span class="math inline">\(t\)</span>, <span class="math inline">\(S_t\)</span> is log-normally distributed. More precisely,</p>
<p><span class="math display">\[
S_t \sim S_0 \exp\left[\left(\mu - \frac{\sigma^2}{2}\right)t + \sigma \sqrt t Z \right]
\]</span></p>
<p>where <span class="math inline">\(Z\)</span> is a standard normal random variable.</p>
<section id="note" class="level4">
<h4 class="anchored" data-anchor-id="note">Note</h4>
<p><span class="math inline">\(S_t\)</span> has the closed form expression</p>
<p><span class="math display">\[
S_t = S_0 e^{\left(\mu - \frac{\sigma^2}2 \right) t+ \sigma W_t}
\]</span></p>
<p>and is also referred to as a <em>geometric Brownian motion</em>.</p>
<p>The price can never be negative, i.e., <span class="math inline">\(S_t \geq 0\)</span> for all <span class="math inline">\(t \geq 0\)</span>.</p>
</section>
</section>
<section id="pricing-under-the-black-scholes-model" class="level2">
<h2 class="anchored" data-anchor-id="pricing-under-the-black-scholes-model">Pricing under the Black-Scholes model</h2>
<p>Assume the price of a call option <span class="math inline">\(C\)</span> is a (smooth enough) function of the calendar time <span class="math inline">\(t\)</span> and the underlying asset <span class="math inline">\(S\)</span>. Consider the portfolio <span class="math inline">\(\Pi\)</span> consisting of selling a call option and holding <span class="math inline">\(\Delta\)</span> shares of <span class="math inline">\(S\)</span>.</p>
<ul>
<li><p>The value of <span class="math inline">\(\Pi\)</span> at time <span class="math inline">\(t\)</span> is <span class="math display">\[
\Pi_t =  -C(t, S_t) + \Delta S_t
\]</span></p></li>
<li><p><font color="blue"> Self-financing strategy </font></p></li>
</ul>
<p><span class="math display">\[
\mathrm{d} \Pi_t =  -\mathrm{d}C_t + \Delta \mathrm{d}S_t
\]</span></p>
<ul>
<li>The change of call price is given by</li>
</ul>
<p><span class="math display">\[\begin{equation}
\begin{aligned}
  \mathrm{d}C(t, S_t) &amp;= C_t \, \mathrm{d}t + C_S \, \mathrm{d}S_t + \frac{1}{2} C_{SS} (\mathrm{d}S_t)^2 \\
             &amp;= C_S \sigma S \, \mathrm{d}W_t + \left( C_t + \frac{1}{2} \sigma^2 S^2 C_{SS} + \mu S C_S \right) \mathrm{d}t
\end{aligned}
\end{equation}\]</span></p>
<ul>
<li>Hence the infinitesimal change of <span class="math inline">\(\Pi\)</span> at time <span class="math inline">\(t\)</span> is</li>
</ul>
<p><span class="math display">\[\begin{equation}
\begin{aligned}
  \mathrm{d} \Pi_t &amp;= -\mathrm{d}C_t + \Delta \, \mathrm{d}S_t \\
          &amp;= -\left[ C_t + \frac{1}{2} \sigma^2 S^2 C_{SS} + \mu S (C_S - \Delta) \right] \mathrm{d}t - \sigma S (C_S - \Delta) \, \mathrm{d}W_t
\end{aligned}
\end{equation}\]</span></p>
<section id="note-1" class="level4">
<h4 class="anchored" data-anchor-id="note-1">Note</h4>
<p><span class="math inline">\((\mathrm{d}S_t)^2 = \sigma^2 S_t^2 \mathrm{d}t\)</span></p>
<ul>
<li>Let <span class="math inline">\(\Delta = C_S\)</span>, i.e., hold this amount <span class="math inline">\(C_S(t,S_t)\)</span> of underlying assets in the portfolio <span class="math inline">\(\Pi\)</span>. Then the infinitesimal change of <span class="math inline">\(\Pi\)</span> becomes</li>
</ul>
<p><span class="math display">\[
\displaystyle \mathrm{d}\Pi_t = -\left( C_t + \frac12 \sigma^2 S^2 C_{SS} \right) \mathrm{d}t
\]</span></p>
<ul>
<li>On the other hand, with this choice of <span class="math inline">\(\Delta\)</span>, <span class="math inline">\(\Pi\)</span> is riskless (non-random) hence must be like cash in bank account (Arbitrage Pricing Theory), i.e.,</li>
</ul>
<p><span class="math display">\[
\mathrm{d}\Pi_t = r \Pi_t \mathrm{d}t = r(-C + \Delta S) \mathrm{d}t = r(-C + C_S S) \mathrm{d}t,
\]</span></p>
<p>where <span class="math inline">\(r\)</span> is the interest rate.</p>
</section>
</section>
<section id="black-scholes-pde" class="level2">
<h2 class="anchored" data-anchor-id="black-scholes-pde">Black-Scholes PDE</h2>
<p>We conclude that the price <span class="math inline">\(C\)</span> of a call option satisfies</p>
<p><span class="math display">\[\begin{equation}
\begin{aligned}
  \frac{\partial C}{\partial t} + \frac{\sigma^2}{2} S^2 \frac{\partial^2 C}{\partial S^2} + rS \frac{\partial C}{\partial S} - rC = 0,
  \quad \text{for } 0 &lt; S &lt; \infty, \quad 0 \leq t &lt; T
\end{aligned}
\end{equation}\]</span></p>
<p>with terminal condition</p>
<p><span class="math display">\[
C(T,S) = (S - K)^+
\]</span></p>
<p>and boundary conditions</p>
<p><span class="math display">\[\begin{equation}
\begin{aligned}
  &amp;&amp; C(t, 0) = 0, \\
  &amp;&amp; C(t, S) \sim S - K e^{-r(T-t)} \quad \text{as } S \to \infty, \\
  &amp;&amp; \text{or more specifically} \quad \lim_{S \to \infty} \frac{C(t, S)}{S} = 1.
\end{aligned}
\end{equation}\]</span></p>
<section id="note-2" class="level4">
<h4 class="anchored" data-anchor-id="note-2">Note</h4>
<p>The Black-Scholes pricing PDE does not depend on the drift <span class="math inline">\(\mu\)</span>.</p>
<p><span class="math inline">\(C(T,S) = (S-K)^+\)</span> è¡¨ç¤ºæ¬§å¼çœ‹æ¶¨æœŸæƒåœ¨åˆ°æœŸæ—¶(<span class="math inline">\(t= T\)</span>)çš„æ”¯ä»˜å‡½æ•°. è‹¥è‚¡ä»·é«˜äºæ‰§è¡Œä»· <span class="math inline">\(K\)</span>, åˆ™ä»·å€¼æ˜¯å·®é¢; å¦åˆ™å½’é›¶.</p>
<p>è¿™é‡Œçš„ PDE æ˜¯é€šè¿‡ Feynamn-Kac å®šç†å¾—åˆ°çš„:</p>
<p><span class="math display">\[\begin{align*}
\mathrm{d} S_t &amp;= r S_t \mathrm{d} t + \sigma S_t \mathrm{d} W_t \\
C(t,s) &amp;= \Eof{e^{-r(T-t)} (S_T - K)^+ \mid S_t = s}
\end{align*}\]</span></p>
<p>é‚£ä¹ˆ PDE å°±æ˜¯ <span class="math display">\[
\frac{\partial C}{\partial t} + r S \frac{\partial C}{\partial S} + \frac{\sigma^2}{2} S^2 \frac{\partial^2 C}{\partial S^2} - r C = 0.
\]</span></p>
</section>
</section>
<section id="solving-black-scholes-pde" class="level2">
<h2 class="anchored" data-anchor-id="solving-black-scholes-pde">Solving Black-Scholes PDE</h2>
<p><span class="math display">\[
\frac{\p C}{\p t} + \frac{\sigma^2}{2}S^2\frac{\p C^2}{\p S^2} + rS\frac{\p C}{\p S} - rC = 0
\]</span></p>
<ul>
<li><span class="math inline">\(\tau = T - t\)</span></li>
</ul>
<p><span class="math display">\[
\frac{\p C}{\p \tau} = \frac{\sigma^2}{2}S^2\frac{\p C^2}{\p S^2} + rS\frac{\p C}{\p S} - rC
\]</span></p>
<ul>
<li><span class="math inline">\(\xi = \ln S\)</span></li>
</ul>
<p><span class="math display">\[
\frac{\p C}{\p \tau} = \frac{\sigma^2}{2}\frac{\p C^2}{\p \xi^2} + \left( r -\frac{\sigma^2}{2} \right) \frac{\p C}{\p \xi} - rC
\]</span></p>
<ul>
<li><span class="math inline">\(c(\xi,\tau) = e^{r\tau}C(\xi,\tau)\)</span></li>
</ul>
<p><span class="math display">\[
\frac{\p c}{\p \tau} = \frac{\sigma^2}{2}\frac{\p c^2}{\p \xi^2} + \left( r -\frac{\sigma^2}{2} \right) \frac{\p c}{\p \xi}
\]</span></p>
<ul>
<li><span class="math inline">\(\displaystyle x = \xi + \left( r - \frac{\sigma^2}{2} \right) \tau\)</span></li>
</ul>
<p><span class="math display">\[
\frac{\p c}{\p \tau} = \frac{\sigma^2}{2} \frac{\p^2 c}{\p x^2}
\]</span></p>
<p>In total, we have done the transformation</p>
<p><span class="math display">\[\begin{equation}
\begin{aligned}
  \tau &amp;= T - t, \\
  x &amp;= \ln S + \left( r - \frac{\sigma^2}{2} \right) (T - t), \\
  c &amp;= e^{r(T-t)} C.
\end{aligned}
\end{equation}\]</span></p>
<p>which transforms Black-Scholes equation into heat equation.</p>
</section>
<section id="the-black-scholes-formula" class="level2">
<h2 class="anchored" data-anchor-id="the-black-scholes-formula">The Black-Scholes formula</h2>
<ul>
<li>For call option</li>
</ul>
<p><span class="math display">\[
C = S e^{-d\tau} N(d_1) - K e^{-r\tau} N(d_2)
\]</span></p>
<p>where <span class="math inline">\(\tau\)</span> is time to expiry, <span class="math inline">\(N(\cdot)\)</span> denotes the cdf for standard normal, and</p>
<p><span class="math display">\[
d_1 = \frac{\log\left(\frac{Se^{-d\tau}}{Ke^{-r\tau}}\right)}{\sigma\sqrt\tau}+ \frac{\sigma\sqrt\tau}2, \qquad d_2 = d_1 - \sigma \sqrt\tau
\]</span></p>
<p>æ³¨:</p>
<table class="caption-top table">
<thead>
<tr class="header">
<th>Term</th>
<th>Economic meaning</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><span class="math inline">\(S e^{-d\tau} N(d_1)\)</span></td>
<td>Dividend discounted stock price</td>
</tr>
<tr class="even">
<td><span class="math inline">\(K e^{-r\tau}\)</span></td>
<td>Present value of strike price</td>
</tr>
<tr class="odd">
<td><span class="math inline">\(N(d_2)\)</span></td>
<td>The probability of the option expires in the money.</td>
</tr>
</tbody>
</table>
<p>æ³¨: in the money = å®å€¼, at the money = å¹³å€¼, out of the money = è™šå€¼.</p>
<p>in the money = the option is worth exercising at expiry, i.e., <span class="math inline">\(S_T &gt; K\)</span>.</p>
<p>The <span class="math inline">\(N(d_1)\)</span> is the factor by which the present value of contingent(æœ‰æ¡ä»¶çš„) receipt(æ”¶å…¥) of the stock, contingent on exercise, exceeds the current value of the stock.</p>
<p>The <span class="math inline">\(N(d_2)\)</span> is the risk-adjusted probability of exercise.</p>
<ul>
<li>For put option</li>
</ul>
<p><span class="math display">\[
P = K e^{-r\tau} N(-d_2) - S e^{-d\tau} N(-d_1).
\]</span></p>
<p><span class="math inline">\(\tau = T - t\)</span></p>
<section id="note-3" class="level3">
<h3 class="anchored" data-anchor-id="note-3">Note</h3>
<ul>
<li><p>Put-call parity</p>
<p><span class="math display">\[
  C - P = S e^{-d\tau} - K e^{-r\tau}.
  \]</span></p></li>
<li><p>Financial meaning of <span class="math inline">\(N(d_1)\)</span> and <span class="math inline">\(N(d_2)\)</span></p></li>
</ul>
<div id="cell-14" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> numpy <span class="im">import</span> exp, log, sqrt</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> scipy.stats <span class="im">import</span> norm</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-15" class="cell" data-execution_count="2">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>norm.rvs(size<span class="op">=</span><span class="dv">10</span>) <span class="co"># generate samples from standard normal </span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>norm.cdf <span class="co"># cdf of standard normal</span></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>norm.pdf <span class="co"># pdf for standard normal</span></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>norm.ppf <span class="co"># quantile funciton</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="2">
<pre><code>&lt;bound method rv_continuous.ppf of &lt;scipy.stats._continuous_distns.norm_gen object at 0x0000020A9875EE10&gt;&gt;</code></pre>
</div>
</div>
<div id="cell-16" class="cell" data-execution_count="3">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(norm.cdf(<span class="dv">0</span>)) <span class="co"># This is N(0) in our notation</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>norm.cdf((<span class="op">-</span><span class="dv">9</span>, <span class="op">-</span><span class="dv">2</span>, <span class="op">-</span><span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">4</span>, <span class="dv">9</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>0.5</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="3">
<pre><code>array([1.12858841e-19, 2.27501319e-02, 1.58655254e-01, 5.00000000e-01,
       8.41344746e-01, 9.77249868e-01, 9.98650102e-01, 9.99968329e-01,
       1.00000000e+00])</code></pre>
</div>
</div>
<div id="cell-17" class="cell" data-execution_count="4">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="co"># plot cdf and pdf for standard normal</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>x <span class="op">=</span> np.linspace(<span class="op">-</span><span class="dv">3</span>, <span class="dv">3</span>, <span class="dv">201</span>)</span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>y <span class="op">=</span> norm.cdf(x)</span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">9</span>, <span class="dv">6</span>))</span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">'Standard normal CDF and PDF'</span>, fontsize<span class="op">=</span><span class="dv">20</span>)</span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>plt.plot(x, y, lw<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a>y <span class="op">=</span> norm.pdf(x)</span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a>plt.plot(x, y, color<span class="op">=</span><span class="st">'green'</span>, ls<span class="op">=</span><span class="st">'dashdot'</span>, lw<span class="op">=</span><span class="dv">3</span>)<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="NSD_Lec03-BlackMertonScholes-1_Summer2025_files/figure-html/cell-5-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<div id="cell-18" class="cell" data-execution_count="5">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Black-Scholes formulas</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a><span class="co"># call</span></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a><span class="co"># t is tau in the formula above</span></span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> bs_call(s, K, sigma, t, r<span class="op">=</span><span class="dv">0</span>, d<span class="op">=</span><span class="dv">0</span>):</span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>    d1 <span class="op">=</span> (log(s<span class="op">/</span>K) <span class="op">+</span> (r <span class="op">-</span> d)<span class="op">*</span>t)<span class="op">/</span>(sigma<span class="op">*</span>sqrt(t)) <span class="op">+</span> sigma<span class="op">*</span>sqrt(t)<span class="op">/</span><span class="dv">2</span></span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a>    d2 <span class="op">=</span> d1 <span class="op">-</span> sigma<span class="op">*</span>sqrt(t)</span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a>    c <span class="op">=</span> s<span class="op">*</span>exp(<span class="op">-</span>d<span class="op">*</span>t)<span class="op">*</span>norm.cdf(d1) <span class="op">-</span> K<span class="op">*</span>exp(<span class="op">-</span>r<span class="op">*</span>t)<span class="op">*</span>norm.cdf(d2)</span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a>    delta <span class="op">=</span> exp(<span class="op">-</span>d<span class="op">*</span>t)<span class="op">*</span>norm.cdf(d1)</span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a>    gamma <span class="op">=</span> exp(<span class="op">-</span>d<span class="op">*</span>t)<span class="op">*</span>norm.pdf(d1)<span class="op">/</span>s<span class="op">/</span>sigma<span class="op">/</span>sqrt(t)</span>
<span id="cb8-11"><a href="#cb8-11" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb8-12"><a href="#cb8-12" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> {<span class="st">'c'</span>: c, <span class="st">'delta'</span>: delta, <span class="st">'gamma'</span>: gamma}</span>
<span id="cb8-13"><a href="#cb8-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-14"><a href="#cb8-14" aria-hidden="true" tabindex="-1"></a><span class="co">#put</span></span>
<span id="cb8-15"><a href="#cb8-15" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> bs_put(s, K, sigma, t, r<span class="op">=</span><span class="dv">0</span>, d<span class="op">=</span><span class="dv">0</span>):</span>
<span id="cb8-16"><a href="#cb8-16" aria-hidden="true" tabindex="-1"></a>    d1 <span class="op">=</span> (log(s<span class="op">/</span>K) <span class="op">+</span> (r <span class="op">-</span> d)<span class="op">*</span>t)<span class="op">/</span>(sigma<span class="op">*</span>sqrt(t)) <span class="op">+</span> sigma<span class="op">*</span>sqrt(t)<span class="op">/</span><span class="dv">2</span></span>
<span id="cb8-17"><a href="#cb8-17" aria-hidden="true" tabindex="-1"></a>    d2 <span class="op">=</span> d1 <span class="op">-</span> sigma<span class="op">*</span>sqrt(t)</span>
<span id="cb8-18"><a href="#cb8-18" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb8-19"><a href="#cb8-19" aria-hidden="true" tabindex="-1"></a>    p <span class="op">=</span> K<span class="op">*</span>exp(<span class="op">-</span>r<span class="op">*</span>t)<span class="op">*</span>norm.cdf(<span class="op">-</span>d2) <span class="op">-</span> s<span class="op">*</span>exp(<span class="op">-</span>d<span class="op">*</span>t)<span class="op">*</span>norm.cdf(<span class="op">-</span>d1)</span>
<span id="cb8-20"><a href="#cb8-20" aria-hidden="true" tabindex="-1"></a>    delta <span class="op">=</span> <span class="op">-</span>exp(<span class="op">-</span>d<span class="op">*</span>t)<span class="op">*</span>norm.cdf(<span class="op">-</span>d1)</span>
<span id="cb8-21"><a href="#cb8-21" aria-hidden="true" tabindex="-1"></a>    gamma <span class="op">=</span> exp(<span class="op">-</span>d<span class="op">*</span>t)<span class="op">*</span>norm.pdf(d1)<span class="op">/</span>s<span class="op">/</span>sigma<span class="op">/</span>sqrt(t)</span>
<span id="cb8-22"><a href="#cb8-22" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb8-23"><a href="#cb8-23" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> {<span class="st">'p'</span>: p, <span class="st">'delta'</span>: delta, <span class="st">'gamma'</span>: gamma}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-19" class="cell" data-execution_count="6">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(bs_call(K<span class="op">=</span><span class="dv">100</span>, s<span class="op">=</span><span class="dv">100</span>, sigma<span class="op">=</span><span class="fl">0.3</span>, t<span class="op">=</span><span class="dv">1</span>))</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(bs_call(K<span class="op">=</span><span class="dv">100</span>, s<span class="op">=</span><span class="dv">102</span>, sigma<span class="op">=</span><span class="fl">0.3</span>, t<span class="op">=</span><span class="dv">1</span>))</span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(bs_call(K<span class="op">=</span><span class="dv">100</span>, s<span class="op">=</span><span class="dv">100</span>, t<span class="op">=</span><span class="dv">1</span>, sigma<span class="op">=</span><span class="fl">.3</span>, r<span class="op">=</span><span class="fl">0.05</span>))</span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(bs_call(s<span class="op">=</span><span class="dv">100</span>, K<span class="op">=</span><span class="dv">90</span>, t<span class="op">=</span><span class="dv">1</span>, sigma<span class="op">=</span><span class="fl">.3</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>{'c': 11.923538474048499, 'delta': 0.5596176923702425, 'gamma': 0.013149311030262966}
{'c': 13.068803286156744, 'delta': 0.5855095394527341, 'gamma': 0.012736690514019119}
{'c': 14.231254785985826, 'delta': 0.6242517279060125, 'gamma': 0.012647764437231514}
{'c': 17.0128799018497, 'delta': 0.6918854176337346, 'gamma': 0.011728453149086748}</code></pre>
</div>
</div>
<div id="cell-20" class="cell" data-execution_count="7">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="co"># option price as a function of the underlying</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>K, sig, T, r <span class="op">=</span> <span class="dv">100</span>, <span class="fl">0.3</span>, <span class="dv">1</span>, <span class="fl">0.05</span> <span class="co">#0.02</span></span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a><span class="co"># payoffs of call and put</span></span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>payoff_c <span class="op">=</span> <span class="kw">lambda</span> s, k: (s <span class="op">-</span> k)<span class="op">*</span>(s <span class="op">&gt;</span> k)</span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a>payoff_p <span class="op">=</span> <span class="kw">lambda</span> s, k: (k <span class="op">-</span> s)<span class="op">*</span>(k <span class="op">&gt;</span> s)</span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a><span class="co"># some temp functions</span></span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a>tmpc <span class="op">=</span> <span class="kw">lambda</span> x: bs_call(x, K, sig, T, r)[<span class="st">'c'</span>]</span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a>tmpp <span class="op">=</span> <span class="kw">lambda</span> x: bs_put(x, K, sig, T, r)[<span class="st">'p'</span>]</span>
<span id="cb11-11"><a href="#cb11-11" aria-hidden="true" tabindex="-1"></a>tmp_payoff_c <span class="op">=</span> <span class="kw">lambda</span> x: payoff_c(x, K)</span>
<span id="cb11-12"><a href="#cb11-12" aria-hidden="true" tabindex="-1"></a>tmp_payoff_p <span class="op">=</span> <span class="kw">lambda</span> x: payoff_p(x, K)</span>
<span id="cb11-13"><a href="#cb11-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-14"><a href="#cb11-14" aria-hidden="true" tabindex="-1"></a><span class="co"># plot</span></span>
<span id="cb11-15"><a href="#cb11-15" aria-hidden="true" tabindex="-1"></a>x <span class="op">=</span> np.linspace(<span class="dv">50</span>, <span class="dv">150</span>, <span class="dv">201</span>)</span>
<span id="cb11-16"><a href="#cb11-16" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">15</span>, <span class="dv">6</span>))</span>
<span id="cb11-17"><a href="#cb11-17" aria-hidden="true" tabindex="-1"></a>plt.subplot(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">1</span>)</span>
<span id="cb11-18"><a href="#cb11-18" aria-hidden="true" tabindex="-1"></a>y <span class="op">=</span> tmpc(x)</span>
<span id="cb11-19"><a href="#cb11-19" aria-hidden="true" tabindex="-1"></a>plt.plot(x, y, label<span class="op">=</span><span class="st">'Black-Scholes'</span>)</span>
<span id="cb11-20"><a href="#cb11-20" aria-hidden="true" tabindex="-1"></a>y <span class="op">=</span> tmp_payoff_c(x)</span>
<span id="cb11-21"><a href="#cb11-21" aria-hidden="true" tabindex="-1"></a>plt.plot(x, y, color<span class="op">=</span><span class="st">'red'</span>, ls<span class="op">=</span><span class="st">'dashed'</span>, label<span class="op">=</span><span class="st">'payoff'</span>)</span>
<span id="cb11-22"><a href="#cb11-22" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="vs">r'</span><span class="dv">$</span><span class="vs">S</span><span class="dv">$</span><span class="vs">'</span>, fontsize<span class="op">=</span><span class="dv">15</span>)</span>
<span id="cb11-23"><a href="#cb11-23" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">'call price'</span>, fontsize<span class="op">=</span><span class="dv">15</span>)</span>
<span id="cb11-24"><a href="#cb11-24" aria-hidden="true" tabindex="-1"></a>plt.legend()</span>
<span id="cb11-25"><a href="#cb11-25" aria-hidden="true" tabindex="-1"></a>plt.subplot(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">2</span>)</span>
<span id="cb11-26"><a href="#cb11-26" aria-hidden="true" tabindex="-1"></a>y <span class="op">=</span> tmpp(x)</span>
<span id="cb11-27"><a href="#cb11-27" aria-hidden="true" tabindex="-1"></a>plt.plot(x, y, label<span class="op">=</span><span class="st">'Black-Scholes'</span>)</span>
<span id="cb11-28"><a href="#cb11-28" aria-hidden="true" tabindex="-1"></a>y <span class="op">=</span> tmp_payoff_p(x)</span>
<span id="cb11-29"><a href="#cb11-29" aria-hidden="true" tabindex="-1"></a>plt.plot(x, y, color<span class="op">=</span><span class="st">'red'</span>, ls<span class="op">=</span><span class="st">'dashed'</span>, label<span class="op">=</span><span class="st">'payoff'</span>)</span>
<span id="cb11-30"><a href="#cb11-30" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="vs">r'</span><span class="dv">$</span><span class="vs">S</span><span class="dv">$</span><span class="vs">'</span>, fontsize<span class="op">=</span><span class="dv">15</span>)</span>
<span id="cb11-31"><a href="#cb11-31" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">'put price'</span>, fontsize<span class="op">=</span><span class="dv">15</span>)</span>
<span id="cb11-32"><a href="#cb11-32" aria-hidden="true" tabindex="-1"></a>plt.legend()<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="NSD_Lec03-BlackMertonScholes-1_Summer2025_files/figure-html/cell-8-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<div id="cell-21" class="cell" data-execution_count="8">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="co"># option price as a function of strike</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>s, sig, T <span class="op">=</span> <span class="dv">100</span>, <span class="fl">0.3</span>, <span class="dv">1</span></span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>tmpc <span class="op">=</span> <span class="kw">lambda</span> x: bs_call(s, x, sig, T)[<span class="st">'c'</span>]</span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>tmpp <span class="op">=</span> <span class="kw">lambda</span> x: bs_put(s, x, sig, T)[<span class="st">'p'</span>]</span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a><span class="co"># plot</span></span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a>x <span class="op">=</span> np.linspace(<span class="dv">50</span>, <span class="dv">150</span>, <span class="dv">201</span>)</span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">15</span>, <span class="dv">6</span>))</span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true" tabindex="-1"></a>plt.subplot(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">1</span>)</span>
<span id="cb12-11"><a href="#cb12-11" aria-hidden="true" tabindex="-1"></a>y <span class="op">=</span> tmpc(x)</span>
<span id="cb12-12"><a href="#cb12-12" aria-hidden="true" tabindex="-1"></a>plt.plot(x, y, label<span class="op">=</span><span class="st">'Black-Scholes'</span>)</span>
<span id="cb12-13"><a href="#cb12-13" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="vs">r'</span><span class="dv">$</span><span class="vs">K</span><span class="dv">$</span><span class="vs">'</span>, fontsize<span class="op">=</span><span class="dv">15</span>)</span>
<span id="cb12-14"><a href="#cb12-14" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">'call price'</span>, fontsize<span class="op">=</span><span class="dv">15</span>)</span>
<span id="cb12-15"><a href="#cb12-15" aria-hidden="true" tabindex="-1"></a>plt.subplot(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">2</span>)</span>
<span id="cb12-16"><a href="#cb12-16" aria-hidden="true" tabindex="-1"></a>y <span class="op">=</span> tmpp(x)</span>
<span id="cb12-17"><a href="#cb12-17" aria-hidden="true" tabindex="-1"></a>plt.plot(x, y, label<span class="op">=</span><span class="st">'Black-Scholes'</span>)</span>
<span id="cb12-18"><a href="#cb12-18" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="vs">r'</span><span class="dv">$</span><span class="vs">K</span><span class="dv">$</span><span class="vs">'</span>, fontsize<span class="op">=</span><span class="dv">15</span>)</span>
<span id="cb12-19"><a href="#cb12-19" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">'put price'</span>, fontsize<span class="op">=</span><span class="dv">15</span>)<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="NSD_Lec03-BlackMertonScholes-1_Summer2025_files/figure-html/cell-9-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<div id="cell-22" class="cell" data-execution_count="9">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="co"># option price as a function of volatility</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>s, K, T <span class="op">=</span> <span class="dv">100</span>, <span class="dv">95</span>, <span class="dv">1</span></span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>tmpc <span class="op">=</span> <span class="kw">lambda</span> x: bs_call(s, K, x, T)[<span class="st">'c'</span>]</span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a>tmpp <span class="op">=</span> <span class="kw">lambda</span> x: bs_put(s, K, x, T)[<span class="st">'p'</span>]</span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a><span class="co"># plot</span></span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a>x <span class="op">=</span> np.linspace(<span class="fl">0.05</span>, <span class="fl">1.5</span>, <span class="dv">201</span>)</span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">15</span>, <span class="dv">6</span>))</span>
<span id="cb13-10"><a href="#cb13-10" aria-hidden="true" tabindex="-1"></a>plt.subplot(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">1</span>)</span>
<span id="cb13-11"><a href="#cb13-11" aria-hidden="true" tabindex="-1"></a>y <span class="op">=</span> tmpc(x)</span>
<span id="cb13-12"><a href="#cb13-12" aria-hidden="true" tabindex="-1"></a>plt.plot(x, y, label<span class="op">=</span><span class="st">'Black-Scholes'</span>)</span>
<span id="cb13-13"><a href="#cb13-13" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="vs">r'</span><span class="dv">$\s</span><span class="vs">igma</span><span class="dv">$</span><span class="vs">'</span>, fontsize<span class="op">=</span><span class="dv">15</span>)</span>
<span id="cb13-14"><a href="#cb13-14" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">'call price'</span>, fontsize<span class="op">=</span><span class="dv">15</span>)</span>
<span id="cb13-15"><a href="#cb13-15" aria-hidden="true" tabindex="-1"></a>plt.subplot(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">2</span>)</span>
<span id="cb13-16"><a href="#cb13-16" aria-hidden="true" tabindex="-1"></a>y <span class="op">=</span> tmpp(x)</span>
<span id="cb13-17"><a href="#cb13-17" aria-hidden="true" tabindex="-1"></a>plt.plot(x, y, label<span class="op">=</span><span class="st">'Black-Scholes'</span>)</span>
<span id="cb13-18"><a href="#cb13-18" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="vs">r'</span><span class="dv">$\s</span><span class="vs">igma</span><span class="dv">$</span><span class="vs">'</span>, fontsize<span class="op">=</span><span class="dv">15</span>)</span>
<span id="cb13-19"><a href="#cb13-19" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">'put price'</span>, fontsize<span class="op">=</span><span class="dv">15</span>)<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="NSD_Lec03-BlackMertonScholes-1_Summer2025_files/figure-html/cell-10-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<div id="cell-23" class="cell" data-execution_count="10">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="co"># option price as a function of time to expiry</span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>s, K, sigma <span class="op">=</span> <span class="dv">100</span>, <span class="dv">102</span>, <span class="fl">0.3</span></span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a>tmpc <span class="op">=</span> <span class="kw">lambda</span> x: bs_call(s, K, sigma, x)[<span class="st">'c'</span>]</span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a>tmpp <span class="op">=</span> <span class="kw">lambda</span> x: bs_put(s, K, sigma, x)[<span class="st">'p'</span>]</span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a><span class="co"># plot</span></span>
<span id="cb14-8"><a href="#cb14-8" aria-hidden="true" tabindex="-1"></a>x <span class="op">=</span> np.linspace(<span class="fl">0.01</span>, <span class="dv">2</span>, <span class="dv">201</span>)</span>
<span id="cb14-9"><a href="#cb14-9" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">15</span>, <span class="dv">6</span>))</span>
<span id="cb14-10"><a href="#cb14-10" aria-hidden="true" tabindex="-1"></a>plt.subplot(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">1</span>)</span>
<span id="cb14-11"><a href="#cb14-11" aria-hidden="true" tabindex="-1"></a>y <span class="op">=</span> tmpc(x)</span>
<span id="cb14-12"><a href="#cb14-12" aria-hidden="true" tabindex="-1"></a>plt.plot(x, y, label<span class="op">=</span><span class="st">'Black-Scholes'</span>)</span>
<span id="cb14-13"><a href="#cb14-13" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">'Time to expiry'</span>, fontsize<span class="op">=</span><span class="dv">15</span>)</span>
<span id="cb14-14"><a href="#cb14-14" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">'call price'</span>, fontsize<span class="op">=</span><span class="dv">15</span>)</span>
<span id="cb14-15"><a href="#cb14-15" aria-hidden="true" tabindex="-1"></a>plt.subplot(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">2</span>)</span>
<span id="cb14-16"><a href="#cb14-16" aria-hidden="true" tabindex="-1"></a>y <span class="op">=</span> tmpp(x)</span>
<span id="cb14-17"><a href="#cb14-17" aria-hidden="true" tabindex="-1"></a>plt.plot(x, y, label<span class="op">=</span><span class="st">'Black-Scholes'</span>)</span>
<span id="cb14-18"><a href="#cb14-18" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">'Time to expiry'</span>, fontsize<span class="op">=</span><span class="dv">15</span>)</span>
<span id="cb14-19"><a href="#cb14-19" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">'put price'</span>, fontsize<span class="op">=</span><span class="dv">15</span>)<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="NSD_Lec03-BlackMertonScholes-1_Summer2025_files/figure-html/cell-11-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
</section>
</section>
<section id="the-greeks" class="level2">
<h2 class="anchored" data-anchor-id="the-greeks">The Greeks</h2>
<p>Sensitivities of option prices in Black-Scholes model - the Greeks.</p>
<p>Assume the dividend rate <span class="math inline">\(d = 0\)</span>.</p>
<p>æ³¨: è‚¡åˆ©ç‡(dividend rate) æ˜¯æŒ‡å…¬å¸å‘è‚¡ä¸œæ”¯ä»˜çš„åˆ©æ¶¦åˆ†é…ç‡, åœ¨ Black-Scholes æ¨¡å‹ä¸­é€šå¸¸å‡è®¾ä¸º <span class="math inline">\(0\)</span>.</p>
<ul>
<li>For call:
<ul>
<li><span class="math inline">\(\displaystyle \Delta_C = \frac{\p C}{\p S} = N(d_1)\)</span></li>
<li>Dual <span class="math inline">\(\displaystyle \Delta_C^K = \frac{\p C}{\p K} = -e^{-rT} N(d_2)\)</span></li>
<li><span class="math inline">\(\displaystyle \Gamma = \frac{\p^2 C}{\p S^2} = \frac{n(d_1)}{S\sigma\sqrt T}\)</span></li>
<li><span class="math inline">\(\displaystyle \Theta_C = \frac{\p C}{\p T} = \frac{S \sigma}{2\sqrt T} n(d_1) + r K e^{-rT} N(d_2)\)</span></li>
<li><span class="math inline">\(\displaystyle \nu \, (\text{vega}) = \frac{\p C}{\p \sigma} = S \sqrt T \, n(d_1)\)</span></li>
<li><span class="math inline">\(\displaystyle \rho_C = \frac{\p C}{\p r} = K T e^{-rT} N(d_2)\)</span></li>
</ul></li>
<li>For put:
<ul>
<li><span class="math inline">\(\displaystyle \Delta_P = \frac{\p P}{\p S} = \Delta_C - 1 = -N(-d_1)\)</span></li>
<li>Dual <span class="math inline">\(\displaystyle \Delta_P^K = \frac{\p P}{\p K} = \Delta_C^K + e^{-r T} = e^{-rT} N(-d_2)\)</span></li>
<li><span class="math inline">\(\displaystyle \Gamma = \frac{\p^2 P}{\p S^2} = \frac{\p^2 C}{\p S^2}\)</span></li>
<li><span class="math inline">\(\displaystyle \Theta_P = \frac{\p P}{\p T} = \Theta_C - r e^{-rT} K = \frac{S \sigma}{2\sqrt T} n(d_1) - r K e^{-rT} N(-d_2)\)</span></li>
<li><span class="math inline">\(\displaystyle \nu \, (\text{vega}) = \frac{\p P}{\p \sigma} = \frac{\p C}{\p \sigma} = S \sqrt T n(d_1)\)</span></li>
<li><span class="math inline">\(\displaystyle \rho_P = \frac{\p P}{\p r} = \rho_C - T e^{-rT} K = -K T e^{-rT} N(-d_2)\)</span></li>
</ul></li>
</ul>
<section id="note-4" class="level4">
<h4 class="anchored" data-anchor-id="note-4">Note</h4>
<ul>
<li><span class="math inline">\(n(x) = N'(x)\)</span> is the pdf for standard normal.</li>
<li><span class="math inline">\(\Theta_C &gt; 0\)</span>, whereas <span class="math inline">\(\Theta_P\)</span> may be negative if <span class="math inline">\(r &gt; 0\)</span>.</li>
</ul>
</section>
</section>
<section id="subtlety-in-self-financing" class="level2">
<h2 class="anchored" data-anchor-id="subtlety-in-self-financing">Subtlety in self-financing</h2>
<p>æ³¨: Subtlety = åŒºåˆ«. æ­¤å¤„æ¢è®¨ä¸¤ç§æƒ…å†µä¹‹ç»†å¾®åŒºåˆ«:</p>
<ul>
<li>æŠ•èµ„è€…åœ¨æ¯ä¸ªæ—¶é—´æ­¥å…ˆè°ƒæ•´æŠ•èµ„ç»„åˆ</li>
<li>æŠ•èµ„è€…å…ˆè§‚å¯Ÿå¸‚åœºä»·æ ¼å˜åŒ–åå†è°ƒæ•´</li>
</ul>
<p>Assume that all the tradings are done at the mid price <span class="math inline">\(S_t\)</span>, i.e., no bid-ask spread and transaction cost.</p>
<p>æ³¨: mid price = ä¸­é—´ä»·, å³ä¹°å…¥ä»·å’Œå–å‡ºä»·çš„å¹³å‡å€¼. åœ¨å®é™…äº¤æ˜“ä¸­, ç”±äºå­˜åœ¨ä¹°å–å·®ä»·(bid-ask spread)å’Œäº¤æ˜“æˆæœ¬, mid price æ˜¯ä¸€ä¸ªç†æƒ³åŒ–çš„å‡è®¾.</p>
<p>In a discrete time setting, consider a portfolio consisting of holding <span class="math inline">\(H_t\)</span> shares of the underlying and <span class="math inline">\(K_t\)</span> dollars in the money/cash account at time <span class="math inline">\(t\)</span>, interest and dividend are assumed zero for simplicity.</p>
<p>The monetary value <span class="math inline">\(V_t\)</span> of the portfolio, <em>marked to market value at the mid price</em>, is thus given by <span class="math inline">\(V_t = H_tS_t + K_t\)</span> (before the price of the underlying changes from <span class="math inline">\(S_t\)</span> to <span class="math inline">\(S_{t+1}\)</span>). At this point, the investor may decide to change his portfolio before he observes the price change of the underlying from <span class="math inline">\(S_t\)</span> to <span class="math inline">\(S_{t+1}\)</span> or after the price change.</p>
<ul>
<li><em>Before price change</em>. In this case, the self-financing condition reads <span class="math display">\[
V_t = H_t S_t + K_t = H_{t+1} S_t + K_{t+1},
\]</span> where apparently <span class="math inline">\(K_{t+1} = K_t + (H_t - H_{t+1}) S_t\)</span>. In other words, the investor simply moves his money from stock to money account (or the other way around) without pouring/withdrawing extra money/shares into/out of the portfolio. The value of the portfolio (after price change) at time <span class="math inline">\(t+1\)</span> is given by <span class="math inline">\(V_{t+1} = H_{t+1}S_{t+1} + K_{t+1}\)</span>. Hence,</li>
</ul>
<p><span class="math display">\[
\begin{aligned}
  \Delta V_{t+1} &amp;= V_{t+1} - V_t \\
                 &amp;= H_{t+1} S_{t+1} + K_{t+1} - (H_t S_t + K_t) \\
                 &amp;= H_{t+1} S_{t+1} + K_{t+1} - (H_{t+1} S_t + K_{t+1}) \\
                 &amp;= H_{t+1} \Delta S_{t+1}.
\end{aligned}
\]</span></p>
<p>If we write <span class="math inline">\(H_{t+1} = H_t + \Delta H_{t+1}\)</span>, then</p>
<p><span class="math display">\[
\Delta V_{t+1} = H_t \Delta S_{t+1} + \Delta H_{t+1} \Delta S_{t+1}
\]</span></p>
<ul>
<li><em>After price change</em>. In this case, the self-financing condition becomes <span class="math display">\[
V_{t+1} = H_t S_{t+1} + K_t = H_{t+1} S_{t+1} + K_{t+1},
\]</span> where <span class="math inline">\(K_{t+1} = K_t + (H_t - H_{t+1}) S_{t+1}\)</span>. Hence, <span class="math display">\[
\begin{aligned}
\Delta V_{t+1} &amp;= V_{t+1} - V_t \\
               &amp;= H_{t+1} S_{t+1} + K_{t+1} - (H_t S_t + K_t) \\
               &amp;= H_{t+1} S_{t+1} + K_t + (H_t - H_{t+1}) S_{t+1} - (H_t S_t + K_t) \\
               &amp;= H_t \Delta S_{t+1}.
\end{aligned}
\]</span></li>
</ul>
<p>The subtlety results from the investorâ€™s decision to rebalance his position before or after he observes the price change. Moreover, the discrepancy between the two increments of portfolio values is exactly the covariation between the holdings <span class="math inline">\(H_t\)</span> and the price <span class="math inline">\(S_t\)</span> of the underlying. In the continuous time limit, the discrepancy becomes insignificant should the covariation vanishes in the continuous time limit. In a recent paper by Carmona and Webster, the authors argued that, in the high frequency trading regime, empirically this covariation is statistically significant. As a result, the process of holdings <span class="math inline">\(H_t\)</span> cannot be of finite variation, counterintuitive to common knowledge.</p>
<blockquote class="blockquote">
<p>å³ä½¿åœ¨â€œæ— äº¤æ˜“æˆæœ¬â€çš„ç†æƒ³æ¨¡å‹ä¸­, æŠ•èµ„è€…è°ƒä»“çš„æ—¶æœºé€‰æ‹©ä¼šå¯¹ç»„åˆä»·å€¼å˜åŒ–äº§ç”Ÿä¸åŒå½±å“, è¿™ç§ç»†å¾®å·®å¼‚åœ¨è¿ç»­æ—¶é—´æé™ä¸­é€šå¸¸è¢«å¿½ç•¥, ä½†åœ¨é«˜é¢‘å¸‚åœºä¸­å´éå¸¸é‡è¦, å› ä¸ºå®é™…æŒä»“è·¯å¾„å’Œä»·æ ¼å˜åŠ¨ä¹‹é—´çš„åå˜å¹¶ä¸ä¸ºé›¶.</p>
</blockquote>
</section>
<section id="self-financing-with-traded-price" class="level2">
<h2 class="anchored" data-anchor-id="self-financing-with-traded-price">Self-financing with traded price</h2>
<p>In reality, trading incurs transaction cost which consist of bid-ask spread, fees, and taxes. The self-financing conditions with transaction cost becomes</p>
<ul>
<li><p><em>Before price change</em>. <span class="math display">\[
V_t = H_t S_t + K_t = H_{t+1} S_t + K_{t+1} ,
\]</span> where <span class="math inline">\(K_{t+1} = K_t + (H_t - H_{t+1})S_t - c_t\)</span> and <span class="math inline">\(c_t &gt; 0\)</span> denotes the transaction cost at time <span class="math inline">\(t\)</span>. Hence, the increment of <span class="math inline">\(V\)</span> at time <span class="math inline">\(t+1\)</span> <span class="math display">\[
\begin{aligned}
\Delta V_{t+1} &amp;= V_{t+1} - V_t \\
               &amp;= H_{t+1} S_{t+1} + K_t + (H_t - H_{t+1}) S_t - c_t - (H_t S_t + K_t) \\
               &amp;= H_{t+1} \Delta S_{t+1} - c_t \\
               &amp;= H_t \Delta S_{t+1} + \Delta H_{t+1} \Delta S_{t+1} - c_t.
\end{aligned}
\]</span></p></li>
<li><p><em>After price change</em>. By the same token, in this case one can show that <span class="math display">\[
\Delta V_{t+1} = H_t \Delta S_{t+1} - c_{t+1}
\]</span></p></li>
</ul>
<p>where the transaction cost <span class="math inline">\(c_{t+1}\)</span> is incurred at time <span class="math inline">\(t+1\)</span>.</p>
</section>
<section id="delta-hedging" class="level2">
<h2 class="anchored" data-anchor-id="delta-hedging">Delta hedging</h2>
<p>The portfolio used in deriving the Black-Scholes PDE is called <em>delta-hedging</em>.</p>
<p>åˆ©ç”¨ <a href="#the-greeks">The Greeks</a> å®šä¹‰çš„ <span class="math inline">\(\Delta\)</span>, Delta Hedging å°±æ˜¯æ„å»ºä¸€ä¸ªæŠ•èµ„ç»„åˆ, ä½¿å¾—è¿™ä¸ªç»„åˆæ•´ä½“çš„ <span class="math inline">\(\Delta = 0\)</span>, ä»è€Œä¸å—æ ‡çš„èµ„äº§ä»·æ ¼å°å¹…å˜åŒ–å½±å“.</p>
<p>Example: å‡è®¾ä½ å–å‡ºäº†ä¸€ä¸ªæ¬§å¼çœ‹æ¶¨æœŸæƒ, å…¶ <span class="math inline">\(\Delta = 0.6\)</span>; é‚£ä¹ˆä½ è¦ ä¹°å…¥ 0.6 è‚¡æ ‡çš„èµ„äº§æ¥è¿›è¡Œå¯¹å†².</p>
<section id="note-5" class="level4">
<h4 class="anchored" data-anchor-id="note-5">Note</h4>
<p>Rebalancing of hedging portfolio is done <em>after</em> the price change.</p>
<p>æˆ‘ä»¬è®¾ portfolio ä¸º <span class="math inline">\(\pi = (s,c,o)\)</span>, ä¹Ÿå°±æ˜¯ stock, cash, option.</p>
<p><span class="math display">\[
\pi^{\text{naked}} = (0,0,-1).
\]</span></p>
<p>é‚£ä¹ˆè¿™ä¸ª naked portfolio çš„ä»·å€¼ä¸º <span class="math inline">\(V(\pi^{\text{naked}})=-C\)</span>.</p>
<p>æ‰€ä»¥:</p>
<p><span class="math display">\[
\text{PNL}_{\text{naked}} = V(\pi^{\text{naked}}_{\text{tomorrow}}) - V(\pi^{\text{naked}}_{\text{today}}) = -C_{\text{tomorrow}} + C_{\text{today}}.
\]</span></p>
<p>è‡³äº delta hedging portfolio, æˆ‘ä»¬è®¾ <span class="math inline">\(\pi^{\text{delta}} = (x,0,-1)\)</span>.</p>
<p>é‚£ä¹ˆ:</p>
<p><span class="math display">\[
\Delta_{\pi^{\text{delta}}} = x - 0 - \Delta_C = x - N(d_1).
\]</span></p>
<p>ç”±äº <span class="math inline">\(\Delta_{\pi^{\text{delta}}} = 0\)</span>, æ‰€ä»¥ <span class="math inline">\(x = N(d_1)\)</span>.</p>
<p><span class="math display">\[\begin{align*}
V(\pi^{\text{delta}}_{\text{today}}) &amp;= N(d_1) S_{\text{today}} - C_{\text{today}} \\
V(\pi^{\text{delta}}_{\text{tomorrow}}) &amp;= N(d_1) S_{\text{tomorrow}} - C_{\text{tomorrow}} \\
\text{PNL}_{\text{delta}} &amp;= V(\pi^{\text{delta}}_{\text{tomorrow}}) - V(\pi^{\text{delta}}_{\text{today}}) \\
\end{align*}\]</span></p>
<p>ä¸€ä¸ªæ•°å€¼ä¾‹å­: è®¾ <span class="math inline">\(\pi = (250, 10000, -200)\)</span>.</p>
<p><span class="math display">\[
V_{\pi} = 250 S + 10000 - 200 C = 250 \times 10 + 10000 - 200 \times 0.25 = 12450.
\]</span></p>
<p><span class="math display">\[
\Delta_{\pi} = 250 + 0 - 200 \times 29\% = 192.
\]</span></p>
<p>è¿™å°±æ„å‘³ç€ä½ éœ€è¦å–å‡º 192 çš„è‚¡ç¥¨.</p>
</section>
<section id="an-example-on-delta-hedge" class="level3">
<h3 class="anchored" data-anchor-id="an-example-on-delta-hedge">An example on delta hedge</h3>
<div id="cell-31" class="cell" data-execution_count="11">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>r, sigma <span class="op">=</span> <span class="dv">0</span>, <span class="fl">0.3</span> </span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>s0, K <span class="op">=</span> <span class="dv">10</span>, <span class="dv">11</span></span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>dt <span class="op">=</span> <span class="dv">1</span><span class="op">/</span><span class="dv">252</span> <span class="co"># one day </span></span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a>t <span class="op">=</span> <span class="dv">1</span><span class="op">/</span><span class="dv">4</span> <span class="co"># a quarter of year, 3 month</span></span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a><span class="co"># unpack a dict by using the .values method for dict object</span></span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a>c, delta, _ <span class="op">=</span> bs_call(s0, K, sigma, t, r).values()</span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f'call price = </span><span class="sc">{</span>c<span class="sc">}</span><span class="ss">, delta = </span><span class="sc">{</span>delta<span class="sc">}</span><span class="ss">'</span>) </span>
<span id="cb15-9"><a href="#cb15-9" aria-hidden="true" tabindex="-1"></a>bs_call(s0, K, sigma, t, r)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>call price = 0.25002448066930727, delta = 0.28760290709660397</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="11">
<pre><code>{'c': 0.25002448066930727,
 'delta': 0.28760290709660397,
 'gamma': 0.2273127644037836}</code></pre>
</div>
</div>
<div id="cell-32" class="cell" data-execution_count="12">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(bs_call(s0, K, sigma, t, r))</span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(bs_call(s0, K, sigma, t, r).values())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>{'c': 0.25002448066930727, 'delta': 0.28760290709660397, 'gamma': 0.2273127644037836}
dict_values([0.25002448066930727, 0.28760290709660397, 0.2273127644037836])</code></pre>
</div>
</div>
<div id="cell-33" class="cell" data-execution_count="13">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="co"># a range of underlying prices one day later</span></span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>s <span class="op">=</span> s0 <span class="op">+</span> np.linspace(<span class="op">-</span><span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">21</span>)</span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(s)</span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a>bs_call(s, K, sigma, t<span class="op">-</span>dt, r)[<span class="st">'c'</span>]</span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a>delta<span class="op">*</span>s0 <span class="op">-</span> c</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[ 9.   9.1  9.2  9.3  9.4  9.5  9.6  9.7  9.8  9.9 10.  10.1 10.2 10.3
 10.4 10.5 10.6 10.7 10.8 10.9 11. ]</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="13">
<pre><code>2.6260045902967324</code></pre>
</div>
</div>
<div id="cell-34" class="cell" data-execution_count="14">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a>pnl_naked <span class="op">=</span> c <span class="op">-</span> bs_call(s, K, sigma, t<span class="op">-</span>dt, r)[<span class="st">'c'</span>]</span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a>pnl_delta <span class="op">=</span> delta<span class="op">*</span>s <span class="op">-</span> bs_call(s, K, sigma, t<span class="op">-</span>dt, r)[<span class="st">'c'</span>] <span class="op">-</span> (delta<span class="op">*</span>s0 <span class="op">-</span> c)</span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a>pd.DataFrame({<span class="st">'naked'</span>: pnl_naked, <span class="st">'delta_hedged'</span>: pnl_delta})</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="14">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">naked</th>
<th data-quarto-table-cell-role="th">delta_hedged</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>0.189399</td>
<td>-0.098204</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>0.178589</td>
<td>-0.080254</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>0.166344</td>
<td>-0.063738</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>0.152554</td>
<td>-0.048768</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>0.137110</td>
<td>-0.035452</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">5</td>
<td>0.119905</td>
<td>-0.023896</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">6</td>
<td>0.100837</td>
<td>-0.014204</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">7</td>
<td>0.079807</td>
<td>-0.006474</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">8</td>
<td>0.056725</td>
<td>-0.000796</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">9</td>
<td>0.031504</td>
<td>0.002744</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">10</td>
<td>0.004069</td>
<td>0.004069</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">11</td>
<td>-0.025650</td>
<td>0.003111</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">12</td>
<td>-0.057711</td>
<td>-0.000190</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">13</td>
<td>-0.092164</td>
<td>-0.005883</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">14</td>
<td>-0.129050</td>
<td>-0.014009</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">15</td>
<td>-0.168397</td>
<td>-0.024596</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">16</td>
<td>-0.210225</td>
<td>-0.037664</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">17</td>
<td>-0.254544</td>
<td>-0.053222</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">18</td>
<td>-0.301352</td>
<td>-0.071269</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">19</td>
<td>-0.350638</td>
<td>-0.091795</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">20</td>
<td>-0.402383</td>
<td>-0.114780</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<div id="cell-35" class="cell" data-execution_count="15">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="co"># plot</span></span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">9</span>, <span class="dv">6</span>))</span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a>plt.plot(s, pnl_naked, <span class="st">'o-'</span>, label<span class="op">=</span><span class="st">'Naked call'</span>)</span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a>plt.plot(s, pnl_delta, <span class="st">'o-.'</span>, color<span class="op">=</span><span class="st">'orange'</span>, label<span class="op">=</span><span class="st">'Delta hedged'</span>)</span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a>plt.hlines(y<span class="op">=</span><span class="dv">0</span>, xmin<span class="op">=</span><span class="bu">min</span>(s), xmax<span class="op">=</span><span class="bu">max</span>(s), ls<span class="op">=</span><span class="st">'dashed'</span>)</span>
<span id="cb24-6"><a href="#cb24-6" aria-hidden="true" tabindex="-1"></a>plt.grid(color<span class="op">=</span><span class="st">'grey'</span>, ls<span class="op">=</span><span class="st">'dotted'</span>)</span>
<span id="cb24-7"><a href="#cb24-7" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">'P&amp;L'</span>, fontsize<span class="op">=</span><span class="dv">15</span>)</span>
<span id="cb24-8"><a href="#cb24-8" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="vs">r'</span><span class="dv">$</span><span class="vs">s</span><span class="dv">$</span><span class="vs">'</span>, fontsize<span class="op">=</span><span class="dv">15</span>)</span>
<span id="cb24-9"><a href="#cb24-9" aria-hidden="true" tabindex="-1"></a>plt.legend()<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="NSD_Lec03-BlackMertonScholes-1_Summer2025_files/figure-html/cell-16-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<div id="cell-36" class="cell" data-execution_count="16">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="co"># zoom into the interval [9.5, 10.5]</span></span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">9</span>, <span class="dv">6</span>))</span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a>plt.plot(s, pnl_naked, <span class="st">'o-'</span>, label<span class="op">=</span><span class="st">'Naked call'</span>)</span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a>plt.plot(s, pnl_delta, <span class="st">'o-.'</span>, color<span class="op">=</span><span class="st">'orange'</span>, label<span class="op">=</span><span class="st">'Delta hedged'</span>)</span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true" tabindex="-1"></a>plt.hlines(y<span class="op">=</span><span class="dv">0</span>, xmin<span class="op">=</span><span class="bu">min</span>(s), xmax<span class="op">=</span><span class="bu">max</span>(s), ls<span class="op">=</span><span class="st">'dashed'</span>)</span>
<span id="cb25-6"><a href="#cb25-6" aria-hidden="true" tabindex="-1"></a>plt.grid(color<span class="op">=</span><span class="st">'grey'</span>, ls<span class="op">=</span><span class="st">'dotted'</span>)</span>
<span id="cb25-7"><a href="#cb25-7" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">'P&amp;L'</span>, fontsize<span class="op">=</span><span class="dv">15</span>)</span>
<span id="cb25-8"><a href="#cb25-8" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="vs">r'</span><span class="dv">$</span><span class="vs">s</span><span class="dv">$</span><span class="vs">'</span>, fontsize<span class="op">=</span><span class="dv">15</span>)</span>
<span id="cb25-9"><a href="#cb25-9" aria-hidden="true" tabindex="-1"></a>plt.xlim(<span class="fl">9.5</span>, <span class="fl">10.5</span>)</span>
<span id="cb25-10"><a href="#cb25-10" aria-hidden="true" tabindex="-1"></a>plt.legend()<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="NSD_Lec03-BlackMertonScholes-1_Summer2025_files/figure-html/cell-17-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
</section>
</section>
<section id="an-example-on-delta-gamma-hedge" class="level2">
<h2 class="anchored" data-anchor-id="an-example-on-delta-gamma-hedge">An example on delta-gamma hedge</h2>
<p>Delta-gamma neutral: <span class="math inline">\(\displaystyle \Delta = \frac{\partial C}{\partial S} = 0, \Gamma = \frac{\partial^2 C}{\partial S^2} = 0\)</span>.</p>
<p><span class="math display">\[
\Gamma_{\pi^{\text{naked}}} = -\frac{\partial^2 C}{\partial S^2} = -\Gamma_{\text{call}}.
\]</span></p>
<p>ä¸ºäº†ä¿è¯ <span class="math inline">\(\Gamma = 0\)</span>, æˆ‘ä»¬å¿…é¡»å¼•å…¥å¦ä¸€ä¸ªç”¨æ¥å¯¹å†²çš„ option.</p>
<p><span class="math display">\[
\pi = (\overset{\text{stock}}{x}, \overset{\text{cash}}{y}, \overset{\text{option}}{z}, \overset{\text{hedging option}}{w}).
\]</span></p>
<p><span class="math display">\[\begin{align*}
0 = \Delta_{\pi} &amp;= x + 0 + z \Delta_{\text{call}} + w \Delta_{\text{hedge}} \\
0 = \Gamma_{\pi} &amp;= 0 + 0 + z \Gamma_{\text{call}} + w \Gamma_{\text{hedge}}.
\end{align*}\]</span></p>
<p>æ‰€ä»¥, æˆ‘ä»¬å°±æœ‰: <span class="math inline">\(\displaystyle w = - \frac{\Gamma_{\text{call}}}{\Gamma_{\text{hedge}}}z\)</span>.</p>
<p><font color="blue"> Note </font></p>
<p>The gammas of the underlying and forward are zero. To construct a delta-gamma hedge portfolio we need to add into the portfolio an instrument that has nonzero gamma, say, call or put options.</p>
<blockquote class="blockquote">
<p>Delta-Gamma Hedging æ˜¯æ„é€ ä¸€ä¸ªç»„åˆ, ä½¿å¾—å®ƒå¯¹æ ‡çš„èµ„äº§ä»·æ ¼çš„ä¸€é˜¶å’ŒäºŒé˜¶å˜åŒ–éƒ½ä¸æ•æ„Ÿ.</p>
</blockquote>
<p>ç°åœ¨å‡è®¾æœ‰ <span class="math inline">\(-1\)</span> å•ä½çš„ <span class="math inline">\(C\)</span> (å–å‡º <span class="math inline">\(C\)</span>), <span class="math inline">\(x\)</span> å•ä½çš„ <span class="math inline">\(C_1\)</span> (å¯¹å†²å·¥å…·), <span class="math inline">\(y\)</span> å•ä½çš„æ ‡çš„èµ„äº§ (è¿™é‡Œå°±æ˜¯ stock).</p>
<ul>
<li><p><span class="math inline">\(\displaystyle -\Gamma_C +  x \Gamma_{C_1} = 0  \Longrightarrow x = \frac{\Gamma_C}{\Gamma_{C_1}}\)</span></p></li>
<li><p><span class="math inline">\(\displaystyle C + x C_1 + y S\)</span></p></li>
<li><p><span class="math inline">\(\displaystyle -\Delta_C + x \Delta_{C_1} + y = 0 \Longrightarrow y = \Delta_C - x \Delta_{C_1}\)</span></p></li>
</ul>
<div id="cell-39" class="cell" data-execution_count="17">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a>r, sigma, K, s0 <span class="op">=</span> <span class="dv">0</span>, <span class="fl">0.3</span>, <span class="dv">11</span>, <span class="dv">10</span></span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a>dt, t <span class="op">=</span> <span class="dv">1</span><span class="op">/</span><span class="dv">252</span>, <span class="dv">1</span><span class="op">/</span><span class="dv">4</span></span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a><span class="co"># target call</span></span>
<span id="cb26-5"><a href="#cb26-5" aria-hidden="true" tabindex="-1"></a>c, delta, gamma <span class="op">=</span> bs_call(s0, K, sigma, t, r).values()</span>
<span id="cb26-6"><a href="#cb26-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-7"><a href="#cb26-7" aria-hidden="true" tabindex="-1"></a><span class="co"># call for hedging</span></span>
<span id="cb26-8"><a href="#cb26-8" aria-hidden="true" tabindex="-1"></a>K_hg <span class="op">=</span> <span class="dv">14</span></span>
<span id="cb26-9"><a href="#cb26-9" aria-hidden="true" tabindex="-1"></a>c_hg, delta_hg, gamma_hg <span class="op">=</span> bs_call(s0, K_hg, sigma, t, r).values()</span>
<span id="cb26-10"><a href="#cb26-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-11"><a href="#cb26-11" aria-hidden="true" tabindex="-1"></a><span class="co"># 1 day later</span></span>
<span id="cb26-12"><a href="#cb26-12" aria-hidden="true" tabindex="-1"></a>s <span class="op">=</span> s0 <span class="op">+</span> np.linspace(<span class="op">-</span><span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">21</span>)</span>
<span id="cb26-13"><a href="#cb26-13" aria-hidden="true" tabindex="-1"></a>cs <span class="op">=</span> bs_call(s, K, sigma, t<span class="op">-</span>dt, r)[<span class="st">'c'</span>]</span>
<span id="cb26-14"><a href="#cb26-14" aria-hidden="true" tabindex="-1"></a>pnl_naked <span class="op">=</span> c <span class="op">-</span> cs</span>
<span id="cb26-15"><a href="#cb26-15" aria-hidden="true" tabindex="-1"></a>pnl_delta <span class="op">=</span> delta<span class="op">*</span>s <span class="op">-</span> cs <span class="op">-</span> (delta<span class="op">*</span>s0 <span class="op">-</span> c)</span>
<span id="cb26-16"><a href="#cb26-16" aria-hidden="true" tabindex="-1"></a>delta_dg <span class="op">=</span> delta <span class="op">-</span> gamma<span class="op">/</span>gamma_hg<span class="op">*</span>delta_hg</span>
<span id="cb26-17"><a href="#cb26-17" aria-hidden="true" tabindex="-1"></a>gamma_dg <span class="op">=</span> gamma<span class="op">/</span>gamma_hg</span>
<span id="cb26-18"><a href="#cb26-18" aria-hidden="true" tabindex="-1"></a>pnl_dg <span class="op">=</span> delta_dg<span class="op">*</span>s <span class="op">+</span> gamma_dg<span class="op">*</span>bs_call(s, K_hg, sigma, t<span class="op">-</span>dt, r)[<span class="st">'c'</span>] <span class="op">-</span> cs <span class="op">-</span> (delta_dg<span class="op">*</span>s0 <span class="op">+</span> gamma_dg<span class="op">*</span>c_hg  <span class="op">-</span> c)</span>
<span id="cb26-19"><a href="#cb26-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-20"><a href="#cb26-20" aria-hidden="true" tabindex="-1"></a><span class="co"># pandas.DataFrame for presentation</span></span>
<span id="cb26-21"><a href="#cb26-21" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> pd.DataFrame(np.array([pnl_naked, pnl_delta, pnl_dg]).transpose())</span>
<span id="cb26-22"><a href="#cb26-22" aria-hidden="true" tabindex="-1"></a>df.columns <span class="op">=</span> [<span class="st">'naked'</span>, <span class="st">'delta hedged'</span>, <span class="st">'delta-gamma hedged'</span>]</span>
<span id="cb26-23"><a href="#cb26-23" aria-hidden="true" tabindex="-1"></a>df</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="17">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">naked</th>
<th data-quarto-table-cell-role="th">delta hedged</th>
<th data-quarto-table-cell-role="th">delta-gamma hedged</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>0.189399</td>
<td>-0.098204</td>
<td>-0.025266</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>0.178589</td>
<td>-0.080254</td>
<td>-0.018913</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>0.166344</td>
<td>-0.063738</td>
<td>-0.013499</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>0.152554</td>
<td>-0.048768</td>
<td>-0.009028</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>0.137110</td>
<td>-0.035452</td>
<td>-0.005487</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">5</td>
<td>0.119905</td>
<td>-0.023896</td>
<td>-0.002840</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">6</td>
<td>0.100837</td>
<td>-0.014204</td>
<td>-0.001027</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">7</td>
<td>0.079807</td>
<td>-0.006474</td>
<td>0.000038</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">8</td>
<td>0.056725</td>
<td>-0.000796</td>
<td>0.000471</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">9</td>
<td>0.031504</td>
<td>0.002744</td>
<td>0.000423</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">10</td>
<td>0.004069</td>
<td>0.004069</td>
<td>0.000075</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">11</td>
<td>-0.025650</td>
<td>0.003111</td>
<td>-0.000354</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">12</td>
<td>-0.057711</td>
<td>-0.000190</td>
<td>-0.000607</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">13</td>
<td>-0.092164</td>
<td>-0.005883</td>
<td>-0.000389</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">14</td>
<td>-0.129050</td>
<td>-0.014009</td>
<td>0.000633</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">15</td>
<td>-0.168397</td>
<td>-0.024596</td>
<td>0.002832</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">16</td>
<td>-0.210225</td>
<td>-0.037664</td>
<td>0.006620</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">17</td>
<td>-0.254544</td>
<td>-0.053222</td>
<td>0.012447</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">18</td>
<td>-0.301352</td>
<td>-0.071269</td>
<td>0.020799</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">19</td>
<td>-0.350638</td>
<td>-0.091795</td>
<td>0.032197</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">20</td>
<td>-0.402383</td>
<td>-0.114780</td>
<td>0.047194</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<div id="cell-40" class="cell" data-execution_count="18">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="co"># plot</span></span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">9</span>, <span class="dv">6</span>))</span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a>plt.plot(s, pnl_naked, <span class="st">'o-'</span>, label<span class="op">=</span><span class="st">'Naked call'</span>)</span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a>plt.plot(s, pnl_delta, <span class="st">'o-.'</span>, color<span class="op">=</span><span class="st">'orange'</span>, label<span class="op">=</span><span class="st">'Delta hedged'</span>)</span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a>plt.plot(s, pnl_dg, <span class="st">'o-.'</span>, color<span class="op">=</span><span class="st">'red'</span>, label<span class="op">=</span><span class="st">'Delta Gamma hedged'</span>)</span>
<span id="cb27-6"><a href="#cb27-6" aria-hidden="true" tabindex="-1"></a>plt.hlines(y<span class="op">=</span><span class="dv">0</span>, xmin<span class="op">=</span><span class="bu">min</span>(s), xmax<span class="op">=</span><span class="bu">max</span>(s), ls<span class="op">=</span><span class="st">'dashed'</span>)</span>
<span id="cb27-7"><a href="#cb27-7" aria-hidden="true" tabindex="-1"></a>plt.grid(color<span class="op">=</span><span class="st">'grey'</span>, ls<span class="op">=</span><span class="st">'dotted'</span>)</span>
<span id="cb27-8"><a href="#cb27-8" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">'P&amp;L'</span>, fontsize<span class="op">=</span><span class="dv">15</span>)</span>
<span id="cb27-9"><a href="#cb27-9" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="vs">r'</span><span class="dv">$</span><span class="vs">s</span><span class="dv">$</span><span class="vs">'</span>, fontsize<span class="op">=</span><span class="dv">15</span>)</span>
<span id="cb27-10"><a href="#cb27-10" aria-hidden="true" tabindex="-1"></a>plt.legend()<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="NSD_Lec03-BlackMertonScholes-1_Summer2025_files/figure-html/cell-19-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<div id="cell-41" class="cell" data-execution_count="19">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="co"># zoom into the interval [9.5, 10.5]</span></span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">9</span>, <span class="dv">6</span>))</span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a>plt.plot(s, pnl_naked, <span class="st">'o-'</span>, label<span class="op">=</span><span class="st">'Naked call'</span>)</span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a>plt.plot(s, pnl_delta, <span class="st">'o-.'</span>, color<span class="op">=</span><span class="st">'orange'</span>, label<span class="op">=</span><span class="st">'Delta hedged'</span>)</span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true" tabindex="-1"></a>plt.plot(s, pnl_dg, <span class="st">'o-.'</span>, color<span class="op">=</span><span class="st">'red'</span>, label<span class="op">=</span><span class="st">'Delta Gamma hedged'</span>)</span>
<span id="cb28-6"><a href="#cb28-6" aria-hidden="true" tabindex="-1"></a>plt.hlines(y<span class="op">=</span><span class="dv">0</span>, xmin<span class="op">=</span><span class="bu">min</span>(s), xmax<span class="op">=</span><span class="bu">max</span>(s), ls<span class="op">=</span><span class="st">'dashed'</span>)</span>
<span id="cb28-7"><a href="#cb28-7" aria-hidden="true" tabindex="-1"></a>plt.grid(color<span class="op">=</span><span class="st">'grey'</span>, ls<span class="op">=</span><span class="st">'dotted'</span>)</span>
<span id="cb28-8"><a href="#cb28-8" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">'P&amp;L'</span>, fontsize<span class="op">=</span><span class="dv">15</span>)</span>
<span id="cb28-9"><a href="#cb28-9" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="vs">r'</span><span class="dv">$</span><span class="vs">s</span><span class="dv">$</span><span class="vs">'</span>, fontsize<span class="op">=</span><span class="dv">15</span>)</span>
<span id="cb28-10"><a href="#cb28-10" aria-hidden="true" tabindex="-1"></a>plt.xlim(<span class="fl">9.5</span>, <span class="fl">10.5</span>)</span>
<span id="cb28-11"><a href="#cb28-11" aria-hidden="true" tabindex="-1"></a>plt.legend()<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="NSD_Lec03-BlackMertonScholes-1_Summer2025_files/figure-html/cell-20-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="dynamical-hedging" class="level2">
<h2 class="anchored" data-anchor-id="dynamical-hedging">Dynamical hedging</h2>
<p>As market conditions evolve, to maintain the <em>delta neutrality</em> of the portfolio, ideally we should dynamically change the holdings in the portfolio.</p>
<p><font color="blue"> Only <em>delta neutrality</em>, not <em>delta-gamma neutrality</em>.</font></p>
<section id="note-6" class="level4">
<h4 class="anchored" data-anchor-id="note-6">Note</h4>
<ul>
<li>Rebalancing of hedging portfolio is done after observing the price change.</li>
</ul>
</section>
<section id="an-example-on-dynamical-hedging" class="level3">
<h3 class="anchored" data-anchor-id="an-example-on-dynamical-hedging">An example on dynamical hedging</h3>
<div id="cell-44" class="cell" data-execution_count="20">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="co"># parameters</span></span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a>r, sigma <span class="op">=</span> <span class="dv">0</span>, <span class="fl">0.3</span></span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a>s0, K <span class="op">=</span> <span class="dv">10</span>, <span class="dv">11</span></span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true" tabindex="-1"></a>dt, t, days_forward <span class="op">=</span> <span class="dv">1</span><span class="op">/</span><span class="dv">252</span>, <span class="dv">1</span><span class="op">/</span><span class="dv">4</span>, <span class="dv">30</span></span>
<span id="cb29-5"><a href="#cb29-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-6"><a href="#cb29-6" aria-hidden="true" tabindex="-1"></a><span class="co"># portfolio positions in cash, options, underlying</span></span>
<span id="cb29-7"><a href="#cb29-7" aria-hidden="true" tabindex="-1"></a><span class="co"># x : number of shares in underlying</span></span>
<span id="cb29-8"><a href="#cb29-8" aria-hidden="true" tabindex="-1"></a><span class="co"># y : dollars in cash</span></span>
<span id="cb29-9"><a href="#cb29-9" aria-hidden="true" tabindex="-1"></a><span class="co"># z : number of options</span></span>
<span id="cb29-10"><a href="#cb29-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-11"><a href="#cb29-11" aria-hidden="true" tabindex="-1"></a><span class="co"># short 1000 calls</span></span>
<span id="cb29-12"><a href="#cb29-12" aria-hidden="true" tabindex="-1"></a>z <span class="op">=</span> <span class="op">-</span><span class="dv">1000</span></span>
<span id="cb29-13"><a href="#cb29-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-14"><a href="#cb29-14" aria-hidden="true" tabindex="-1"></a><span class="co"># current price and delta of call</span></span>
<span id="cb29-15"><a href="#cb29-15" aria-hidden="true" tabindex="-1"></a>c, delta, _ <span class="op">=</span> bs_call(s0, K, sigma, t, r).values()</span>
<span id="cb29-16"><a href="#cb29-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-17"><a href="#cb29-17" aria-hidden="true" tabindex="-1"></a><span class="co"># construct a zero value and delta neutral portfolio</span></span>
<span id="cb29-18"><a href="#cb29-18" aria-hidden="true" tabindex="-1"></a>x <span class="op">=</span> delta<span class="op">*</span>(<span class="op">-</span>z)</span>
<span id="cb29-19"><a href="#cb29-19" aria-hidden="true" tabindex="-1"></a>y <span class="op">=</span> <span class="op">-</span>(x<span class="op">*</span>s0 <span class="op">+</span> z<span class="op">*</span>c)</span>
<span id="cb29-20"><a href="#cb29-20" aria-hidden="true" tabindex="-1"></a>port_value, port_delta <span class="op">=</span> x<span class="op">*</span>s0 <span class="op">+</span> y <span class="op">+</span> z<span class="op">*</span>c, x <span class="op">+</span> z<span class="op">*</span>delta</span>
<span id="cb29-21"><a href="#cb29-21" aria-hidden="true" tabindex="-1"></a>s, pnl_cum <span class="op">=</span> s0, <span class="dv">0</span></span>
<span id="cb29-22"><a href="#cb29-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-23"><a href="#cb29-23" aria-hidden="true" tabindex="-1"></a><span class="co"># pandas.DataFrame for presentation</span></span>
<span id="cb29-24"><a href="#cb29-24" aria-hidden="true" tabindex="-1"></a>pd.DataFrame(np.array([port_value, port_delta, pnl_cum, s, c, x, y, z<span class="op">*</span>delta]).reshape(<span class="dv">1</span>, <span class="dv">8</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="20">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">0</th>
<th data-quarto-table-cell-role="th">1</th>
<th data-quarto-table-cell-role="th">2</th>
<th data-quarto-table-cell-role="th">3</th>
<th data-quarto-table-cell-role="th">4</th>
<th data-quarto-table-cell-role="th">5</th>
<th data-quarto-table-cell-role="th">6</th>
<th data-quarto-table-cell-role="th">7</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>-8.526513e-14</td>
<td>0.0</td>
<td>0.0</td>
<td>10.0</td>
<td>0.250024</td>
<td>287.602907</td>
<td>-2626.00459</td>
<td>-287.602907</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<div id="cell-45" class="cell" data-execution_count="21">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 1 day later</span></span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a>i <span class="op">=</span> <span class="dv">1</span></span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a>s_new <span class="op">=</span> s0<span class="op">*</span>exp((r <span class="op">-</span> sigma<span class="op">**</span><span class="dv">2</span><span class="op">/</span><span class="dv">2</span>)<span class="op">*</span>dt <span class="op">+</span> sigma<span class="op">*</span>sqrt(dt)<span class="op">*</span>norm.rvs()) <span class="co"># sample a new stock price</span></span>
<span id="cb30-4"><a href="#cb30-4" aria-hidden="true" tabindex="-1"></a>c_new, delta_new, _ <span class="op">=</span> bs_call(s_new, K, sigma, t<span class="op">-</span>i<span class="op">*</span>dt, r).values()</span>
<span id="cb30-5"><a href="#cb30-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-6"><a href="#cb30-6" aria-hidden="true" tabindex="-1"></a><span class="co"># portfolio value before rebalance </span></span>
<span id="cb30-7"><a href="#cb30-7" aria-hidden="true" tabindex="-1"></a>port_value_new <span class="op">=</span> x<span class="op">*</span>s_new <span class="op">+</span> y<span class="op">*</span>exp(r<span class="op">*</span>i<span class="op">*</span>dt) <span class="op">+</span> z<span class="op">*</span>c_new</span>
<span id="cb30-8"><a href="#cb30-8" aria-hidden="true" tabindex="-1"></a>pnl_cum <span class="op">=</span> pnl_cum <span class="op">+</span> port_value_new <span class="op">-</span> port_value</span>
<span id="cb30-9"><a href="#cb30-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-10"><a href="#cb30-10" aria-hidden="true" tabindex="-1"></a><span class="co"># rebalance to delta neutral</span></span>
<span id="cb30-11"><a href="#cb30-11" aria-hidden="true" tabindex="-1"></a>x_new <span class="op">=</span> delta_new<span class="op">*</span>(<span class="op">-</span>z)</span>
<span id="cb30-12"><a href="#cb30-12" aria-hidden="true" tabindex="-1"></a>y_new <span class="op">=</span> y<span class="op">*</span>exp(r<span class="op">*</span>i<span class="op">*</span>dt) <span class="op">+</span> (x <span class="op">-</span> x_new)<span class="op">*</span>s_new</span>
<span id="cb30-13"><a href="#cb30-13" aria-hidden="true" tabindex="-1"></a>port_value <span class="op">=</span> x_new<span class="op">*</span>s_new <span class="op">+</span> y_new <span class="op">+</span> z<span class="op">*</span>c_new</span>
<span id="cb30-14"><a href="#cb30-14" aria-hidden="true" tabindex="-1"></a>port_delta <span class="op">=</span> x_new <span class="op">+</span> z<span class="op">*</span>delta_new</span>
<span id="cb30-15"><a href="#cb30-15" aria-hidden="true" tabindex="-1"></a>s, c, x, delta, y <span class="op">=</span> s_new, c_new, x_new, delta_new, y_new</span>
<span id="cb30-16"><a href="#cb30-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-17"><a href="#cb30-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-18"><a href="#cb30-18" aria-hidden="true" tabindex="-1"></a><span class="co"># display the result</span></span>
<span id="cb30-19"><a href="#cb30-19" aria-hidden="true" tabindex="-1"></a>pd.DataFrame(np.array([port_value, s, c, y, x]).reshape(<span class="dv">1</span>, <span class="dv">5</span>),</span>
<span id="cb30-20"><a href="#cb30-20" aria-hidden="true" tabindex="-1"></a>            columns<span class="op">=</span>[<span class="st">'portfolio value'</span>, <span class="st">'stock price'</span>, <span class="st">'call price'</span>, <span class="st">'shares'</span>, <span class="st">'cash'</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="21">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">portfolio value</th>
<th data-quarto-table-cell-role="th">stock price</th>
<th data-quarto-table-cell-role="th">call price</th>
<th data-quarto-table-cell-role="th">shares</th>
<th data-quarto-table-cell-role="th">cash</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>2.546886</td>
<td>9.892218</td>
<td>0.216479</td>
<td>-2367.146177</td>
<td>261.435023</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<div id="cell-46" class="cell" data-execution_count="22">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Let's see how it works for 30 days forward</span></span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a><span class="co"># initialize data</span></span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a>port_value <span class="op">=</span> np.zeros(days_forward<span class="op">+</span><span class="dv">1</span>)</span>
<span id="cb31-4"><a href="#cb31-4" aria-hidden="true" tabindex="-1"></a>s <span class="op">=</span> s0 <span class="op">+</span> np.zeros(days_forward<span class="op">+</span><span class="dv">1</span>)</span>
<span id="cb31-5"><a href="#cb31-5" aria-hidden="true" tabindex="-1"></a>calls <span class="op">=</span> c <span class="op">+</span> np.zeros(days_forward<span class="op">+</span><span class="dv">1</span>)</span>
<span id="cb31-6"><a href="#cb31-6" aria-hidden="true" tabindex="-1"></a>deltas <span class="op">=</span> delta <span class="op">+</span> np.zeros(days_forward<span class="op">+</span><span class="dv">1</span>)</span>
<span id="cb31-7"><a href="#cb31-7" aria-hidden="true" tabindex="-1"></a>shares <span class="op">=</span> x <span class="op">+</span> np.zeros(days_forward<span class="op">+</span><span class="dv">1</span>)</span>
<span id="cb31-8"><a href="#cb31-8" aria-hidden="true" tabindex="-1"></a>cash <span class="op">=</span> y <span class="op">+</span> np.zeros(days_forward<span class="op">+</span><span class="dv">1</span>)</span>
<span id="cb31-9"><a href="#cb31-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-10"><a href="#cb31-10" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(days_forward):    </span>
<span id="cb31-11"><a href="#cb31-11" aria-hidden="true" tabindex="-1"></a>    <span class="co"># sample a stock price</span></span>
<span id="cb31-12"><a href="#cb31-12" aria-hidden="true" tabindex="-1"></a>    s[i<span class="op">+</span><span class="dv">1</span>] <span class="op">=</span> s[i]<span class="op">*</span>exp((r <span class="op">-</span> sigma<span class="op">**</span><span class="dv">2</span><span class="op">/</span><span class="dv">2</span>)<span class="op">*</span>dt <span class="op">+</span> sigma<span class="op">*</span>sqrt(dt)<span class="op">*</span>norm.rvs()) </span>
<span id="cb31-13"><a href="#cb31-13" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb31-14"><a href="#cb31-14" aria-hidden="true" tabindex="-1"></a>    <span class="co"># calculate new call price and delta</span></span>
<span id="cb31-15"><a href="#cb31-15" aria-hidden="true" tabindex="-1"></a>    calls[i<span class="op">+</span><span class="dv">1</span>], deltas[i<span class="op">+</span><span class="dv">1</span>], _ <span class="op">=</span> bs_call(s[i<span class="op">+</span><span class="dv">1</span>], K, sigma, t<span class="op">-</span>i<span class="op">*</span>dt, r).values()</span>
<span id="cb31-16"><a href="#cb31-16" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb31-17"><a href="#cb31-17" aria-hidden="true" tabindex="-1"></a>    <span class="co"># portfolio value before rebalance </span></span>
<span id="cb31-18"><a href="#cb31-18" aria-hidden="true" tabindex="-1"></a>    port_value[i<span class="op">+</span><span class="dv">1</span>] <span class="op">=</span> shares[i]<span class="op">*</span>s[i<span class="op">+</span><span class="dv">1</span>] <span class="op">+</span> cash[i]<span class="op">*</span>exp(r<span class="op">*</span>dt) <span class="op">+</span> z<span class="op">*</span>calls[i<span class="op">+</span><span class="dv">1</span>]</span>
<span id="cb31-19"><a href="#cb31-19" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb31-20"><a href="#cb31-20" aria-hidden="true" tabindex="-1"></a>    <span class="co"># rebalance (self-financing) to delta neutral</span></span>
<span id="cb31-21"><a href="#cb31-21" aria-hidden="true" tabindex="-1"></a>    shares[i<span class="op">+</span><span class="dv">1</span>] <span class="op">=</span> deltas[i<span class="op">+</span><span class="dv">1</span>]<span class="op">*</span>(<span class="op">-</span>z)</span>
<span id="cb31-22"><a href="#cb31-22" aria-hidden="true" tabindex="-1"></a>    cash[i<span class="op">+</span><span class="dv">1</span>] <span class="op">=</span> cash[i]<span class="op">*</span>exp(r<span class="op">*</span>dt) <span class="op">+</span> (shares[i] <span class="op">-</span> shares[i<span class="op">+</span><span class="dv">1</span>])<span class="op">*</span>s[i<span class="op">+</span><span class="dv">1</span>]</span>
<span id="cb31-23"><a href="#cb31-23" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb31-24"><a href="#cb31-24" aria-hidden="true" tabindex="-1"></a><span class="co"># display the result</span></span>
<span id="cb31-25"><a href="#cb31-25" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> pd.DataFrame(np.array([port_value, s, calls, shares, cash]).T)</span>
<span id="cb31-26"><a href="#cb31-26" aria-hidden="true" tabindex="-1"></a>df.columns <span class="op">=</span> [<span class="st">'portfolio value'</span>, <span class="st">'stock price'</span>, <span class="st">'call price'</span>, <span class="st">'shares'</span>, <span class="st">'cash'</span>]</span>
<span id="cb31-27"><a href="#cb31-27" aria-hidden="true" tabindex="-1"></a>df</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="22">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">portfolio value</th>
<th data-quarto-table-cell-role="th">stock price</th>
<th data-quarto-table-cell-role="th">call price</th>
<th data-quarto-table-cell-role="th">shares</th>
<th data-quarto-table-cell-role="th">cash</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>0.000000</td>
<td>10.000000</td>
<td>0.216479</td>
<td>261.435023</td>
<td>-2367.146177</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>-1.685025</td>
<td>9.942157</td>
<td>0.233767</td>
<td>274.561382</td>
<td>-2497.650498</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>2.268928</td>
<td>9.941718</td>
<td>0.229692</td>
<td>272.461998</td>
<td>-2476.779020</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>6.211547</td>
<td>9.932415</td>
<td>0.223215</td>
<td>268.327792</td>
<td>-2435.716366</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>7.977730</td>
<td>9.800739</td>
<td>0.186117</td>
<td>237.182288</td>
<td>-2130.467417</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">5</td>
<td>11.198113</td>
<td>9.743563</td>
<td>0.169335</td>
<td>222.740773</td>
<td>-1989.755598</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">6</td>
<td>11.639786</td>
<td>9.924673</td>
<td>0.209234</td>
<td>260.177939</td>
<td>-2361.307222</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">7</td>
<td>8.445821</td>
<td>9.679310</td>
<td>0.148590</td>
<td>204.653243</td>
<td>-1823.866480</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">8</td>
<td>4.882468</td>
<td>9.424510</td>
<td>0.100008</td>
<td>153.308707</td>
<td>-1339.969360</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">9</td>
<td>5.726561</td>
<td>9.286795</td>
<td>0.078051</td>
<td>127.580670</td>
<td>-1101.038366</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">10</td>
<td>7.598509</td>
<td>9.388071</td>
<td>0.089100</td>
<td>141.955984</td>
<td>-1235.994839</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">11</td>
<td>10.324611</td>
<td>9.406149</td>
<td>0.088940</td>
<td>142.546174</td>
<td>-1241.546252</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">12</td>
<td>10.635569</td>
<td>9.585027</td>
<td>0.114127</td>
<td>173.031658</td>
<td>-1533.750432</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">13</td>
<td>10.375330</td>
<td>9.783245</td>
<td>0.148685</td>
<td>211.536361</td>
<td>-1910.451358</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">14</td>
<td>9.859347</td>
<td>9.595023</td>
<td>0.109386</td>
<td>169.590464</td>
<td>-1507.979495</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">15</td>
<td>12.248389</td>
<td>9.514560</td>
<td>0.093351</td>
<td>151.388201</td>
<td>-1334.792971</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">16</td>
<td>7.022855</td>
<td>9.221413</td>
<td>0.054197</td>
<td>99.998587</td>
<td>-860.908107</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">17</td>
<td>9.182860</td>
<td>9.267979</td>
<td>0.056694</td>
<td>104.264357</td>
<td>-900.443174</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">18</td>
<td>11.500153</td>
<td>9.296259</td>
<td>0.057325</td>
<td>105.861646</td>
<td>-915.291984</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">19</td>
<td>-2.567556</td>
<td>9.746510</td>
<td>0.119057</td>
<td>186.474293</td>
<td>-1700.983964</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">20</td>
<td>1.108896</td>
<td>9.776974</td>
<td>0.121061</td>
<td>190.090952</td>
<td>-1736.343949</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">21</td>
<td>3.292136</td>
<td>9.669038</td>
<td>0.098361</td>
<td>163.857148</td>
<td>-1482.688290</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">22</td>
<td>-1.645460</td>
<td>9.389589</td>
<td>0.057509</td>
<td>109.119273</td>
<td>-968.722121</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">23</td>
<td>0.884305</td>
<td>9.384055</td>
<td>0.054375</td>
<td>105.194186</td>
<td>-931.888885</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">24</td>
<td>3.350541</td>
<td>9.372953</td>
<td>0.050741</td>
<td>100.368375</td>
<td>-886.656788</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">25</td>
<td>5.651420</td>
<td>9.440110</td>
<td>0.055180</td>
<td>108.085315</td>
<td>-959.505545</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">26</td>
<td>7.572448</td>
<td>9.363605</td>
<td>0.044990</td>
<td>92.697566</td>
<td>-815.420747</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">27</td>
<td>9.973373</td>
<td>9.384116</td>
<td>0.044491</td>
<td>92.648530</td>
<td>-814.960587</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">28</td>
<td>11.436208</td>
<td>9.290807</td>
<td>0.034383</td>
<td>75.986501</td>
<td>-660.156885</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">29</td>
<td>13.356387</td>
<td>9.365511</td>
<td>0.038139</td>
<td>83.349842</td>
<td>-729.118332</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">30</td>
<td>15.200208</td>
<td>9.307130</td>
<td>0.031429</td>
<td>71.947088</td>
<td>-622.991417</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</section>
</section>
<section id="dynamic-hedge-in-practice" class="level2">
<h2 class="anchored" data-anchor-id="dynamic-hedge-in-practice">Dynamic hedge in practice</h2>
<ul>
<li>Continuous trading in practice is unrealistic.</li>
<li>The tradeoff between frequency of rebalancing and replication of derivative</li>
<li>Imperfect hedge, risk penalty</li>
<li>Transaction cost, market order or limit order, etc</li>
</ul>
<p>æ³¨: Replication creates an asset or portfolio using a combination of another asset, portfolio, and/or derivative. The following combinations produce the equivalent single asset: Long asset + Short derivative = Long risk free asset.</p>
</section>
<section id="deep-hedging" class="level2">
<h2 class="anchored" data-anchor-id="deep-hedging">Deep hedging</h2>
<p>Research works on hedging problem that resort to reinforcement learning techniques include</p>
<ul>
<li>Halperin, <em>QLBS: Q-Learner in the Black-Scholes(-Merton) Worlds</em></li>
<li>Buehler, Gonon, Teichmann, and Wood, <em>Deep hedging</em></li>
<li>Cao, Chen, Hull, and Poulos, <em>Deep hedging of derivatives using reinforcement learning</em></li>
<li>Kolm and Ritter, <em>Dynamic replication and hedging: a reinforcement learning approach</em></li>
</ul>
</section>
<section id="deep-hedging-in-a-nutshell" class="level2">
<h2 class="anchored" data-anchor-id="deep-hedging-in-a-nutshell">Deep hedging in a nutshell</h2>
<p>The key idea behind deep hedging in the aforementioned works is to formulate the hedging problem as a stochastic control problem with certain objective functional, then solve the resulting control problem by the techniques introduced in reinforcement learning.</p>
<p>Letâ€™s take the work by Cao, Chen, Hull, and Poulos as an example.</p>
</section>
<section id="notations" class="level2">
<h2 class="anchored" data-anchor-id="notations">Notations</h2>
<ul>
<li><span class="math inline">\(i\)</span>: time, running from <span class="math inline">\(0\)</span> to <span class="math inline">\(n\)</span></li>
<li><span class="math inline">\(C_i\)</span>: value of the call/derivative at the beginning of the time <span class="math inline">\(i\)</span></li>
<li><span class="math inline">\(S_i\)</span>: price of the underlying at the beginning of the time <span class="math inline">\(i\)</span></li>
<li><span class="math inline">\(H_i\)</span>: holdings of the underlying between time <span class="math inline">\(i\)</span> and <span class="math inline">\(i+1\)</span>.</li>
<li><span class="math inline">\(\kappa\)</span>: proportional transaction cost</li>
<li><span class="math inline">\(R_i\)</span>: running reward gained at time <span class="math inline">\(i\)</span></li>
</ul>
</section>
<section id="settings-in-cao-chen-hull-poulos" class="level2">
<h2 class="anchored" data-anchor-id="settings-in-cao-chen-hull-poulos">Settings in Cao-Chen-Hull-Poulos</h2>
<p>Cao-Chen-Hull-Poulos formulate the hedging problem as follows.</p>
<ul>
<li>a trader is hedging a short position in a call option</li>
<li>hedging portfolio consisting of shares in the underlying, no cash component?</li>
<li>the trader re-balances his position at time intervals of length <span class="math inline">\(\Delta t\)</span> and is subject to trading costs</li>
<li>The life of the option is <span class="math inline">\(n\)</span>.</li>
<li>The cost of a trade in the underlying asset is proportional to the value of what is being bought or sold</li>
<li>The state at time <span class="math inline">\(i\)</span> is defined by three parameters:
<ol type="1">
<li>The holding <span class="math inline">\(H_{i-1}\)</span> of the asset during the previous time period; i.e., from time <span class="math inline">\(i-1\)</span> to time <span class="math inline">\(i\)</span></li>
<li>The asset price <span class="math inline">\(S_i\)</span> at time <span class="math inline">\(i\)</span></li>
<li>The time to maturity <span class="math inline">\((n-i)\)</span></li>
</ol></li>
<li>The action/control <span class="math inline">\(H_i\)</span> at time <span class="math inline">\(i\)</span> is the amount of the asset to be held for the next period, i.e., from time <span class="math inline">\(i\)</span> to time <span class="math inline">\(i+1\)</span>.</li>
<li>Rebalance is done after observing the price change.</li>
</ul>
</section>
<section id="two-alternative-formulations" class="level2">
<h2 class="anchored" data-anchor-id="two-alternative-formulations">Two alternative formulations</h2>
<ul>
<li>There are two alternative formulations for the hedging problem:
<ul>
<li>the accounting P&amp;L formulation</li>
<li>the cash flow formulation.</li>
</ul></li>
<li>For ease of exposition, no discounting is assumed in the control problem, i.e., <span class="math inline">\(\gamma=1\)</span></li>
</ul>
</section>
<section id="accounting-pl-formulation" class="level2">
<h2 class="anchored" data-anchor-id="accounting-pl-formulation">Accounting P&amp;L formulation</h2>
<p>For <span class="math inline">\(1 \leq i \leq n\)</span>, define the running reward gained at time <span class="math inline">\(i\)</span> as</p>
<p><span class="math display">\[
\begin{aligned}
  R_i &amp;= -C_i + C_{i-1} + H_{i-1} (S_i - S_{i-1}) - \kappa |S_i (H_i - H_{i-1})| \\
      &amp;= -\Delta C_i + \underbrace{H_{i-1} \Delta S_i}_{\text{marked to market}} - \underbrace{\kappa |S_i \Delta H_i|}_{\text{transaction cost}}.
\end{aligned}
\]</span></p>
<p>Note that this formulation is consistent with the self-financing condition with transaction cost that was discussed previously. To set up the hedging initially and liquidate the position at expiry of option, we add to the (undiscounted) cumulative rewards</p>
<ul>
<li>initial reward: <span class="math inline">\(-\kappa|S_0 H_0|\)</span></li>
<li>terminal reward: <span class="math inline">\(-\kappa|S_n H_n|\)</span></li>
</ul>
<p>Thus, the performance criterion <span class="math inline">\(Y^A\)</span> for a given hedging strategy <span class="math inline">\((H_0, \cdots, H_n)\)</span> reads</p>
<p><span class="math display">\[
\begin{aligned}
  Y^A &amp;= -\kappa |S_0 H_0| + \sum_{i=1}^n R_i - \kappa |S_n H_n| \\
      &amp;= -\kappa |S_0 H_0| + C_0 - C_n + \sum_{i=1}^n H_{i-1} \Delta S_i - \kappa \sum_{i=1}^n |S_i \Delta H_i| - \kappa |S_n H_n|.
\end{aligned}
\]</span></p>
</section>
<section id="cashflow-formulation" class="level2">
<h2 class="anchored" data-anchor-id="cashflow-formulation">Cashflow formulation</h2>
<p>In this formulation, for <span class="math inline">\(1 \leq i \leq n\)</span>, the running reward gained at time <span class="math inline">\(i\)</span> is defined by</p>
<p><span class="math display">\[
R_i = S_i(H_{i-1} - H_i) - \kappa |S_i(H_i - H_{i-1})|
= -S_i \Delta H_i - \kappa |S_i \Delta H_i|
\]</span></p>
<p>with - initial cost for setting up a position: <span class="math inline">\(-S_0H_0 - \kappa|S_0 H_0|\)</span> - terminal cost for liquidate the position and payoff to call: <span class="math inline">\(S_nH_n - \kappa|S_n H_n| - C_n\)</span>.</p>
<p>Thus, the performance criterion <span class="math inline">\(Y^C\)</span> for a given hedging strategy <span class="math inline">\((H_0, \cdots, H_n)\)</span> reads</p>
<p><span class="math display">\[
\begin{aligned}
  Y^C &amp;= -S_0 H_0 - \kappa |S_0 H_0| + \sum_{i=1}^n R_i + S_n H_n - \kappa |S_n H_n| - C_n \\
      &amp;= -S_0 H_0 - \kappa |S_0 H_0| - \sum_{i=1}^n S_i \Delta H_i - \kappa \sum_{i=1}^n |S_i \Delta H_i| + S_n H_n - \kappa |S_n H_n| - C_n.
\end{aligned}
\]</span></p>
</section>
<section id="accounting-pl-vs-cashflow" class="level2">
<h2 class="anchored" data-anchor-id="accounting-pl-vs-cashflow">Accounting P&amp;L vs cashflow</h2>
<p>Recall that</p>
<p><span class="math display">\[
\begin{aligned}
  Y^A &amp;= -\kappa |S_0 H_0| + C_0 - C_n + \sum_{i=1}^n H_{i-1} \Delta S_i - \kappa \sum_{i=1}^n |S_i \Delta H_i| - \kappa |S_n H_n| \\
      &amp;= -\kappa |S_0 H_0| + C_0 - C_n + H_n S_n - H_0 S_0 - \sum_{i=1}^n S_i \Delta H_i - \kappa \sum_{i=1}^n |S_i \Delta H_i| - \kappa |S_n H_n|.
\end{aligned}
\]</span></p>
<p>where in the last equality we applied the following <em>summation by parts</em> formula</p>
<p><span class="math display">\[
\sum_{i=1}^n H_{i-1} \Delta S_i = H_n S_n - H_0 S_0 - \sum_{i=1}^n S_i \Delta H_i.
\]</span></p>
<p>It follows that</p>
<p><span class="math display">\[
Y^A - Y^C = C_0.
\]</span></p>
<p>The two formulations are basically the same.</p>
</section>
<section id="objective-functional-and-resulting-control-problem" class="level2">
<h2 class="anchored" data-anchor-id="objective-functional-and-resulting-control-problem">Objective functional and resulting control problem</h2>
<p>Objective functional for the performance criterion <span class="math inline">\(Y\)</span> is given by its expectation penalized by a risk measure. Namely,</p>
<p><span class="math display">\[
\Eof{Y} - \lambda \rho(Y),
\]</span></p>
<p>where <span class="math inline">\(\rho\)</span> is certain prespecified risk measure. Hence, the hedging problem can be recast as the following stochastic control problem</p>
<p><span class="math display">\[
\max_{(H_0, \cdots, H_n)} \Eof{Y} - \lambda \rho(Y).
\]</span></p>
<p>From this point on, reinforcement learning techniques are then applied to solve the above control problem.</p>
<section id="note-7" class="level4">
<h4 class="anchored" data-anchor-id="note-7">Note</h4>
<ul>
<li>In the original Cao-Chen-Hull-Poulos paper, the authors chose to penalize the expected reward by standard deviation. However, from control theory point of view, penalizing expected reward by variance/standard deviation will induce (unnecessary?) difficulty due to time inconsistency.</li>
<li>In the Buehler et al paper, the authors utilized the expected shortfall or conditional value-at-risk as the risk measure.</li>
</ul>
</section>
</section>
<section id="implementation-of-deep-hedging-in-tensorflow" class="level2">
<h2 class="anchored" data-anchor-id="implementation-of-deep-hedging-in-tensorflow">Implementation of Deep hedging in <code>Tensorflow</code></h2>
<p>Courtsey: Laura He and Tony Xie, Baruch MFE 2020</p>
</section>
<section id="deep-hedging-implementation-with-ddpg-algorithm" class="level2">
<h2 class="anchored" data-anchor-id="deep-hedging-implementation-with-ddpg-algorithm">Deep-hedging implementation with DDPG Algorithm</h2>
<p><strong>Step 1</strong> Initialize neural network of <span class="math inline">\(Q_1(s,a|\theta^{Q_1}), Q_2(s,a|\theta^{Q_2})\)</span> and policy function <span class="math inline">\(\mu(s|\theta^\mu)\)</span>. Set target networks <span class="math inline">\(Q_1' \leftarrow Q_1,Q_2' \leftarrow Q_2,\mu' \leftarrow \mu\)</span>. Create replay buffer <span class="math inline">\(R\)</span>.</p>
<p><strong>Step 2</strong> Begin loop:</p>
<p><strong>for</strong> episode <span class="math inline">\(= 1\)</span> to n_path:</p>
<p>Generate random process <span class="math inline">\({N_i}, i = 0, 1, ..., m\)</span> for action exploration. <br> Get initial state: <span class="math inline">\(s_0 = [S_0\)</span>(stock price), <span class="math inline">\(V_0\)</span>(option price), <span class="math inline">\(H_{-1} = 0\)</span>(holding), <span class="math inline">\(\tau_0 = T = m\, \mathrm{d}t\)</span>(time to maturity)<span class="math inline">\(]\)</span>.</p>
<p><strong>for</strong> <span class="math inline">\(i = 0\)</span> to <span class="math inline">\(m\)</span> (<span class="math inline">\(m\)</span> time intervals):</p>
<p><strong>Step 2.1</strong> Calculate action: <span class="math inline">\(a_i = (1-\epsilon_i)\mu(s_i|\theta^\mu) + \epsilon_i N_i,\,\, s_i = [S_i, V_i, H_{i-1}, \tau_i = (m-i)\mathrm{d}t]\)</span> <br> <strong>Step 2.2</strong> Execute <span class="math inline">\(a_i\)</span>. Get <span class="math inline">\(r_i = -(V_{i+1} - V_i) + H_i(S_{i+1} - S_i) - \kappa |S_ia_i|,\,\, 0\leqslant i&lt;m\)</span> <br> <span class="math inline">\(\hspace{4.2 cm} r_m = - \kappa|S_mH_{m-1}|\)</span> <br> <strong>Step 2.3</strong> Observe new state: <span class="math inline">\(s_{i+1} = [S_{i+1}, V_{i+1}, H_i = H_{i-1}+a_i, \tau_{i+1} = (m-i-1)\mathrm{d}t]\)</span> <br> <strong>Step 2.4</strong> Store <span class="math inline">\((s_i, a_i, r_i, s_{i+1})\)</span> in the replay buffer <span class="math inline">\(R\)</span>. <br> <strong>Step 2.5</strong> Sample <span class="math inline">\(J\)</span> transitions from <span class="math inline">\(R\)</span>, mark as <span class="math inline">\((s_j, a_j, r_j, s_{j+1}), \,\, j = 1 \sim N/ J?\)</span> <br> <span class="math inline">\(\hspace{1.6 cm}y_j^{(1)} = r_j + \gamma Q_1'(s_{i+1}, \mu'(s_{i+1}|\theta^{\mu'})|\theta^{Q'})\)</span></p>
<p>$y_j^{(2)} = r_j^2 + ^2 Q_2â€™(s_{i+1}, â€˜(s_{i+1}|<sup>{â€™})|</sup>{Qâ€™}) + 2 r_j Q_1â€™(s_{i+1}, â€˜(s_{i+1}|<sup>{â€™})|</sup>{Qâ€™}) $</p>
<p><span class="math inline">\(\hspace{1.4 cm}\)</span> Update <span class="math inline">\(Q_{1,2}\)</span>: <span class="math inline">\(Q_{1,2} = \underset{Q_{1,2}}{\mathrm{argmin}}\left\{\frac{1}{J}\sum_j\left(y_j^{(1,2)} - Q_{1,2}(s_j,a_j|\theta^{Q_{1,2}})\right)^2\right\}\)</span> <br> <span class="math inline">\(\hspace{1.4 cm}\)</span> Update <span class="math inline">\(\mu\)</span> using gradient descent: <span class="math inline">\(\nabla_{\theta^{\mu}}G = \frac{1}{J}\sum_j\nabla_aF(s_j, a_j|\theta^{Q_{1,2}})\nabla_{\theta^{\mu}}\mu(s_j|\theta^{\mu}),\,\, \theta^\mu = \theta^\mu - \nabla_{\theta^\mu}G \times \text{step}\)</span></p>
<p><strong>Step 2.6</strong> Update the target networks: <span class="math inline">\(\theta^{Q'_{1,2}} \leftarrow \tau\theta^{Q_{1,2}} + (1-\tau)\theta^{Q'_{1,2}}, \,\,\theta^{\mu'} \leftarrow \tau\theta^\mu + (1-\tau)\theta^{\mu'}\)</span></p>
<div id="cell-59" class="cell" data-execution_count="23">
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a>pip show DDPG</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Note: you may need to restart the kernel to use updated packages.</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>WARNING: Package(s) not found: DDPG</code></pre>
</div>
</div>
<div id="cell-60" class="cell" data-execution_count="24">
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="co"># import DDPG and other related packages</span></span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb35-4"><a href="#cb35-4" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> DDPG.world <span class="im">import</span> World</span>
<span id="cb35-5"><a href="#cb35-5" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> tensorflow <span class="im">as</span> tf</span>
<span id="cb35-6"><a href="#cb35-6" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> DDPG.blackscholesgenerator <span class="im">import</span> GenerateBSPath, BSCall</span>
<span id="cb35-7"><a href="#cb35-7" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb35-8"><a href="#cb35-8" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb35-9"><a href="#cb35-9" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> seaborn <span class="im">as</span> sns</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="performance-of-deep-hedging-vs-delta-hedging" class="level2">
<h2 class="anchored" data-anchor-id="performance-of-deep-hedging-vs-delta-hedging">Performance of deep hedging vs delta hedging</h2>
<div id="cell-62" class="cell" data-execution_count="25">
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a><span class="co"># python function to implement the trained model </span></span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> DDPG(n_path<span class="op">=</span><span class="dv">5000</span>, m<span class="op">=</span><span class="dv">4</span>, T<span class="op">=</span><span class="dv">1</span><span class="op">/</span><span class="dv">12</span>, r<span class="op">=</span><span class="dv">0</span>, q<span class="op">=</span><span class="dv">0</span>, sigma<span class="op">=</span><span class="fl">0.2</span>, S0<span class="op">=</span><span class="dv">100</span>, K<span class="op">=</span><span class="dv">100</span>, model_path<span class="op">=</span><span class="st">""</span>):</span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a>    stock_price, call_price, call_delta <span class="op">=</span> GenerateBSPath(n_path<span class="op">=</span>n_path, <span class="op">\</span></span>
<span id="cb36-4"><a href="#cb36-4" aria-hidden="true" tabindex="-1"></a>                m<span class="op">=</span>m, T<span class="op">=</span>T, r<span class="op">=</span>r, q<span class="op">=</span>q, sigma<span class="op">=</span>sigma, S0<span class="op">=</span>S0, K<span class="op">=</span>K)</span>
<span id="cb36-5"><a href="#cb36-5" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb36-6"><a href="#cb36-6" aria-hidden="true" tabindex="-1"></a>    V0 <span class="op">=</span> call_price[<span class="dv">0</span>,<span class="dv">0</span>]</span>
<span id="cb36-7"><a href="#cb36-7" aria-hidden="true" tabindex="-1"></a>    initial_state <span class="op">=</span> np.array([S0, V0, <span class="dv">0</span>, T])</span>
<span id="cb36-8"><a href="#cb36-8" aria-hidden="true" tabindex="-1"></a>    state_size, action_size <span class="op">=</span> <span class="dv">4</span>, <span class="dv">1</span></span>
<span id="cb36-9"><a href="#cb36-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-10"><a href="#cb36-10" aria-hidden="true" tabindex="-1"></a>    world <span class="op">=</span> World(state_size, action_size, initial_state, dt<span class="op">=</span>T<span class="op">/</span>m)</span>
<span id="cb36-11"><a href="#cb36-11" aria-hidden="true" tabindex="-1"></a>    <span class="co"># load-in saved (trained) model </span></span>
<span id="cb36-12"><a href="#cb36-12" aria-hidden="true" tabindex="-1"></a>    <span class="co"># actor_model = tf.keras.models.load_model(f'{model_path}/Actor_Model', compile=False)</span></span>
<span id="cb36-13"><a href="#cb36-13" aria-hidden="true" tabindex="-1"></a>    actor_model <span class="op">=</span> tf.keras.layers.TFSMLayer(</span>
<span id="cb36-14"><a href="#cb36-14" aria-hidden="true" tabindex="-1"></a>        <span class="ss">f'</span><span class="sc">{</span>model_path<span class="sc">}</span><span class="ss">/Actor_Model'</span>, </span>
<span id="cb36-15"><a href="#cb36-15" aria-hidden="true" tabindex="-1"></a>        call_endpoint<span class="op">=</span><span class="st">'serving_default'</span></span>
<span id="cb36-16"><a href="#cb36-16" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb36-17"><a href="#cb36-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-18"><a href="#cb36-18" aria-hidden="true" tabindex="-1"></a>    actions_model <span class="op">=</span> np.zeros((n_path, m))</span>
<span id="cb36-19"><a href="#cb36-19" aria-hidden="true" tabindex="-1"></a>    rewards <span class="op">=</span> np.zeros(n_path)</span>
<span id="cb36-20"><a href="#cb36-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-21"><a href="#cb36-21" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> episode <span class="kw">in</span> <span class="bu">range</span>(n_path):</span>
<span id="cb36-22"><a href="#cb36-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-23"><a href="#cb36-23" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> episode <span class="op">%</span> <span class="dv">2000</span> <span class="op">==</span> <span class="dv">0</span>:</span>
<span id="cb36-24"><a href="#cb36-24" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(episode)</span>
<span id="cb36-25"><a href="#cb36-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-26"><a href="#cb36-26" aria-hidden="true" tabindex="-1"></a>        world.initialize()</span>
<span id="cb36-27"><a href="#cb36-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-28"><a href="#cb36-28" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(m):</span>
<span id="cb36-29"><a href="#cb36-29" aria-hidden="true" tabindex="-1"></a>            state <span class="op">=</span> world.get_state()</span>
<span id="cb36-30"><a href="#cb36-30" aria-hidden="true" tabindex="-1"></a>            output <span class="op">=</span> actor_model(np.array([state])) <span class="co"># å‡è®¾ output æ˜¯å­—å…¸</span></span>
<span id="cb36-31"><a href="#cb36-31" aria-hidden="true" tabindex="-1"></a>            first_value <span class="op">=</span> <span class="bu">next</span>(<span class="bu">iter</span>(output.values())).numpy()[<span class="dv">0</span>, <span class="dv">0</span>]  <span class="co"># æå–ç¬¬ä¸€ä¸ªå€¼å¹¶è½¬ä¸ºæ ‡é‡</span></span>
<span id="cb36-32"><a href="#cb36-32" aria-hidden="true" tabindex="-1"></a>            actions_model[episode, i] <span class="op">=</span> first_value</span>
<span id="cb36-33"><a href="#cb36-33" aria-hidden="true" tabindex="-1"></a>            <span class="co"># actor_model(np.array([state]))[0,0]</span></span>
<span id="cb36-34"><a href="#cb36-34" aria-hidden="true" tabindex="-1"></a>            next_state, reward, done <span class="op">=</span> world.act(actions_model[episode, i], (stock_price[episode, i<span class="op">+</span><span class="dv">1</span>], call_price[episode, i<span class="op">+</span><span class="dv">1</span>]))</span>
<span id="cb36-35"><a href="#cb36-35" aria-hidden="true" tabindex="-1"></a>            rewards[episode] <span class="op">+=</span> reward </span>
<span id="cb36-36"><a href="#cb36-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-37"><a href="#cb36-37" aria-hidden="true" tabindex="-1"></a>        state <span class="op">=</span> world.get_state()</span>
<span id="cb36-38"><a href="#cb36-38" aria-hidden="true" tabindex="-1"></a>        rewards[episode] <span class="op">+=</span> world.act(<span class="dv">0</span>, (<span class="dv">0</span>,<span class="dv">0</span>))[<span class="dv">1</span>]</span>
<span id="cb36-39"><a href="#cb36-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-40"><a href="#cb36-40" aria-hidden="true" tabindex="-1"></a><span class="co">#    print(actions_model)</span></span>
<span id="cb36-41"><a href="#cb36-41" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb36-42"><a href="#cb36-42" aria-hidden="true" tabindex="-1"></a>    positions <span class="op">=</span> call_delta[:,:m]</span>
<span id="cb36-43"><a href="#cb36-43" aria-hidden="true" tabindex="-1"></a>    actions <span class="op">=</span> np.hstack((call_delta[:,<span class="dv">0</span>].reshape(n_path,<span class="dv">1</span>), np.diff(call_delta[:,:m], axis <span class="op">=</span> <span class="dv">1</span>)))</span>
<span id="cb36-44"><a href="#cb36-44" aria-hidden="true" tabindex="-1"></a>    payoff <span class="op">=</span> positions<span class="op">*</span>np.diff(stock_price, axis<span class="op">=</span><span class="dv">1</span>) <span class="op">-</span> np.diff(call_price, axis<span class="op">=</span><span class="dv">1</span>) <span class="op">-</span> np.<span class="bu">abs</span>(actions<span class="op">*</span>stock_price[:,:m])<span class="op">*</span><span class="fl">0.01</span> </span>
<span id="cb36-45"><a href="#cb36-45" aria-hidden="true" tabindex="-1"></a>    payoff <span class="op">=</span> np.<span class="bu">sum</span>(payoff, axis<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb36-46"><a href="#cb36-46" aria-hidden="true" tabindex="-1"></a>    payoff <span class="op">-=</span> np.<span class="bu">abs</span>(call_delta[:,m]<span class="op">*</span>stock_price[:,m])<span class="op">*</span><span class="fl">0.01</span></span>
<span id="cb36-47"><a href="#cb36-47" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb36-48"><a href="#cb36-48" aria-hidden="true" tabindex="-1"></a>    payoff_zero <span class="op">=</span> <span class="op">-</span> np.diff(call_price, axis <span class="op">=</span> <span class="dv">1</span>) </span>
<span id="cb36-49"><a href="#cb36-49" aria-hidden="true" tabindex="-1"></a>    payoff_zero <span class="op">=</span> np.<span class="bu">sum</span>(payoff_zero, axis <span class="op">=</span> <span class="dv">1</span>)</span>
<span id="cb36-50"><a href="#cb36-50" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb36-51"><a href="#cb36-51" aria-hidden="true" tabindex="-1"></a>    hedging_cost_mean <span class="op">=</span> np.array([<span class="op">-</span>rewards.mean(), <span class="op">-</span>payoff.mean(), <span class="op">-</span>payoff_zero.mean()])</span>
<span id="cb36-52"><a href="#cb36-52" aria-hidden="true" tabindex="-1"></a>    hedging_cost_std <span class="op">=</span> np.array([rewards.std(), payoff.std(), payoff_zero.std()])</span>
<span id="cb36-53"><a href="#cb36-53" aria-hidden="true" tabindex="-1"></a>    obj_func <span class="op">=</span> hedging_cost_mean <span class="op">+</span> <span class="fl">1.5</span><span class="op">*</span>hedging_cost_std</span>
<span id="cb36-54"><a href="#cb36-54" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb36-55"><a href="#cb36-55" aria-hidden="true" tabindex="-1"></a>    method_name <span class="op">=</span> [<span class="st">"DDPG"</span>, <span class="st">"Delta"</span>, <span class="st">"No Hedge"</span>]</span>
<span id="cb36-56"><a href="#cb36-56" aria-hidden="true" tabindex="-1"></a>    hedging_cost_mean <span class="op">=</span> np.array([<span class="op">-</span>rewards.mean(), <span class="op">-</span>payoff.mean(), <span class="op">-</span>payoff_zero.mean()])</span>
<span id="cb36-57"><a href="#cb36-57" aria-hidden="true" tabindex="-1"></a>    hedging_cost_std <span class="op">=</span> np.array([rewards.std(), payoff.std(), payoff_zero.std()])</span>
<span id="cb36-58"><a href="#cb36-58" aria-hidden="true" tabindex="-1"></a>    obj_func <span class="op">=</span> hedging_cost_mean <span class="op">+</span> <span class="fl">1.5</span><span class="op">*</span>hedging_cost_std</span>
<span id="cb36-59"><a href="#cb36-59" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb36-60"><a href="#cb36-60" aria-hidden="true" tabindex="-1"></a>    mean_in_price <span class="op">=</span> <span class="dv">100</span> <span class="op">*</span> hedging_cost_mean <span class="op">/</span> V0</span>
<span id="cb36-61"><a href="#cb36-61" aria-hidden="true" tabindex="-1"></a>    std_in_price <span class="op">=</span> <span class="dv">100</span> <span class="op">*</span> hedging_cost_std <span class="op">/</span> V0</span>
<span id="cb36-62"><a href="#cb36-62" aria-hidden="true" tabindex="-1"></a>    obj_func_in_price <span class="op">=</span> mean_in_price <span class="op">+</span> <span class="fl">1.5</span><span class="op">*</span>std_in_price</span>
<span id="cb36-63"><a href="#cb36-63" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb36-64"><a href="#cb36-64" aria-hidden="true" tabindex="-1"></a>    result <span class="op">=</span> pd.DataFrame({<span class="st">'Name'</span>: method_name,</span>
<span id="cb36-65"><a href="#cb36-65" aria-hidden="true" tabindex="-1"></a>                           <span class="st">'Mean'</span>: hedging_cost_mean,</span>
<span id="cb36-66"><a href="#cb36-66" aria-hidden="true" tabindex="-1"></a>                           <span class="st">'STD'</span>: hedging_cost_std, </span>
<span id="cb36-67"><a href="#cb36-67" aria-hidden="true" tabindex="-1"></a>                           <span class="st">'Obj Func'</span>: obj_func, <span class="co">#\</span></span>
<span id="cb36-68"><a href="#cb36-68" aria-hidden="true" tabindex="-1"></a>                           <span class="st">'Mean in Option Price(%)'</span>: mean_in_price, </span>
<span id="cb36-69"><a href="#cb36-69" aria-hidden="true" tabindex="-1"></a>                           <span class="st">'STD in Option Price(%)'</span>: std_in_price, <span class="co">#\</span></span>
<span id="cb36-70"><a href="#cb36-70" aria-hidden="true" tabindex="-1"></a>                           <span class="st">'Obj Func in Option Price(%)'</span>: obj_func_in_price})</span>
<span id="cb36-71"><a href="#cb36-71" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb36-72"><a href="#cb36-72" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"----------- DDPG Result: </span><span class="sc">{</span>m<span class="sc">}</span><span class="ss"> hedges in </span><span class="sc">{</span><span class="bu">int</span>(T<span class="op">*</span><span class="dv">12</span>)<span class="sc">}</span><span class="ss"> month. -----------"</span>)</span>
<span id="cb36-73"><a href="#cb36-73" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb36-74"><a href="#cb36-74" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(result)</span>
<span id="cb36-75"><a href="#cb36-75" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb36-76"><a href="#cb36-76" aria-hidden="true" tabindex="-1"></a>    plt.figure(figsize<span class="op">=</span>(<span class="dv">8</span>,<span class="dv">6</span>))</span>
<span id="cb36-77"><a href="#cb36-77" aria-hidden="true" tabindex="-1"></a>    sns.histplot(rewards, label<span class="op">=</span><span class="st">'DDPG'</span>, kde<span class="op">=</span><span class="va">True</span>, stat<span class="op">=</span><span class="st">'density'</span>, element<span class="op">=</span><span class="st">'step'</span>)</span>
<span id="cb36-78"><a href="#cb36-78" aria-hidden="true" tabindex="-1"></a>    sns.histplot(payoff, kde<span class="op">=</span><span class="va">True</span>, label<span class="op">=</span><span class="st">'Delta'</span>, stat<span class="op">=</span><span class="st">'density'</span>, color<span class="op">=</span><span class="st">'orange'</span>, element<span class="op">=</span><span class="st">'step'</span>)</span>
<span id="cb36-79"><a href="#cb36-79" aria-hidden="true" tabindex="-1"></a>    plt.legend()</span>
<span id="cb36-80"><a href="#cb36-80" aria-hidden="true" tabindex="-1"></a>    plt.show()</span>
<span id="cb36-81"><a href="#cb36-81" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb36-82"><a href="#cb36-82" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> actor_model</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-63" class="cell" data-execution_count="26">
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a><span class="co"># function for plotting optimal policy </span></span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> mpl_toolkits.mplot3d <span class="im">import</span> Axes3D</span>
<span id="cb37-3"><a href="#cb37-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-4"><a href="#cb37-4" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> plotAction(curr_model):</span>
<span id="cb37-5"><a href="#cb37-5" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb37-6"><a href="#cb37-6" aria-hidden="true" tabindex="-1"></a>    TT <span class="op">=</span> np.arange(<span class="dv">0</span>, <span class="dv">1</span>, <span class="fl">0.05</span>)</span>
<span id="cb37-7"><a href="#cb37-7" aria-hidden="true" tabindex="-1"></a>    SS <span class="op">=</span> np.arange(<span class="dv">80</span>, <span class="dv">120</span>, <span class="fl">0.5</span>)</span>
<span id="cb37-8"><a href="#cb37-8" aria-hidden="true" tabindex="-1"></a>    Y, X <span class="op">=</span> np.meshgrid(TT, SS)</span>
<span id="cb37-9"><a href="#cb37-9" aria-hidden="true" tabindex="-1"></a>    Z_DDPG <span class="op">=</span> np.zeros((SS.shape[<span class="dv">0</span>], TT.shape[<span class="dv">0</span>]))</span>
<span id="cb37-10"><a href="#cb37-10" aria-hidden="true" tabindex="-1"></a>    <span class="co">#Z_BS = np.zeros((SS.shape[0], TT.shape[0]))</span></span>
<span id="cb37-11"><a href="#cb37-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-12"><a href="#cb37-12" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(SS.shape[<span class="dv">0</span>]):</span>
<span id="cb37-13"><a href="#cb37-13" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> j <span class="kw">in</span> <span class="bu">range</span>(TT.shape[<span class="dv">0</span>]):</span>
<span id="cb37-14"><a href="#cb37-14" aria-hidden="true" tabindex="-1"></a>            BS_model <span class="op">=</span> BSCall(T<span class="op">=</span>TT[j], sigma<span class="op">=</span>sigma, S0<span class="op">=</span>SS[i])</span>
<span id="cb37-15"><a href="#cb37-15" aria-hidden="true" tabindex="-1"></a>            output <span class="op">=</span> curr_model(np.array([[SS[i],BS_model[<span class="dv">0</span>],<span class="dv">0</span>,TT[j]]]))</span>
<span id="cb37-16"><a href="#cb37-16" aria-hidden="true" tabindex="-1"></a>            Z_DDPG[i,j] <span class="op">=</span> <span class="bu">next</span>(<span class="bu">iter</span>(output.values())).numpy()[<span class="dv">0</span>][<span class="dv">0</span>]</span>
<span id="cb37-17"><a href="#cb37-17" aria-hidden="true" tabindex="-1"></a>            <span class="co">#Z_BS[i,j] = BS_model[1]</span></span>
<span id="cb37-18"><a href="#cb37-18" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb37-19"><a href="#cb37-19" aria-hidden="true" tabindex="-1"></a>    V0 <span class="op">=</span> BSCall(T<span class="op">=</span>T, sigma<span class="op">=</span>sigma, S0<span class="op">=</span>S0)[<span class="dv">0</span>]</span>
<span id="cb37-20"><a href="#cb37-20" aria-hidden="true" tabindex="-1"></a>    BS_action_pos <span class="op">=</span> [<span class="bu">next</span>(<span class="bu">iter</span>(curr_model(np.array([[S0, V0, _pos, T]])).values())).numpy()[<span class="dv">0</span>][<span class="dv">0</span>] <span class="cf">for</span> _pos <span class="kw">in</span> np.arange(<span class="op">-</span><span class="dv">1</span>,<span class="dv">1</span>,<span class="fl">0.05</span>)]</span>
<span id="cb37-21"><a href="#cb37-21" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb37-22"><a href="#cb37-22" aria-hidden="true" tabindex="-1"></a>    <span class="co"># %matplotlib notebook</span></span>
<span id="cb37-23"><a href="#cb37-23" aria-hidden="true" tabindex="-1"></a>    fig <span class="op">=</span> plt.figure(figsize<span class="op">=</span>(<span class="dv">16</span>,<span class="dv">6</span>))  </span>
<span id="cb37-24"><a href="#cb37-24" aria-hidden="true" tabindex="-1"></a>    ax3 <span class="op">=</span> fig.add_subplot(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">1</span>, projection<span class="op">=</span><span class="st">'3d'</span>)</span>
<span id="cb37-25"><a href="#cb37-25" aria-hidden="true" tabindex="-1"></a>    ax3.plot_surface(X, Y, Z_DDPG)</span>
<span id="cb37-26"><a href="#cb37-26" aria-hidden="true" tabindex="-1"></a>    <span class="co"># ax3.plot_surface(X,Y,Z_BS)</span></span>
<span id="cb37-27"><a href="#cb37-27" aria-hidden="true" tabindex="-1"></a>    plt.title(<span class="st">"Action vs. Stock price &amp; Time to maturity"</span>)</span>
<span id="cb37-28"><a href="#cb37-28" aria-hidden="true" tabindex="-1"></a>    plt.xlabel(<span class="st">"Stock price"</span>)</span>
<span id="cb37-29"><a href="#cb37-29" aria-hidden="true" tabindex="-1"></a>    plt.ylabel(<span class="st">"Time to maturity"</span>)</span>
<span id="cb37-30"><a href="#cb37-30" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb37-31"><a href="#cb37-31" aria-hidden="true" tabindex="-1"></a>    ax2 <span class="op">=</span> fig.add_subplot(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">2</span>)</span>
<span id="cb37-32"><a href="#cb37-32" aria-hidden="true" tabindex="-1"></a>    ax2.plot(np.arange(<span class="op">-</span><span class="dv">1</span>, <span class="dv">1</span>, <span class="fl">0.05</span>), BS_action_pos)</span>
<span id="cb37-33"><a href="#cb37-33" aria-hidden="true" tabindex="-1"></a>    plt.title(<span class="st">"Action vs. Position"</span>)</span>
<span id="cb37-34"><a href="#cb37-34" aria-hidden="true" tabindex="-1"></a>    plt.xlabel(<span class="st">"Position"</span>)</span>
<span id="cb37-35"><a href="#cb37-35" aria-hidden="true" tabindex="-1"></a>    plt.show()<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="one-month-option-weekly-hedging" class="level2">
<h2 class="anchored" data-anchor-id="one-month-option-weekly-hedging">One-month option, weekly hedging</h2>
<div id="cell-65" class="cell" data-execution_count="27">
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a><span class="op">%%</span>time</span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a><span class="co"># model paramters</span></span>
<span id="cb38-3"><a href="#cb38-3" aria-hidden="true" tabindex="-1"></a>r, q, sigma, S0, K <span class="op">=</span> <span class="dv">0</span>, <span class="dv">0</span>, <span class="fl">0.2</span>, <span class="dv">100</span>, <span class="dv">100</span></span>
<span id="cb38-4"><a href="#cb38-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-5"><a href="#cb38-5" aria-hidden="true" tabindex="-1"></a><span class="co"># simulation parameters</span></span>
<span id="cb38-6"><a href="#cb38-6" aria-hidden="true" tabindex="-1"></a><span class="co"># option expires in a month, hedging weekly</span></span>
<span id="cb38-7"><a href="#cb38-7" aria-hidden="true" tabindex="-1"></a>T, m, n_path <span class="op">=</span> <span class="dv">1</span><span class="op">/</span><span class="dv">12</span>, <span class="dv">4</span>, <span class="dv">5_000</span></span>
<span id="cb38-8"><a href="#cb38-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-9"><a href="#cb38-9" aria-hidden="true" tabindex="-1"></a>model_path <span class="op">=</span> <span class="st">"DDPG/trained_models/1m/weekly"</span></span>
<span id="cb38-10"><a href="#cb38-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-11"><a href="#cb38-11" aria-hidden="true" tabindex="-1"></a><span class="co"># set random seed for reproducing the result</span></span>
<span id="cb38-12"><a href="#cb38-12" aria-hidden="true" tabindex="-1"></a>np.random.seed(<span class="dv">9999</span>)</span>
<span id="cb38-13"><a href="#cb38-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-14"><a href="#cb38-14" aria-hidden="true" tabindex="-1"></a>weekly <span class="op">=</span> DDPG(n_path<span class="op">=</span>n_path, m<span class="op">=</span>m, T<span class="op">=</span>T, r<span class="op">=</span>r, q<span class="op">=</span>q, sigma<span class="op">=</span>sigma, S0<span class="op">=</span>S0, K<span class="op">=</span>K, model_path<span class="op">=</span>model_path)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>0
2000
4000
----------- DDPG Result: 4 hedges in 1 month. -----------
       Name      Mean       STD  Obj Func  Mean in Option Price(%)  \
0      DDPG  1.135191  2.199476  4.434405                49.292365   
1     Delta  1.543443  1.172043  3.301507                67.019524   
2  No Hedge  0.053613  3.528923  5.346998                 2.327991   

   STD in Option Price(%)  Obj Func in Option Price(%)  
0               95.505890                   192.551201  
1               50.892563                   143.358369  
2              153.233282                   232.177914  </code></pre>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="NSD_Lec03-BlackMertonScholes-1_Summer2025_files/figure-html/cell-28-output-2.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>CPU times: total: 3.03 s
Wall time: 23.8 s</code></pre>
</div>
</div>
</section>
<section id="what-does-the-optimal-action-look-like" class="level2">
<h2 class="anchored" data-anchor-id="what-does-the-optimal-action-look-like">What does the optimal action look like?</h2>
<div id="cell-67" class="cell" data-execution_count="28">
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a>plotAction(weekly)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="NSD_Lec03-BlackMertonScholes-1_Summer2025_files/figure-html/cell-29-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="one-month-option-tridaily-hedging" class="level2">
<h2 class="anchored" data-anchor-id="one-month-option-tridaily-hedging">One-month option, tridaily hedging</h2>
<div id="cell-69" class="cell" data-execution_count="29">
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a><span class="op">%%</span>time</span>
<span id="cb42-2"><a href="#cb42-2" aria-hidden="true" tabindex="-1"></a><span class="co"># one month option, tridaily hedging</span></span>
<span id="cb42-3"><a href="#cb42-3" aria-hidden="true" tabindex="-1"></a>T, m <span class="op">=</span> <span class="dv">1</span><span class="op">/</span><span class="dv">12</span>, <span class="dv">10</span></span>
<span id="cb42-4"><a href="#cb42-4" aria-hidden="true" tabindex="-1"></a>model_path <span class="op">=</span> <span class="st">"DDPG/trained_models/1m/3-day"</span></span>
<span id="cb42-5"><a href="#cb42-5" aria-hidden="true" tabindex="-1"></a>tridaily <span class="op">=</span> DDPG(n_path<span class="op">=</span>n_path, m<span class="op">=</span>m, T<span class="op">=</span>T, r<span class="op">=</span>r, q<span class="op">=</span>q, sigma<span class="op">=</span>sigma, S0<span class="op">=</span>S0, K<span class="op">=</span>K, model_path<span class="op">=</span>model_path)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>0
2000
4000
----------- DDPG Result: 10 hedges in 1 month. -----------
       Name      Mean       STD  Obj Func  Mean in Option Price(%)  \
0      DDPG  1.798405  2.092016  4.936429                78.090545   
1     Delta  1.957786  0.940487  3.368517                85.011175   
2  No Hedge  0.017840  3.497339  5.263849                 0.774652   

   STD in Option Price(%)  Obj Func in Option Price(%)  
0               90.839724                   214.350131  
1               40.837944                   146.268091  
2              151.861840                   228.567411  </code></pre>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="NSD_Lec03-BlackMertonScholes-1_Summer2025_files/figure-html/cell-30-output-2.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>CPU times: total: 7.06 s
Wall time: 53.4 s</code></pre>
</div>
</div>
<div id="cell-70" class="cell" data-execution_count="30">
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a><span class="co"># plot tridaily action function </span></span>
<span id="cb45-2"><a href="#cb45-2" aria-hidden="true" tabindex="-1"></a>plotAction(tridaily)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="NSD_Lec03-BlackMertonScholes-1_Summer2025_files/figure-html/cell-31-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="month-option-weekly-hedging" class="level2">
<h2 class="anchored" data-anchor-id="month-option-weekly-hedging">3-month option, weekly hedging</h2>
<div id="cell-72" class="cell" data-execution_count="31">
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a><span class="op">%%</span>time</span>
<span id="cb46-2"><a href="#cb46-2" aria-hidden="true" tabindex="-1"></a><span class="co"># 3 months option, weekly hedging</span></span>
<span id="cb46-3"><a href="#cb46-3" aria-hidden="true" tabindex="-1"></a>T, m <span class="op">=</span> <span class="dv">3</span><span class="op">/</span><span class="dv">12</span>, <span class="dv">4</span></span>
<span id="cb46-4"><a href="#cb46-4" aria-hidden="true" tabindex="-1"></a>model_path <span class="op">=</span> <span class="st">"DDPG/trained_models/3m/weekly"</span></span>
<span id="cb46-5"><a href="#cb46-5" aria-hidden="true" tabindex="-1"></a>weekly_3m <span class="op">=</span> DDPG(n_path<span class="op">=</span>n_path, m<span class="op">=</span>m, T<span class="op">=</span>T, r<span class="op">=</span>r, q<span class="op">=</span>q, sigma<span class="op">=</span>sigma, S0<span class="op">=</span>S0, K<span class="op">=</span>K, model_path<span class="op">=</span>model_path)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>0
2000
4000
----------- DDPG Result: 4 hedges in 3 month. -----------
       Name      Mean       STD  Obj Func  Mean in Option Price(%)  \
0      DDPG  0.857973  3.904091  6.714109                21.515145   
1     Delta  1.474011  1.784586  4.150890                36.963365   
2  No Hedge -0.124989  6.013195  8.894803                -3.134323   

   STD in Option Price(%)  Obj Func in Option Price(%)  
0               97.901820                   168.367874  
1               44.751576                   104.090729  
2              150.791253                   223.052557  </code></pre>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="NSD_Lec03-BlackMertonScholes-1_Summer2025_files/figure-html/cell-32-output-2.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>CPU times: total: 2.89 s
Wall time: 19.6 s</code></pre>
</div>
</div>
<div id="cell-73" class="cell" data-execution_count="32">
<div class="sourceCode cell-code" id="cb49"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a>plotAction(weekly_3m)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="NSD_Lec03-BlackMertonScholes-1_Summer2025_files/figure-html/cell-33-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="concluding-remarks-on-deep-hedging" class="level2">
<h2 class="anchored" data-anchor-id="concluding-remarks-on-deep-hedging">Concluding remarks on deep hedging</h2>
<ul>
<li><p>Hedging with DDPG Algorithm can reduce the average hedging cost, however, it increases the variance of cost for the Black-Scholes model and probably also for stochastic volatility models.</p></li>
<li><p>As is mentioned in the original paper, the impact of trading costs (or transaction cost) is to under-hedge relative to delta hedging in some situations and over-hedge in other situations. By hedging short European call option position, we observe under-hedge relative to delta hedging.</p></li>
<li><p>One may be able to reduce the variance of hedging cost in the DDPG Algorithm by adding more paths for training. In the code, we used 5000 training paths for each model while renewing the model after each episode. However, using too many paths in the training stage may result in overfitting.</p></li>
</ul>
</section>
<section id="lecture-notes" class="level2">
<h2 class="anchored" data-anchor-id="lecture-notes">Lecture Notes</h2>
<p>Thanks to æ®µå‡¤ä»ª (DuÃ n FÃ¨ng YÃ­) and åˆ˜å¼˜é”Œ (LiÃº HÃ³ng XÄ«n) for their lecture notes.</p>
<section id="black-scholes-model-1" class="level3">
<h3 class="anchored" data-anchor-id="black-scholes-model-1">Black-Scholes Model</h3>
<ul>
<li>Revolutionary Concept: The Black-Scholes model, developed 24 years ago, introduced groundbreaking ideas that transformed option pricing. <em>It challenged traditional static hedging approaches with dynamic hedging, emphasizing continuous position adjustment</em>.</li>
<li>New Ideas: Key concepts include delta hedging, where the number of shares held (<span class="math inline">\(\Delta\)</span>) equals the partial derivative of the option price with respect to the stock price (<span class="math inline">\(\displaystyle \frac{\partial C}{\partial S}\)</span>). <font color="red">This approach aims to make the portfolio risk-free.</font></li>
</ul>
<p>æ¨¡å‹å‡è®¾:</p>
<ul>
<li>Stock Price Movement: The model assumes that <font color="green">stock prices</font> follow a <font color="blue">geometric Brownian motion</font>, where the return (change in price over price) follows a normal distribution. This assumption simplifies the pricing process.</li>
<li>Risk-Neutral Pricing: When pricing options, the model assumes a risk-neutral environment, where <font color="red">the expected return on the stock is equal to the risk-free interest rate</font>. This assumption allows for consistent pricing across different market conditions.</li>
</ul>
</section>
<section id="option-pricing-with-the-black-scholes-model" class="level3">
<h3 class="anchored" data-anchor-id="option-pricing-with-the-black-scholes-model">Option Pricing with the Black-Scholes Model</h3>
<section id="pricing-formula" class="level4">
<h4 class="anchored" data-anchor-id="pricing-formula">Pricing Formula</h4>
<ul>
<li>Call Option Price: The formula for call option price is</li>
</ul>
<p><span class="math display">\[
C = S e^{-D \tau} N(d_1) - K e^{-r \tau} N(d_2),
\]</span></p>
<p>where <span class="math inline">\(S\)</span> is the stock price, <span class="math inline">\(K\)</span> is the strike price, <span class="math inline">\(D\)</span> is the dividend rate, <span class="math inline">\(r\)</span> is the risk-free interest rate, <span class="math inline">\(\tau\)</span> is the time to expiration, and <span class="math inline">\(N(d_1)\)</span> and <span class="math inline">\(N(d_2)\)</span> are the cumulative distribution functions of the standard normal distribution.</p>
<ul>
<li>Put Option Price: The put option price formula is</li>
</ul>
<p><span class="math display">\[
P = K e^{-r \tau} N(-d_2) - S e^{-D \tau} N(-d_1).
\]</span></p>
</section>
<section id="parameter-estimation" class="level4">
<h4 class="anchored" data-anchor-id="parameter-estimation">Parameter Estimation</h4>
<ul>
<li>Volatility: Volatility (<span class="math inline">\(\sigma\)</span>) is a crucial parameter in the Black-Scholes model. It represents the degree of price fluctuation of the underlying asset. Estimating volatility accurately is challenging but essential for option pricing.</li>
<li>Other Parameters: Other parameters such as stock price, strike price, interest rate, and time to expiration are usually observable in the market. However, dividend rate may require estimation based on historical data or company announcements.</li>
</ul>
<p>æ³¨: å®šä»·ä¸çœŸå®æ¦‚ç‡æ— å…³ â†’ éœ€ç”¨<strong>é£é™©ä¸­æ€§æ¦‚ç‡</strong></p>
<p>é£é™©ä¸­æ€§ä¸‹: èµ„äº§æ”¶ç›Šç‡ = æ— é£é™©åˆ©ç‡(<span class="math inline">\(r\)</span>)</p>
</section>
</section>
<section id="æœŸæƒå®šä»·ä¸å¯¹å†²" class="level3">
<h3 class="anchored" data-anchor-id="æœŸæƒå®šä»·ä¸å¯¹å†²">æœŸæƒå®šä»·ä¸å¯¹å†²</h3>
<p>Example:</p>
<blockquote class="blockquote">
<ul>
<li>æœ‰å®¶å…¬å¸æŒç»­å–å‡ºè™šå€¼çœ‹æ¶¨æœŸæƒåå¤šå¹´ (æ­¤æ—¶ä¹°æ–¹è¡Œæƒæ— åˆ©å¯å›¾), èµšå–æƒåˆ©é‡‘, ä½†æŸæ¬¡å¸‚åœºå¤§å¹…ä¸Šæ¶¨å¯¼è‡´å·¨é¢äºæŸ (å¤§é‡ä¹°æ–¹è¦æ±‚è¡Œæƒ), CEO å…¬å¼€é“æ­‰. è¯´æ˜å³ä½¿æ¦‚ç‡å¾ˆå°, å–æ–¹é¢ä¸´çš„æ½œåœ¨æŸå¤±æ˜¯æ— é™çš„.</li>
<li>ä¹°å…¥æœŸæƒæœ€å¤šæŸå¤±æœŸæƒè´¹; è€Œå–å‡ºçœ‹æ¶¨æœŸæƒè‹¥æœªå¯¹å†², æŸå¤±å¯èƒ½æå¤§. å› æ­¤å¤§è§„æ¨¡æœºæ„ (å¦‚å¯¹å†²åŸºé‡‘) å¿…é¡»å¯¹å†².</li>
</ul>
</blockquote>
<section id="delta-hedging-1" class="level4">
<h4 class="anchored" data-anchor-id="delta-hedging-1">Delta Hedging</h4>
<p>æ„å»ºæ–¹æ³•: é€šè¿‡è®¡ç®—èµ„äº§ç»„åˆä¸­è‚¡ç¥¨ã€ç°é‡‘å’ŒæœŸæƒçš„ delta, ä½¿ç»„åˆæ€» delta ä¸º 0. ä¾‹å¦‚, å–å‡ºä¸€ä¸ª call æœŸæƒå, æŒæœ‰ç›¸åº”æ•°é‡çš„è‚¡ç¥¨å¯ä»¥å®ç° delta ä¸­æ€§.</p>
</section>
<section id="delta-gamma-hedging" class="level4">
<h4 class="anchored" data-anchor-id="delta-gamma-hedging">Delta-Gamma Hedging</h4>
<p>æ¦‚å¿µä»‹ç»: é™¤äº† delta ä¸­æ€§, è¿˜ä½¿ç»„åˆçš„ gamma ä¹Ÿä¸º 0. ç”±äºè‚¡ç¥¨ gamma ä¸º 0, éœ€è¦é¢å¤–å¼•å…¥å¦ä¸€ä¸ªæœŸæƒæ¥ä¸­å’Œ gamma.</p>
</section>
<section id="åŠ¨æ€å¯¹å†²-dynamic-hedging" class="level4">
<h4 class="anchored" data-anchor-id="åŠ¨æ€å¯¹å†²-dynamic-hedging">åŠ¨æ€å¯¹å†² (Dynamic Hedging)</h4>
<p>æ“ä½œæµç¨‹:</p>
<ul>
<li>æ¯æ—¥è°ƒæ•´: i) è®¡ç®—å½“æ—¥ç»„åˆ Delta/Gamma å€¼; ii) ä¹°å–è‚¡ç¥¨åŠå¯¹å†²æœŸæƒä½¿é£é™©ä¸­æ€§; iii) æŒ‰è‡ªèèµ„åŸåˆ™æ›´æ–°ç°é‡‘è´¦æˆ·.</li>
<li>æ¨¡æ‹Ÿæ•ˆæœ: 30 æ—¥åŠ¨æ€ Delta å¯¹å†²å, ç»„åˆæ³¢åŠ¨è¿œä½äºè£¸å–ç©º.</li>
</ul>
</section>
</section>
<section id="black-scholes-æ¨¡å‹ä¸éšå«æ³¢åŠ¨ç‡" class="level3">
<h3 class="anchored" data-anchor-id="black-scholes-æ¨¡å‹ä¸éšå«æ³¢åŠ¨ç‡">Black-Scholes æ¨¡å‹ä¸éšå«æ³¢åŠ¨ç‡</h3>
<p>å†å²èƒŒæ™¯: Black-Scholes æ¨¡å‹è‡ª 1973 å¹´èµ·è¢«å¹¿æ³›ä½¿ç”¨, äººä»¬æœ€åˆé€šè¿‡å†å²æ³¢åŠ¨ç‡æ¥è®¡ç®—æœŸæƒä»·æ ¼.</p>
<p>ç°å®ç¼ºé™·: å®é™…å¸‚åœºä¸­, ç”¨å¸‚åœºä»·æ ¼å€’æ¨å‡ºçš„éšå«æ³¢åŠ¨ç‡å‘ç°å…¶åœ¨ä¸åŒè¡Œæƒä»·å’ŒæœŸé™ä¸Šå¹¶ä¸ä¸€è‡´, è¯´æ˜æ¨¡å‹ä¸ç°å®å­˜åœ¨å·®è·.</p>
<p><strong>éšå«æ³¢åŠ¨ç‡çš„é‡è¦æ€§</strong></p>
<ul>
<li>å¸‚åœºæƒ…ç»ªæŒ‡æ ‡: éšå«æ³¢åŠ¨ç‡ä»£è¡¨å¸‚åœºå¯¹æœªæ¥æ³¢åŠ¨çš„é¢„æœŸ, æ˜¯æŠ•èµ„è€…æƒ…ç»ªçš„åæ˜ .</li>
<li>æ¨¡å‹æ”¹è¿›æ–¹å‘: éšå«æ³¢åŠ¨ç‡çš„å‘ç°ä¹Ÿæ¨åŠ¨äº†æ¨¡å‹çš„æ”¹è¿›, æ¯”å¦‚å±€éƒ¨æ³¢åŠ¨ç‡æ¨¡å‹ã€éšæœºæ³¢åŠ¨ç‡æ¨¡å‹ç­‰, ä½¿æ¨¡å‹æ›´è´´åˆå®é™….</li>
</ul>
<p>éšå«æ³¢åŠ¨ç‡å¾®ç¬‘ç°è±¡: åœ¨å®é™…å¸‚åœºä¸­, éšå«æ³¢åŠ¨ç‡å¾€å¾€å‘ˆç°å‡ºä¸åŒçš„å½¢çŠ¶, å¦‚ U å½¢æˆ– V å½¢, è€Œä¸æ˜¯å•è°ƒé€’å¢æˆ–é€’å‡ã€‚è¿™ç§ç°è±¡è¢«ç§°ä¸ºéšå«æ³¢åŠ¨ç‡å¾®ç¬‘.</p>
<p>å¸‚åœºä¿®æ­£æ¨¡å‹:</p>
<ul>
<li>Dupire å±€éƒ¨æ³¢åŠ¨ç‡æ¨¡å‹: é€šè¿‡å±€éƒ¨æ³¢åŠ¨ç‡æ¥ä¿®æ­£ Black-Scholes æ¨¡å‹ï¼Œä½¿å…¶èƒ½å¤Ÿæ›´å¥½åœ°é€‚åº”å¸‚åœºæ•°æ®.</li>
<li>Heston éšæœºæ³¢åŠ¨ç‡æ¨¡å‹: é€šè¿‡å¼•å…¥éšæœºæ³¢åŠ¨ç‡æ¥ä¿®æ­£ Black-Scholes æ¨¡å‹ï¼Œä½¿å…¶èƒ½å¤Ÿæ›´å¥½åœ°æ•æ‰å¸‚åœºçš„æ³¢åŠ¨ç‰¹æ€§. <span class="math display">\[
\mathrm{d} \nu_t = \kappa(\theta - \nu_t) \mathrm{d}t + \sigma \sqrt{\nu_t} \mathrm{d}W_t,
\]</span> è¿™é‡Œæ³¢åŠ¨ç‡ <span class="math inline">\(\nu_t\)</span> è‡ªèº«éšæœºæ¼”åŒ–, å¸¸ç”¨äºæ‹Ÿåˆéšå«æ³¢åŠ¨ç‡éšè¡Œæƒä»·ä¸æœŸé™çš„å¼‚è´¨æ€§.</li>
</ul>
</section>
<section id="jump-trading" class="level3">
<h3 class="anchored" data-anchor-id="jump-trading">Jump Trading</h3>
<ol type="1">
<li><p>å…¬å¸å‘å±•ä¸äº¤æ˜“ç­–ç•¥</p>
<ul>
<li>ç§‘æŠ€é©±åŠ¨: 1999 å¹´åˆ›ç«‹äºèŠåŠ å“¥äº¤æ˜“æ‰€, è‡´åŠ›äºç”µå­äº¤æ˜“, ä»ä¼ ç»Ÿå¥—åˆ©é€æ­¥è½¬å‹.</li>
<li>å¤šé¢‘ç‡äº¤æ˜“: æ¶µç›–é«˜é¢‘ã€ä¸­é¢‘ã€ä½é¢‘äº¤æ˜“, åˆ©ç”¨çº¿æ€§å›å½’ã€æœºå™¨å­¦ä¹ ã€AI ç­‰ç­–ç•¥.</li>
<li>æŠ€æœ¯æŠ•å…¥: æ‹¥æœ‰é«˜æ€§èƒ½ C++ ç³»ç»Ÿã€è‡ªç ”ç¡¬ä»¶å’Œè¶…çº§è®¡ç®—é›†ç¾¤, åœ¨ç½‘ç»œä¼ è¾“æ–¹é¢æŠ•å…¥å·¨å¤§.</li>
</ul></li>
<li><p>å…¬å¸æ–‡åŒ–ä¸ä»·å€¼è§‚</p>
<ul>
<li>æ‰å¹³ç»“æ„: ç»„ç»‡å±‚çº§å°‘, å†³ç­–å¿«é€Ÿ, å‘˜å·¥æœ‰è‡ªç”±æå‡ºå’Œå®ç°æƒ³æ³•.</li>
<li>æŒ‰èƒ½åŠ›å¥–åŠ±: é¼“åŠ±åˆ›æ–°, å¥½çš„ç‚¹å­ä¸è®ºå‡ºè‡ªè°éƒ½èƒ½è¢«é‡‡çº³.</li>
<li>æ–‡åŒ–æ´»åŠ¨ä¸°å¯Œ: å¦‚å…¬å¸æä¾›æ—©é¤ã€åˆé¤ã€ä¸‹åˆèŒ¶, ä¸¾åŠå…¨çƒæ‰‘å…‹ç‰Œæ¯”èµ›ã€ä¹’ä¹“èµ›ç­‰ï¼Œè¥é€ è½»æ¾æ°›å›´.</li>
</ul></li>
<li><p>æ‹›è˜ä¿¡æ¯</p>
<ul>
<li>å®ä¹ é¡¹ç›®: å¤å­£ 10 å‘¨, åŒ…æ‹¬ 3 å‘¨åŸ¹è®­ä¸è½®å²—, çœŸå®å‚ä¸é¡¹ç›®, å¯¼å¸ˆæ¯å‘¨åé¦ˆ.</li>
<li>å…¨èŒæœºä¼š: è¡¨ç°å¥½çš„å®ä¹ ç”Ÿå¯ç›´æ¥è·å¾—æ­£å¼å·¥ä½œé‚€è¯·.</li>
</ul></li>
</ol>
</section>
<section id="åšå¸‚å•†æ ¸å¿ƒèŒèƒ½ä¸ç›ˆåˆ©æœºåˆ¶" class="level3">
<h3 class="anchored" data-anchor-id="åšå¸‚å•†æ ¸å¿ƒèŒèƒ½ä¸ç›ˆåˆ©æœºåˆ¶">åšå¸‚å•†æ ¸å¿ƒèŒèƒ½ä¸ç›ˆåˆ©æœºåˆ¶ ğŸ¦</h3>
<p>åšå¸‚å•† (Market Maker) åœ¨é«˜é¢‘äº¤æ˜“ (HFT) ç¯å¢ƒä¸­æœ‰æ€æ ·çš„å¸‚åœºæœºåˆ¶ã€ç­–ç•¥æ¶æ„ã€é£æ§æ¡†æ¶ä»¥åŠå°† RL å¯¹å†²ä¸æ¨¡å‹é£é™©ç®¡ç†èåˆçš„æ€è·¯?</p>
<p>å¸‚åœºæœºåˆ¶:</p>
<ol type="1">
<li>ä»·æ ¼å‘ç°æœºåˆ¶: åšå¸‚å•†é€šè¿‡æä¾›ä¹°å–æŠ¥ä»·ï¼Œå¸®åŠ©å¸‚åœºå½¢æˆä»·æ ¼. å…¶æŠ¥ä»·åŸºäºå¯¹å¸‚åœºæµåŠ¨æ€§ã€ä¾›éœ€å…³ç³»å’Œå…¶ä»–å¸‚åœºå‚ä¸è€…è¡Œä¸ºçš„åˆ†æ.</li>
<li>æµåŠ¨æ€§ä¾›ç»™: åšå¸‚å•†ä¸æ–­æŒ‚å• (Bid/Ask), æœåŠ¡æœºæ„å¤§å•è¿›å‡ºå¸‚åœº, ç¨³å®šæ·±åº¦å¹¶é™ä½äº¤æ˜“æ»‘ç‚¹.</li>
</ol>
</section>
<section id="é«˜é¢‘äº¤æ˜“å…³é”®è¦ç´ ä¸æŠ€æœ¯åŸºç¡€" class="level3">
<h3 class="anchored" data-anchor-id="é«˜é¢‘äº¤æ˜“å…³é”®è¦ç´ ä¸æŠ€æœ¯åŸºç¡€">é«˜é¢‘äº¤æ˜“å…³é”®è¦ç´ ä¸æŠ€æœ¯åŸºç¡€ ğŸ–¥ï¸</h3>
<ol type="1">
<li>è®¢å•ç°¿è§£æä¸ä¿¡å·è¯†åˆ«
<ol type="a">
<li>å¤§å•æ‹†åˆ†, å¦‚ 500 æ‰‹ â†’ 10Ã—50 æ‰‹, æš—ç¤ºæœºæ„å»ºä»“.</li>
<li>å†°å±±è®¢å•, æŒç»­å°é‡æˆäº¤, é¢„ç¤ºéšè—å¤§å•.</li>
</ol></li>
<li>åŸºç¡€è®¾æ–½: æä½å»¶è¿Ÿ
<ol type="a">
<li>ä½¿ç”¨ FPGA æˆ– kernel bypass æŠ€æœ¯å®ç°æä½å»¶è¿Ÿå¤„ç†</li>
<li>åˆ©ç”¨å¾®æ³¢ã€æ— çº¿ç­‰ä¼ è¾“æ–¹å¼, æ¯”å…‰çº¤æ›´æ¥è¿‘ç›´çº¿è·¯å¾„, å‡å°‘ä¼ è¾“è·ç¦»å’Œå»¶è¿Ÿ</li>
<li>å¸‚åœºæ¥è¿‘æ€§éƒ¨ç½² (colocation)ã€ä¸“æœ‰ç›´è¿çº¿è·¯å’Œé›¶è·³ç‚¹ç½‘ç»œè®¾è®¡ä»¥ç¼©çŸ­ tickâ€‘toâ€‘trade æ—¶å»¶</li>
</ol></li>
</ol>
<p><span class="citation" data-cites="gao2020optimalmarketmakingpresence">(<a href="#ref-gao2020optimalmarketmakingpresence" role="doc-biblioref">Gao and Wang 2020</a>)</span></p>
<blockquote class="blockquote">
<p>Our analysis suggests that latency can be an additional risk source for market makers and one key task in market making is to predict the order values based on market primitives.</p>
</blockquote>
</section>
<section id="å…³é”®æ¦‚å¿µæ€»ç»“" class="level3">
<h3 class="anchored" data-anchor-id="å…³é”®æ¦‚å¿µæ€»ç»“">å…³é”®æ¦‚å¿µæ€»ç»“</h3>
<table class="caption-top table">
<colgroup>
<col style="width: 25%">
<col style="width: 25%">
<col style="width: 50%">
</colgroup>
<thead>
<tr class="header">
<th>æ¦‚å¿µ</th>
<th>å®šä¹‰</th>
<th>åº”ç”¨åœºæ™¯</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Delta (<span class="math inline">\(\Delta\)</span>)</td>
<td>æœŸæƒä»·æ ¼å¯¹æ ‡çš„ä»·æ ¼çš„ä¸€é˜¶æ•æ„Ÿåº¦ (å¯¹å†²æ¯”ç‡)</td>
<td>Delta å¯¹å†²æ¶ˆé™¤çº¿æ€§é£é™©</td>
</tr>
<tr class="even">
<td>Gamma (<span class="math inline">\(\Gamma\)</span>)</td>
<td>æœŸæƒä»·æ ¼å¯¹æ ‡çš„ä»·æ ¼çš„äºŒé˜¶æ•æ„Ÿåº¦ (æ›²ç‡é£é™©)</td>
<td>Gamma å¯¹å†²æ¶ˆé™¤éçº¿æ€§é£é™©</td>
</tr>
<tr class="odd">
<td>è‡ªèèµ„</td>
<td>å¤´å¯¸è°ƒæ•´ä»…é€šè¿‡å†…éƒ¨ç°é‡‘è°ƒé…, æ— å¤–éƒ¨æ³¨èµ„</td>
<td>ä¿è¯å¯¹å†²æˆæœ¬å¯æ§</td>
</tr>
<tr class="even">
<td>æ³¢åŠ¨ç‡å¾®ç¬‘</td>
<td>è™šå€¼/å®å€¼æœŸæƒéšå«æ³¢åŠ¨ç‡é«˜äºå¹³å€¼çš„å¸‚åœºç°è±¡</td>
<td>æ­ç¤ºBSæ¨¡å‹å±€é™æ€§</td>
</tr>
<tr class="odd">
<td>æ·±åº¦è™šå€¼æœŸæƒ</td>
<td>è¡Œæƒä»·è¿œç¦»ç°ä»·çš„æœŸæƒ (å¦‚ç°ä»·$10, è¡Œæƒä»·$14)</td>
<td>Gamma å¯¹å†²çš„æˆæœ¬æœ€ä¼˜å·¥å…·</td>
</tr>
<tr class="even">
<td>éšæœºæ³¢åŠ¨ç‡</td>
<td>æ³¢åŠ¨ç‡éšæ—¶é—´éšæœºå˜åŒ–çš„æ¨¡å‹ (å¦‚Heston)</td>
<td>æ›´è´´åˆå¸‚åœºå®é™…çš„å¸Œè…Šå€¼è®¡ç®—</td>
</tr>
</tbody>
</table>



</section>
</section>

<div id="quarto-appendix" class="default"><section class="quarto-appendix-contents" role="doc-bibliography" id="quarto-bibliography"><h2 class="anchored quarto-appendix-heading">References</h2><div id="refs" class="references csl-bib-body hanging-indent" data-entry-spacing="0" role="list">
<div id="ref-gao2020optimalmarketmakingpresence" class="csl-entry" role="listitem">
Gao, Xuefeng, and Yunhan Wang. 2020. <span>â€œOptimal Market Making in the Presence of Latency.â€</span> <a href="https://arxiv.org/abs/1806.05849">https://arxiv.org/abs/1806.05849</a>.
</div>
</div></section></div></main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "î§‹";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
        const codeEl = trigger.previousElementSibling.cloneNode(true);
        for (const childEl of codeEl.children) {
          if (isCodeAnnotation(childEl)) {
            childEl.remove();
          }
        }
        return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp('/' + window.location.host + '/');
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
</div> <!-- /content -->




</body></html>