<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.7.32">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Topics in Quantitative Finance, Summer 2025 – Topics in QF</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
/* CSS for citations */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
  margin-bottom: 0em;
}
.hanging-indent div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}</style>


<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js" integrity="sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==" crossorigin="anonymous"></script><script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<script src="../site_libs/quarto-html/quarto.js" type="module"></script>
<script src="../site_libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting-37eea08aefeeee20ff55810ff984fec1.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap-b82b626913fb92a8b9be04cecd5320fa.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" integrity="sha512-c3Nl8+7g4LMSTdrm621y7kf9v3SDPnhxLNhcjFJbKECVnmZHTdo+IRO05sNLTH/D3vA6u1X32ehoLC7WFVdheg==" crossorigin="anonymous"></script>

<script type="application/javascript">define('jquery', [],function() {return window.jQuery;})</script>

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

<link rel="stylesheet" href="../styles.css">
<link rel="stylesheet" href="styles.css">
</head>

<body class="nav-fixed quarto-light">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="../index.html">
    <span class="navbar-title">Topics in QF</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="../index.html"> 
<span class="menu-text">Home</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../about.html"> 
<span class="menu-text">About</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../NSD_Lec01-FinancialEngineering_Summer2025.html"> 
<span class="menu-text">Lecture 01</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../NSD_Lec02-StochCal_Summer2025.html"> 
<span class="menu-text">Lecture 02</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../NSD_Lec03-BlackMertonScholes-1_Summer2025.html"> 
<span class="menu-text">Lecture 03</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../NSD_Lec04_Summer2025/NSD_Lec04-BlackMertonScholes-2_Summer2025.html"> 
<span class="menu-text">Lecture 04</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link active" href="../NSD_Lec05_Summer2025/NSD_Lec05-Volatility_Summer2025.html" aria-current="page"> 
<span class="menu-text">Lecture 05</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../NSD_Lec06-OptimalOrderExecution_Summer2025.html"> 
<span class="menu-text">Lecture 06</span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-full page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#lecture-5-volatility-and-volatility-linked-derivatives" id="toc-lecture-5-volatility-and-volatility-linked-derivatives" class="nav-link active" data-scroll-target="#lecture-5-volatility-and-volatility-linked-derivatives">Lecture 5: Volatility and volatility-linked derivatives</a></li>
  <li><a href="#agenda" id="toc-agenda" class="nav-link" data-scroll-target="#agenda">Agenda</a></li>
  <li><a href="#what-is-volatility" id="toc-what-is-volatility" class="nav-link" data-scroll-target="#what-is-volatility">What is volatility?</a></li>
  <li><a href="#why-is-volatility-important" id="toc-why-is-volatility-important" class="nav-link" data-scroll-target="#why-is-volatility-important">Why is volatility important?</a></li>
  <li><a href="#volatilities" id="toc-volatilities" class="nav-link" data-scroll-target="#volatilities">Volatilities</a></li>
  <li><a href="#historical-volatility" id="toc-historical-volatility" class="nav-link" data-scroll-target="#historical-volatility">Historical volatility</a></li>
  <li><a href="#example-of-historical-volatility" id="toc-example-of-historical-volatility" class="nav-link" data-scroll-target="#example-of-historical-volatility">Example of historical volatility</a>
  <ul class="collapse">
  <li><a href="#note" id="toc-note" class="nav-link" data-scroll-target="#note">Note</a></li>
  <li><a href="#exponentially-weighted-moving-average-ewma" id="toc-exponentially-weighted-moving-average-ewma" class="nav-link" data-scroll-target="#exponentially-weighted-moving-average-ewma">Exponentially weighted moving average (EWMA)</a></li>
  </ul></li>
  <li><a href="#now-lets-dirty-our-hands" id="toc-now-lets-dirty-our-hands" class="nav-link" data-scroll-target="#now-lets-dirty-our-hands">Now let’s dirty our hands …</a>
  <ul class="collapse">
  <li><a href="#tips-you-may-skip-the-next-5-cells-if-you-encounter-an-error." id="toc-tips-you-may-skip-the-next-5-cells-if-you-encounter-an-error." class="nav-link" data-scroll-target="#tips-you-may-skip-the-next-5-cells-if-you-encounter-an-error.">Tips: You may skip the next 5 cells if you encounter an error.</a></li>
  <li><a href="#you-may-start-from-here." id="toc-you-may-start-from-here." class="nav-link" data-scroll-target="#you-may-start-from-here.">You may start from here.</a></li>
  </ul></li>
  <li><a href="#volatility-estimation-using-ohlc" id="toc-volatility-estimation-using-ohlc" class="nav-link" data-scroll-target="#volatility-estimation-using-ohlc">Volatility estimation using OHLC</a></li>
  <li><a href="#implied-volatility" id="toc-implied-volatility" class="nav-link" data-scroll-target="#implied-volatility">Implied volatility</a></li>
  <li><a href="#why-implied-volatility-rather-than-the-price-itself" id="toc-why-implied-volatility-rather-than-the-price-itself" class="nav-link" data-scroll-target="#why-implied-volatility-rather-than-the-price-itself">Why implied volatility rather than the price itself?</a></li>
  <li><a href="#a-practical-tip-for-fetching-risk-free-and-dividend-rates" id="toc-a-practical-tip-for-fetching-risk-free-and-dividend-rates" class="nav-link" data-scroll-target="#a-practical-tip-for-fetching-risk-free-and-dividend-rates">A practical tip for fetching risk free and dividend rates</a></li>
  <li><a href="#example---implied-volatilities-of-options-on-spx" id="toc-example---implied-volatilities-of-options-on-spx" class="nav-link" data-scroll-target="#example---implied-volatilities-of-options-on-spx">Example - Implied volatilities of options on SPX</a>
  <ul class="collapse">
  <li><a href="#tips-you-may-skip-the-next-12-cells-if-you-encounter-an-error." id="toc-tips-you-may-skip-the-next-12-cells-if-you-encounter-an-error." class="nav-link" data-scroll-target="#tips-you-may-skip-the-next-12-cells-if-you-encounter-an-error.">Tips: You may skip the next 12 cells if you encounter an error.</a></li>
  <li><a href="#you-may-start-from-here" id="toc-you-may-start-from-here" class="nav-link" data-scroll-target="#you-may-start-from-here">You may start from here</a></li>
  <li><a href="#create-python-class-optionanalytics" id="toc-create-python-class-optionanalytics" class="nav-link" data-scroll-target="#create-python-class-optionanalytics">Create <code>python</code> class <code>OptionAnalytics</code></a></li>
  </ul></li>
  <li><a href="#a-shorter-time-to-expiry-option-on-spx" id="toc-a-shorter-time-to-expiry-option-on-spx" class="nav-link" data-scroll-target="#a-shorter-time-to-expiry-option-on-spx">A shorter time to expiry option on SPX</a>
  <ul class="collapse">
  <li><a href="#tips-you-may-skip-this-part-if-you-encounter-an-error." id="toc-tips-you-may-skip-this-part-if-you-encounter-an-error." class="nav-link" data-scroll-target="#tips-you-may-skip-this-part-if-you-encounter-an-error.">Tips: You may skip this part if you encounter an error.</a></li>
  <li><a href="#you-may-start-from-here.-1" id="toc-you-may-start-from-here.-1" class="nav-link" data-scroll-target="#you-may-start-from-here.-1">You may start from here.</a></li>
  </ul></li>
  <li><a href="#gpr-fit-for-spx-implied-volatility-curve" id="toc-gpr-fit-for-spx-implied-volatility-curve" class="nav-link" data-scroll-target="#gpr-fit-for-spx-implied-volatility-curve">GPR fit for SPX implied volatility curve</a>
  <ul class="collapse">
  <li><a href="#fine-tune-hyperparameters-by-mle" id="toc-fine-tune-hyperparameters-by-mle" class="nav-link" data-scroll-target="#fine-tune-hyperparameters-by-mle">Fine tune hyperparameters by MLE</a></li>
  </ul></li>
  <li><a href="#what-is-vix" id="toc-what-is-vix" class="nav-link" data-scroll-target="#what-is-vix">What is VIX?</a></li>
  <li><a href="#volatility-indices-published-by-cboe" id="toc-volatility-indices-published-by-cboe" class="nav-link" data-scroll-target="#volatility-indices-published-by-cboe">Volatility indices published by CBOE</a>
  <ul class="collapse">
  <li><a href="#note-1" id="toc-note-1" class="nav-link" data-scroll-target="#note-1">Note</a></li>
  </ul></li>
  <li><a href="#formula-of-financial-engineering" id="toc-formula-of-financial-engineering" class="nav-link" data-scroll-target="#formula-of-financial-engineering">“Formula of financial engineering”</a></li>
  <li><a href="#example---log-contract" id="toc-example---log-contract" class="nav-link" data-scroll-target="#example---log-contract">Example - log contract</a>
  <ul class="collapse">
  <li><a href="#note-2" id="toc-note-2" class="nav-link" data-scroll-target="#note-2">Note</a></li>
  </ul></li>
  <li><a href="#how-is-vix-calculated" id="toc-how-is-vix-calculated" class="nav-link" data-scroll-target="#how-is-vix-calculated">How is VIX calculated?</a>
  <ul class="collapse">
  <li><a href="#download-vix-data-from-yfinance" id="toc-download-vix-data-from-yfinance" class="nav-link" data-scroll-target="#download-vix-data-from-yfinance">Download VIX data from <code>yfinance</code></a></li>
  <li><a href="#you-may-skip-this-part-if-you-encounter-an-error." id="toc-you-may-skip-this-part-if-you-encounter-an-error." class="nav-link" data-scroll-target="#you-may-skip-this-part-if-you-encounter-an-error.">You may skip this part if you encounter an error.</a></li>
  </ul></li>
  <li><a href="#volatility-derivatives" id="toc-volatility-derivatives" class="nav-link" data-scroll-target="#volatility-derivatives">Volatility derivatives</a></li>
  <li><a href="#variance-swap" id="toc-variance-swap" class="nav-link" data-scroll-target="#variance-swap">Variance swap</a></li>
  <li><a href="#volatility-swap" id="toc-volatility-swap" class="nav-link" data-scroll-target="#volatility-swap">Volatility swap</a></li>
  <li><a href="#calculating-volatility-swap-fair-strike-from-mgf" id="toc-calculating-volatility-swap-fair-strike-from-mgf" class="nav-link" data-scroll-target="#calculating-volatility-swap-fair-strike-from-mgf">Calculating volatility swap fair strike from MGF</a></li>
  <li><a href="#vix-futures" id="toc-vix-futures" class="nav-link" data-scroll-target="#vix-futures">VIX futures</a></li>
  <li><a href="#vix-option" id="toc-vix-option" class="nav-link" data-scroll-target="#vix-option">VIX option</a></li>
  <li><a href="#a-look-at-the-vix-option-chain-from-yahoo-finance" id="toc-a-look-at-the-vix-option-chain-from-yahoo-finance" class="nav-link" data-scroll-target="#a-look-at-the-vix-option-chain-from-yahoo-finance">A look at the VIX option chain from Yahoo Finance</a>
  <ul class="collapse">
  <li><a href="#you-may-skip-the-next-5-cells-if-you-encounter-an-error." id="toc-you-may-skip-the-next-5-cells-if-you-encounter-an-error." class="nav-link" data-scroll-target="#you-may-skip-the-next-5-cells-if-you-encounter-an-error.">You may skip the next 5 cells if you encounter an error.</a></li>
  <li><a href="#you-may-start-from-here.-2" id="toc-you-may-start-from-here.-2" class="nav-link" data-scroll-target="#you-may-start-from-here.-2">You may start from here.</a></li>
  </ul></li>
  <li><a href="#gpr-fit-for-vix-option-implied-volatility-curve" id="toc-gpr-fit-for-vix-option-implied-volatility-curve" class="nav-link" data-scroll-target="#gpr-fit-for-vix-option-implied-volatility-curve">GPR fit for VIX option implied volatility curve</a></li>
  <li><a href="#appendix-optional" id="toc-appendix-optional" class="nav-link" data-scroll-target="#appendix-optional">Appendix (Optional)</a></li>
  <li><a href="#volatility-estimation-using-high-frequency-data" id="toc-volatility-estimation-using-high-frequency-data" class="nav-link" data-scroll-target="#volatility-estimation-using-high-frequency-data">Volatility estimation using high frequency data</a></li>
  <li><a href="#realized-variance" id="toc-realized-variance" class="nav-link" data-scroll-target="#realized-variance">Realized variance</a>
  <ul class="collapse">
  <li><a href="#technical-notes" id="toc-technical-notes" class="nav-link" data-scroll-target="#technical-notes">Technical notes</a></li>
  <li><a href="#assumption" id="toc-assumption" class="nav-link" data-scroll-target="#assumption">Assumption</a></li>
  </ul></li>
  <li><a href="#integrated-variance-or-quadratic-variation" id="toc-integrated-variance-or-quadratic-variation" class="nav-link" data-scroll-target="#integrated-variance-or-quadratic-variation">Integrated variance or quadratic variation</a>
  <ul class="collapse">
  <li><a href="#microstructure-noise" id="toc-microstructure-noise" class="nav-link" data-scroll-target="#microstructure-noise">Microstructure noise</a></li>
  <li><a href="#asymptotic-result" id="toc-asymptotic-result" class="nav-link" data-scroll-target="#asymptotic-result">Asymptotic result</a></li>
  <li><a href="#the-conventional-solution" id="toc-the-conventional-solution" class="nav-link" data-scroll-target="#the-conventional-solution">The conventional solution</a></li>
  <li><a href="#subsampling" id="toc-subsampling" class="nav-link" data-scroll-target="#subsampling">Subsampling</a></li>
  <li><a href="#boosting-rv-estimator" id="toc-boosting-rv-estimator" class="nav-link" data-scroll-target="#boosting-rv-estimator">Boosting RV estimator</a></li>
  <li><a href="#the-zma-estimator" id="toc-the-zma-estimator" class="nav-link" data-scroll-target="#the-zma-estimator">The ZMA estimator</a></li>
  <li><a href="#the-zhou-estimator" id="toc-the-zhou-estimator" class="nav-link" data-scroll-target="#the-zhou-estimator">The Zhou estimator</a></li>
  </ul></li>
  <li><a href="#realized-library" id="toc-realized-library" class="nav-link" data-scroll-target="#realized-library">Realized library</a></li>
  <li><a href="#spx-realized-variance" id="toc-spx-realized-variance" class="nav-link" data-scroll-target="#spx-realized-variance">SPX realized variance</a></li>
  <li><a href="#the-corsi-har-rv-forecast" id="toc-the-corsi-har-rv-forecast" class="nav-link" data-scroll-target="#the-corsi-har-rv-forecast">The Corsi HAR-RV forecast</a>
  <ul class="collapse">
  <li><a href="#note-9" id="toc-note-9" class="nav-link" data-scroll-target="#note-9">Note</a></li>
  <li><a href="#references" id="toc-references" class="nav-link" data-scroll-target="#references">References</a></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content column-page-left" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Topics in Quantitative Finance, Summer 2025</h1>
</div>



<div class="quarto-title-meta column-page-left">

    
  
    
  </div>
  


</header>


<section id="lecture-5-volatility-and-volatility-linked-derivatives" class="level2">
<h2 class="anchored" data-anchor-id="lecture-5-volatility-and-volatility-linked-derivatives">Lecture 5: Volatility and volatility-linked derivatives</h2>
<p><br> <br></p>
<center>
<font size="5," color="darkblue"> Tai-Ho Wang (王 太和)</font>
</center>
<p><span class="math display">\[
\newcommand{\bea}{\begin{eqnarray}}
\newcommand{\eea}{\end{eqnarray}}
\newcommand{\supp}{\mathrm{supp}}
\newcommand{\F}{\mathcal{F} }
\newcommand{\cF}{\mathcal{F} }
\newcommand{\E}{\mathbb{E} }
\newcommand{\Eof}[1]{\mathbb{E}\left[ #1 \right]}
\newcommand{\Etof}[1]{\mathbb{E}_t\left[ #1 \right]}
\def\Cov{{ \text{Cov} }}
\def\ES{{ \text{ES} }}
\def\Var{{ \text{Var} }}
\def\VaR{{ \text{VaR} }}
\def\sd{{ \text{sd} }}
\def\corr{{ \text{corr} }}
\newcommand{\1}{\mathbf{1} }
\newcommand{\p}{\partial}
\newcommand{\PP}{\mathbb{P} }
\newcommand{\Pof}[1]{\mathbb{P}\left[ #1 \right]}
\newcommand{\QQ}{\mathbb{Q} }
\renewcommand{\R}{\mathbb{R} }
\newcommand{\DD}{\mathbb{D} }
\newcommand{\HH}{\mathbb{H} }
\newcommand{\spn}{\mathrm{span} }
\newcommand{\cov}{\mathrm{cov} }
\newcommand{\HS}{\mathcal{L}_{\mathrm{HS}} }
\newcommand{\Hess}{\mathrm{Hess} }
\newcommand{\trace}{\mathrm{trace} }
\newcommand{\LL}{\mathcal{L} }
\newcommand{\s}{\mathcal{S} }
\newcommand{\ee}{\mathcal{E} }
\newcommand{\ff}{\mathcal{F} }
\newcommand{\hh}{\mathcal{H} }
\newcommand{\bb}{\mathcal{B} }
\newcommand{\dd}{\mathcal{D} }
\newcommand{\g}{\mathcal{G} }
\newcommand{\half}{\frac{1}{2} }
\newcommand{\T}{\mathcal{T} }
\newcommand{\bit}{\begin{itemize}}
\newcommand{\eit}{\end{itemize}}
\newcommand{\beq}{\begin{equation}}
\newcommand{\eeq}{\end{equation}}
\newcommand{\tr}{\text{tr}}
\renewcommand{\angl}[1]{\langle #1 \rangle}
\]</span></p>
</section>
<section id="agenda" class="level2">
<h2 class="anchored" data-anchor-id="agenda">Agenda</h2>
<ul>
<li>Volatility and its various estimators
<ul>
<li>Historical volatility</li>
<li>Implied volatility</li>
<li>Realized variance</li>
<li>VIX</li>
</ul></li>
<li>Implied volatility
<ul>
<li>Estimating discount factor and dividend rates by put-call parity</li>
<li>GPR fit of implied volatilities</li>
</ul></li>
<li>Volatility indices published by CBOE</li>
<li>Volatility linked derivatives
<ul>
<li>VIX option</li>
</ul></li>
<li>Appendix (Optional)
<ul>
<li>Realized variance from high frequency data</li>
<li>The Corsi HAR-RV forecast</li>
</ul></li>
</ul>
</section>
<section id="what-is-volatility" class="level2">
<h2 class="anchored" data-anchor-id="what-is-volatility">What is volatility?</h2>
<p>From the <a href="https://en.wikipedia.org/wiki/Volatility_(finance)">Wikipage</a>:</p>
<blockquote class="blockquote">
<p>In finance, volatility (symbol <span class="math inline">\(\sigma\)</span>) is the degree of variation of a trading price series over time as measured by the standard deviation of logarithmic returns.</p>
<ul>
<li>Historic volatility measures a time series of past market prices.</li>
<li>Implied volatility looks forward in time, being derived from the market price of a market-traded derivative (in particular, an option).</li>
<li>Realized variance estimates the integrated variance or quadratic variation by using high frequency data.</li>
</ul>
</blockquote>
<p>注: 波动率是金融资产价格的波动程度.</p>
</section>
<section id="why-is-volatility-important" class="level2">
<h2 class="anchored" data-anchor-id="why-is-volatility-important">Why is volatility important?</h2>
<p>From the same <a href="https://en.wikipedia.org/wiki/Volatility_(finance)">Wikipage</a>:</p>
<blockquote class="blockquote">
<p>Investors care about volatility for at least the following reasons:</p>
<ul>
<li><p>The wider the swings in an investment’s price, the harder emotionally it is to not worry;</p></li>
<li><p>Price volatility of a trading instrument can define position sizing in a portfolio;</p></li>
<li><p>When certain cash flows from selling a security are needed at a specific future date, higher volatility means a greater chance of a shortfall;</p></li>
<li><p>Higher volatility of returns while saving for retirement results in a wider distribution of possible final portfolio values;</p></li>
<li><p>Higher volatility of return when retired gives withdrawals a larger permanent impact on the portfolio’s value;</p></li>
<li><p>Price volatility presents opportunities to buy assets cheaply and sell when overpriced;</p></li>
<li><p><font color="blue"> Portfolio volatility has a negative impact on the compound annual growth rate (CAGR) of that portfolio </font></p></li>
<li><p>Volatility affects pricing of options, being a parameter of the Black–Scholes model.</p></li>
</ul>
</blockquote>
<p>In today’s markets, it is also possible to trade volatility directly, through the use of derivative securities such as options and variance swaps.</p>
</section>
<section id="volatilities" class="level2">
<h2 class="anchored" data-anchor-id="volatilities">Volatilities</h2>
<p>Volatility of a financial asset in its most preliminary form is defined as the (conditional) standard deviation of its log return. In practice, there exist various notions of “volatility” that are commonly used including</p>
<ul>
<li>Historical volatility (历史波动率)</li>
<li>Realized and integrated variance/volatility (实际波动率, 一个理论上的, 无法被计算的值)</li>
<li>Implied volatility (隐含波动率, 隐含波动率是制期权市场投资者在进行期权交易时对实际波动率的认识)</li>
<li>Instantaneous volatility (瞬时波动率)</li>
</ul>
<p>and methods of inferring these volatilities respectively from</p>
<ul>
<li>Daily or high-frequency time series data of the underlying</li>
<li>Price series of variance swap</li>
<li>Prices of liquidly traded vanilla options</li>
</ul>
<p>Daily closing prices <span class="math inline">\(S_t\)</span>: <span class="math inline">\(S_0, S_1, S_2, ..., S_T\)</span>.</p>
<p>Log return <span class="math inline">\(\displaystyle r_t = \log (S_t/S_{t-1})\)</span>.</p>
<p>Then the daily volatility is defined as: <span class="math display">\[
\sigma_t = \sqrt{\Eof{r_t^2}} = \sqrt{\Eof{\left(\log S_t/S_{t-1}\right)^2}}.
\]</span></p>
<p>And the annualized volatility is defined as: <span class="math display">\[
\sigma_t^{\text{annualized}} = \sqrt{252} \cdot \sigma_t.
\]</span></p>
<p>The constant <span class="math inline">\(\sqrt{252}\)</span> is used to convert the daily volatility to annualized volatility, assuming there are 252 trading days in a year.</p>
</section>
<section id="historical-volatility" class="level2">
<h2 class="anchored" data-anchor-id="historical-volatility">Historical volatility</h2>
<p>Historical volatility uses, say daily, price series to calculate the sample conditional standard deviation of log returns <font color="red">in rolling time windows</font> of a prespecified width.</p>
</section>
<section id="example-of-historical-volatility" class="level2">
<h2 class="anchored" data-anchor-id="example-of-historical-volatility">Example of historical volatility</h2>
<p>Now let’s calculate the volatility of S&amp;P500 using 25-day rolling time windows.</p>
<p>One can calculate the volatility series of the input price series <span class="math inline">\(S_t\)</span>, <span class="math inline">\(1 \leq t \leq T\)</span>, by the following formula</p>
<p><span class="math display">\[
\sigma_t = \sqrt{\frac N{n-2}\sum_{i=1}^{n-1} (r_i - \bar r)^2}, \quad \text{ for } n \leq t \leq T,
\]</span></p>
<p>where</p>
<span class="math display">\[\begin{aligned}
r_i &amp;= \ln S_{t + i} - \ln S_{t + i - 1}, \quad \text{for } 1 \leq i \leq n - 1, \\
\bar{r} &amp;= \frac{1}{n-1} \sum_{i=1}^{n-1} r_i.
\end{aligned}\]</span>
<section id="note" class="level3">
<h3 class="anchored" data-anchor-id="note">Note</h3>
<ul>
<li><span class="math inline">\(n\)</span> denotes the width (number of days) of rolling window</li>
<li><span class="math inline">\(N\)</span> denotes the number of days in a year, thus <span class="math inline">\(\sqrt N\)</span> is the annualized factor</li>
<li>The first <span class="math inline">\(n-1\)</span> points in the output volatility series appear as NA, for an obvious reason.</li>
</ul>
</section>
<section id="exponentially-weighted-moving-average-ewma" class="level3">
<h3 class="anchored" data-anchor-id="exponentially-weighted-moving-average-ewma">Exponentially weighted moving average (EWMA)</h3>
<p>An alternative to calculate historical volatility is the <em>exponentially weighted moving average</em> method.</p>
<p><span class="math display">\[
\sigma_t = \sqrt{N(1 - \lambda)\sum_{i=1}^{\infty} \lambda^i (r_{t - i} - \bar r)^2}, \quad \text{ for } n \leq t \leq T,
\]</span></p>
<p>for some <span class="math inline">\(\lambda \in (0, 1)\)</span>.</p>
</section>
</section>
<section id="now-lets-dirty-our-hands" class="level2">
<h2 class="anchored" data-anchor-id="now-lets-dirty-our-hands">Now let’s dirty our hands …</h2>
<p>注: SPX stands for S&amp;P 500 index, which is a stock market index that measures the stock performance of 500 large companies listed on stock exchanges in the United States.</p>
<div id="cell-10" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co">#pip install yfinance</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-11" class="cell" data-execution_count="2">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> yfinance <span class="im">as</span> yf</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-12" class="cell" data-execution_count="3">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> numpy <span class="im">import</span> exp, log, sqrt</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> scipy.stats <span class="im">as</span> ss</span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> scipy.stats <span class="im">import</span> norm</span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> yfinance <span class="im">as</span> yf</span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> statsmodels.formula.api <span class="im">as</span> sm</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="tips-you-may-skip-the-next-5-cells-if-you-encounter-an-error." class="level3">
<h3 class="anchored" data-anchor-id="tips-you-may-skip-the-next-5-cells-if-you-encounter-an-error.">Tips: You may skip the next 5 cells if you encounter an error.</h3>
<div id="cell-14" class="cell" data-execution_count="4">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> os</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>proxy <span class="op">=</span> <span class="st">'http://127.0.0.1:7897'</span></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>os.environ[<span class="st">'HTTP_PROXY'</span>] <span class="op">=</span> proxy</span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>os.environ[<span class="st">'HTTPS_PROXY'</span>] <span class="op">=</span> proxy</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-15" class="cell" data-execution_count="5">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>start, end <span class="op">=</span> <span class="st">'2019-01-01'</span>, <span class="st">'2024-07-24'</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a><span class="co"># download SPX from yahoo finance</span></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>spx <span class="op">=</span> yf.Ticker(<span class="st">"^GSPC"</span>).history(start<span class="op">=</span>start, end<span class="op">=</span>end)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-16" class="cell" data-execution_count="6">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="co"># brief look at the data</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>spx.info(), spx.isna().<span class="bu">sum</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>&lt;class 'pandas.core.frame.DataFrame'&gt;
DatetimeIndex: 1398 entries, 2019-01-02 00:00:00-05:00 to 2024-07-23 00:00:00-04:00
Data columns (total 7 columns):
 #   Column        Non-Null Count  Dtype  
---  ------        --------------  -----  
 0   Open          1398 non-null   float64
 1   High          1398 non-null   float64
 2   Low           1398 non-null   float64
 3   Close         1398 non-null   float64
 4   Volume        1398 non-null   int64  
 5   Dividends     1398 non-null   float64
 6   Stock Splits  1398 non-null   float64
dtypes: float64(6), int64(1)
memory usage: 87.4 KB</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="6">
<pre><code>(None,
 Open            0
 High            0
 Low             0
 Close           0
 Volume          0
 Dividends       0
 Stock Splits    0
 dtype: int64)</code></pre>
</div>
</div>
<div id="cell-17" class="cell" data-execution_count="7">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="co"># first and last few rows of the data</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>spx</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="7">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">Open</th>
<th data-quarto-table-cell-role="th">High</th>
<th data-quarto-table-cell-role="th">Low</th>
<th data-quarto-table-cell-role="th">Close</th>
<th data-quarto-table-cell-role="th">Volume</th>
<th data-quarto-table-cell-role="th">Dividends</th>
<th data-quarto-table-cell-role="th">Stock Splits</th>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">Date</th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">2019-01-02 00:00:00-05:00</td>
<td>2476.959961</td>
<td>2519.489990</td>
<td>2467.469971</td>
<td>2510.030029</td>
<td>3733160000</td>
<td>0.0</td>
<td>0.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">2019-01-03 00:00:00-05:00</td>
<td>2491.919922</td>
<td>2493.139893</td>
<td>2443.959961</td>
<td>2447.889893</td>
<td>3858830000</td>
<td>0.0</td>
<td>0.0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2019-01-04 00:00:00-05:00</td>
<td>2474.330078</td>
<td>2538.070068</td>
<td>2474.330078</td>
<td>2531.939941</td>
<td>4234140000</td>
<td>0.0</td>
<td>0.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">2019-01-07 00:00:00-05:00</td>
<td>2535.610107</td>
<td>2566.159912</td>
<td>2524.560059</td>
<td>2549.689941</td>
<td>4133120000</td>
<td>0.0</td>
<td>0.0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2019-01-08 00:00:00-05:00</td>
<td>2568.110107</td>
<td>2579.820068</td>
<td>2547.560059</td>
<td>2574.409912</td>
<td>4120060000</td>
<td>0.0</td>
<td>0.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2024-07-17 00:00:00-04:00</td>
<td>5610.069824</td>
<td>5622.490234</td>
<td>5584.810059</td>
<td>5588.270020</td>
<td>4246450000</td>
<td>0.0</td>
<td>0.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">2024-07-18 00:00:00-04:00</td>
<td>5608.560059</td>
<td>5614.049805</td>
<td>5522.810059</td>
<td>5544.589844</td>
<td>4007510000</td>
<td>0.0</td>
<td>0.0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2024-07-19 00:00:00-04:00</td>
<td>5543.370117</td>
<td>5557.500000</td>
<td>5497.040039</td>
<td>5505.000000</td>
<td>3760570000</td>
<td>0.0</td>
<td>0.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">2024-07-22 00:00:00-04:00</td>
<td>5544.540039</td>
<td>5570.359863</td>
<td>5529.040039</td>
<td>5564.410156</td>
<td>3375180000</td>
<td>0.0</td>
<td>0.0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2024-07-23 00:00:00-04:00</td>
<td>5565.299805</td>
<td>5585.339844</td>
<td>5550.899902</td>
<td>5555.740234</td>
<td>3500210000</td>
<td>0.0</td>
<td>0.0</td>
</tr>
</tbody>
</table>

<p>1398 rows × 7 columns</p>
</div>
</div>
</div>
<div id="cell-18" class="cell" data-execution_count="8">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="co"># save data, just in case</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a><span class="co"># spx.to_csv('spx_07252022.csv')</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="you-may-start-from-here." class="level3">
<h3 class="anchored" data-anchor-id="you-may-start-from-here.">You may start from here.</h3>
<div id="cell-20" class="cell" data-execution_count="9">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="co"># load saved data</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>spx <span class="op">=</span> pd.read_csv(<span class="st">'spx_07252022.csv'</span>)</span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>spx.index <span class="op">=</span> spx[<span class="st">'Date'</span>]</span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>spx <span class="op">=</span> spx.drop(<span class="st">'Date'</span>, axis<span class="op">=</span><span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-21" class="cell" data-execution_count="10">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="co"># summary statistics</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>spx.describe().transpose()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="10">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">count</th>
<th data-quarto-table-cell-role="th">mean</th>
<th data-quarto-table-cell-role="th">std</th>
<th data-quarto-table-cell-role="th">min</th>
<th data-quarto-table-cell-role="th">25%</th>
<th data-quarto-table-cell-role="th">50%</th>
<th data-quarto-table-cell-role="th">75%</th>
<th data-quarto-table-cell-role="th">max</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">Open</td>
<td>895.0</td>
<td>3.586641e+03</td>
<td>6.613510e+02</td>
<td>2290.709961</td>
<td>2.980045e+03</td>
<td>3.439380e+03</td>
<td>4.213645e+03</td>
<td>4.804510e+03</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">High</td>
<td>895.0</td>
<td>3.608340e+03</td>
<td>6.637349e+02</td>
<td>2300.729980</td>
<td>2.991620e+03</td>
<td>3.464860e+03</td>
<td>4.239375e+03</td>
<td>4.818620e+03</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">Low</td>
<td>895.0</td>
<td>3.562902e+03</td>
<td>6.583530e+02</td>
<td>2191.860107</td>
<td>2.963575e+03</td>
<td>3.419930e+03</td>
<td>4.192340e+03</td>
<td>4.780040e+03</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">Close</td>
<td>895.0</td>
<td>3.587314e+03</td>
<td>6.608265e+02</td>
<td>2237.399902</td>
<td>2.978570e+03</td>
<td>3.443120e+03</td>
<td>4.209795e+03</td>
<td>4.796560e+03</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">Adj Close</td>
<td>895.0</td>
<td>3.587314e+03</td>
<td>6.608265e+02</td>
<td>2237.399902</td>
<td>2.978570e+03</td>
<td>3.443120e+03</td>
<td>4.209795e+03</td>
<td>4.796560e+03</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">Volume</td>
<td>895.0</td>
<td>4.069480e+09</td>
<td>1.168092e+09</td>
<td>0.000000</td>
<td>3.337885e+09</td>
<td>3.778890e+09</td>
<td>4.548675e+09</td>
<td>9.878040e+09</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<div id="cell-22" class="cell" data-execution_count="11">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="co"># plot spx adjusted close</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">9</span>, <span class="dv">6</span>))</span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>spx[<span class="st">'Close'</span>].plot()</span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">'SPX'</span>, fontsize<span class="op">=</span><span class="dv">12</span>)</span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a>plt.grid()<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="NSD_Lec05-Volatility_Summer2025_files/figure-html/cell-12-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<div id="cell-23" class="cell" data-execution_count="12">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="co"># log return of spx </span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>r <span class="op">=</span> log(spx[<span class="st">'Close'</span>]).diff()</span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a><span class="co"># historical volatility in this period</span></span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a>vol <span class="op">=</span> r.std()<span class="op">*</span>sqrt(<span class="dv">252</span>)</span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a>r, r.mean(), vol, <span class="bu">type</span>(r)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="12">
<pre><code>(Date
 2019-01-02         NaN
 2019-01-03   -0.025068
 2019-01-04    0.033759
 2019-01-07    0.006986
 2019-01-08    0.009649
                 ...   
 2022-07-15    0.019019
 2022-07-18   -0.008399
 2022-07-19    0.027254
 2022-07-20    0.005878
 2022-07-21    0.009813
 Name: Close, Length: 895, dtype: float64,
 0.0005209587220526575,
 0.22945020327258875,
 pandas.core.series.Series)</code></pre>
</div>
</div>
<div id="cell-24" class="cell" data-execution_count="13">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="co"># plot log return</span></span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">9</span>, <span class="dv">6</span>))</span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>r.plot(lw<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">'SPX log return'</span>, fontsize<span class="op">=</span><span class="dv">12</span>)</span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a>plt.grid()<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="NSD_Lec05-Volatility_Summer2025_files/figure-html/cell-14-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<div id="cell-25" class="cell" data-execution_count="14">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>r.iloc[<span class="dv">0</span>:<span class="dv">10</span>], r.iloc[<span class="op">-</span><span class="dv">10</span>:]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="14">
<pre><code>(Date
 2019-01-02         NaN
 2019-01-03   -0.025068
 2019-01-04    0.033759
 2019-01-07    0.006986
 2019-01-08    0.009649
 2019-01-09    0.004090
 2019-01-10    0.004508
 2019-01-11   -0.000146
 2019-01-14   -0.005271
 2019-01-15    0.010665
 Name: Close, dtype: float64,
 Date
 2022-07-08   -0.000831
 2022-07-11   -0.011594
 2022-07-12   -0.009287
 2022-07-13   -0.004467
 2022-07-14   -0.003003
 2022-07-15    0.019019
 2022-07-18   -0.008399
 2022-07-19    0.027254
 2022-07-20    0.005878
 2022-07-21    0.009813
 Name: Close, dtype: float64)</code></pre>
</div>
</div>
<div id="cell-26" class="cell" data-execution_count="15">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="co"># n: rwidth of rolling window</span></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a><span class="co"># N: annualizing factor</span></span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> volatility(data, n<span class="op">=</span><span class="dv">10</span>, N<span class="op">=</span><span class="dv">252</span>):</span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a>    data <span class="op">=</span> pd.Series(data)</span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a>    vol <span class="op">=</span> [np.nan <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(n)]</span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="bu">len</span>(data)<span class="op">-</span>n):</span>
<span id="cb19-7"><a href="#cb19-7" aria-hidden="true" tabindex="-1"></a>        vol <span class="op">+=</span> [data.iloc[i:(i<span class="op">+</span>n)].std()<span class="op">*</span>sqrt(N)]</span>
<span id="cb19-8"><a href="#cb19-8" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> pd.DataFrame({<span class="st">'volatility'</span>: vol})</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-27" class="cell" data-execution_count="16">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a>volatility(r)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="16">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">volatility</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>NaN</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>NaN</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>NaN</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>NaN</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>NaN</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">...</td>
<td>...</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">890</td>
<td>0.136786</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">891</td>
<td>0.160218</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">892</td>
<td>0.160347</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">893</td>
<td>0.210679</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">894</td>
<td>0.211261</td>
</tr>
</tbody>
</table>

<p>895 rows × 1 columns</p>
</div>
</div>
</div>
<div id="cell-28" class="cell" data-execution_count="17">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a>spx_vol <span class="op">=</span> volatility(r)</span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a>spx_vol.index <span class="op">=</span> r.index</span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">9</span>, <span class="dv">6</span>))</span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a>plt.plot(spx_vol)</span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">'Volatility'</span>, fontsize<span class="op">=</span><span class="dv">12</span>)</span>
<span id="cb21-6"><a href="#cb21-6" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">'SPX historical volatility'</span>, fontsize<span class="op">=</span><span class="dv">24</span>)</span>
<span id="cb21-7"><a href="#cb21-7" aria-hidden="true" tabindex="-1"></a>plt.grid()<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="NSD_Lec05-Volatility_Summer2025_files/figure-html/cell-18-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<div id="cell-29" class="cell" data-execution_count="18">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="co"># leverage effect</span></span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>spx_scaled <span class="op">=</span> (spx <span class="op">-</span> spx.mean())<span class="op">/</span>(spx.<span class="bu">max</span>() <span class="op">-</span> spx.<span class="bu">min</span>())</span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">9</span>, <span class="dv">6</span>))</span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a>spx_scaled[<span class="st">'Close'</span>].plot(color<span class="op">=</span><span class="st">'k'</span>, lw<span class="op">=</span><span class="dv">1</span>, label<span class="op">=</span><span class="st">'scaled spx'</span>)</span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a>plt.ylim([<span class="op">-</span><span class="fl">0.6</span>, <span class="dv">1</span>])</span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a>plt.plot(spx_vol, <span class="st">'b-.'</span>, lw<span class="op">=</span><span class="dv">1</span>, label<span class="op">=</span><span class="st">'volatility'</span>)</span>
<span id="cb22-7"><a href="#cb22-7" aria-hidden="true" tabindex="-1"></a>plt.grid()</span>
<span id="cb22-8"><a href="#cb22-8" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">'Leverage effect'</span>, fontsize<span class="op">=</span><span class="dv">24</span>)</span>
<span id="cb22-9"><a href="#cb22-9" aria-hidden="true" tabindex="-1"></a>plt.legend()<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="NSD_Lec05-Volatility_Summer2025_files/figure-html/cell-19-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<p>注: Leverage effect (杠杆效应): Stock price 下降, Volatility 上升. Stock price 上升, Volatility 下降.</p>
<p>Equity index returns interact negatively with return volatilities.</p>
<p>Carr, Peter, and Liuren Wu. “Leverage Effect, Volatility Feedback, and Self-Exciting Market Disruptions.” The Journal of Financial and Quantitative Analysis, vol.&nbsp;52, no. 5, 2017, pp.&nbsp;2119–56. JSTOR, https://www.jstor.org/stable/26590473. Accessed 28 July 2025.</p>
</section>
</section>
<section id="volatility-estimation-using-ohlc" class="level2">
<h2 class="anchored" data-anchor-id="volatility-estimation-using-ohlc">Volatility estimation using OHLC</h2>
<ul>
<li>Parkison</li>
<li>Garman-Klass</li>
<li>Rogers-Satchell</li>
<li>Yang-Zhang</li>
</ul>
<span class="math display">\[\begin{aligned}
\sigma_P^2 &amp;= \frac{1}{4\ln2} \frac{1}{n}\sum_{i=1}^n (\ln H_i - \ln L_i)^2, \\
\sigma_{GK}^2 &amp;= \frac{1}{n} \left\{\sum_{i=1}^n \frac{1}{2}(\ln H_i - \ln L_i)^2 + (2\ln2 - 1)(\ln C_i - \ln O_i)^2 \right\}, \\
\sigma_{RS}^2 &amp;= \frac{1}{n} \sum_{i=1}^n u_i(u_i - c_i) + d_i(d_i - c_i), \\
\sigma_{YZ}^2 &amp;= \sigma_O^2 + w\sigma_C^2 + (1 - w)\sigma_P^2, \quad w = \frac{0.34}{1.34 + \frac{n+1}{n-1}}.
\end{aligned}\]</span>
<ul>
<li><span class="math inline">\(u_i = \ln H_i - \ln O_i\)</span>: daily high weighted by open,</li>
<li><span class="math inline">\(d_i = \ln L_i - \ln O_i\)</span>: daily low weighted by open</li>
<li><span class="math inline">\(o_i = \ln O_i - \ln C_{i-1}\)</span></li>
<li><span class="math inline">\(c_i = \ln C_i - \ln O_i\)</span></li>
</ul>
<p>We make the calculation of these volatilties into a python <code>class</code>.</p>
<div id="cell-33" class="cell">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> Volatilities:</span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> <span class="fu">__init__</span>(<span class="va">self</span>, OHLC, n<span class="op">=</span><span class="dv">10</span>, N<span class="op">=</span><span class="dv">252</span>):</span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.n <span class="op">=</span> n</span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.N <span class="op">=</span> N</span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.OHLC <span class="op">=</span> pd.DataFrame(OHLC)</span>
<span id="cb23-6"><a href="#cb23-6" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.o <span class="op">=</span> <span class="va">self</span>.OHLC.Open</span>
<span id="cb23-7"><a href="#cb23-7" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.h <span class="op">=</span> <span class="va">self</span>.OHLC.High</span>
<span id="cb23-8"><a href="#cb23-8" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.l <span class="op">=</span> <span class="va">self</span>.OHLC.Low</span>
<span id="cb23-9"><a href="#cb23-9" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.c <span class="op">=</span> <span class="va">self</span>.OHLC.Close</span>
<span id="cb23-10"><a href="#cb23-10" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.r <span class="op">=</span> log(<span class="va">self</span>.OHLC[<span class="st">'Close'</span>]).diff()</span>
<span id="cb23-11"><a href="#cb23-11" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.vols_c <span class="op">=</span> [np.nan <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="va">self</span>.n)] </span>
<span id="cb23-12"><a href="#cb23-12" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.vols_p <span class="op">=</span> [np.nan <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="va">self</span>.n)]</span>
<span id="cb23-13"><a href="#cb23-13" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.vols_gk <span class="op">=</span> [np.nan <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="va">self</span>.n)] </span>
<span id="cb23-14"><a href="#cb23-14" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.vols_rs <span class="op">=</span> [np.nan <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="va">self</span>.n)] </span>
<span id="cb23-15"><a href="#cb23-15" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb23-16"><a href="#cb23-16" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="bu">len</span>(<span class="va">self</span>.r) <span class="op">-</span> <span class="va">self</span>.n):</span>
<span id="cb23-17"><a href="#cb23-17" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.vols_c <span class="op">+=</span> [<span class="va">self</span>.r.iloc[i:(i<span class="op">+</span><span class="va">self</span>.n)].std()<span class="op">*</span>sqrt(<span class="va">self</span>.N)]</span>
<span id="cb23-18"><a href="#cb23-18" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.vols_p <span class="op">+=</span> [<span class="va">self</span>.cal_vol_p(<span class="va">self</span>.h.iloc[i:(i<span class="op">+</span><span class="va">self</span>.n)], <span class="va">self</span>.l.iloc[i:(i<span class="op">+</span><span class="va">self</span>.n)])<span class="op">*</span>sqrt(<span class="va">self</span>.N)]</span>
<span id="cb23-19"><a href="#cb23-19" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.vols_gk <span class="op">+=</span> [<span class="va">self</span>.cal_vol_gk(<span class="va">self</span>.o.iloc[i:(i<span class="op">+</span><span class="va">self</span>.n)], <span class="va">self</span>.h.iloc[i:(i<span class="op">+</span><span class="va">self</span>.n)], <span class="va">self</span>.l.iloc[i:(i<span class="op">+</span><span class="va">self</span>.n)], <span class="va">self</span>.c.iloc[i:(i<span class="op">+</span><span class="va">self</span>.n)])<span class="op">*</span>sqrt(<span class="va">self</span>.N)]</span>
<span id="cb23-20"><a href="#cb23-20" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.vols_rs <span class="op">+=</span> [<span class="va">self</span>.cal_vol_rs(<span class="va">self</span>.o.iloc[i:(i<span class="op">+</span><span class="va">self</span>.n)], <span class="va">self</span>.h.iloc[i:(i<span class="op">+</span><span class="va">self</span>.n)], <span class="va">self</span>.l.iloc[i:(i<span class="op">+</span><span class="va">self</span>.n)], <span class="va">self</span>.c.iloc[i:(i<span class="op">+</span><span class="va">self</span>.n)])<span class="op">*</span>sqrt(<span class="va">self</span>.N)]</span>
<span id="cb23-21"><a href="#cb23-21" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.vols <span class="op">=</span> pd.DataFrame({<span class="st">'close'</span>: <span class="va">self</span>.vols_c, <span class="st">'parkinson'</span>: <span class="va">self</span>.vols_p, <span class="st">'garman-klass'</span>: <span class="va">self</span>.vols_gk, <span class="st">'rogers-satchell'</span>: <span class="va">self</span>.vols_rs})</span>
<span id="cb23-22"><a href="#cb23-22" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.vols.index <span class="op">=</span> <span class="va">self</span>.OHLC.index</span>
<span id="cb23-23"><a href="#cb23-23" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb23-24"><a href="#cb23-24" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> cal_vol_p(<span class="va">self</span>, H, L):</span>
<span id="cb23-25"><a href="#cb23-25" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> np.sqrt(((log(H) <span class="op">-</span> log(L))<span class="op">**</span><span class="dv">2</span>).mean()<span class="op">/</span>log(<span class="dv">2</span>)<span class="op">/</span><span class="dv">4</span>)</span>
<span id="cb23-26"><a href="#cb23-26" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb23-27"><a href="#cb23-27" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> cal_vol_gk(<span class="va">self</span>, O, H, L, C):</span>
<span id="cb23-28"><a href="#cb23-28" aria-hidden="true" tabindex="-1"></a>        term1 <span class="op">=</span> ((log(H) <span class="op">-</span> log(L))<span class="op">**</span><span class="dv">2</span>).mean()<span class="op">/</span><span class="dv">2</span></span>
<span id="cb23-29"><a href="#cb23-29" aria-hidden="true" tabindex="-1"></a>        term2 <span class="op">=</span> (<span class="dv">2</span><span class="op">*</span>log(<span class="dv">2</span>) <span class="op">-</span> <span class="dv">1</span>)<span class="op">*</span>((log(C) <span class="op">-</span> log(O))<span class="op">**</span><span class="dv">2</span>).mean()</span>
<span id="cb23-30"><a href="#cb23-30" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> np.sqrt(term1 <span class="op">-</span> term2)</span>
<span id="cb23-31"><a href="#cb23-31" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb23-32"><a href="#cb23-32" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> cal_vol_rs(<span class="va">self</span>, O, H, L, C):</span>
<span id="cb23-33"><a href="#cb23-33" aria-hidden="true" tabindex="-1"></a>        u, d, c <span class="op">=</span> log(H) <span class="op">-</span> log(O), log(L) <span class="op">-</span> log(O), log(C) <span class="op">-</span> log(O)</span>
<span id="cb23-34"><a href="#cb23-34" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> np.sqrt((u<span class="op">*</span>(u<span class="op">-</span>c)).mean() <span class="op">+</span> (d<span class="op">*</span>(d<span class="op">-</span>c)).mean())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-34" class="cell" data-execution_count="20">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="op">%%</span>time</span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>spx_vols <span class="op">=</span> Volatilities(spx)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>CPU times: total: 344 ms
Wall time: 1.69 s</code></pre>
</div>
</div>
<div id="cell-35" class="cell" data-execution_count="21">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a>spx_vols.vols[<span class="st">'garman-klass'</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="21">
<pre><code>Date
2019-01-02         NaN
2019-01-03         NaN
2019-01-04         NaN
2019-01-07         NaN
2019-01-08         NaN
                ...   
2022-07-15    0.128716
2022-07-18    0.126178
2022-07-19    0.138915
2022-07-20    0.140416
2022-07-21    0.140299
Name: garman-klass, Length: 895, dtype: float64</code></pre>
</div>
</div>
<div id="cell-36" class="cell" data-execution_count="22">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">10</span>, <span class="dv">6</span>))</span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a>spx_vols.vols[<span class="st">'close'</span>].plot(ls<span class="op">=</span><span class="st">'--'</span>, label<span class="op">=</span><span class="st">'Close'</span>, lw<span class="op">=</span><span class="fl">0.8</span>)</span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a>spx_vols.vols[<span class="st">'parkinson'</span>].plot(lw<span class="op">=</span><span class="fl">0.8</span>, label<span class="op">=</span><span class="st">'Parkinson'</span>)</span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a>spx_vols.vols[<span class="st">'garman-klass'</span>].plot(lw<span class="op">=</span><span class="fl">0.8</span>, label<span class="op">=</span><span class="st">'Garman-Klass'</span>)</span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true" tabindex="-1"></a>spx_vols.vols[<span class="st">'rogers-satchell'</span>].plot(lw<span class="op">=</span><span class="fl">0.8</span>, label<span class="op">=</span><span class="st">'Rogers-Satchell'</span>)</span>
<span id="cb28-6"><a href="#cb28-6" aria-hidden="true" tabindex="-1"></a>plt.legend()</span>
<span id="cb28-7"><a href="#cb28-7" aria-hidden="true" tabindex="-1"></a>plt.grid()<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="NSD_Lec05-Volatility_Summer2025_files/figure-html/cell-23-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<div id="cell-37" class="cell" data-execution_count="23">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a>spx.tail(<span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="23">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">Open</th>
<th data-quarto-table-cell-role="th">High</th>
<th data-quarto-table-cell-role="th">Low</th>
<th data-quarto-table-cell-role="th">Close</th>
<th data-quarto-table-cell-role="th">Adj Close</th>
<th data-quarto-table-cell-role="th">Volume</th>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">Date</th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">2022-07-21</td>
<td>3955.469971</td>
<td>3999.290039</td>
<td>3927.639893</td>
<td>3998.949951</td>
<td>3998.949951</td>
<td>3586030000</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</section>
<section id="implied-volatility" class="level2">
<h2 class="anchored" data-anchor-id="implied-volatility">Implied volatility</h2>
<p>“A wrong number to a wrong formula for a correct answer.”</p>
<p>注: wrong number = volatility, wrong formula = Black-Scholes formula, correct answer = option price.</p>
<ul>
<li><p>In the Black-Scholes model there is a one-to-one relation between the price of the option and the volatility parameter <span class="math inline">\(\sigma\)</span>. The option prices are often quoted by stating this specific volatility, called the <em>implied volatility</em>.</p></li>
<li><p>In Black-Scholes world, the volatility is assumed constant. But in reality, options of different strike require different volatilities to match their market prices. This is called the <em>volatility smile</em>.</p></li>
<li><p>Most of the work was inspired in modeling the implied volatility.</p></li>
</ul>
</section>
<section id="why-implied-volatility-rather-than-the-price-itself" class="level2">
<h2 class="anchored" data-anchor-id="why-implied-volatility-rather-than-the-price-itself">Why implied volatility rather than the price itself?</h2>
<ul>
<li>Price of a call option is decreasing in strike and increasing in time to expiry</li>
<li>Price of a far out-of-money option is small whereas price of a far in-the-money option carries mostly the intrinsic value</li>
<li>Statistically speaking, implied volatility is a more standard quantity to infer</li>
<li>Traders trade options in terms of implied volatilities rather than their prices</li>
</ul>
<p>注:</p>
<ul>
<li>期权价格本身不具备标准化, 不同期权之间不能直接比较; 但波动率是一个标准化的参数, 它不依赖 strike 或 expiry, 因此更便于比较.</li>
<li>期权价格的构成不一致, 有的主要是时间价值, 有的主要是内在价值; 隐含波动率剥离了内在价值, 只反映市场对未来波动的预期, 是一个更“干净”的指标.</li>
<li>你可以比较今天和昨天的隐含波动率来判断市场情绪变化; 但比较期权价格则可能受行权价、到期日等因素干扰.</li>
</ul>
<p>注: 隐含波动率是市场通过期权的价格推导出的一种预期未来波动率, 它不代表过去的价格波动, 而是预测未来的价格波动区间. IV值高, 意味着市场认为未来价格波动较大; IV 值低, 则意味着市场预期未来波动较小.</p>
<p>期权的价格主要由四个因素决定: 标的资产价格、执行价格、到期时间和波动率. 隐含波动率是唯一一个通过市场价格间接估算出来的变量, 因此它在期权交易中的地位尤为特殊.</p>
<p>隐含波动率与期权价格呈正相关关系. 简单来说, IV 越高, 期权价格越高; IV越低, 期权价格越便宜. 这是因为高隐含波动率意味着标的资产未来可能出现较大的价格波动, 买方愿意为此支付更多的期权溢价, 而卖方则要求更高的补偿来承担风险.</p>
<p>隐含波动率没有固定的计算公式, 而是通过反推法, 根据期权定价模型 (如 Black-Scholes 模型) 和期权的市场价格来计算. 在实际交易中, 不同执行价的期权隐含波动率常呈现“微笑”或“倾斜”的形态, 这种现象被称为“波动率微笑 (Volatility Smile)”.</p>
<p>深度虚值期权 (OTM) 和深度实值期权 (ITM) 的 IV 通常较高, 因为这些期权受到极端价格变动的影响更大. 平值期权 (ATM) 的IV较低, 因为它更接近当前市场价格, 波动性风险相对较小.</p>
</section>
<section id="a-practical-tip-for-fetching-risk-free-and-dividend-rates" class="level2">
<h2 class="anchored" data-anchor-id="a-practical-tip-for-fetching-risk-free-and-dividend-rates">A practical tip for fetching risk free and dividend rates</h2>
<p>Q: How to obtain the interest rate <span class="math inline">\(r\)</span> and dividend rate <span class="math inline">\(d\)</span> for the calculation of implied volatility?</p>
<p>A: Put-call parity.</p>
<p>Recall the Put-Call Parity for European options</p>
<p><span class="math display">\[
C - P = Se^{-dT}  - K e^{-rT} = e^{-rT} (F - K),
\]</span></p>
<p>where <span class="math inline">\(F\)</span> denotes the forward price of the underlying. Hence, if we regress <span class="math inline">\(C - P\)</span> against <span class="math inline">\(K\)</span>, the (negative) slope gives us the discount factor and the intercept gives the ex-dividend underlying.</p>
<p><span class="math inline">\(F = S e^{-(d-r)T}\)</span>, which means we can get the dividend rate <span class="math inline">\(d\)</span> by the intercept <span class="math inline">\(F\)</span>.</p>
</section>
<section id="example---implied-volatilities-of-options-on-spx" class="level2">
<h2 class="anchored" data-anchor-id="example---implied-volatilities-of-options-on-spx">Example - Implied volatilities of options on SPX</h2>
<div id="cell-43" class="cell" data-execution_count="24">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="co"># import required modules</span></span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> datetime</span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> datetime <span class="im">import</span> datetime <span class="im">as</span> dt</span>
<span id="cb30-4"><a href="#cb30-4" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb30-5"><a href="#cb30-5" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> numpy <span class="im">import</span> exp, log, sqrt</span>
<span id="cb30-6"><a href="#cb30-6" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> scipy.stats <span class="im">as</span> ss</span>
<span id="cb30-7"><a href="#cb30-7" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> scipy.stats <span class="im">import</span> norm</span>
<span id="cb30-8"><a href="#cb30-8" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb30-9"><a href="#cb30-9" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> yfinance <span class="im">as</span> yf</span>
<span id="cb30-10"><a href="#cb30-10" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb30-11"><a href="#cb30-11" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> statsmodels.formula.api <span class="im">as</span> sm</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="tips-you-may-skip-the-next-12-cells-if-you-encounter-an-error." class="level3">
<h3 class="anchored" data-anchor-id="tips-you-may-skip-the-next-12-cells-if-you-encounter-an-error.">Tips: You may skip the next 12 cells if you encounter an error.</h3>
<div id="cell-45" class="cell" data-execution_count="25">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="co"># download spx options data from yahoo finance</span></span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a>spx <span class="op">=</span> yf.Ticker(<span class="st">'^SPX'</span>)</span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a>spx_expiries <span class="op">=</span> spx.options</span>
<span id="cb31-4"><a href="#cb31-4" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(spx_expiries)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>('2025-07-28', '2025-07-29', '2025-07-30', '2025-07-31', '2025-08-01', '2025-08-04', '2025-08-05', '2025-08-06', '2025-08-07', '2025-08-08', '2025-08-11', '2025-08-12', '2025-08-13', '2025-08-14', '2025-08-15', '2025-08-18', '2025-08-19', '2025-08-20', '2025-08-21', '2025-08-22', '2025-08-25', '2025-08-26', '2025-08-27', '2025-08-28', '2025-08-29', '2025-09-02', '2025-09-05', '2025-09-08', '2025-09-12', '2025-09-19', '2025-09-30', '2025-10-17', '2025-10-31', '2025-11-21', '2025-11-28', '2025-12-19', '2025-12-31', '2026-01-16', '2026-02-20', '2026-03-20', '2026-03-31', '2026-04-17', '2026-05-15', '2026-06-18', '2026-06-30', '2026-07-17', '2026-08-21', '2026-09-18', '2026-12-18', '2027-06-17', '2027-12-17', '2028-12-15', '2029-12-21', '2030-12-20')</code></pre>
</div>
</div>
<div id="cell-46" class="cell" data-execution_count="26">
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="co"># choose an expiry </span></span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a>idx <span class="op">=</span> <span class="dv">17</span></span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a>today <span class="op">=</span> dt.strftime(dt.now(), <span class="st">'%Y-%m-</span><span class="sc">%d</span><span class="st">'</span>)</span>
<span id="cb33-4"><a href="#cb33-4" aria-hidden="true" tabindex="-1"></a>day_count <span class="op">=</span> (dt.strptime(spx_expiries[idx], <span class="st">'%Y-%m-</span><span class="sc">%d</span><span class="st">'</span>) <span class="op">-</span> dt.now()).days</span>
<span id="cb33-5"><a href="#cb33-5" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f'option expiry = </span><span class="sc">{</span>spx_expiries[idx]<span class="sc">}</span><span class="ss">, today = </span><span class="sc">{</span>today<span class="sc">}</span><span class="ss">'</span>)</span>
<span id="cb33-6"><a href="#cb33-6" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f'There are </span><span class="sc">{</span>day_count<span class="sc">}</span><span class="ss"> days to expiry'</span>)</span>
<span id="cb33-7"><a href="#cb33-7" aria-hidden="true" tabindex="-1"></a>option_chain <span class="op">=</span> spx.option_chain(spx_expiries[idx])</span>
<span id="cb33-8"><a href="#cb33-8" aria-hidden="true" tabindex="-1"></a>spx_calls <span class="op">=</span> option_chain.calls</span>
<span id="cb33-9"><a href="#cb33-9" aria-hidden="true" tabindex="-1"></a>spx_puts <span class="op">=</span> option_chain.puts</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>option expiry = 2025-08-20, today = 2025-07-28
There are 22 days to expiry</code></pre>
</div>
</div>
<div id="cell-47" class="cell" data-execution_count="27">
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a>spx_calls.shape, spx_puts.shape</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="27">
<pre><code>((55, 14), (84, 14))</code></pre>
</div>
</div>
<div id="cell-48" class="cell" data-execution_count="28">
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a>spx_calls.info()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>&lt;class 'pandas.core.frame.DataFrame'&gt;
RangeIndex: 55 entries, 0 to 54
Data columns (total 14 columns):
 #   Column             Non-Null Count  Dtype              
---  ------             --------------  -----              
 0   contractSymbol     55 non-null     object             
 1   lastTradeDate      55 non-null     datetime64[ns, UTC]
 2   strike             55 non-null     float64            
 3   lastPrice          55 non-null     float64            
 4   bid                55 non-null     float64            
 5   ask                55 non-null     float64            
 6   change             55 non-null     float64            
 7   percentChange      55 non-null     float64            
 8   volume             38 non-null     float64            
 9   openInterest       55 non-null     int64              
 10  impliedVolatility  55 non-null     float64            
 11  inTheMoney         55 non-null     bool               
 12  contractSize       55 non-null     object             
 13  currency           55 non-null     object             
dtypes: bool(1), datetime64[ns, UTC](1), float64(8), int64(1), object(3)
memory usage: 5.8+ KB</code></pre>
</div>
</div>
<div id="cell-49" class="cell" data-execution_count="29">
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a>spx_calls.isna().<span class="bu">sum</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="29">
<pre><code>contractSymbol        0
lastTradeDate         0
strike                0
lastPrice             0
bid                   0
ask                   0
change                0
percentChange         0
volume               17
openInterest          0
impliedVolatility     0
inTheMoney            0
contractSize          0
currency              0
dtype: int64</code></pre>
</div>
</div>
<div id="cell-50" class="cell" data-execution_count="30">
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a>spx_puts.isna().<span class="bu">sum</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="30">
<pre><code>contractSymbol        0
lastTradeDate         0
strike                0
lastPrice             0
bid                   0
ask                   0
change                0
percentChange         0
volume               19
openInterest          0
impliedVolatility     0
inTheMoney            0
contractSize          0
currency              0
dtype: int64</code></pre>
</div>
</div>
<div id="cell-51" class="cell" data-execution_count="31">
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a>spx_calls</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="31">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">contractSymbol</th>
<th data-quarto-table-cell-role="th">lastTradeDate</th>
<th data-quarto-table-cell-role="th">strike</th>
<th data-quarto-table-cell-role="th">lastPrice</th>
<th data-quarto-table-cell-role="th">bid</th>
<th data-quarto-table-cell-role="th">ask</th>
<th data-quarto-table-cell-role="th">change</th>
<th data-quarto-table-cell-role="th">percentChange</th>
<th data-quarto-table-cell-role="th">volume</th>
<th data-quarto-table-cell-role="th">openInterest</th>
<th data-quarto-table-cell-role="th">impliedVolatility</th>
<th data-quarto-table-cell-role="th">inTheMoney</th>
<th data-quarto-table-cell-role="th">contractSize</th>
<th data-quarto-table-cell-role="th">currency</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>SPXW250820C05100000</td>
<td>2025-07-15 20:12:00+00:00</td>
<td>5100.0</td>
<td>1160.00</td>
<td>1327.3</td>
<td>1335.80</td>
<td>0.0</td>
<td>0.0</td>
<td>NaN</td>
<td>0</td>
<td>0.667568</td>
<td>True</td>
<td>REGULAR</td>
<td>USD</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>SPXW250820C05200000</td>
<td>2025-07-16 13:33:29+00:00</td>
<td>5200.0</td>
<td>1080.00</td>
<td>1227.8</td>
<td>1236.30</td>
<td>0.0</td>
<td>0.0</td>
<td>NaN</td>
<td>0</td>
<td>0.625065</td>
<td>True</td>
<td>REGULAR</td>
<td>USD</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>SPXW250820C05450000</td>
<td>2025-07-17 18:35:24+00:00</td>
<td>5450.0</td>
<td>873.00</td>
<td>979.4</td>
<td>987.90</td>
<td>0.0</td>
<td>0.0</td>
<td>NaN</td>
<td>0</td>
<td>0.520505</td>
<td>True</td>
<td>REGULAR</td>
<td>USD</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>SPXW250820C05600000</td>
<td>2025-07-17 18:39:43+00:00</td>
<td>5600.0</td>
<td>725.75</td>
<td>830.6</td>
<td>839.10</td>
<td>0.0</td>
<td>0.0</td>
<td>NaN</td>
<td>0</td>
<td>0.471059</td>
<td>True</td>
<td>REGULAR</td>
<td>USD</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>SPXW250820C06000000</td>
<td>2025-07-25 19:40:13+00:00</td>
<td>6000.0</td>
<td>419.54</td>
<td>438.2</td>
<td>446.60</td>
<td>0.0</td>
<td>0.0</td>
<td>1.0</td>
<td>0</td>
<td>0.305007</td>
<td>True</td>
<td>REGULAR</td>
<td>USD</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">5</td>
<td>SPXW250820C06100000</td>
<td>2025-07-22 19:07:15+00:00</td>
<td>6100.0</td>
<td>263.17</td>
<td>342.9</td>
<td>351.70</td>
<td>0.0</td>
<td>0.0</td>
<td>NaN</td>
<td>0</td>
<td>0.265789</td>
<td>True</td>
<td>REGULAR</td>
<td>USD</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">6</td>
<td>SPXW250820C06150000</td>
<td>2025-07-24 17:14:10+00:00</td>
<td>6150.0</td>
<td>267.38</td>
<td>296.7</td>
<td>305.40</td>
<td>0.0</td>
<td>0.0</td>
<td>2.0</td>
<td>0</td>
<td>0.246815</td>
<td>True</td>
<td>REGULAR</td>
<td>USD</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">7</td>
<td>SPXW250820C06175000</td>
<td>2025-07-14 18:00:54+00:00</td>
<td>6175.0</td>
<td>186.31</td>
<td>273.7</td>
<td>282.50</td>
<td>0.0</td>
<td>0.0</td>
<td>NaN</td>
<td>0</td>
<td>0.237251</td>
<td>True</td>
<td>REGULAR</td>
<td>USD</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">8</td>
<td>SPXW250820C06200000</td>
<td>2025-07-25 19:53:07+00:00</td>
<td>6200.0</td>
<td>232.41</td>
<td>251.6</td>
<td>260.00</td>
<td>0.0</td>
<td>0.0</td>
<td>33.0</td>
<td>0</td>
<td>0.227989</td>
<td>True</td>
<td>REGULAR</td>
<td>USD</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">9</td>
<td>SPXW250820C06225000</td>
<td>2025-07-15 15:00:23+00:00</td>
<td>6225.0</td>
<td>147.87</td>
<td>228.9</td>
<td>237.90</td>
<td>0.0</td>
<td>0.0</td>
<td>NaN</td>
<td>0</td>
<td>0.218937</td>
<td>True</td>
<td>REGULAR</td>
<td>USD</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">10</td>
<td>SPXW250820C06240000</td>
<td>2025-07-22 14:09:40+00:00</td>
<td>6240.0</td>
<td>141.65</td>
<td>215.9</td>
<td>224.80</td>
<td>0.0</td>
<td>0.0</td>
<td>NaN</td>
<td>0</td>
<td>0.213516</td>
<td>True</td>
<td>REGULAR</td>
<td>USD</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">11</td>
<td>SPXW250820C06250000</td>
<td>2025-07-25 19:53:07+00:00</td>
<td>6250.0</td>
<td>189.71</td>
<td>210.5</td>
<td>213.40</td>
<td>0.0</td>
<td>0.0</td>
<td>33.0</td>
<td>0</td>
<td>0.205288</td>
<td>True</td>
<td>REGULAR</td>
<td>USD</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">12</td>
<td>SPXW250820C06260000</td>
<td>2025-07-24 14:14:35+00:00</td>
<td>6260.0</td>
<td>164.55</td>
<td>202.2</td>
<td>204.80</td>
<td>0.0</td>
<td>0.0</td>
<td>NaN</td>
<td>0</td>
<td>0.201723</td>
<td>True</td>
<td>REGULAR</td>
<td>USD</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">13</td>
<td>SPXW250820C06270000</td>
<td>2025-07-24 14:14:35+00:00</td>
<td>6270.0</td>
<td>156.70</td>
<td>193.7</td>
<td>196.30</td>
<td>0.0</td>
<td>0.0</td>
<td>NaN</td>
<td>0</td>
<td>0.198216</td>
<td>True</td>
<td>REGULAR</td>
<td>USD</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">14</td>
<td>SPXW250820C06275000</td>
<td>2025-07-23 19:48:30+00:00</td>
<td>6275.0</td>
<td>147.30</td>
<td>189.2</td>
<td>192.10</td>
<td>0.0</td>
<td>0.0</td>
<td>6.0</td>
<td>0</td>
<td>0.196499</td>
<td>True</td>
<td>REGULAR</td>
<td>USD</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">15</td>
<td>SPXW250820C06280000</td>
<td>2025-07-23 17:30:30+00:00</td>
<td>6280.0</td>
<td>135.77</td>
<td>185.2</td>
<td>187.90</td>
<td>0.0</td>
<td>0.0</td>
<td>26.0</td>
<td>0</td>
<td>0.194756</td>
<td>True</td>
<td>REGULAR</td>
<td>USD</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">16</td>
<td>SPXW250820C06290000</td>
<td>2025-07-24 13:43:32+00:00</td>
<td>6290.0</td>
<td>141.60</td>
<td>176.7</td>
<td>179.60</td>
<td>0.0</td>
<td>0.0</td>
<td>1.0</td>
<td>0</td>
<td>0.191334</td>
<td>True</td>
<td>REGULAR</td>
<td>USD</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">17</td>
<td>SPXW250820C06300000</td>
<td>2025-07-25 19:03:56+00:00</td>
<td>6300.0</td>
<td>151.55</td>
<td>168.5</td>
<td>171.40</td>
<td>0.0</td>
<td>0.0</td>
<td>4.0</td>
<td>0</td>
<td>0.187943</td>
<td>True</td>
<td>REGULAR</td>
<td>USD</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">18</td>
<td>SPXW250820C06310000</td>
<td>2025-07-25 19:03:56+00:00</td>
<td>6310.0</td>
<td>143.79</td>
<td>160.4</td>
<td>163.30</td>
<td>0.0</td>
<td>0.0</td>
<td>1.0</td>
<td>0</td>
<td>0.184575</td>
<td>True</td>
<td>REGULAR</td>
<td>USD</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">19</td>
<td>SPXW250820C06320000</td>
<td>2025-07-25 19:51:42+00:00</td>
<td>6320.0</td>
<td>134.47</td>
<td>153.4</td>
<td>154.20</td>
<td>0.0</td>
<td>0.0</td>
<td>1.0</td>
<td>0</td>
<td>0.179478</td>
<td>True</td>
<td>REGULAR</td>
<td>USD</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">20</td>
<td>SPXW250820C06325000</td>
<td>2025-07-25 19:51:42+00:00</td>
<td>6325.0</td>
<td>130.77</td>
<td>149.4</td>
<td>150.30</td>
<td>0.0</td>
<td>0.0</td>
<td>5.0</td>
<td>0</td>
<td>0.177907</td>
<td>True</td>
<td>REGULAR</td>
<td>USD</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">21</td>
<td>SPXW250820C06330000</td>
<td>2025-07-24 14:25:27+00:00</td>
<td>6330.0</td>
<td>114.00</td>
<td>145.6</td>
<td>146.40</td>
<td>0.0</td>
<td>0.0</td>
<td>40.0</td>
<td>0</td>
<td>0.176297</td>
<td>True</td>
<td>REGULAR</td>
<td>USD</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">22</td>
<td>SPXW250820C06340000</td>
<td>2025-07-25 19:22:20+00:00</td>
<td>6340.0</td>
<td>123.00</td>
<td>137.8</td>
<td>138.70</td>
<td>0.0</td>
<td>0.0</td>
<td>40.0</td>
<td>0</td>
<td>0.173102</td>
<td>True</td>
<td>REGULAR</td>
<td>USD</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">23</td>
<td>SPXW250820C06350000</td>
<td>2025-07-25 18:13:34+00:00</td>
<td>6350.0</td>
<td>114.81</td>
<td>130.2</td>
<td>131.10</td>
<td>0.0</td>
<td>0.0</td>
<td>15.0</td>
<td>0</td>
<td>0.169888</td>
<td>True</td>
<td>REGULAR</td>
<td>USD</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">24</td>
<td>SPXW250820C06360000</td>
<td>2025-07-23 16:41:48+00:00</td>
<td>6360.0</td>
<td>82.10</td>
<td>122.8</td>
<td>123.60</td>
<td>0.0</td>
<td>0.0</td>
<td>2.0</td>
<td>0</td>
<td>0.166646</td>
<td>True</td>
<td>REGULAR</td>
<td>USD</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">25</td>
<td>SPXW250820C06370000</td>
<td>2025-07-25 12:56:28+00:00</td>
<td>6370.0</td>
<td>89.09</td>
<td>115.6</td>
<td>116.40</td>
<td>0.0</td>
<td>0.0</td>
<td>1.0</td>
<td>0</td>
<td>0.163667</td>
<td>True</td>
<td>REGULAR</td>
<td>USD</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">26</td>
<td>SPXW250820C06375000</td>
<td>2025-07-25 14:56:57+00:00</td>
<td>6375.0</td>
<td>87.15</td>
<td>112.0</td>
<td>112.90</td>
<td>0.0</td>
<td>0.0</td>
<td>4.0</td>
<td>0</td>
<td>0.162251</td>
<td>True</td>
<td>REGULAR</td>
<td>USD</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">27</td>
<td>SPXW250820C06380000</td>
<td>2025-07-25 16:19:30+00:00</td>
<td>6380.0</td>
<td>87.71</td>
<td>108.5</td>
<td>109.40</td>
<td>0.0</td>
<td>0.0</td>
<td>80.0</td>
<td>0</td>
<td>0.160785</td>
<td>True</td>
<td>REGULAR</td>
<td>USD</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">28</td>
<td>SPXW250820C06400000</td>
<td>2025-07-25 19:59:21+00:00</td>
<td>6400.0</td>
<td>79.20</td>
<td>94.9</td>
<td>95.80</td>
<td>0.0</td>
<td>0.0</td>
<td>2.0</td>
<td>0</td>
<td>0.154961</td>
<td>False</td>
<td>REGULAR</td>
<td>USD</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">29</td>
<td>SPXW250820C06410000</td>
<td>2025-07-25 15:48:10+00:00</td>
<td>6410.0</td>
<td>67.17</td>
<td>88.4</td>
<td>89.30</td>
<td>0.0</td>
<td>0.0</td>
<td>1.0</td>
<td>0</td>
<td>0.152150</td>
<td>False</td>
<td>REGULAR</td>
<td>USD</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">30</td>
<td>SPXW250820C06420000</td>
<td>2025-07-25 15:11:55+00:00</td>
<td>6420.0</td>
<td>62.95</td>
<td>82.2</td>
<td>83.10</td>
<td>0.0</td>
<td>0.0</td>
<td>36.0</td>
<td>0</td>
<td>0.149537</td>
<td>False</td>
<td>REGULAR</td>
<td>USD</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">31</td>
<td>SPXW250820C06425000</td>
<td>2025-07-25 16:09:42+00:00</td>
<td>6425.0</td>
<td>60.34</td>
<td>79.2</td>
<td>80.10</td>
<td>0.0</td>
<td>0.0</td>
<td>11.0</td>
<td>0</td>
<td>0.148286</td>
<td>False</td>
<td>REGULAR</td>
<td>USD</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">32</td>
<td>SPXW250820C06430000</td>
<td>2025-07-25 15:11:50+00:00</td>
<td>6430.0</td>
<td>57.88</td>
<td>76.2</td>
<td>77.10</td>
<td>0.0</td>
<td>0.0</td>
<td>18.0</td>
<td>0</td>
<td>0.146964</td>
<td>False</td>
<td>REGULAR</td>
<td>USD</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">33</td>
<td>SPXW250820C06440000</td>
<td>2025-07-25 16:22:59+00:00</td>
<td>6440.0</td>
<td>54.59</td>
<td>70.5</td>
<td>71.30</td>
<td>0.0</td>
<td>0.0</td>
<td>4.0</td>
<td>0</td>
<td>0.144416</td>
<td>False</td>
<td>REGULAR</td>
<td>USD</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">34</td>
<td>SPXW250820C06450000</td>
<td>2025-07-25 17:04:55+00:00</td>
<td>6450.0</td>
<td>52.55</td>
<td>65.1</td>
<td>65.90</td>
<td>0.0</td>
<td>0.0</td>
<td>39.0</td>
<td>0</td>
<td>0.142198</td>
<td>False</td>
<td>REGULAR</td>
<td>USD</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">35</td>
<td>SPXW250820C06460000</td>
<td>2025-07-25 19:52:19+00:00</td>
<td>6460.0</td>
<td>49.20</td>
<td>59.8</td>
<td>60.60</td>
<td>0.0</td>
<td>0.0</td>
<td>3.0</td>
<td>0</td>
<td>0.139829</td>
<td>False</td>
<td>REGULAR</td>
<td>USD</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">36</td>
<td>SPXW250820C06470000</td>
<td>2025-07-25 15:29:27+00:00</td>
<td>6470.0</td>
<td>40.74</td>
<td>54.9</td>
<td>55.70</td>
<td>0.0</td>
<td>0.0</td>
<td>5.0</td>
<td>0</td>
<td>0.137780</td>
<td>False</td>
<td>REGULAR</td>
<td>USD</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">37</td>
<td>SPXW250820C06475000</td>
<td>2025-07-25 18:47:39+00:00</td>
<td>6475.0</td>
<td>45.30</td>
<td>52.4</td>
<td>53.30</td>
<td>0.0</td>
<td>0.0</td>
<td>71.0</td>
<td>0</td>
<td>0.136712</td>
<td>False</td>
<td>REGULAR</td>
<td>USD</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">38</td>
<td>SPXW250820C06480000</td>
<td>2025-07-24 14:44:53+00:00</td>
<td>6480.0</td>
<td>37.38</td>
<td>50.2</td>
<td>51.00</td>
<td>0.0</td>
<td>0.0</td>
<td>NaN</td>
<td>0</td>
<td>0.135726</td>
<td>False</td>
<td>REGULAR</td>
<td>USD</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">39</td>
<td>SPXW250820C06500000</td>
<td>2025-07-25 17:56:19+00:00</td>
<td>6500.0</td>
<td>34.52</td>
<td>41.7</td>
<td>42.40</td>
<td>0.0</td>
<td>0.0</td>
<td>7.0</td>
<td>0</td>
<td>0.131917</td>
<td>False</td>
<td>REGULAR</td>
<td>USD</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">40</td>
<td>SPXW250820C06525000</td>
<td>2025-07-25 19:52:20+00:00</td>
<td>6525.0</td>
<td>26.10</td>
<td>32.5</td>
<td>33.10</td>
<td>0.0</td>
<td>0.0</td>
<td>50.0</td>
<td>0</td>
<td>0.127639</td>
<td>False</td>
<td>REGULAR</td>
<td>USD</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">41</td>
<td>SPXW250820C06550000</td>
<td>2025-07-25 19:52:20+00:00</td>
<td>6550.0</td>
<td>19.80</td>
<td>24.9</td>
<td>25.50</td>
<td>0.0</td>
<td>0.0</td>
<td>14.0</td>
<td>0</td>
<td>0.124173</td>
<td>False</td>
<td>REGULAR</td>
<td>USD</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">42</td>
<td>SPXW250820C06575000</td>
<td>2025-07-24 14:22:05+00:00</td>
<td>6575.0</td>
<td>13.00</td>
<td>18.7</td>
<td>19.30</td>
<td>0.0</td>
<td>0.0</td>
<td>NaN</td>
<td>0</td>
<td>0.121156</td>
<td>False</td>
<td>REGULAR</td>
<td>USD</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">43</td>
<td>SPXW250820C06600000</td>
<td>2025-07-25 13:30:56+00:00</td>
<td>6600.0</td>
<td>9.30</td>
<td>13.9</td>
<td>14.50</td>
<td>0.0</td>
<td>0.0</td>
<td>1.0</td>
<td>0</td>
<td>0.118940</td>
<td>False</td>
<td>REGULAR</td>
<td>USD</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">44</td>
<td>SPXW250820C06625000</td>
<td>2025-07-25 17:38:33+00:00</td>
<td>6625.0</td>
<td>8.40</td>
<td>10.1</td>
<td>10.70</td>
<td>0.0</td>
<td>0.0</td>
<td>5.0</td>
<td>0</td>
<td>0.116964</td>
<td>False</td>
<td>REGULAR</td>
<td>USD</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">45</td>
<td>SPXW250820C06650000</td>
<td>2025-07-25 14:10:48+00:00</td>
<td>6650.0</td>
<td>5.00</td>
<td>7.3</td>
<td>7.70</td>
<td>0.0</td>
<td>0.0</td>
<td>4.0</td>
<td>0</td>
<td>0.114999</td>
<td>False</td>
<td>REGULAR</td>
<td>USD</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">46</td>
<td>SPXW250820C06675000</td>
<td>2025-07-25 19:43:31+00:00</td>
<td>6675.0</td>
<td>4.20</td>
<td>5.1</td>
<td>5.60</td>
<td>0.0</td>
<td>0.0</td>
<td>2.0</td>
<td>0</td>
<td>0.114015</td>
<td>False</td>
<td>REGULAR</td>
<td>USD</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">47</td>
<td>SPXW250820C06700000</td>
<td>2025-07-25 14:40:39+00:00</td>
<td>6700.0</td>
<td>2.70</td>
<td>3.6</td>
<td>4.10</td>
<td>0.0</td>
<td>0.0</td>
<td>5.0</td>
<td>0</td>
<td>0.113641</td>
<td>False</td>
<td>REGULAR</td>
<td>USD</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">48</td>
<td>SPXW250820C06725000</td>
<td>2025-07-22 13:37:28+00:00</td>
<td>6725.0</td>
<td>1.97</td>
<td>2.6</td>
<td>2.95</td>
<td>0.0</td>
<td>0.0</td>
<td>NaN</td>
<td>0</td>
<td>0.113229</td>
<td>False</td>
<td>REGULAR</td>
<td>USD</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">49</td>
<td>SPXW250820C06750000</td>
<td>2025-07-23 15:22:01+00:00</td>
<td>6750.0</td>
<td>1.30</td>
<td>1.9</td>
<td>2.15</td>
<td>0.0</td>
<td>0.0</td>
<td>NaN</td>
<td>0</td>
<td>0.113351</td>
<td>False</td>
<td>REGULAR</td>
<td>USD</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">50</td>
<td>SPXW250820C06800000</td>
<td>2025-07-23 14:06:32+00:00</td>
<td>6800.0</td>
<td>0.82</td>
<td>0.0</td>
<td>1.30</td>
<td>0.0</td>
<td>0.0</td>
<td>1.0</td>
<td>0</td>
<td>0.116311</td>
<td>False</td>
<td>REGULAR</td>
<td>USD</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">51</td>
<td>SPXW250820C06900000</td>
<td>2025-07-23 15:47:26+00:00</td>
<td>6900.0</td>
<td>0.45</td>
<td>0.0</td>
<td>0.00</td>
<td>0.0</td>
<td>0.0</td>
<td>6.0</td>
<td>0</td>
<td>0.062509</td>
<td>False</td>
<td>REGULAR</td>
<td>USD</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">52</td>
<td>SPXW250820C07000000</td>
<td>2025-07-23 14:52:42+00:00</td>
<td>7000.0</td>
<td>0.25</td>
<td>0.0</td>
<td>0.00</td>
<td>0.0</td>
<td>0.0</td>
<td>NaN</td>
<td>0</td>
<td>0.062509</td>
<td>False</td>
<td>REGULAR</td>
<td>USD</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">53</td>
<td>SPXW250820C07200000</td>
<td>2025-07-24 13:48:48+00:00</td>
<td>7200.0</td>
<td>0.25</td>
<td>0.0</td>
<td>0.00</td>
<td>0.0</td>
<td>0.0</td>
<td>NaN</td>
<td>0</td>
<td>0.062509</td>
<td>False</td>
<td>REGULAR</td>
<td>USD</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">54</td>
<td>SPXW250820C08000000</td>
<td>2025-07-23 13:30:06+00:00</td>
<td>8000.0</td>
<td>0.05</td>
<td>0.0</td>
<td>0.00</td>
<td>0.0</td>
<td>0.0</td>
<td>NaN</td>
<td>0</td>
<td>0.125009</td>
<td>False</td>
<td>REGULAR</td>
<td>USD</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<div id="cell-52" class="cell" data-execution_count="32">
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a><span class="co"># clean up data</span></span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true" tabindex="-1"></a><span class="co"># remove NA's</span></span>
<span id="cb44-3"><a href="#cb44-3" aria-hidden="true" tabindex="-1"></a>spx_calls <span class="op">=</span> spx_calls.drop([<span class="st">'currency'</span>, <span class="st">'contractSize'</span>], axis<span class="op">=</span><span class="dv">1</span>).dropna()</span>
<span id="cb44-4"><a href="#cb44-4" aria-hidden="true" tabindex="-1"></a>spx_puts <span class="op">=</span> spx_puts.drop([<span class="st">'currency'</span>, <span class="st">'contractSize'</span>], axis<span class="op">=</span><span class="dv">1</span>).dropna()</span>
<span id="cb44-5"><a href="#cb44-5" aria-hidden="true" tabindex="-1"></a>spx_calls.shape, spx_puts.shape</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="32">
<pre><code>((38, 12), (65, 12))</code></pre>
</div>
</div>
<div id="cell-53" class="cell" data-execution_count="33">
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a>spx_calls[spx_calls[<span class="st">'lastTradeDate'</span>] <span class="op">&gt;</span> <span class="st">'2024-07'</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="33">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">contractSymbol</th>
<th data-quarto-table-cell-role="th">lastTradeDate</th>
<th data-quarto-table-cell-role="th">strike</th>
<th data-quarto-table-cell-role="th">lastPrice</th>
<th data-quarto-table-cell-role="th">bid</th>
<th data-quarto-table-cell-role="th">ask</th>
<th data-quarto-table-cell-role="th">change</th>
<th data-quarto-table-cell-role="th">percentChange</th>
<th data-quarto-table-cell-role="th">volume</th>
<th data-quarto-table-cell-role="th">openInterest</th>
<th data-quarto-table-cell-role="th">impliedVolatility</th>
<th data-quarto-table-cell-role="th">inTheMoney</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>SPXW250820C06000000</td>
<td>2025-07-25 19:40:13+00:00</td>
<td>6000.0</td>
<td>419.54</td>
<td>438.2</td>
<td>446.6</td>
<td>0.0</td>
<td>0.0</td>
<td>1.0</td>
<td>0</td>
<td>0.305007</td>
<td>True</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">6</td>
<td>SPXW250820C06150000</td>
<td>2025-07-24 17:14:10+00:00</td>
<td>6150.0</td>
<td>267.38</td>
<td>296.7</td>
<td>305.4</td>
<td>0.0</td>
<td>0.0</td>
<td>2.0</td>
<td>0</td>
<td>0.246815</td>
<td>True</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">8</td>
<td>SPXW250820C06200000</td>
<td>2025-07-25 19:53:07+00:00</td>
<td>6200.0</td>
<td>232.41</td>
<td>251.6</td>
<td>260.0</td>
<td>0.0</td>
<td>0.0</td>
<td>33.0</td>
<td>0</td>
<td>0.227989</td>
<td>True</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">11</td>
<td>SPXW250820C06250000</td>
<td>2025-07-25 19:53:07+00:00</td>
<td>6250.0</td>
<td>189.71</td>
<td>210.5</td>
<td>213.4</td>
<td>0.0</td>
<td>0.0</td>
<td>33.0</td>
<td>0</td>
<td>0.205288</td>
<td>True</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">14</td>
<td>SPXW250820C06275000</td>
<td>2025-07-23 19:48:30+00:00</td>
<td>6275.0</td>
<td>147.30</td>
<td>189.2</td>
<td>192.1</td>
<td>0.0</td>
<td>0.0</td>
<td>6.0</td>
<td>0</td>
<td>0.196499</td>
<td>True</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">15</td>
<td>SPXW250820C06280000</td>
<td>2025-07-23 17:30:30+00:00</td>
<td>6280.0</td>
<td>135.77</td>
<td>185.2</td>
<td>187.9</td>
<td>0.0</td>
<td>0.0</td>
<td>26.0</td>
<td>0</td>
<td>0.194756</td>
<td>True</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">16</td>
<td>SPXW250820C06290000</td>
<td>2025-07-24 13:43:32+00:00</td>
<td>6290.0</td>
<td>141.60</td>
<td>176.7</td>
<td>179.6</td>
<td>0.0</td>
<td>0.0</td>
<td>1.0</td>
<td>0</td>
<td>0.191334</td>
<td>True</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">17</td>
<td>SPXW250820C06300000</td>
<td>2025-07-25 19:03:56+00:00</td>
<td>6300.0</td>
<td>151.55</td>
<td>168.5</td>
<td>171.4</td>
<td>0.0</td>
<td>0.0</td>
<td>4.0</td>
<td>0</td>
<td>0.187943</td>
<td>True</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">18</td>
<td>SPXW250820C06310000</td>
<td>2025-07-25 19:03:56+00:00</td>
<td>6310.0</td>
<td>143.79</td>
<td>160.4</td>
<td>163.3</td>
<td>0.0</td>
<td>0.0</td>
<td>1.0</td>
<td>0</td>
<td>0.184575</td>
<td>True</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">19</td>
<td>SPXW250820C06320000</td>
<td>2025-07-25 19:51:42+00:00</td>
<td>6320.0</td>
<td>134.47</td>
<td>153.4</td>
<td>154.2</td>
<td>0.0</td>
<td>0.0</td>
<td>1.0</td>
<td>0</td>
<td>0.179478</td>
<td>True</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">20</td>
<td>SPXW250820C06325000</td>
<td>2025-07-25 19:51:42+00:00</td>
<td>6325.0</td>
<td>130.77</td>
<td>149.4</td>
<td>150.3</td>
<td>0.0</td>
<td>0.0</td>
<td>5.0</td>
<td>0</td>
<td>0.177907</td>
<td>True</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">21</td>
<td>SPXW250820C06330000</td>
<td>2025-07-24 14:25:27+00:00</td>
<td>6330.0</td>
<td>114.00</td>
<td>145.6</td>
<td>146.4</td>
<td>0.0</td>
<td>0.0</td>
<td>40.0</td>
<td>0</td>
<td>0.176297</td>
<td>True</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">22</td>
<td>SPXW250820C06340000</td>
<td>2025-07-25 19:22:20+00:00</td>
<td>6340.0</td>
<td>123.00</td>
<td>137.8</td>
<td>138.7</td>
<td>0.0</td>
<td>0.0</td>
<td>40.0</td>
<td>0</td>
<td>0.173102</td>
<td>True</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">23</td>
<td>SPXW250820C06350000</td>
<td>2025-07-25 18:13:34+00:00</td>
<td>6350.0</td>
<td>114.81</td>
<td>130.2</td>
<td>131.1</td>
<td>0.0</td>
<td>0.0</td>
<td>15.0</td>
<td>0</td>
<td>0.169888</td>
<td>True</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">24</td>
<td>SPXW250820C06360000</td>
<td>2025-07-23 16:41:48+00:00</td>
<td>6360.0</td>
<td>82.10</td>
<td>122.8</td>
<td>123.6</td>
<td>0.0</td>
<td>0.0</td>
<td>2.0</td>
<td>0</td>
<td>0.166646</td>
<td>True</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">25</td>
<td>SPXW250820C06370000</td>
<td>2025-07-25 12:56:28+00:00</td>
<td>6370.0</td>
<td>89.09</td>
<td>115.6</td>
<td>116.4</td>
<td>0.0</td>
<td>0.0</td>
<td>1.0</td>
<td>0</td>
<td>0.163667</td>
<td>True</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">26</td>
<td>SPXW250820C06375000</td>
<td>2025-07-25 14:56:57+00:00</td>
<td>6375.0</td>
<td>87.15</td>
<td>112.0</td>
<td>112.9</td>
<td>0.0</td>
<td>0.0</td>
<td>4.0</td>
<td>0</td>
<td>0.162251</td>
<td>True</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">27</td>
<td>SPXW250820C06380000</td>
<td>2025-07-25 16:19:30+00:00</td>
<td>6380.0</td>
<td>87.71</td>
<td>108.5</td>
<td>109.4</td>
<td>0.0</td>
<td>0.0</td>
<td>80.0</td>
<td>0</td>
<td>0.160785</td>
<td>True</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">28</td>
<td>SPXW250820C06400000</td>
<td>2025-07-25 19:59:21+00:00</td>
<td>6400.0</td>
<td>79.20</td>
<td>94.9</td>
<td>95.8</td>
<td>0.0</td>
<td>0.0</td>
<td>2.0</td>
<td>0</td>
<td>0.154961</td>
<td>False</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">29</td>
<td>SPXW250820C06410000</td>
<td>2025-07-25 15:48:10+00:00</td>
<td>6410.0</td>
<td>67.17</td>
<td>88.4</td>
<td>89.3</td>
<td>0.0</td>
<td>0.0</td>
<td>1.0</td>
<td>0</td>
<td>0.152150</td>
<td>False</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">30</td>
<td>SPXW250820C06420000</td>
<td>2025-07-25 15:11:55+00:00</td>
<td>6420.0</td>
<td>62.95</td>
<td>82.2</td>
<td>83.1</td>
<td>0.0</td>
<td>0.0</td>
<td>36.0</td>
<td>0</td>
<td>0.149537</td>
<td>False</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">31</td>
<td>SPXW250820C06425000</td>
<td>2025-07-25 16:09:42+00:00</td>
<td>6425.0</td>
<td>60.34</td>
<td>79.2</td>
<td>80.1</td>
<td>0.0</td>
<td>0.0</td>
<td>11.0</td>
<td>0</td>
<td>0.148286</td>
<td>False</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">32</td>
<td>SPXW250820C06430000</td>
<td>2025-07-25 15:11:50+00:00</td>
<td>6430.0</td>
<td>57.88</td>
<td>76.2</td>
<td>77.1</td>
<td>0.0</td>
<td>0.0</td>
<td>18.0</td>
<td>0</td>
<td>0.146964</td>
<td>False</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">33</td>
<td>SPXW250820C06440000</td>
<td>2025-07-25 16:22:59+00:00</td>
<td>6440.0</td>
<td>54.59</td>
<td>70.5</td>
<td>71.3</td>
<td>0.0</td>
<td>0.0</td>
<td>4.0</td>
<td>0</td>
<td>0.144416</td>
<td>False</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">34</td>
<td>SPXW250820C06450000</td>
<td>2025-07-25 17:04:55+00:00</td>
<td>6450.0</td>
<td>52.55</td>
<td>65.1</td>
<td>65.9</td>
<td>0.0</td>
<td>0.0</td>
<td>39.0</td>
<td>0</td>
<td>0.142198</td>
<td>False</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">35</td>
<td>SPXW250820C06460000</td>
<td>2025-07-25 19:52:19+00:00</td>
<td>6460.0</td>
<td>49.20</td>
<td>59.8</td>
<td>60.6</td>
<td>0.0</td>
<td>0.0</td>
<td>3.0</td>
<td>0</td>
<td>0.139829</td>
<td>False</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">36</td>
<td>SPXW250820C06470000</td>
<td>2025-07-25 15:29:27+00:00</td>
<td>6470.0</td>
<td>40.74</td>
<td>54.9</td>
<td>55.7</td>
<td>0.0</td>
<td>0.0</td>
<td>5.0</td>
<td>0</td>
<td>0.137780</td>
<td>False</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">37</td>
<td>SPXW250820C06475000</td>
<td>2025-07-25 18:47:39+00:00</td>
<td>6475.0</td>
<td>45.30</td>
<td>52.4</td>
<td>53.3</td>
<td>0.0</td>
<td>0.0</td>
<td>71.0</td>
<td>0</td>
<td>0.136712</td>
<td>False</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">39</td>
<td>SPXW250820C06500000</td>
<td>2025-07-25 17:56:19+00:00</td>
<td>6500.0</td>
<td>34.52</td>
<td>41.7</td>
<td>42.4</td>
<td>0.0</td>
<td>0.0</td>
<td>7.0</td>
<td>0</td>
<td>0.131917</td>
<td>False</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">40</td>
<td>SPXW250820C06525000</td>
<td>2025-07-25 19:52:20+00:00</td>
<td>6525.0</td>
<td>26.10</td>
<td>32.5</td>
<td>33.1</td>
<td>0.0</td>
<td>0.0</td>
<td>50.0</td>
<td>0</td>
<td>0.127639</td>
<td>False</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">41</td>
<td>SPXW250820C06550000</td>
<td>2025-07-25 19:52:20+00:00</td>
<td>6550.0</td>
<td>19.80</td>
<td>24.9</td>
<td>25.5</td>
<td>0.0</td>
<td>0.0</td>
<td>14.0</td>
<td>0</td>
<td>0.124173</td>
<td>False</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">43</td>
<td>SPXW250820C06600000</td>
<td>2025-07-25 13:30:56+00:00</td>
<td>6600.0</td>
<td>9.30</td>
<td>13.9</td>
<td>14.5</td>
<td>0.0</td>
<td>0.0</td>
<td>1.0</td>
<td>0</td>
<td>0.118940</td>
<td>False</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">44</td>
<td>SPXW250820C06625000</td>
<td>2025-07-25 17:38:33+00:00</td>
<td>6625.0</td>
<td>8.40</td>
<td>10.1</td>
<td>10.7</td>
<td>0.0</td>
<td>0.0</td>
<td>5.0</td>
<td>0</td>
<td>0.116964</td>
<td>False</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">45</td>
<td>SPXW250820C06650000</td>
<td>2025-07-25 14:10:48+00:00</td>
<td>6650.0</td>
<td>5.00</td>
<td>7.3</td>
<td>7.7</td>
<td>0.0</td>
<td>0.0</td>
<td>4.0</td>
<td>0</td>
<td>0.114999</td>
<td>False</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">46</td>
<td>SPXW250820C06675000</td>
<td>2025-07-25 19:43:31+00:00</td>
<td>6675.0</td>
<td>4.20</td>
<td>5.1</td>
<td>5.6</td>
<td>0.0</td>
<td>0.0</td>
<td>2.0</td>
<td>0</td>
<td>0.114015</td>
<td>False</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">47</td>
<td>SPXW250820C06700000</td>
<td>2025-07-25 14:40:39+00:00</td>
<td>6700.0</td>
<td>2.70</td>
<td>3.6</td>
<td>4.1</td>
<td>0.0</td>
<td>0.0</td>
<td>5.0</td>
<td>0</td>
<td>0.113641</td>
<td>False</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">50</td>
<td>SPXW250820C06800000</td>
<td>2025-07-23 14:06:32+00:00</td>
<td>6800.0</td>
<td>0.82</td>
<td>0.0</td>
<td>1.3</td>
<td>0.0</td>
<td>0.0</td>
<td>1.0</td>
<td>0</td>
<td>0.116311</td>
<td>False</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">51</td>
<td>SPXW250820C06900000</td>
<td>2025-07-23 15:47:26+00:00</td>
<td>6900.0</td>
<td>0.45</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>6.0</td>
<td>0</td>
<td>0.062509</td>
<td>False</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<div id="cell-54" class="cell" data-execution_count="34">
<div class="sourceCode cell-code" id="cb47"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a><span class="co"># remove data point where either bid = 0 or ask = 0</span></span>
<span id="cb47-2"><a href="#cb47-2" aria-hidden="true" tabindex="-1"></a><span class="co"># remove data that that are not traded recently</span></span>
<span id="cb47-3"><a href="#cb47-3" aria-hidden="true" tabindex="-1"></a>spx_calls <span class="op">=</span> spx_calls[(spx_calls[<span class="st">'bid'</span>] <span class="op">&gt;</span> <span class="dv">0</span>) <span class="op">&amp;</span> (spx_calls[<span class="st">'ask'</span>] <span class="op">&gt;</span> <span class="dv">0</span>)]</span>
<span id="cb47-4"><a href="#cb47-4" aria-hidden="true" tabindex="-1"></a><span class="co">#spx_calls[spx_calls['lastTradeDate'] &gt; '2022-07']</span></span>
<span id="cb47-5"><a href="#cb47-5" aria-hidden="true" tabindex="-1"></a>spx_calls</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="34">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">contractSymbol</th>
<th data-quarto-table-cell-role="th">lastTradeDate</th>
<th data-quarto-table-cell-role="th">strike</th>
<th data-quarto-table-cell-role="th">lastPrice</th>
<th data-quarto-table-cell-role="th">bid</th>
<th data-quarto-table-cell-role="th">ask</th>
<th data-quarto-table-cell-role="th">change</th>
<th data-quarto-table-cell-role="th">percentChange</th>
<th data-quarto-table-cell-role="th">volume</th>
<th data-quarto-table-cell-role="th">openInterest</th>
<th data-quarto-table-cell-role="th">impliedVolatility</th>
<th data-quarto-table-cell-role="th">inTheMoney</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>SPXW250820C06000000</td>
<td>2025-07-25 19:40:13+00:00</td>
<td>6000.0</td>
<td>419.54</td>
<td>438.2</td>
<td>446.6</td>
<td>0.0</td>
<td>0.0</td>
<td>1.0</td>
<td>0</td>
<td>0.305007</td>
<td>True</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">6</td>
<td>SPXW250820C06150000</td>
<td>2025-07-24 17:14:10+00:00</td>
<td>6150.0</td>
<td>267.38</td>
<td>296.7</td>
<td>305.4</td>
<td>0.0</td>
<td>0.0</td>
<td>2.0</td>
<td>0</td>
<td>0.246815</td>
<td>True</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">8</td>
<td>SPXW250820C06200000</td>
<td>2025-07-25 19:53:07+00:00</td>
<td>6200.0</td>
<td>232.41</td>
<td>251.6</td>
<td>260.0</td>
<td>0.0</td>
<td>0.0</td>
<td>33.0</td>
<td>0</td>
<td>0.227989</td>
<td>True</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">11</td>
<td>SPXW250820C06250000</td>
<td>2025-07-25 19:53:07+00:00</td>
<td>6250.0</td>
<td>189.71</td>
<td>210.5</td>
<td>213.4</td>
<td>0.0</td>
<td>0.0</td>
<td>33.0</td>
<td>0</td>
<td>0.205288</td>
<td>True</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">14</td>
<td>SPXW250820C06275000</td>
<td>2025-07-23 19:48:30+00:00</td>
<td>6275.0</td>
<td>147.30</td>
<td>189.2</td>
<td>192.1</td>
<td>0.0</td>
<td>0.0</td>
<td>6.0</td>
<td>0</td>
<td>0.196499</td>
<td>True</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">15</td>
<td>SPXW250820C06280000</td>
<td>2025-07-23 17:30:30+00:00</td>
<td>6280.0</td>
<td>135.77</td>
<td>185.2</td>
<td>187.9</td>
<td>0.0</td>
<td>0.0</td>
<td>26.0</td>
<td>0</td>
<td>0.194756</td>
<td>True</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">16</td>
<td>SPXW250820C06290000</td>
<td>2025-07-24 13:43:32+00:00</td>
<td>6290.0</td>
<td>141.60</td>
<td>176.7</td>
<td>179.6</td>
<td>0.0</td>
<td>0.0</td>
<td>1.0</td>
<td>0</td>
<td>0.191334</td>
<td>True</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">17</td>
<td>SPXW250820C06300000</td>
<td>2025-07-25 19:03:56+00:00</td>
<td>6300.0</td>
<td>151.55</td>
<td>168.5</td>
<td>171.4</td>
<td>0.0</td>
<td>0.0</td>
<td>4.0</td>
<td>0</td>
<td>0.187943</td>
<td>True</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">18</td>
<td>SPXW250820C06310000</td>
<td>2025-07-25 19:03:56+00:00</td>
<td>6310.0</td>
<td>143.79</td>
<td>160.4</td>
<td>163.3</td>
<td>0.0</td>
<td>0.0</td>
<td>1.0</td>
<td>0</td>
<td>0.184575</td>
<td>True</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">19</td>
<td>SPXW250820C06320000</td>
<td>2025-07-25 19:51:42+00:00</td>
<td>6320.0</td>
<td>134.47</td>
<td>153.4</td>
<td>154.2</td>
<td>0.0</td>
<td>0.0</td>
<td>1.0</td>
<td>0</td>
<td>0.179478</td>
<td>True</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">20</td>
<td>SPXW250820C06325000</td>
<td>2025-07-25 19:51:42+00:00</td>
<td>6325.0</td>
<td>130.77</td>
<td>149.4</td>
<td>150.3</td>
<td>0.0</td>
<td>0.0</td>
<td>5.0</td>
<td>0</td>
<td>0.177907</td>
<td>True</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">21</td>
<td>SPXW250820C06330000</td>
<td>2025-07-24 14:25:27+00:00</td>
<td>6330.0</td>
<td>114.00</td>
<td>145.6</td>
<td>146.4</td>
<td>0.0</td>
<td>0.0</td>
<td>40.0</td>
<td>0</td>
<td>0.176297</td>
<td>True</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">22</td>
<td>SPXW250820C06340000</td>
<td>2025-07-25 19:22:20+00:00</td>
<td>6340.0</td>
<td>123.00</td>
<td>137.8</td>
<td>138.7</td>
<td>0.0</td>
<td>0.0</td>
<td>40.0</td>
<td>0</td>
<td>0.173102</td>
<td>True</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">23</td>
<td>SPXW250820C06350000</td>
<td>2025-07-25 18:13:34+00:00</td>
<td>6350.0</td>
<td>114.81</td>
<td>130.2</td>
<td>131.1</td>
<td>0.0</td>
<td>0.0</td>
<td>15.0</td>
<td>0</td>
<td>0.169888</td>
<td>True</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">24</td>
<td>SPXW250820C06360000</td>
<td>2025-07-23 16:41:48+00:00</td>
<td>6360.0</td>
<td>82.10</td>
<td>122.8</td>
<td>123.6</td>
<td>0.0</td>
<td>0.0</td>
<td>2.0</td>
<td>0</td>
<td>0.166646</td>
<td>True</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">25</td>
<td>SPXW250820C06370000</td>
<td>2025-07-25 12:56:28+00:00</td>
<td>6370.0</td>
<td>89.09</td>
<td>115.6</td>
<td>116.4</td>
<td>0.0</td>
<td>0.0</td>
<td>1.0</td>
<td>0</td>
<td>0.163667</td>
<td>True</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">26</td>
<td>SPXW250820C06375000</td>
<td>2025-07-25 14:56:57+00:00</td>
<td>6375.0</td>
<td>87.15</td>
<td>112.0</td>
<td>112.9</td>
<td>0.0</td>
<td>0.0</td>
<td>4.0</td>
<td>0</td>
<td>0.162251</td>
<td>True</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">27</td>
<td>SPXW250820C06380000</td>
<td>2025-07-25 16:19:30+00:00</td>
<td>6380.0</td>
<td>87.71</td>
<td>108.5</td>
<td>109.4</td>
<td>0.0</td>
<td>0.0</td>
<td>80.0</td>
<td>0</td>
<td>0.160785</td>
<td>True</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">28</td>
<td>SPXW250820C06400000</td>
<td>2025-07-25 19:59:21+00:00</td>
<td>6400.0</td>
<td>79.20</td>
<td>94.9</td>
<td>95.8</td>
<td>0.0</td>
<td>0.0</td>
<td>2.0</td>
<td>0</td>
<td>0.154961</td>
<td>False</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">29</td>
<td>SPXW250820C06410000</td>
<td>2025-07-25 15:48:10+00:00</td>
<td>6410.0</td>
<td>67.17</td>
<td>88.4</td>
<td>89.3</td>
<td>0.0</td>
<td>0.0</td>
<td>1.0</td>
<td>0</td>
<td>0.152150</td>
<td>False</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">30</td>
<td>SPXW250820C06420000</td>
<td>2025-07-25 15:11:55+00:00</td>
<td>6420.0</td>
<td>62.95</td>
<td>82.2</td>
<td>83.1</td>
<td>0.0</td>
<td>0.0</td>
<td>36.0</td>
<td>0</td>
<td>0.149537</td>
<td>False</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">31</td>
<td>SPXW250820C06425000</td>
<td>2025-07-25 16:09:42+00:00</td>
<td>6425.0</td>
<td>60.34</td>
<td>79.2</td>
<td>80.1</td>
<td>0.0</td>
<td>0.0</td>
<td>11.0</td>
<td>0</td>
<td>0.148286</td>
<td>False</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">32</td>
<td>SPXW250820C06430000</td>
<td>2025-07-25 15:11:50+00:00</td>
<td>6430.0</td>
<td>57.88</td>
<td>76.2</td>
<td>77.1</td>
<td>0.0</td>
<td>0.0</td>
<td>18.0</td>
<td>0</td>
<td>0.146964</td>
<td>False</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">33</td>
<td>SPXW250820C06440000</td>
<td>2025-07-25 16:22:59+00:00</td>
<td>6440.0</td>
<td>54.59</td>
<td>70.5</td>
<td>71.3</td>
<td>0.0</td>
<td>0.0</td>
<td>4.0</td>
<td>0</td>
<td>0.144416</td>
<td>False</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">34</td>
<td>SPXW250820C06450000</td>
<td>2025-07-25 17:04:55+00:00</td>
<td>6450.0</td>
<td>52.55</td>
<td>65.1</td>
<td>65.9</td>
<td>0.0</td>
<td>0.0</td>
<td>39.0</td>
<td>0</td>
<td>0.142198</td>
<td>False</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">35</td>
<td>SPXW250820C06460000</td>
<td>2025-07-25 19:52:19+00:00</td>
<td>6460.0</td>
<td>49.20</td>
<td>59.8</td>
<td>60.6</td>
<td>0.0</td>
<td>0.0</td>
<td>3.0</td>
<td>0</td>
<td>0.139829</td>
<td>False</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">36</td>
<td>SPXW250820C06470000</td>
<td>2025-07-25 15:29:27+00:00</td>
<td>6470.0</td>
<td>40.74</td>
<td>54.9</td>
<td>55.7</td>
<td>0.0</td>
<td>0.0</td>
<td>5.0</td>
<td>0</td>
<td>0.137780</td>
<td>False</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">37</td>
<td>SPXW250820C06475000</td>
<td>2025-07-25 18:47:39+00:00</td>
<td>6475.0</td>
<td>45.30</td>
<td>52.4</td>
<td>53.3</td>
<td>0.0</td>
<td>0.0</td>
<td>71.0</td>
<td>0</td>
<td>0.136712</td>
<td>False</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">39</td>
<td>SPXW250820C06500000</td>
<td>2025-07-25 17:56:19+00:00</td>
<td>6500.0</td>
<td>34.52</td>
<td>41.7</td>
<td>42.4</td>
<td>0.0</td>
<td>0.0</td>
<td>7.0</td>
<td>0</td>
<td>0.131917</td>
<td>False</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">40</td>
<td>SPXW250820C06525000</td>
<td>2025-07-25 19:52:20+00:00</td>
<td>6525.0</td>
<td>26.10</td>
<td>32.5</td>
<td>33.1</td>
<td>0.0</td>
<td>0.0</td>
<td>50.0</td>
<td>0</td>
<td>0.127639</td>
<td>False</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">41</td>
<td>SPXW250820C06550000</td>
<td>2025-07-25 19:52:20+00:00</td>
<td>6550.0</td>
<td>19.80</td>
<td>24.9</td>
<td>25.5</td>
<td>0.0</td>
<td>0.0</td>
<td>14.0</td>
<td>0</td>
<td>0.124173</td>
<td>False</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">43</td>
<td>SPXW250820C06600000</td>
<td>2025-07-25 13:30:56+00:00</td>
<td>6600.0</td>
<td>9.30</td>
<td>13.9</td>
<td>14.5</td>
<td>0.0</td>
<td>0.0</td>
<td>1.0</td>
<td>0</td>
<td>0.118940</td>
<td>False</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">44</td>
<td>SPXW250820C06625000</td>
<td>2025-07-25 17:38:33+00:00</td>
<td>6625.0</td>
<td>8.40</td>
<td>10.1</td>
<td>10.7</td>
<td>0.0</td>
<td>0.0</td>
<td>5.0</td>
<td>0</td>
<td>0.116964</td>
<td>False</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">45</td>
<td>SPXW250820C06650000</td>
<td>2025-07-25 14:10:48+00:00</td>
<td>6650.0</td>
<td>5.00</td>
<td>7.3</td>
<td>7.7</td>
<td>0.0</td>
<td>0.0</td>
<td>4.0</td>
<td>0</td>
<td>0.114999</td>
<td>False</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">46</td>
<td>SPXW250820C06675000</td>
<td>2025-07-25 19:43:31+00:00</td>
<td>6675.0</td>
<td>4.20</td>
<td>5.1</td>
<td>5.6</td>
<td>0.0</td>
<td>0.0</td>
<td>2.0</td>
<td>0</td>
<td>0.114015</td>
<td>False</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">47</td>
<td>SPXW250820C06700000</td>
<td>2025-07-25 14:40:39+00:00</td>
<td>6700.0</td>
<td>2.70</td>
<td>3.6</td>
<td>4.1</td>
<td>0.0</td>
<td>0.0</td>
<td>5.0</td>
<td>0</td>
<td>0.113641</td>
<td>False</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<div id="cell-55" class="cell" data-execution_count="35">
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a>spx_puts <span class="op">=</span> spx_puts[(spx_puts[<span class="st">'bid'</span>] <span class="op">&gt;</span> <span class="dv">0</span>) <span class="op">&amp;</span> (spx_puts[<span class="st">'ask'</span>] <span class="op">&gt;</span> <span class="dv">0</span>)]</span>
<span id="cb48-2"><a href="#cb48-2" aria-hidden="true" tabindex="-1"></a><span class="co">#spx_puts = spx_puts[spx_puts['lastTradeDate'] &gt; '2022-02']</span></span>
<span id="cb48-3"><a href="#cb48-3" aria-hidden="true" tabindex="-1"></a>spx_puts</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="35">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">contractSymbol</th>
<th data-quarto-table-cell-role="th">lastTradeDate</th>
<th data-quarto-table-cell-role="th">strike</th>
<th data-quarto-table-cell-role="th">lastPrice</th>
<th data-quarto-table-cell-role="th">bid</th>
<th data-quarto-table-cell-role="th">ask</th>
<th data-quarto-table-cell-role="th">change</th>
<th data-quarto-table-cell-role="th">percentChange</th>
<th data-quarto-table-cell-role="th">volume</th>
<th data-quarto-table-cell-role="th">openInterest</th>
<th data-quarto-table-cell-role="th">impliedVolatility</th>
<th data-quarto-table-cell-role="th">inTheMoney</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">6</td>
<td>SPXW250820P04800000</td>
<td>2025-07-23 19:03:36+00:00</td>
<td>4800.0</td>
<td>1.55</td>
<td>0.70</td>
<td>0.90</td>
<td>0.000000</td>
<td>0.000000</td>
<td>23.0</td>
<td>0</td>
<td>0.429327</td>
<td>False</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">11</td>
<td>SPXW250820P05400000</td>
<td>2025-07-25 19:37:03+00:00</td>
<td>5400.0</td>
<td>2.85</td>
<td>2.20</td>
<td>2.40</td>
<td>0.000000</td>
<td>0.000000</td>
<td>1.0</td>
<td>0</td>
<td>0.301795</td>
<td>False</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">12</td>
<td>SPXW250820P05425000</td>
<td>2025-07-25 20:02:09+00:00</td>
<td>5425.0</td>
<td>2.80</td>
<td>2.30</td>
<td>2.50</td>
<td>0.000000</td>
<td>0.000000</td>
<td>1590.0</td>
<td>0</td>
<td>0.296272</td>
<td>False</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">13</td>
<td>SPXW250820P05450000</td>
<td>2025-07-25 20:00:17+00:00</td>
<td>5450.0</td>
<td>3.00</td>
<td>2.40</td>
<td>2.60</td>
<td>0.000000</td>
<td>0.000000</td>
<td>4.0</td>
<td>0</td>
<td>0.290657</td>
<td>False</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">14</td>
<td>SPXW250820P05500000</td>
<td>2025-07-25 20:00:51+00:00</td>
<td>5500.0</td>
<td>3.32</td>
<td>2.65</td>
<td>2.85</td>
<td>0.000000</td>
<td>0.000000</td>
<td>100.0</td>
<td>0</td>
<td>0.279884</td>
<td>False</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">17</td>
<td>SPXW250820P05575000</td>
<td>2025-07-21 18:22:57+00:00</td>
<td>5575.0</td>
<td>6.30</td>
<td>3.00</td>
<td>3.30</td>
<td>0.000000</td>
<td>0.000000</td>
<td>25.0</td>
<td>0</td>
<td>0.263801</td>
<td>False</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">19</td>
<td>SPXW250820P05625000</td>
<td>2025-07-25 19:45:59+00:00</td>
<td>5625.0</td>
<td>4.30</td>
<td>3.30</td>
<td>3.60</td>
<td>0.000000</td>
<td>0.000000</td>
<td>61.0</td>
<td>0</td>
<td>0.252449</td>
<td>False</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">21</td>
<td>SPXW250820P05675000</td>
<td>2025-07-24 19:45:17+00:00</td>
<td>5675.0</td>
<td>5.10</td>
<td>3.70</td>
<td>4.00</td>
<td>0.000000</td>
<td>0.000000</td>
<td>1.0</td>
<td>0</td>
<td>0.241646</td>
<td>False</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">22</td>
<td>SPXW250820P05700000</td>
<td>2025-07-24 20:08:32+00:00</td>
<td>5700.0</td>
<td>5.80</td>
<td>3.90</td>
<td>4.20</td>
<td>0.000000</td>
<td>0.000000</td>
<td>23.0</td>
<td>0</td>
<td>0.236031</td>
<td>False</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">24</td>
<td>SPXW250820P05750000</td>
<td>2025-07-24 13:54:07+00:00</td>
<td>5750.0</td>
<td>6.00</td>
<td>4.30</td>
<td>4.70</td>
<td>0.000000</td>
<td>0.000000</td>
<td>72.0</td>
<td>0</td>
<td>0.225182</td>
<td>False</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">25</td>
<td>SPXW250820P05775000</td>
<td>2025-07-23 18:05:17+00:00</td>
<td>5775.0</td>
<td>7.47</td>
<td>4.60</td>
<td>5.00</td>
<td>0.000000</td>
<td>0.000000</td>
<td>67.0</td>
<td>0</td>
<td>0.219902</td>
<td>False</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">26</td>
<td>SPXW250820P05800000</td>
<td>2025-07-24 19:57:36+00:00</td>
<td>5800.0</td>
<td>7.25</td>
<td>4.90</td>
<td>5.30</td>
<td>0.000000</td>
<td>0.000000</td>
<td>807.0</td>
<td>0</td>
<td>0.214394</td>
<td>False</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">27</td>
<td>SPXW250820P05825000</td>
<td>2025-07-23 19:59:30+00:00</td>
<td>5825.0</td>
<td>8.40</td>
<td>5.20</td>
<td>5.60</td>
<td>0.000000</td>
<td>0.000000</td>
<td>20.0</td>
<td>0</td>
<td>0.208702</td>
<td>False</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">28</td>
<td>SPXW250820P05850000</td>
<td>2025-07-25 19:44:58+00:00</td>
<td>5850.0</td>
<td>7.30</td>
<td>5.60</td>
<td>6.00</td>
<td>0.000000</td>
<td>0.000000</td>
<td>12.0</td>
<td>0</td>
<td>0.203469</td>
<td>False</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">29</td>
<td>SPXW250820P05875000</td>
<td>2025-07-25 20:03:13+00:00</td>
<td>5875.0</td>
<td>7.70</td>
<td>6.10</td>
<td>6.40</td>
<td>0.000000</td>
<td>0.000000</td>
<td>41.0</td>
<td>0</td>
<td>0.197976</td>
<td>False</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">30</td>
<td>SPXW250820P05900000</td>
<td>2025-07-25 19:03:54+00:00</td>
<td>5900.0</td>
<td>8.20</td>
<td>6.60</td>
<td>6.90</td>
<td>0.000000</td>
<td>0.000000</td>
<td>4.0</td>
<td>0</td>
<td>0.192833</td>
<td>False</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">31</td>
<td>SPXW250820P05925000</td>
<td>2025-07-25 15:01:11+00:00</td>
<td>5925.0</td>
<td>9.40</td>
<td>7.10</td>
<td>7.50</td>
<td>0.000000</td>
<td>0.000000</td>
<td>6.0</td>
<td>0</td>
<td>0.187905</td>
<td>False</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">32</td>
<td>SPXW250820P05950000</td>
<td>2025-07-25 19:44:10+00:00</td>
<td>5950.0</td>
<td>9.90</td>
<td>7.80</td>
<td>8.10</td>
<td>0.000000</td>
<td>0.000000</td>
<td>12.0</td>
<td>0</td>
<td>0.182625</td>
<td>False</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">33</td>
<td>SPXW250820P05975000</td>
<td>2025-07-25 15:29:05+00:00</td>
<td>5975.0</td>
<td>11.16</td>
<td>8.50</td>
<td>8.90</td>
<td>0.000000</td>
<td>0.000000</td>
<td>1.0</td>
<td>0</td>
<td>0.177949</td>
<td>False</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">34</td>
<td>SPXW250820P06000000</td>
<td>2025-07-25 19:44:29+00:00</td>
<td>6000.0</td>
<td>12.10</td>
<td>9.40</td>
<td>9.70</td>
<td>0.000000</td>
<td>0.000000</td>
<td>6.0</td>
<td>0</td>
<td>0.172814</td>
<td>False</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">35</td>
<td>SPXW250820P06025000</td>
<td>2025-07-23 20:06:00+00:00</td>
<td>6025.0</td>
<td>17.34</td>
<td>10.40</td>
<td>10.70</td>
<td>0.000000</td>
<td>0.000000</td>
<td>2.0</td>
<td>0</td>
<td>0.168069</td>
<td>False</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">36</td>
<td>SPXW250820P06050000</td>
<td>2025-07-28 00:15:00+00:00</td>
<td>6050.0</td>
<td>12.18</td>
<td>11.40</td>
<td>11.80</td>
<td>-2.320000</td>
<td>-15.999998</td>
<td>5.0</td>
<td>0</td>
<td>0.163186</td>
<td>False</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">37</td>
<td>SPXW250820P06075000</td>
<td>2025-07-28 00:15:00+00:00</td>
<td>6075.0</td>
<td>13.58</td>
<td>12.60</td>
<td>13.10</td>
<td>-2.719999</td>
<td>-16.687113</td>
<td>5.0</td>
<td>0</td>
<td>0.158463</td>
<td>False</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">38</td>
<td>SPXW250820P06100000</td>
<td>2025-07-25 18:15:22+00:00</td>
<td>6100.0</td>
<td>18.15</td>
<td>14.10</td>
<td>14.70</td>
<td>0.000000</td>
<td>0.000000</td>
<td>11.0</td>
<td>0</td>
<td>0.154084</td>
<td>False</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">39</td>
<td>SPXW250820P06110000</td>
<td>2025-07-25 19:35:59+00:00</td>
<td>6110.0</td>
<td>18.72</td>
<td>14.70</td>
<td>15.20</td>
<td>0.000000</td>
<td>0.000000</td>
<td>4.0</td>
<td>0</td>
<td>0.151711</td>
<td>False</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">40</td>
<td>SPXW250820P06125000</td>
<td>2025-07-23 20:06:00+00:00</td>
<td>6125.0</td>
<td>26.39</td>
<td>15.70</td>
<td>16.20</td>
<td>0.000000</td>
<td>0.000000</td>
<td>95.0</td>
<td>0</td>
<td>0.148728</td>
<td>False</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">42</td>
<td>SPXW250820P06140000</td>
<td>2025-07-23 14:37:25+00:00</td>
<td>6140.0</td>
<td>36.73</td>
<td>16.80</td>
<td>17.30</td>
<td>0.000000</td>
<td>0.000000</td>
<td>5.0</td>
<td>0</td>
<td>0.145768</td>
<td>False</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">43</td>
<td>SPXW250820P06150000</td>
<td>2025-07-25 19:51:42+00:00</td>
<td>6150.0</td>
<td>22.40</td>
<td>17.60</td>
<td>18.10</td>
<td>0.000000</td>
<td>0.000000</td>
<td>33.0</td>
<td>0</td>
<td>0.143830</td>
<td>False</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">45</td>
<td>SPXW250820P06170000</td>
<td>2025-07-23 15:57:02+00:00</td>
<td>6170.0</td>
<td>35.67</td>
<td>19.20</td>
<td>19.80</td>
<td>0.000000</td>
<td>0.000000</td>
<td>2.0</td>
<td>0</td>
<td>0.139833</td>
<td>False</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">46</td>
<td>SPXW250820P06175000</td>
<td>2025-07-28 00:15:00+00:00</td>
<td>6175.0</td>
<td>20.83</td>
<td>19.70</td>
<td>20.20</td>
<td>-9.469999</td>
<td>-31.254124</td>
<td>2.0</td>
<td>0</td>
<td>0.138692</td>
<td>False</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">48</td>
<td>SPXW250820P06190000</td>
<td>2025-07-25 14:54:57+00:00</td>
<td>6190.0</td>
<td>28.37</td>
<td>21.10</td>
<td>21.60</td>
<td>0.000000</td>
<td>0.000000</td>
<td>5.0</td>
<td>0</td>
<td>0.135568</td>
<td>False</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">49</td>
<td>SPXW250820P06200000</td>
<td>2025-07-28 00:15:00+00:00</td>
<td>6200.0</td>
<td>23.43</td>
<td>22.10</td>
<td>22.60</td>
<td>-4.570000</td>
<td>-16.321428</td>
<td>2.0</td>
<td>0</td>
<td>0.133466</td>
<td>False</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">52</td>
<td>SPXW250820P06225000</td>
<td>2025-07-25 19:52:19+00:00</td>
<td>6225.0</td>
<td>31.30</td>
<td>24.80</td>
<td>25.50</td>
<td>0.000000</td>
<td>0.000000</td>
<td>3.0</td>
<td>0</td>
<td>0.128450</td>
<td>False</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">53</td>
<td>SPXW250820P06230000</td>
<td>2025-07-25 19:59:09+00:00</td>
<td>6230.0</td>
<td>32.20</td>
<td>25.40</td>
<td>26.10</td>
<td>0.000000</td>
<td>0.000000</td>
<td>3.0</td>
<td>0</td>
<td>0.127370</td>
<td>False</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">55</td>
<td>SPXW250820P06250000</td>
<td>2025-07-25 19:59:02+00:00</td>
<td>6250.0</td>
<td>35.20</td>
<td>27.90</td>
<td>28.50</td>
<td>0.000000</td>
<td>0.000000</td>
<td>12.0</td>
<td>0</td>
<td>0.122655</td>
<td>False</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">56</td>
<td>SPXW250820P06260000</td>
<td>2025-07-25 19:59:00+00:00</td>
<td>6260.0</td>
<td>36.80</td>
<td>29.40</td>
<td>29.90</td>
<td>0.000000</td>
<td>0.000000</td>
<td>3.0</td>
<td>0</td>
<td>0.120439</td>
<td>False</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">58</td>
<td>SPXW250820P06275000</td>
<td>2025-07-25 18:25:43+00:00</td>
<td>6275.0</td>
<td>39.51</td>
<td>31.60</td>
<td>32.10</td>
<td>0.000000</td>
<td>0.000000</td>
<td>14.0</td>
<td>0</td>
<td>0.116964</td>
<td>False</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">59</td>
<td>SPXW250820P06280000</td>
<td>2025-07-25 19:59:05+00:00</td>
<td>6280.0</td>
<td>40.70</td>
<td>32.30</td>
<td>32.90</td>
<td>0.000000</td>
<td>0.000000</td>
<td>8.0</td>
<td>0</td>
<td>0.115834</td>
<td>False</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">60</td>
<td>SPXW250820P06290000</td>
<td>2025-07-25 19:59:16+00:00</td>
<td>6290.0</td>
<td>42.80</td>
<td>34.00</td>
<td>34.60</td>
<td>0.000000</td>
<td>0.000000</td>
<td>3.0</td>
<td>0</td>
<td>0.113599</td>
<td>False</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">61</td>
<td>SPXW250820P06300000</td>
<td>2025-07-25 20:11:02+00:00</td>
<td>6300.0</td>
<td>44.80</td>
<td>35.70</td>
<td>36.40</td>
<td>0.000000</td>
<td>0.000000</td>
<td>15.0</td>
<td>0</td>
<td>0.111326</td>
<td>False</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">62</td>
<td>SPXW250820P06310000</td>
<td>2025-07-25 19:59:42+00:00</td>
<td>6310.0</td>
<td>47.20</td>
<td>37.60</td>
<td>38.30</td>
<td>0.000000</td>
<td>0.000000</td>
<td>4.0</td>
<td>0</td>
<td>0.108999</td>
<td>False</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">63</td>
<td>SPXW250820P06320000</td>
<td>2025-07-25 19:35:39+00:00</td>
<td>6320.0</td>
<td>48.85</td>
<td>39.60</td>
<td>40.20</td>
<td>0.000000</td>
<td>0.000000</td>
<td>3.0</td>
<td>0</td>
<td>0.106435</td>
<td>False</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">64</td>
<td>SPXW250820P06325000</td>
<td>2025-07-25 13:47:22+00:00</td>
<td>6325.0</td>
<td>57.90</td>
<td>40.60</td>
<td>41.30</td>
<td>0.000000</td>
<td>0.000000</td>
<td>4.0</td>
<td>0</td>
<td>0.105314</td>
<td>False</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">65</td>
<td>SPXW250820P06330000</td>
<td>2025-07-25 19:35:56+00:00</td>
<td>6330.0</td>
<td>51.45</td>
<td>41.70</td>
<td>42.30</td>
<td>0.000000</td>
<td>0.000000</td>
<td>7.0</td>
<td>0</td>
<td>0.103959</td>
<td>False</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">66</td>
<td>SPXW250820P06340000</td>
<td>2025-07-25 13:37:46+00:00</td>
<td>6340.0</td>
<td>61.92</td>
<td>43.90</td>
<td>44.60</td>
<td>0.000000</td>
<td>0.000000</td>
<td>4.0</td>
<td>0</td>
<td>0.101545</td>
<td>False</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">67</td>
<td>SPXW250820P06350000</td>
<td>2025-07-25 19:58:36+00:00</td>
<td>6350.0</td>
<td>57.50</td>
<td>46.30</td>
<td>47.00</td>
<td>0.000000</td>
<td>0.000000</td>
<td>11.0</td>
<td>0</td>
<td>0.099000</td>
<td>False</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">68</td>
<td>SPXW250820P06360000</td>
<td>2025-07-25 14:30:50+00:00</td>
<td>6360.0</td>
<td>66.90</td>
<td>48.70</td>
<td>49.50</td>
<td>0.000000</td>
<td>0.000000</td>
<td>1.0</td>
<td>0</td>
<td>0.096311</td>
<td>False</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">70</td>
<td>SPXW250820P06375000</td>
<td>2025-07-25 19:52:10+00:00</td>
<td>6375.0</td>
<td>66.77</td>
<td>52.90</td>
<td>53.70</td>
<td>0.000000</td>
<td>0.000000</td>
<td>1.0</td>
<td>0</td>
<td>0.092359</td>
<td>False</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">71</td>
<td>SPXW250820P06380000</td>
<td>2025-07-25 19:52:19+00:00</td>
<td>6380.0</td>
<td>67.10</td>
<td>54.40</td>
<td>55.20</td>
<td>0.000000</td>
<td>0.000000</td>
<td>2.0</td>
<td>0</td>
<td>0.091013</td>
<td>False</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">72</td>
<td>SPXW250820P06390000</td>
<td>2025-07-25 19:52:19+00:00</td>
<td>6390.0</td>
<td>70.80</td>
<td>57.40</td>
<td>58.20</td>
<td>0.000000</td>
<td>0.000000</td>
<td>3.0</td>
<td>0</td>
<td>0.088033</td>
<td>True</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">73</td>
<td>SPXW250820P06400000</td>
<td>2025-07-25 19:52:19+00:00</td>
<td>6400.0</td>
<td>74.70</td>
<td>60.70</td>
<td>61.50</td>
<td>0.000000</td>
<td>0.000000</td>
<td>2.0</td>
<td>0</td>
<td>0.085088</td>
<td>True</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">75</td>
<td>SPXW250820P06420000</td>
<td>2025-07-25 19:57:32+00:00</td>
<td>6420.0</td>
<td>83.10</td>
<td>68.00</td>
<td>68.90</td>
<td>0.000000</td>
<td>0.000000</td>
<td>1.0</td>
<td>0</td>
<td>0.078977</td>
<td>True</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">76</td>
<td>SPXW250820P06425000</td>
<td>2025-07-25 19:58:28+00:00</td>
<td>6425.0</td>
<td>84.90</td>
<td>69.90</td>
<td>70.80</td>
<td>0.000000</td>
<td>0.000000</td>
<td>1.0</td>
<td>0</td>
<td>0.077177</td>
<td>True</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">79</td>
<td>SPXW250820P06450000</td>
<td>2025-07-25 17:59:21+00:00</td>
<td>6450.0</td>
<td>98.02</td>
<td>80.70</td>
<td>81.60</td>
<td>0.000000</td>
<td>0.000000</td>
<td>63.0</td>
<td>0</td>
<td>0.067556</td>
<td>True</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">81</td>
<td>SPXW250820P06550000</td>
<td>2025-07-25 19:36:12+00:00</td>
<td>6550.0</td>
<td>162.00</td>
<td>139.50</td>
<td>142.20</td>
<td>0.000000</td>
<td>0.000000</td>
<td>1.0</td>
<td>0</td>
<td>0.000010</td>
<td>True</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<div id="cell-56" class="cell" data-execution_count="36">
<div class="sourceCode cell-code" id="cb49"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a><span class="co"># save data as csv</span></span>
<span id="cb49-2"><a href="#cb49-2" aria-hidden="true" tabindex="-1"></a><span class="co">#spx_calls.to_csv('spxcall_07252022.csv', index=False)</span></span>
<span id="cb49-3"><a href="#cb49-3" aria-hidden="true" tabindex="-1"></a><span class="co">#spx_puts.to_csv('spxput_07252022.csv', index=False)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="you-may-start-from-here" class="level3">
<h3 class="anchored" data-anchor-id="you-may-start-from-here">You may start from here</h3>
<div id="cell-58" class="cell" data-execution_count="37">
<div class="sourceCode cell-code" id="cb50"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a><span class="co"># read saved spx option data</span></span>
<span id="cb50-2"><a href="#cb50-2" aria-hidden="true" tabindex="-1"></a>spx_calls <span class="op">=</span> pd.read_csv(<span class="st">'spxcall_07252022.csv'</span>)</span>
<span id="cb50-3"><a href="#cb50-3" aria-hidden="true" tabindex="-1"></a>spx_puts <span class="op">=</span> pd.read_csv(<span class="st">'spxput_07252022.csv'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="create-python-class-optionanalytics" class="level3">
<h3 class="anchored" data-anchor-id="create-python-class-optionanalytics">Create <code>python</code> class <code>OptionAnalytics</code></h3>
<p>Wrap everything up in a python class.</p>
<div id="cell-60" class="cell" data-execution_count="38">
<div class="sourceCode cell-code" id="cb51"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> OptionAnalytics:</span>
<span id="cb51-2"><a href="#cb51-2" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> <span class="fu">__init__</span>(<span class="va">self</span>, option_chain, expiry, today):</span>
<span id="cb51-3"><a href="#cb51-3" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.expiry <span class="op">=</span> expiry</span>
<span id="cb51-4"><a href="#cb51-4" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.today <span class="op">=</span> today</span>
<span id="cb51-5"><a href="#cb51-5" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="kw">not</span> <span class="bu">type</span>(today) <span class="op">==</span> datetime.datetime:</span>
<span id="cb51-6"><a href="#cb51-6" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.today <span class="op">=</span> dt.strptime(today, <span class="st">'%Y-%m-</span><span class="sc">%d</span><span class="st">'</span>)</span>
<span id="cb51-7"><a href="#cb51-7" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.calls, <span class="va">self</span>.puts <span class="op">=</span> option_chain</span>
<span id="cb51-8"><a href="#cb51-8" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.ks_c <span class="op">=</span> <span class="va">self</span>.calls[<span class="st">'strike'</span>]</span>
<span id="cb51-9"><a href="#cb51-9" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.cs <span class="op">=</span> (<span class="va">self</span>.calls[<span class="st">'bid'</span>] <span class="op">+</span> <span class="va">self</span>.calls[<span class="st">'ask'</span>])<span class="op">/</span><span class="dv">2</span> </span>
<span id="cb51-10"><a href="#cb51-10" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.ks_p <span class="op">=</span> <span class="va">self</span>.puts[<span class="st">'strike'</span>] </span>
<span id="cb51-11"><a href="#cb51-11" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.ps <span class="op">=</span> (<span class="va">self</span>.puts[<span class="st">'bid'</span>] <span class="op">+</span> <span class="va">self</span>.puts[<span class="st">'ask'</span>])<span class="op">/</span><span class="dv">2</span>         </span>
<span id="cb51-12"><a href="#cb51-12" aria-hidden="true" tabindex="-1"></a>        <span class="co"># strikes that are traded for both calls and puts</span></span>
<span id="cb51-13"><a href="#cb51-13" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.ks <span class="op">=</span> np.array([])</span>
<span id="cb51-14"><a href="#cb51-14" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> k <span class="kw">in</span> <span class="va">self</span>.ks_c:</span>
<span id="cb51-15"><a href="#cb51-15" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> k <span class="kw">in</span> np.array(<span class="va">self</span>.ks_p):</span>
<span id="cb51-16"><a href="#cb51-16" aria-hidden="true" tabindex="-1"></a>                <span class="va">self</span>.ks <span class="op">=</span> np.concatenate([<span class="va">self</span>.ks, [k]])</span>
<span id="cb51-17"><a href="#cb51-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-18"><a href="#cb51-18" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.mids_call <span class="op">=</span> np.array([])</span>
<span id="cb51-19"><a href="#cb51-19" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> k <span class="kw">in</span> <span class="va">self</span>.ks:</span>
<span id="cb51-20"><a href="#cb51-20" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.calls[<span class="va">self</span>.calls[<span class="st">'strike'</span>] <span class="op">==</span> k][<span class="st">'bid'</span>]</span>
<span id="cb51-21"><a href="#cb51-21" aria-hidden="true" tabindex="-1"></a>            bid <span class="op">=</span> <span class="va">self</span>.calls[<span class="va">self</span>.calls[<span class="st">'strike'</span>] <span class="op">==</span> k][<span class="st">'bid'</span>]</span>
<span id="cb51-22"><a href="#cb51-22" aria-hidden="true" tabindex="-1"></a>            ask <span class="op">=</span> <span class="va">self</span>.calls[<span class="va">self</span>.calls[<span class="st">'strike'</span>] <span class="op">==</span> k][<span class="st">'ask'</span>]</span>
<span id="cb51-23"><a href="#cb51-23" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.mids_call <span class="op">=</span> np.concatenate([<span class="va">self</span>.mids_call, np.array((bid <span class="op">+</span> ask)<span class="op">/</span><span class="dv">2</span>)])</span>
<span id="cb51-24"><a href="#cb51-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-25"><a href="#cb51-25" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.mids_put <span class="op">=</span> np.array([])</span>
<span id="cb51-26"><a href="#cb51-26" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> k <span class="kw">in</span> <span class="va">self</span>.ks:</span>
<span id="cb51-27"><a href="#cb51-27" aria-hidden="true" tabindex="-1"></a>            bid <span class="op">=</span> <span class="va">self</span>.puts[<span class="va">self</span>.puts[<span class="st">'strike'</span>] <span class="op">==</span> k][<span class="st">'bid'</span>]</span>
<span id="cb51-28"><a href="#cb51-28" aria-hidden="true" tabindex="-1"></a>            ask <span class="op">=</span> <span class="va">self</span>.puts[<span class="va">self</span>.puts[<span class="st">'strike'</span>] <span class="op">==</span> k][<span class="st">'ask'</span>]</span>
<span id="cb51-29"><a href="#cb51-29" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.mids_put <span class="op">=</span> np.concatenate([<span class="va">self</span>.mids_put, np.array((bid <span class="op">+</span> ask)<span class="op">/</span><span class="dv">2</span>)])</span>
<span id="cb51-30"><a href="#cb51-30" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb51-31"><a href="#cb51-31" aria-hidden="true" tabindex="-1"></a>        tmp <span class="op">=</span> <span class="va">self</span>.imp_vols()</span>
<span id="cb51-32"><a href="#cb51-32" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.ivs, <span class="va">self</span>.s_adj <span class="op">=</span> tmp[<span class="st">'imp_vols'</span>], tmp[<span class="st">'s_adj'</span>]</span>
<span id="cb51-33"><a href="#cb51-33" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb51-34"><a href="#cb51-34" aria-hidden="true" tabindex="-1"></a>    <span class="co"># put-call parity plot </span></span>
<span id="cb51-35"><a href="#cb51-35" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> plot_parity(<span class="va">self</span>):</span>
<span id="cb51-36"><a href="#cb51-36" aria-hidden="true" tabindex="-1"></a>        plt.figure(figsize<span class="op">=</span>(<span class="dv">9</span>, <span class="dv">5</span>))</span>
<span id="cb51-37"><a href="#cb51-37" aria-hidden="true" tabindex="-1"></a>        plt.plot(<span class="va">self</span>.ks, <span class="va">self</span>.mids_call <span class="op">-</span> <span class="va">self</span>.mids_put, <span class="st">'r.--'</span>)</span>
<span id="cb51-38"><a href="#cb51-38" aria-hidden="true" tabindex="-1"></a>        plt.ylabel(<span class="vs">r'</span><span class="dv">$</span><span class="vs">C - P</span><span class="dv">$</span><span class="vs">'</span>, fontsize<span class="op">=</span><span class="dv">12</span>)</span>
<span id="cb51-39"><a href="#cb51-39" aria-hidden="true" tabindex="-1"></a>        plt.xlabel(<span class="vs">r'</span><span class="dv">$</span><span class="vs">K</span><span class="dv">$</span><span class="vs">'</span>, fontsize<span class="op">=</span><span class="dv">12</span>)</span>
<span id="cb51-40"><a href="#cb51-40" aria-hidden="true" tabindex="-1"></a>        plt.title(<span class="ss">f'Expiry: </span><span class="sc">{</span><span class="va">self</span><span class="sc">.</span>expiry<span class="sc">}</span><span class="ss">'</span>, fontsize<span class="op">=</span><span class="dv">15</span>)<span class="op">;</span></span>
<span id="cb51-41"><a href="#cb51-41" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="va">None</span></span>
<span id="cb51-42"><a href="#cb51-42" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb51-43"><a href="#cb51-43" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> plot_arb(<span class="va">self</span>):</span>
<span id="cb51-44"><a href="#cb51-44" aria-hidden="true" tabindex="-1"></a>        <span class="co"># monotonicity and convexity for option premia vs strikes</span></span>
<span id="cb51-45"><a href="#cb51-45" aria-hidden="true" tabindex="-1"></a>        fig, axes <span class="op">=</span> plt.subplots(<span class="dv">1</span>, <span class="dv">2</span>, figsize<span class="op">=</span>(<span class="dv">12</span>, <span class="dv">5</span>), sharey<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb51-46"><a href="#cb51-46" aria-hidden="true" tabindex="-1"></a>        axes[<span class="dv">0</span>].plot(<span class="va">self</span>.ks_c, <span class="va">self</span>.cs, <span class="st">'bo--'</span>)</span>
<span id="cb51-47"><a href="#cb51-47" aria-hidden="true" tabindex="-1"></a>        axes[<span class="dv">0</span>].set_ylabel(<span class="st">'Option mid price'</span>, fontsize<span class="op">=</span><span class="dv">12</span>)</span>
<span id="cb51-48"><a href="#cb51-48" aria-hidden="true" tabindex="-1"></a>        axes[<span class="dv">0</span>].set_xlabel(<span class="st">'Strike'</span>, fontsize<span class="op">=</span><span class="dv">12</span>)</span>
<span id="cb51-49"><a href="#cb51-49" aria-hidden="true" tabindex="-1"></a>        axes[<span class="dv">1</span>].plot(<span class="va">self</span>.ks_p, <span class="va">self</span>.ps, <span class="st">'ro--'</span>)</span>
<span id="cb51-50"><a href="#cb51-50" aria-hidden="true" tabindex="-1"></a>        axes[<span class="dv">1</span>].set_xlabel(<span class="st">'Strike'</span>, fontsize<span class="op">=</span><span class="dv">12</span>)<span class="op">;</span></span>
<span id="cb51-51"><a href="#cb51-51" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="va">None</span></span>
<span id="cb51-52"><a href="#cb51-52" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb51-53"><a href="#cb51-53" aria-hidden="true" tabindex="-1"></a>    <span class="co"># plot implied vol</span></span>
<span id="cb51-54"><a href="#cb51-54" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> plot_imp_vols1(<span class="va">self</span>):</span>
<span id="cb51-55"><a href="#cb51-55" aria-hidden="true" tabindex="-1"></a>        ivs_c <span class="op">=</span> <span class="va">self</span>.calls[<span class="st">'impliedVolatility'</span>]</span>
<span id="cb51-56"><a href="#cb51-56" aria-hidden="true" tabindex="-1"></a>        ivs_p <span class="op">=</span> <span class="va">self</span>.puts[<span class="st">'impliedVolatility'</span>]</span>
<span id="cb51-57"><a href="#cb51-57" aria-hidden="true" tabindex="-1"></a>        <span class="co"># plot </span></span>
<span id="cb51-58"><a href="#cb51-58" aria-hidden="true" tabindex="-1"></a>        plt.figure(figsize<span class="op">=</span>(<span class="dv">10</span>, <span class="dv">6</span>))</span>
<span id="cb51-59"><a href="#cb51-59" aria-hidden="true" tabindex="-1"></a>        plt.plot(<span class="va">self</span>.ks_p, ivs_p, <span class="st">'ro--'</span>, label<span class="op">=</span><span class="st">'implied vol from puts'</span>)</span>
<span id="cb51-60"><a href="#cb51-60" aria-hidden="true" tabindex="-1"></a>        plt.plot(<span class="va">self</span>.ks_c, ivs_c, <span class="st">'bo--'</span>, label<span class="op">=</span><span class="st">'implied vol from calls'</span>)</span>
<span id="cb51-61"><a href="#cb51-61" aria-hidden="true" tabindex="-1"></a>        plt.title(<span class="ss">f'Expiration date: </span><span class="sc">{</span><span class="va">self</span><span class="sc">.</span>expiry<span class="sc">}</span><span class="ss">'</span>, fontsize<span class="op">=</span><span class="dv">15</span>)</span>
<span id="cb51-62"><a href="#cb51-62" aria-hidden="true" tabindex="-1"></a>        plt.xlabel(<span class="st">'Strikes'</span>, fontsize<span class="op">=</span><span class="dv">12</span>)</span>
<span id="cb51-63"><a href="#cb51-63" aria-hidden="true" tabindex="-1"></a>        plt.ylabel(<span class="st">'Impliied Volatilities'</span>, fontsize<span class="op">=</span><span class="dv">12</span>)</span>
<span id="cb51-64"><a href="#cb51-64" aria-hidden="true" tabindex="-1"></a>        plt.legend()<span class="op">;</span></span>
<span id="cb51-65"><a href="#cb51-65" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="va">None</span></span>
<span id="cb51-66"><a href="#cb51-66" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb51-67"><a href="#cb51-67" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Black-Scholes formula for call</span></span>
<span id="cb51-68"><a href="#cb51-68" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> bs_call(<span class="va">self</span>, s, K, t, sigma, r<span class="op">=</span><span class="dv">0</span>):</span>
<span id="cb51-69"><a href="#cb51-69" aria-hidden="true" tabindex="-1"></a>        d1 <span class="op">=</span> (log(s<span class="op">/</span>K) <span class="op">+</span> r<span class="op">*</span>t)<span class="op">/</span>(sigma<span class="op">*</span>sqrt(t)) <span class="op">+</span> sigma<span class="op">*</span>sqrt(t)<span class="op">/</span><span class="dv">2</span></span>
<span id="cb51-70"><a href="#cb51-70" aria-hidden="true" tabindex="-1"></a>        d2 <span class="op">=</span> d1 <span class="op">-</span> sigma<span class="op">*</span>sqrt(t)</span>
<span id="cb51-71"><a href="#cb51-71" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> s<span class="op">*</span>norm.cdf(d1) <span class="op">-</span> K<span class="op">*</span>exp(<span class="op">-</span>r<span class="op">*</span>t)<span class="op">*</span>norm.cdf(d2)</span>
<span id="cb51-72"><a href="#cb51-72" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb51-73"><a href="#cb51-73" aria-hidden="true" tabindex="-1"></a>    <span class="co"># function calculating implied vol by the bisection method</span></span>
<span id="cb51-74"><a href="#cb51-74" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> bs_impvol_call(<span class="va">self</span>, s0, K, T, C, r<span class="op">=</span><span class="dv">0</span>):</span>
<span id="cb51-75"><a href="#cb51-75" aria-hidden="true" tabindex="-1"></a>        K <span class="op">=</span> np.array([K])</span>
<span id="cb51-76"><a href="#cb51-76" aria-hidden="true" tabindex="-1"></a>        n <span class="op">=</span> <span class="bu">len</span>(K)</span>
<span id="cb51-77"><a href="#cb51-77" aria-hidden="true" tabindex="-1"></a>        sigmaL, sigmaH <span class="op">=</span> <span class="fl">1e-10</span><span class="op">*</span>np.ones(n), <span class="dv">10</span><span class="op">*</span>np.ones(n)</span>
<span id="cb51-78"><a href="#cb51-78" aria-hidden="true" tabindex="-1"></a>        CL, CH <span class="op">=</span> <span class="va">self</span>.bs_call(s0, K, T, sigmaL, r), <span class="va">self</span>.bs_call(s0, K, T, sigmaH, r)</span>
<span id="cb51-79"><a href="#cb51-79" aria-hidden="true" tabindex="-1"></a>        <span class="cf">while</span> np.mean(sigmaH <span class="op">-</span> sigmaL) <span class="op">&gt;</span> <span class="fl">1e-10</span>:</span>
<span id="cb51-80"><a href="#cb51-80" aria-hidden="true" tabindex="-1"></a>            sigma <span class="op">=</span> (sigmaL <span class="op">+</span> sigmaH)<span class="op">/</span><span class="dv">2</span></span>
<span id="cb51-81"><a href="#cb51-81" aria-hidden="true" tabindex="-1"></a>            CM <span class="op">=</span> <span class="va">self</span>.bs_call(s0, K, T, sigma, r)</span>
<span id="cb51-82"><a href="#cb51-82" aria-hidden="true" tabindex="-1"></a>            CL <span class="op">=</span> CL <span class="op">+</span> (CM <span class="op">&lt;</span> C)<span class="op">*</span>(CM <span class="op">-</span> CL)</span>
<span id="cb51-83"><a href="#cb51-83" aria-hidden="true" tabindex="-1"></a>            sigmaL <span class="op">=</span> sigmaL <span class="op">+</span> (CM <span class="op">&lt;</span> C)<span class="op">*</span>(sigma <span class="op">-</span> sigmaL)</span>
<span id="cb51-84"><a href="#cb51-84" aria-hidden="true" tabindex="-1"></a>            CH <span class="op">=</span> CH <span class="op">+</span> (CM <span class="op">&gt;=</span> C)<span class="op">*</span>(CM <span class="op">-</span> CH)</span>
<span id="cb51-85"><a href="#cb51-85" aria-hidden="true" tabindex="-1"></a>            sigmaH <span class="op">=</span> sigmaH <span class="op">+</span> (CM <span class="op">&gt;=</span> C)<span class="op">*</span>(sigma <span class="op">-</span> sigmaH)    </span>
<span id="cb51-86"><a href="#cb51-86" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> sigma[<span class="dv">0</span>]</span>
<span id="cb51-87"><a href="#cb51-87" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb51-88"><a href="#cb51-88" aria-hidden="true" tabindex="-1"></a>    <span class="co"># calculate implied vols</span></span>
<span id="cb51-89"><a href="#cb51-89" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> imp_vols(<span class="va">self</span>):</span>
<span id="cb51-90"><a href="#cb51-90" aria-hidden="true" tabindex="-1"></a>        <span class="co"># regress call - put over strike K </span></span>
<span id="cb51-91"><a href="#cb51-91" aria-hidden="true" tabindex="-1"></a>        <span class="co"># apply put-call parity </span></span>
<span id="cb51-92"><a href="#cb51-92" aria-hidden="true" tabindex="-1"></a>        df <span class="op">=</span> {<span class="st">'CP'</span>: <span class="va">self</span>.mids_call <span class="op">-</span> <span class="va">self</span>.mids_put, <span class="st">'Strike'</span>: <span class="va">self</span>.ks}</span>
<span id="cb51-93"><a href="#cb51-93" aria-hidden="true" tabindex="-1"></a>        result <span class="op">=</span> sm.ols(formula<span class="op">=</span><span class="st">'CP ~ Strike'</span>, data<span class="op">=</span>df).fit()</span>
<span id="cb51-94"><a href="#cb51-94" aria-hidden="true" tabindex="-1"></a>        s_adj, pv <span class="op">=</span> result.params[<span class="dv">0</span>], <span class="op">-</span>result.params[<span class="dv">1</span>]</span>
<span id="cb51-95"><a href="#cb51-95" aria-hidden="true" tabindex="-1"></a>        ks_pv <span class="op">=</span> <span class="va">self</span>.ks<span class="op">*</span>pv</span>
<span id="cb51-96"><a href="#cb51-96" aria-hidden="true" tabindex="-1"></a>        days_to_expiry <span class="op">=</span> (dt.strptime(<span class="va">self</span>.expiry, <span class="st">'%Y-%m-</span><span class="sc">%d</span><span class="st">'</span>) <span class="op">-</span> <span class="va">self</span>.today).days</span>
<span id="cb51-97"><a href="#cb51-97" aria-hidden="true" tabindex="-1"></a>        imp_vols <span class="op">=</span> <span class="va">self</span>.bs_impvol_call(s_adj, ks_pv, days_to_expiry<span class="op">/</span><span class="dv">365</span>, <span class="va">self</span>.mids_call, r<span class="op">=</span><span class="dv">0</span>)        </span>
<span id="cb51-98"><a href="#cb51-98" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> {<span class="st">'imp_vols'</span>: imp_vols, <span class="st">'pv'</span>: pv, <span class="st">'s_adj'</span>: s_adj}</span>
<span id="cb51-99"><a href="#cb51-99" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb51-100"><a href="#cb51-100" aria-hidden="true" tabindex="-1"></a>    <span class="co"># plot implied vol</span></span>
<span id="cb51-101"><a href="#cb51-101" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> plot_imp_vols2(<span class="va">self</span>):</span>
<span id="cb51-102"><a href="#cb51-102" aria-hidden="true" tabindex="-1"></a>        plt.figure(figsize<span class="op">=</span>(<span class="dv">10</span>, <span class="dv">6</span>))</span>
<span id="cb51-103"><a href="#cb51-103" aria-hidden="true" tabindex="-1"></a>        y <span class="op">=</span> <span class="va">self</span>.ivs[<span class="va">self</span>.ivs<span class="op">&gt;</span><span class="fl">0.001</span>]</span>
<span id="cb51-104"><a href="#cb51-104" aria-hidden="true" tabindex="-1"></a>        x <span class="op">=</span> <span class="va">self</span>.ks[<span class="va">self</span>.ivs<span class="op">&gt;</span><span class="fl">0.001</span>]</span>
<span id="cb51-105"><a href="#cb51-105" aria-hidden="true" tabindex="-1"></a>        plt.plot(log(x<span class="op">/</span><span class="va">self</span>.s_adj), y, <span class="st">'b.--'</span>)</span>
<span id="cb51-106"><a href="#cb51-106" aria-hidden="true" tabindex="-1"></a>        plt.plot(log(x<span class="op">/</span><span class="va">self</span>.s_adj), y, <span class="st">'r.'</span>)</span>
<span id="cb51-107"><a href="#cb51-107" aria-hidden="true" tabindex="-1"></a>        plt.xlabel(<span class="st">'logmoneyness'</span>, fontsize<span class="op">=</span><span class="dv">12</span>)</span>
<span id="cb51-108"><a href="#cb51-108" aria-hidden="true" tabindex="-1"></a>        plt.ylabel(<span class="st">'implied volatilities'</span>, fontsize<span class="op">=</span><span class="dv">12</span>)</span>
<span id="cb51-109"><a href="#cb51-109" aria-hidden="true" tabindex="-1"></a>        plt.title(<span class="st">'Implied volatilities vs Logmoneyness'</span>, fontsize<span class="op">=</span><span class="dv">15</span>)<span class="op">;</span></span>
<span id="cb51-110"><a href="#cb51-110" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="va">None</span></span>
<span id="cb51-111"><a href="#cb51-111" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb51-112"><a href="#cb51-112" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> <span class="fu">__call__</span>(<span class="va">self</span>):</span>
<span id="cb51-113"><a href="#cb51-113" aria-hidden="true" tabindex="-1"></a>        <span class="cf">pass</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-61" class="cell" data-execution_count="39">
<div class="sourceCode cell-code" id="cb52"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a>expiry <span class="op">=</span> <span class="st">'2022-08-26'</span></span>
<span id="cb52-2"><a href="#cb52-2" aria-hidden="true" tabindex="-1"></a>today <span class="op">=</span> <span class="st">'2022-07-25'</span></span>
<span id="cb52-3"><a href="#cb52-3" aria-hidden="true" tabindex="-1"></a><span class="co"># today = dt.now()</span></span>
<span id="cb52-4"><a href="#cb52-4" aria-hidden="true" tabindex="-1"></a>spx_opt <span class="op">=</span> OptionAnalytics([spx_calls, spx_puts], expiry, today)</span>
<span id="cb52-5"><a href="#cb52-5" aria-hidden="true" tabindex="-1"></a><span class="co">#spx_opt = OptionAnalytics([spx_calls, spx_puts], spx_expiries[idx])</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>C:\Windows\Temp\ipykernel_3812\903028481.py:94: FutureWarning: Series.__getitem__ treating keys as positions is deprecated. In a future version, integer keys will always be treated as labels (consistent with DataFrame behavior). To access a value by position, use `ser.iloc[pos]`
  s_adj, pv = result.params[0], -result.params[1]</code></pre>
</div>
</div>
<div id="cell-62" class="cell" data-execution_count="40">
<div class="sourceCode cell-code" id="cb54"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a>spx_opt.plot_arb()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="NSD_Lec05-Volatility_Summer2025_files/figure-html/cell-41-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<div id="cell-63" class="cell" data-execution_count="41">
<div class="sourceCode cell-code" id="cb55"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a>spx_opt.plot_parity()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="NSD_Lec05-Volatility_Summer2025_files/figure-html/cell-42-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<div id="cell-64" class="cell" data-execution_count="42">
<div class="sourceCode cell-code" id="cb56"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a>spx_opt.s_adj</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="42">
<pre><code>3956.9116921934447</code></pre>
</div>
</div>
<div id="cell-65" class="cell" data-execution_count="43">
<div class="sourceCode cell-code" id="cb58"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb58-1"><a href="#cb58-1" aria-hidden="true" tabindex="-1"></a>spx_opt.imp_vols()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>C:\Windows\Temp\ipykernel_3812\903028481.py:94: FutureWarning: Series.__getitem__ treating keys as positions is deprecated. In a future version, integer keys will always be treated as labels (consistent with DataFrame behavior). To access a value by position, use `ser.iloc[pos]`
  s_adj, pv = result.params[0], -result.params[1]</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="43">
<pre><code>{'imp_vols': array([0.30600045, 0.30595555, 0.2977905 , 0.29545201, 0.28072122,
        0.28232929, 0.2760224 , 0.27571335, 0.26859412, 0.26908309,
        0.27284159, 0.2708769 , 0.26853801, 0.26566743, 0.26527454,
        0.26282943, 0.26242285, 0.2594965 , 0.25959885, 0.25941643,
        0.25750019, 0.25653246, 0.25254566, 0.25387708, 0.25385611,
        0.2507587 , 0.25183417, 0.24960497, 0.24816526, 0.24549749,
        0.2473746 , 0.24511455, 0.24306506, 0.24344569, 0.24239335,
        0.2381772 , 0.23923107, 0.23911993, 0.23822523, 0.23924822,
        0.23345209, 0.23237829, 0.2344444 , 0.23344536, 0.22909791,
        0.22899399, 0.23093383, 0.23010241, 0.22853441, 0.22734051,
        0.22629503, 0.22473931, 0.22267772, 0.22467133, 0.22094489,
        0.22158022, 0.22029972, 0.21894173, 0.22040126, 0.21866736,
        0.21803138, 0.21752707, 0.21522827, 0.21498524, 0.21433691,
        0.21338911, 0.21299896, 0.20983357, 0.21131474, 0.20839273,
        0.20862321, 0.20877018, 0.20719259, 0.20584517, 0.20362794,
        0.20224901, 0.20071144, 0.20063567, 0.19902292, 0.19711411,
        0.19699863, 0.19436676, 0.1925327 , 0.18606077, 0.18129871,
        0.1965902 , 0.22174679]),
 'pv': 0.9978522732469026,
 's_adj': 3956.9116921934447}</code></pre>
</div>
</div>
<div id="cell-66" class="cell" data-execution_count="44">
<div class="sourceCode cell-code" id="cb61"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb61-1"><a href="#cb61-1" aria-hidden="true" tabindex="-1"></a>spx_opt.plot_imp_vols2(), spx_opt.plot_imp_vols1()<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="NSD_Lec05-Volatility_Summer2025_files/figure-html/cell-45-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="NSD_Lec05-Volatility_Summer2025_files/figure-html/cell-45-output-2.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
</section>
</section>
<section id="a-shorter-time-to-expiry-option-on-spx" class="level2">
<h2 class="anchored" data-anchor-id="a-shorter-time-to-expiry-option-on-spx">A shorter time to expiry option on SPX</h2>
<section id="tips-you-may-skip-this-part-if-you-encounter-an-error." class="level3">
<h3 class="anchored" data-anchor-id="tips-you-may-skip-this-part-if-you-encounter-an-error.">Tips: You may skip this part if you encounter an error.</h3>
<div id="cell-69" class="cell" data-execution_count="45">
<div class="sourceCode cell-code" id="cb62"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb62-1"><a href="#cb62-1" aria-hidden="true" tabindex="-1"></a><span class="co"># choose an expiry </span></span>
<span id="cb62-2"><a href="#cb62-2" aria-hidden="true" tabindex="-1"></a>idx <span class="op">=</span> <span class="dv">5</span></span>
<span id="cb62-3"><a href="#cb62-3" aria-hidden="true" tabindex="-1"></a>today <span class="op">=</span> dt.strftime(dt.now(), <span class="st">'%Y-%m-</span><span class="sc">%d</span><span class="st">'</span>)</span>
<span id="cb62-4"><a href="#cb62-4" aria-hidden="true" tabindex="-1"></a>day_count <span class="op">=</span> (dt.strptime(spx_expiries[idx], <span class="st">'%Y-%m-</span><span class="sc">%d</span><span class="st">'</span>) <span class="op">-</span> dt.now()).days</span>
<span id="cb62-5"><a href="#cb62-5" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f'option expiry = </span><span class="sc">{</span>spx_expiries[idx]<span class="sc">}</span><span class="ss">, today = </span><span class="sc">{</span>today<span class="sc">}</span><span class="ss">'</span>)</span>
<span id="cb62-6"><a href="#cb62-6" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f'There are </span><span class="sc">{</span>day_count<span class="sc">}</span><span class="ss"> days to expiry'</span>)</span>
<span id="cb62-7"><a href="#cb62-7" aria-hidden="true" tabindex="-1"></a>option_chain <span class="op">=</span> spx.option_chain(spx_expiries[idx])</span>
<span id="cb62-8"><a href="#cb62-8" aria-hidden="true" tabindex="-1"></a>spx_calls1 <span class="op">=</span> option_chain.calls</span>
<span id="cb62-9"><a href="#cb62-9" aria-hidden="true" tabindex="-1"></a>spx_puts1 <span class="op">=</span> option_chain.puts</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>option expiry = 2025-08-04, today = 2025-07-28
There are 6 days to expiry</code></pre>
</div>
</div>
<div id="cell-70" class="cell" data-execution_count="46">
<div class="sourceCode cell-code" id="cb64"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb64-1"><a href="#cb64-1" aria-hidden="true" tabindex="-1"></a><span class="co"># clean data</span></span>
<span id="cb64-2"><a href="#cb64-2" aria-hidden="true" tabindex="-1"></a>spx_calls1 <span class="op">=</span> spx_calls1.dropna()</span>
<span id="cb64-3"><a href="#cb64-3" aria-hidden="true" tabindex="-1"></a>spx_calls1 <span class="op">=</span> spx_calls1[(spx_calls1[<span class="st">'bid'</span>] <span class="op">&gt;</span> <span class="dv">0</span>) <span class="op">&amp;</span> (spx_calls1[<span class="st">'ask'</span>] <span class="op">&gt;</span> <span class="dv">0</span>)]</span>
<span id="cb64-4"><a href="#cb64-4" aria-hidden="true" tabindex="-1"></a>spx_puts1 <span class="op">=</span> spx_puts1.dropna()</span>
<span id="cb64-5"><a href="#cb64-5" aria-hidden="true" tabindex="-1"></a>spx_puts1 <span class="op">=</span> spx_puts1[(spx_puts1[<span class="st">'bid'</span>] <span class="op">&gt;</span> <span class="dv">0</span>) <span class="op">&amp;</span> (spx_puts1[<span class="st">'ask'</span>] <span class="op">&gt;</span> <span class="dv">0</span>)]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-71" class="cell" data-execution_count="47">
<div class="sourceCode cell-code" id="cb65"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb65-1"><a href="#cb65-1" aria-hidden="true" tabindex="-1"></a>today <span class="op">=</span> dt.now()</span>
<span id="cb65-2"><a href="#cb65-2" aria-hidden="true" tabindex="-1"></a>spx_opt1 <span class="op">=</span> OptionAnalytics([spx_calls1, spx_puts1], spx_expiries[idx], today)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>C:\Windows\Temp\ipykernel_3812\903028481.py:94: FutureWarning: Series.__getitem__ treating keys as positions is deprecated. In a future version, integer keys will always be treated as labels (consistent with DataFrame behavior). To access a value by position, use `ser.iloc[pos]`
  s_adj, pv = result.params[0], -result.params[1]</code></pre>
</div>
</div>
<div id="cell-72" class="cell" data-execution_count="48">
<div class="sourceCode cell-code" id="cb67"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb67-1"><a href="#cb67-1" aria-hidden="true" tabindex="-1"></a>spx_opt1.plot_arb()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="NSD_Lec05-Volatility_Summer2025_files/figure-html/cell-49-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<div id="cell-73" class="cell" data-execution_count="49">
<div class="sourceCode cell-code" id="cb68"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb68-1"><a href="#cb68-1" aria-hidden="true" tabindex="-1"></a>spx_opt1.plot_parity()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="NSD_Lec05-Volatility_Summer2025_files/figure-html/cell-50-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<div id="cell-74" class="cell" data-execution_count="50">
<div class="sourceCode cell-code" id="cb69"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb69-1"><a href="#cb69-1" aria-hidden="true" tabindex="-1"></a>spx_opt.imp_vols()[<span class="st">'pv'</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>C:\Windows\Temp\ipykernel_3812\903028481.py:94: FutureWarning: Series.__getitem__ treating keys as positions is deprecated. In a future version, integer keys will always be treated as labels (consistent with DataFrame behavior). To access a value by position, use `ser.iloc[pos]`
  s_adj, pv = result.params[0], -result.params[1]</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="50">
<pre><code>0.9978522732469026</code></pre>
</div>
</div>
<div id="cell-75" class="cell" data-execution_count="51">
<div class="sourceCode cell-code" id="cb72"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb72-1"><a href="#cb72-1" aria-hidden="true" tabindex="-1"></a>spx_opt1.s_adj, spx_opt1.imp_vols()[<span class="st">'pv'</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>C:\Windows\Temp\ipykernel_3812\903028481.py:94: FutureWarning: Series.__getitem__ treating keys as positions is deprecated. In a future version, integer keys will always be treated as labels (consistent with DataFrame behavior). To access a value by position, use `ser.iloc[pos]`
  s_adj, pv = result.params[0], -result.params[1]</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="51">
<pre><code>(6384.272448907927, 0.9936040369548137)</code></pre>
</div>
</div>
<div id="cell-76" class="cell" data-execution_count="52">
<div class="sourceCode cell-code" id="cb75"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb75-1"><a href="#cb75-1" aria-hidden="true" tabindex="-1"></a>spx_opt1.plot_imp_vols2(), spx_opt1.plot_imp_vols1()<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="NSD_Lec05-Volatility_Summer2025_files/figure-html/cell-53-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="NSD_Lec05-Volatility_Summer2025_files/figure-html/cell-53-output-2.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="you-may-start-from-here.-1" class="level3">
<h3 class="anchored" data-anchor-id="you-may-start-from-here.-1">You may start from here.</h3>
</section>
</section>
<section id="gpr-fit-for-spx-implied-volatility-curve" class="level2">
<h2 class="anchored" data-anchor-id="gpr-fit-for-spx-implied-volatility-curve">GPR fit for SPX implied volatility curve</h2>
<div id="cell-79" class="cell" data-execution_count="53">
<div class="sourceCode cell-code" id="cb76"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb76-1"><a href="#cb76-1" aria-hidden="true" tabindex="-1"></a><span class="co"># The posterior mean function from GPR</span></span>
<span id="cb76-2"><a href="#cb76-2" aria-hidden="true" tabindex="-1"></a><span class="co"># inputs: </span></span>
<span id="cb76-3"><a href="#cb76-3" aria-hidden="true" tabindex="-1"></a><span class="co"># m: prior mean function </span></span>
<span id="cb76-4"><a href="#cb76-4" aria-hidden="true" tabindex="-1"></a><span class="co"># k: prior kernel</span></span>
<span id="cb76-5"><a href="#cb76-5" aria-hidden="true" tabindex="-1"></a><span class="co"># y: observations</span></span>
<span id="cb76-6"><a href="#cb76-6" aria-hidden="true" tabindex="-1"></a><span class="co"># x: indices</span></span>
<span id="cb76-7"><a href="#cb76-7" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb76-8"><a href="#cb76-8" aria-hidden="true" tabindex="-1"></a><span class="co"># output: the posterior mean function</span></span>
<span id="cb76-9"><a href="#cb76-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-10"><a href="#cb76-10" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> pos_mean(m, k, y, x, sigma<span class="op">=</span><span class="fl">0.001</span>):</span>
<span id="cb76-11"><a href="#cb76-11" aria-hidden="true" tabindex="-1"></a>    n <span class="op">=</span> <span class="bu">len</span>(x)</span>
<span id="cb76-12"><a href="#cb76-12" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb76-13"><a href="#cb76-13" aria-hidden="true" tabindex="-1"></a>    <span class="co"># calculate the covariance matrices</span></span>
<span id="cb76-14"><a href="#cb76-14" aria-hidden="true" tabindex="-1"></a>    tmp, _ <span class="op">=</span> np.meshgrid(x, x)</span>
<span id="cb76-15"><a href="#cb76-15" aria-hidden="true" tabindex="-1"></a>    Sigma_YY <span class="op">=</span> k(tmp, _)</span>
<span id="cb76-16"><a href="#cb76-16" aria-hidden="true" tabindex="-1"></a>    Sigma_YY <span class="op">=</span> Sigma_YY <span class="op">+</span> sigma<span class="op">**</span><span class="dv">2</span><span class="op">*</span>np.identity(n)</span>
<span id="cb76-17"><a href="#cb76-17" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb76-18"><a href="#cb76-18" aria-hidden="true" tabindex="-1"></a>    <span class="co"># determine Sigma_YY_inv(Y - EY) by solving the linear system Sigma_YY x = Y - EY</span></span>
<span id="cb76-19"><a href="#cb76-19" aria-hidden="true" tabindex="-1"></a>    Sigma_YY_inv_Y_EY <span class="op">=</span> np.linalg.solve(Sigma_YY, y <span class="op">-</span> m(x))</span>
<span id="cb76-20"><a href="#cb76-20" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb76-21"><a href="#cb76-21" aria-hidden="true" tabindex="-1"></a>    <span class="co"># return the posterior mean function</span></span>
<span id="cb76-22"><a href="#cb76-22" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="kw">lambda</span> xx: m(xx) <span class="op">+</span> <span class="bu">sum</span>(k(xx, x)<span class="op">*</span>Sigma_YY_inv_Y_EY)</span>
<span id="cb76-23"><a href="#cb76-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-24"><a href="#cb76-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-25"><a href="#cb76-25" aria-hidden="true" tabindex="-1"></a><span class="co"># The posterior kernel from GPR</span></span>
<span id="cb76-26"><a href="#cb76-26" aria-hidden="true" tabindex="-1"></a><span class="co"># inputs: </span></span>
<span id="cb76-27"><a href="#cb76-27" aria-hidden="true" tabindex="-1"></a><span class="co"># k: prior kernel</span></span>
<span id="cb76-28"><a href="#cb76-28" aria-hidden="true" tabindex="-1"></a><span class="co"># x: indices</span></span>
<span id="cb76-29"><a href="#cb76-29" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb76-30"><a href="#cb76-30" aria-hidden="true" tabindex="-1"></a><span class="co"># output: the posterior kernel</span></span>
<span id="cb76-31"><a href="#cb76-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-32"><a href="#cb76-32" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> pos_kernel(k, x, sigma<span class="op">=</span><span class="fl">0.1</span>):</span>
<span id="cb76-33"><a href="#cb76-33" aria-hidden="true" tabindex="-1"></a>    n <span class="op">=</span> <span class="bu">len</span>(x)</span>
<span id="cb76-34"><a href="#cb76-34" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb76-35"><a href="#cb76-35" aria-hidden="true" tabindex="-1"></a>    <span class="co"># calculate the covariance matrices</span></span>
<span id="cb76-36"><a href="#cb76-36" aria-hidden="true" tabindex="-1"></a>    tmp, _ <span class="op">=</span> np.meshgrid(x, x)</span>
<span id="cb76-37"><a href="#cb76-37" aria-hidden="true" tabindex="-1"></a>    Sigma_YY <span class="op">=</span> k(tmp, _)</span>
<span id="cb76-38"><a href="#cb76-38" aria-hidden="true" tabindex="-1"></a>    Sigma_YY <span class="op">=</span> Sigma_YY <span class="op">+</span> sigma<span class="op">**</span><span class="dv">2</span><span class="op">*</span>np.identity(n)</span>
<span id="cb76-39"><a href="#cb76-39" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb76-40"><a href="#cb76-40" aria-hidden="true" tabindex="-1"></a>    <span class="co"># return the posterior kernel</span></span>
<span id="cb76-41"><a href="#cb76-41" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> _(xx, xp):</span>
<span id="cb76-42"><a href="#cb76-42" aria-hidden="true" tabindex="-1"></a>        <span class="co"># determine Sigma_YY_inv Sigma_Yxp by solving the linear system Sigma_YY x = Sigma_Yxp</span></span>
<span id="cb76-43"><a href="#cb76-43" aria-hidden="true" tabindex="-1"></a>        Sigma_YY_inv_Yxp <span class="op">=</span> np.linalg.solve(Sigma_YY, k(xp, x))</span>
<span id="cb76-44"><a href="#cb76-44" aria-hidden="true" tabindex="-1"></a>        Sigma_xY <span class="op">=</span> k(xx, x)</span>
<span id="cb76-45"><a href="#cb76-45" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> k(xx, xp) <span class="op">-</span> <span class="bu">sum</span>(Sigma_xY<span class="op">*</span>Sigma_YY_inv_Yxp)</span>
<span id="cb76-46"><a href="#cb76-46" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb76-47"><a href="#cb76-47" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> _ </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-80" class="cell" data-execution_count="54">
<div class="sourceCode cell-code" id="cb77"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb77-1"><a href="#cb77-1" aria-hidden="true" tabindex="-1"></a>imp_vols <span class="op">=</span> spx_opt.ivs</span>
<span id="cb77-2"><a href="#cb77-2" aria-hidden="true" tabindex="-1"></a>logmnyns <span class="op">=</span> np.log(spx_opt.ks<span class="op">/</span>spx_opt.s_adj)</span>
<span id="cb77-3"><a href="#cb77-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-4"><a href="#cb77-4" aria-hidden="true" tabindex="-1"></a><span class="co"># set hyperparameters by guessing</span></span>
<span id="cb77-5"><a href="#cb77-5" aria-hidden="true" tabindex="-1"></a>A, l, sigma <span class="op">=</span> <span class="fl">0.1</span>, <span class="fl">0.1</span>, <span class="fl">0.01</span></span>
<span id="cb77-6"><a href="#cb77-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-7"><a href="#cb77-7" aria-hidden="true" tabindex="-1"></a><span class="co"># prior mean function</span></span>
<span id="cb77-8"><a href="#cb77-8" aria-hidden="true" tabindex="-1"></a><span class="co"># set prior mean as sample mean of implied vols</span></span>
<span id="cb77-9"><a href="#cb77-9" aria-hidden="true" tabindex="-1"></a>iv_mean <span class="op">=</span> imp_vols.mean()</span>
<span id="cb77-10"><a href="#cb77-10" aria-hidden="true" tabindex="-1"></a>mpr <span class="op">=</span> <span class="kw">lambda</span> x: iv_mean</span>
<span id="cb77-11"><a href="#cb77-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-12"><a href="#cb77-12" aria-hidden="true" tabindex="-1"></a><span class="co"># prior kernel</span></span>
<span id="cb77-13"><a href="#cb77-13" aria-hidden="true" tabindex="-1"></a>k <span class="op">=</span> <span class="kw">lambda</span> x, y: A<span class="op">*</span>np.exp(<span class="op">-</span>np.<span class="bu">abs</span>(x<span class="op">-</span>y)<span class="op">**</span><span class="dv">2</span><span class="op">/</span><span class="dv">2</span><span class="op">/</span>l<span class="op">**</span><span class="dv">2</span>)</span>
<span id="cb77-14"><a href="#cb77-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-15"><a href="#cb77-15" aria-hidden="true" tabindex="-1"></a><span class="co"># indices and observations</span></span>
<span id="cb77-16"><a href="#cb77-16" aria-hidden="true" tabindex="-1"></a>x_is <span class="op">=</span> logmnyns</span>
<span id="cb77-17"><a href="#cb77-17" aria-hidden="true" tabindex="-1"></a>n <span class="op">=</span> <span class="bu">len</span>(x_is)</span>
<span id="cb77-18"><a href="#cb77-18" aria-hidden="true" tabindex="-1"></a>y_is <span class="op">=</span> imp_vols</span>
<span id="cb77-19"><a href="#cb77-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-20"><a href="#cb77-20" aria-hidden="true" tabindex="-1"></a><span class="co"># posterior mean function for implied vol</span></span>
<span id="cb77-21"><a href="#cb77-21" aria-hidden="true" tabindex="-1"></a>mpo_iv <span class="op">=</span> pos_mean(mpr, k, y_is, x_is, sigma<span class="op">=</span>sigma)</span>
<span id="cb77-22"><a href="#cb77-22" aria-hidden="true" tabindex="-1"></a>mpo_iv <span class="op">=</span> np.vectorize(mpo_iv)</span>
<span id="cb77-23"><a href="#cb77-23" aria-hidden="true" tabindex="-1"></a>mpo_iv(x_is)</span>
<span id="cb77-24"><a href="#cb77-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-25"><a href="#cb77-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-26"><a href="#cb77-26" aria-hidden="true" tabindex="-1"></a><span class="co"># fitted values</span></span>
<span id="cb77-27"><a href="#cb77-27" aria-hidden="true" tabindex="-1"></a>iv_hat <span class="op">=</span> mpo_iv(x_is)</span>
<span id="cb77-28"><a href="#cb77-28" aria-hidden="true" tabindex="-1"></a>pd.DataFrame(y_is, iv_hat)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="54">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">0</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0.307461</td>
<td>0.306000</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">0.299448</td>
<td>0.305956</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">0.298590</td>
<td>0.297790</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">0.294401</td>
<td>0.295452</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">0.288030</td>
<td>0.280721</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">...</td>
<td>...</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">0.192479</td>
<td>0.192533</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">0.185995</td>
<td>0.186061</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">0.181538</td>
<td>0.181299</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">0.196908</td>
<td>0.196590</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">0.221521</td>
<td>0.221747</td>
</tr>
</tbody>
</table>

<p>87 rows × 1 columns</p>
</div>
</div>
</div>
<div id="cell-81" class="cell" data-execution_count="55">
<div class="sourceCode cell-code" id="cb78"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb78-1"><a href="#cb78-1" aria-hidden="true" tabindex="-1"></a><span class="co"># plot </span></span>
<span id="cb78-2"><a href="#cb78-2" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">9</span>, <span class="dv">6</span>))</span>
<span id="cb78-3"><a href="#cb78-3" aria-hidden="true" tabindex="-1"></a>plt.plot(x_is, y_is, <span class="st">'bo'</span>, label<span class="op">=</span><span class="st">'Market data'</span>)</span>
<span id="cb78-4"><a href="#cb78-4" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">'logmoneyness'</span>)</span>
<span id="cb78-5"><a href="#cb78-5" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">'implied vol'</span>)</span>
<span id="cb78-6"><a href="#cb78-6" aria-hidden="true" tabindex="-1"></a>x <span class="op">=</span> np.linspace(x_is.<span class="bu">min</span>(), x_is.<span class="bu">max</span>(), <span class="dv">200</span>)</span>
<span id="cb78-7"><a href="#cb78-7" aria-hidden="true" tabindex="-1"></a>plt.plot(x, mpo_iv(x), <span class="st">'r--'</span>, label<span class="op">=</span><span class="st">'GPR fit'</span>)</span>
<span id="cb78-8"><a href="#cb78-8" aria-hidden="true" tabindex="-1"></a>plt.legend()<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="NSD_Lec05-Volatility_Summer2025_files/figure-html/cell-56-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<div id="cell-82" class="cell" data-execution_count="56">
<div class="sourceCode cell-code" id="cb79"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb79-1"><a href="#cb79-1" aria-hidden="true" tabindex="-1"></a><span class="co"># analysis on absolute errors </span></span>
<span id="cb79-2"><a href="#cb79-2" aria-hidden="true" tabindex="-1"></a>abs_errs <span class="op">=</span> np.<span class="bu">abs</span>(iv_hat <span class="op">-</span> y_is)</span>
<span id="cb79-3"><a href="#cb79-3" aria-hidden="true" tabindex="-1"></a>plt.plot(x_is, abs_errs, <span class="st">'bo'</span>)</span>
<span id="cb79-4"><a href="#cb79-4" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">'logmoneyness'</span>, fontsize<span class="op">=</span><span class="dv">12</span>) </span>
<span id="cb79-5"><a href="#cb79-5" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">'errors'</span>, fontsize<span class="op">=</span><span class="dv">12</span>)</span>
<span id="cb79-6"><a href="#cb79-6" aria-hidden="true" tabindex="-1"></a>pd.DataFrame(abs_errs).describe().transpose()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="56">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">count</th>
<th data-quarto-table-cell-role="th">mean</th>
<th data-quarto-table-cell-role="th">std</th>
<th data-quarto-table-cell-role="th">min</th>
<th data-quarto-table-cell-role="th">25%</th>
<th data-quarto-table-cell-role="th">50%</th>
<th data-quarto-table-cell-role="th">75%</th>
<th data-quarto-table-cell-role="th">max</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>87.0</td>
<td>0.001156</td>
<td>0.001303</td>
<td>0.000011</td>
<td>0.000347</td>
<td>0.000829</td>
<td>0.001325</td>
<td>0.007309</td>
</tr>
</tbody>
</table>

</div>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="NSD_Lec05-Volatility_Summer2025_files/figure-html/cell-57-output-2.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<section id="fine-tune-hyperparameters-by-mle" class="level3">
<h3 class="anchored" data-anchor-id="fine-tune-hyperparameters-by-mle">Fine tune hyperparameters by MLE</h3>
<div id="cell-84" class="cell" data-execution_count="57">
<div class="sourceCode cell-code" id="cb80"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb80-1"><a href="#cb80-1" aria-hidden="true" tabindex="-1"></a><span class="co"># estimate the hyperparameters by MLE</span></span>
<span id="cb80-2"><a href="#cb80-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-3"><a href="#cb80-3" aria-hidden="true" tabindex="-1"></a><span class="co"># objective function</span></span>
<span id="cb80-4"><a href="#cb80-4" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> obj(x, y):</span>
<span id="cb80-5"><a href="#cb80-5" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> _(params):</span>
<span id="cb80-6"><a href="#cb80-6" aria-hidden="true" tabindex="-1"></a>        A, l, sigma <span class="op">=</span> params</span>
<span id="cb80-7"><a href="#cb80-7" aria-hidden="true" tabindex="-1"></a>        k <span class="op">=</span> <span class="kw">lambda</span> u, v: A<span class="op">*</span>np.exp(<span class="op">-</span>np.<span class="bu">abs</span>(u<span class="op">-</span>v)<span class="op">**</span><span class="dv">2</span><span class="op">/</span><span class="dv">2</span><span class="op">/</span>l<span class="op">**</span><span class="dv">2</span>)</span>
<span id="cb80-8"><a href="#cb80-8" aria-hidden="true" tabindex="-1"></a>        n <span class="op">=</span> <span class="bu">len</span>(x)</span>
<span id="cb80-9"><a href="#cb80-9" aria-hidden="true" tabindex="-1"></a>        <span class="co"># calculate the covariance matrices</span></span>
<span id="cb80-10"><a href="#cb80-10" aria-hidden="true" tabindex="-1"></a>        tmp, _ <span class="op">=</span> np.meshgrid(x, x)</span>
<span id="cb80-11"><a href="#cb80-11" aria-hidden="true" tabindex="-1"></a>        Sigma_YY <span class="op">=</span> k(tmp, _)</span>
<span id="cb80-12"><a href="#cb80-12" aria-hidden="true" tabindex="-1"></a>        Sigma_YY <span class="op">=</span> Sigma_YY <span class="op">+</span> sigma<span class="op">**</span><span class="dv">2</span><span class="op">*</span>np.identity(n)</span>
<span id="cb80-13"><a href="#cb80-13" aria-hidden="true" tabindex="-1"></a>        Sigma_YY_inv_y <span class="op">=</span> np.linalg.solve(Sigma_YY, y)        </span>
<span id="cb80-14"><a href="#cb80-14" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> np.log(np.linalg.det(Sigma_YY)) <span class="op">+</span> <span class="bu">sum</span>(y<span class="op">*</span>Sigma_YY_inv_y) <span class="co">#this is in fact negative log likelihood</span></span>
<span id="cb80-15"><a href="#cb80-15" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> _</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-85" class="cell" data-execution_count="58">
<div class="sourceCode cell-code" id="cb81"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb81-1"><a href="#cb81-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> scipy.optimize <span class="im">import</span> minimize</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-86" class="cell" data-execution_count="59">
<div class="sourceCode cell-code" id="cb82"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb82-1"><a href="#cb82-1" aria-hidden="true" tabindex="-1"></a><span class="op">%%</span>time</span>
<span id="cb82-2"><a href="#cb82-2" aria-hidden="true" tabindex="-1"></a><span class="co"># minimize objective function</span></span>
<span id="cb82-3"><a href="#cb82-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(obj(x_is, y_is)([<span class="fl">0.1</span>, <span class="fl">0.1</span>, <span class="fl">0.1</span>]))</span>
<span id="cb82-4"><a href="#cb82-4" aria-hidden="true" tabindex="-1"></a>pars <span class="op">=</span> [<span class="fl">0.1</span>, <span class="fl">0.1</span>, <span class="fl">0.1</span>]</span>
<span id="cb82-5"><a href="#cb82-5" aria-hidden="true" tabindex="-1"></a>res <span class="op">=</span> minimize(obj(x_is, y_is), pars, method<span class="op">=</span><span class="st">'nelder-mead'</span>, </span>
<span id="cb82-6"><a href="#cb82-6" aria-hidden="true" tabindex="-1"></a>               options<span class="op">=</span>{<span class="st">'xatol'</span>: <span class="fl">1e-8</span>, <span class="st">'disp'</span>: <span class="va">True</span>}) </span>
<span id="cb82-7"><a href="#cb82-7" aria-hidden="true" tabindex="-1"></a>hyparams <span class="op">=</span> res.x</span>
<span id="cb82-8"><a href="#cb82-8" aria-hidden="true" tabindex="-1"></a>hyparams</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>-381.2423169273305</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>C:\Windows\Temp\ipykernel_3812\1457444304.py:14: RuntimeWarning: divide by zero encountered in log
  return np.log(np.linalg.det(Sigma_YY)) + sum(y*Sigma_YY_inv_y) #this is in fact negative log likelihood
d:\HuaweiMoveData\Users\平面向皮卡丘\Desktop\24-25-3\量化金融专题\slides\.venv\Lib\site-packages\scipy\optimize\_optimize.py:869: RuntimeWarning: invalid value encountered in subtract
  np.max(np.abs(fsim[0] - fsim[1:])) &lt;= fatol):</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>CPU times: total: 18.2 s
Wall time: 9.85 s</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>&lt;timed exec&gt;:4: RuntimeWarning: Maximum number of function evaluations has been exceeded.</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="59">
<pre><code>array([ 0.13481481,  0.16574074, -0.00740741])</code></pre>
</div>
</div>
<div id="cell-87" class="cell" data-execution_count="60">
<div class="sourceCode cell-code" id="cb88"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb88-1"><a href="#cb88-1" aria-hidden="true" tabindex="-1"></a><span class="co"># hyperparameters estimated from MLE</span></span>
<span id="cb88-2"><a href="#cb88-2" aria-hidden="true" tabindex="-1"></a>A, l, sigma <span class="op">=</span> hyparams</span>
<span id="cb88-3"><a href="#cb88-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-4"><a href="#cb88-4" aria-hidden="true" tabindex="-1"></a><span class="co"># prior mean function</span></span>
<span id="cb88-5"><a href="#cb88-5" aria-hidden="true" tabindex="-1"></a><span class="co"># set prior mean as sample mean of implied vols</span></span>
<span id="cb88-6"><a href="#cb88-6" aria-hidden="true" tabindex="-1"></a>iv_mean <span class="op">=</span> imp_vols.mean()</span>
<span id="cb88-7"><a href="#cb88-7" aria-hidden="true" tabindex="-1"></a>mpr <span class="op">=</span> <span class="kw">lambda</span> x: iv_mean</span>
<span id="cb88-8"><a href="#cb88-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-9"><a href="#cb88-9" aria-hidden="true" tabindex="-1"></a><span class="co"># prior kernel</span></span>
<span id="cb88-10"><a href="#cb88-10" aria-hidden="true" tabindex="-1"></a>k <span class="op">=</span> <span class="kw">lambda</span> x, y: A<span class="op">*</span>np.exp(<span class="op">-</span>np.<span class="bu">abs</span>(x<span class="op">-</span>y)<span class="op">**</span><span class="dv">2</span><span class="op">/</span><span class="dv">2</span><span class="op">/</span>l<span class="op">**</span><span class="dv">2</span>)</span>
<span id="cb88-11"><a href="#cb88-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-12"><a href="#cb88-12" aria-hidden="true" tabindex="-1"></a><span class="co"># indices and observations</span></span>
<span id="cb88-13"><a href="#cb88-13" aria-hidden="true" tabindex="-1"></a>x_is <span class="op">=</span> logmnyns</span>
<span id="cb88-14"><a href="#cb88-14" aria-hidden="true" tabindex="-1"></a>n <span class="op">=</span> <span class="bu">len</span>(x_is)</span>
<span id="cb88-15"><a href="#cb88-15" aria-hidden="true" tabindex="-1"></a>y_is <span class="op">=</span> imp_vols</span>
<span id="cb88-16"><a href="#cb88-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-17"><a href="#cb88-17" aria-hidden="true" tabindex="-1"></a><span class="co"># posterior mean function for implied vol</span></span>
<span id="cb88-18"><a href="#cb88-18" aria-hidden="true" tabindex="-1"></a>mpo_iv <span class="op">=</span> pos_mean(mpr, k, y_is, x_is, sigma<span class="op">=</span>sigma)</span>
<span id="cb88-19"><a href="#cb88-19" aria-hidden="true" tabindex="-1"></a>mpo_iv <span class="op">=</span> np.vectorize(mpo_iv)</span>
<span id="cb88-20"><a href="#cb88-20" aria-hidden="true" tabindex="-1"></a><span class="co">#mpo_iv(x_is)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-88" class="cell" data-execution_count="61">
<div class="sourceCode cell-code" id="cb89"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb89-1"><a href="#cb89-1" aria-hidden="true" tabindex="-1"></a><span class="co"># plot </span></span>
<span id="cb89-2"><a href="#cb89-2" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">9</span>, <span class="dv">6</span>))</span>
<span id="cb89-3"><a href="#cb89-3" aria-hidden="true" tabindex="-1"></a>plt.plot(x_is, y_is, <span class="st">'bo'</span>, label<span class="op">=</span><span class="st">'Market data'</span>)</span>
<span id="cb89-4"><a href="#cb89-4" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">'logmoneyness'</span>)</span>
<span id="cb89-5"><a href="#cb89-5" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">'implied vol'</span>)</span>
<span id="cb89-6"><a href="#cb89-6" aria-hidden="true" tabindex="-1"></a>x <span class="op">=</span> np.linspace(x_is.<span class="bu">min</span>(), x_is.<span class="bu">max</span>(), <span class="dv">200</span>)</span>
<span id="cb89-7"><a href="#cb89-7" aria-hidden="true" tabindex="-1"></a>plt.plot(x, mpo_iv(x), <span class="st">'r--'</span>, label<span class="op">=</span><span class="st">'GPR fit'</span>)</span>
<span id="cb89-8"><a href="#cb89-8" aria-hidden="true" tabindex="-1"></a>plt.legend()<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="NSD_Lec05-Volatility_Summer2025_files/figure-html/cell-62-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<div id="cell-89" class="cell" data-execution_count="62">
<div class="sourceCode cell-code" id="cb90"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb90-1"><a href="#cb90-1" aria-hidden="true" tabindex="-1"></a><span class="co"># analysis on absolute errors </span></span>
<span id="cb90-2"><a href="#cb90-2" aria-hidden="true" tabindex="-1"></a>abs_errs <span class="op">=</span> np.<span class="bu">abs</span>(iv_hat <span class="op">-</span> y_is)</span>
<span id="cb90-3"><a href="#cb90-3" aria-hidden="true" tabindex="-1"></a>plt.plot(x_is, abs_errs, <span class="st">'bo'</span>)</span>
<span id="cb90-4"><a href="#cb90-4" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">'logmoneyness'</span>, fontsize<span class="op">=</span><span class="dv">12</span>) </span>
<span id="cb90-5"><a href="#cb90-5" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">'errors'</span>, fontsize<span class="op">=</span><span class="dv">12</span>)</span>
<span id="cb90-6"><a href="#cb90-6" aria-hidden="true" tabindex="-1"></a>pd.DataFrame(abs_errs).describe().transpose()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="62">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">count</th>
<th data-quarto-table-cell-role="th">mean</th>
<th data-quarto-table-cell-role="th">std</th>
<th data-quarto-table-cell-role="th">min</th>
<th data-quarto-table-cell-role="th">25%</th>
<th data-quarto-table-cell-role="th">50%</th>
<th data-quarto-table-cell-role="th">75%</th>
<th data-quarto-table-cell-role="th">max</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>87.0</td>
<td>0.001156</td>
<td>0.001303</td>
<td>0.000011</td>
<td>0.000347</td>
<td>0.000829</td>
<td>0.001325</td>
<td>0.007309</td>
</tr>
</tbody>
</table>

</div>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="NSD_Lec05-Volatility_Summer2025_files/figure-html/cell-63-output-2.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
</section>
</section>
<section id="what-is-vix" class="level2">
<h2 class="anchored" data-anchor-id="what-is-vix">What is VIX?</h2>
<p>Quote from <a href="https://www.investopedia.com/terms/v/vix.asp">this page</a> in Investopedia:</p>
<blockquote class="blockquote">
<p>Created by the Chicago Board Options Exchange (CBOE), the Volatility Index, or VIX, is a real-time market index that represents the market’s expectation of 30-day forward-looking volatility. Derived from the price inputs of the S&amp;P 500 index options, it provides a measure of market risk and investors’ sentiments. It is also known by other names like “Fear Gauge” or “Fear Index.” Investors, research analysts and portfolio managers look to VIX values as a way to measure market risk, fear and stress before they take investment decisions.</p>
</blockquote>
<blockquote class="blockquote">
<p>Introduced in 1993, the Volatility Index (VIX) was initially a weighted measure of the implied volatility (IV) of eight S&amp;P 100 at-the-money put and call options. Ten years later, in 2004, it expanded to use options based on a broader index, the S&amp;P 500. This expansion allows for a more accurate view of investors’ expectations on future market volatility. VIX values higher than 30 are usually associated with a significant amount of volatility as a result of investor fear or uncertainty. Values below 15 ordinarily correspond to less stressful, or even complacent, times in the markets.</p>
</blockquote>
<ul>
<li><p>Originally, the VIX computation was designed to mimic the implied volatility of an at-the-money 1 month option on the OEX index. It did this by averaging volatilities from 8 options (puts and calls from the closest to ATM strikes in the nearest and next to nearest months).</p></li>
<li><p>The CBOE changed the VIX computation: “CBOE is changing VIX to provide a more precise and robust measure of expected market volatility and to create a viable underlying index for tradable volatility products.”</p></li>
<li><p>CBOE listed futures on the VIX in 2004.</p></li>
</ul>
</section>
<section id="volatility-indices-published-by-cboe" class="level2">
<h2 class="anchored" data-anchor-id="volatility-indices-published-by-cboe">Volatility indices published by CBOE</h2>
<p>In addition to VIX, other volatility indices published by <a href="http://www.cboe.com/products/vix-index-volatility/volatility-on-stock-indexes/cboe-s-p-500-9-day-vol-index-vix9d">CBOE</a> include</p>
<ul>
<li>VIX9D</li>
<li>VIX3M</li>
<li>VIX6M</li>
<li>VOX</li>
<li>VXD: Dow Jones index volatility</li>
<li>RVX</li>
<li>VXN</li>
<li>VVIX: VIX of VIX.</li>
</ul>
<table class="caption-top table">
<thead>
<tr class="header">
<th>指数</th>
<th>标的资产</th>
<th>期限</th>
<th>用途</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>VIX9D</td>
<td>标普 500</td>
<td>9 天</td>
<td>短期市场波动对冲</td>
</tr>
<tr class="even">
<td>VIX3M</td>
<td>标普 500</td>
<td>3 个月</td>
<td>中长期波动管理</td>
</tr>
<tr class="odd">
<td>VIX6M</td>
<td>标普 500</td>
<td>6 个月</td>
<td>长期波动对冲</td>
</tr>
<tr class="even">
<td>VOX</td>
<td>纳斯达克 100</td>
<td>30 天</td>
<td>科技股波动监测</td>
</tr>
<tr class="odd">
<td>VXD</td>
<td>道琼斯工业平均指数</td>
<td>30 天</td>
<td>蓝筹股波动监测</td>
</tr>
<tr class="even">
<td>RVX</td>
<td>房地产投资信托 (REITs)</td>
<td>30 天</td>
<td>房地产市场波动监测</td>
</tr>
<tr class="odd">
<td>VXN</td>
<td>纳斯达克综合指数</td>
<td>30 天</td>
<td>科技股及小型股波动监测</td>
</tr>
<tr class="even">
<td>VVIX</td>
<td>VIX 指数本身</td>
<td>30 天</td>
<td>波动率的波动性 (市场恐慌指标)</td>
</tr>
</tbody>
</table>
<section id="note-1" class="level3">
<h3 class="anchored" data-anchor-id="note-1">Note</h3>
<p>More volatility indices published by CBOE can be found in <a href="http://www.cboe.com/Volatility">this link</a>.</p>
<div style="text-align: center;">
<img src="./VIX-real.svg" alt="VIX Real-time Chart" width="600">
<p>
VIX Chart from Investopedia
</p>
</div>
</section>
</section>
<section id="formula-of-financial-engineering" class="level2">
<h2 class="anchored" data-anchor-id="formula-of-financial-engineering">“Formula of financial engineering”</h2>
<p>Engineering: “Build something new out of something that is not.”</p>
<p>Notice that all payoffs we saw before can be expressed as a combination of payoffs from calls and puts, even the underlying itself since it can be regarded as a call struck at zero. A natural question to ask is, to what extent, can a given payoff function be represented as a combination of calls and puts?</p>
<p>The answer is surprisingly “all the payoffs”! The following formula shows how.</p>
<p>Let <span class="math inline">\(\varphi\)</span> be a payoff function, we have</p>
<p><span class="math display">\[
\varphi(s) = \varphi(f) + \varphi'(f)(s - f) + \int_f^\infty (s - k)^+ \varphi''(k) \mathrm{d}k + \int_0^f (k - s)^+ \varphi''(k)\mathrm{d}k.
\]</span></p>
<p>Let <span class="math inline">\(\delta\)</span> denote the Dirac delta function and <span class="math inline">\(\theta\)</span> the Heaviside function. Note that heuristically <span class="math inline">\(\theta' = \delta\)</span>, i.e., the Dirac delta can be regarded as the derivative of the Heaviside function.</p>
<p>The payoff <span class="math inline">\(\varphi(s)\)</span> at time <span class="math inline">\(T\)</span> can be written as</p>
<span class="math display">\[\begin{aligned}
\varphi(s) &amp;= \int_0^\infty \varphi(k) \delta(s - k)\,\mathrm{d}k \\
&amp;= \int_0^f \varphi(k) \delta(s - k)\,\mathrm{d}k + \int_f^\infty \varphi(k) \delta(s - k)\,\mathrm{d}k \\
&amp;= \varphi(f) - \int_0^f \varphi'(k) \theta(k - s)\,\mathrm{d}k + \int_f^\infty \varphi'(k) \theta(s - k)\,\mathrm{d}k \\
&amp;= \varphi(f) + \varphi'(f) (s - f) + \int_0^f \varphi''(k) (k - s)^+\,\mathrm{d}k + \int_f^\infty \varphi''(k) (s - k)^+\,\mathrm{d}k.
\end{aligned}\]</span>
<p>Thus,</p>
<p><span class="math display">\[
\varphi(S_T) = \varphi(f) + \varphi'(f) (S_T - f) + \int_0^f \varphi''(k) (k - S_T)^+ \mathrm{d}k + \int_f^\infty \varphi''(k) (S_T - k)^+ \mathrm{d}k.
\]</span></p>
<p>With <span class="math inline">\(f = \Eof{S_T}\)</span> and taking expectation on both sides, we end up</p>
<span class="math display">\[\begin{aligned}
\E[\varphi(S_T)] &amp;= \varphi(f) + \int_0^f \varphi''(k) P(k)\, \mathrm{d}k + \int_f^\infty \varphi''(k) C(k)\, \mathrm{d}k.
\end{aligned}\]</span>
<ul>
<li>The price of any European style contingent claim can be expressed in terms of strips of out-of-money European options.</li>
</ul>
<section id="remark" class="level4">
<h4 class="anchored" data-anchor-id="remark">Remark</h4>
<p>Dirac delta function <span class="math inline">\(\delta\)</span> is a distribution, not a function. It is defined by the property that for any continuous function <span class="math inline">\(f\)</span>, we have <span class="math display">\[
\int_{-\infty}^\infty f(x) \delta(x - a)\,\mathrm{d}x = f(a).
\]</span></p>
<div style="text-align: center;">
<img src="./dirac-delta-func.svg" alt="Dirac Delta Function" width="400">
<p>
Dirac delta function
</p>
</div>
<p>Heaviside function <span class="math inline">\(\theta\)</span> is defined as <span class="math inline">\(\theta(x) = 0\)</span> for <span class="math inline">\(x &lt; 0\)</span> and <span class="math inline">\(\theta(x) = 1\)</span> for <span class="math inline">\(x \geq 0\)</span>. It is the integral of the Dirac delta function, i.e., <span class="math inline">\(\theta'(x) = \delta(x)\)</span>.</p>
<p>严格定义: 令 <span class="math inline">\(\delta_1(x), \delta_2(x), ...\)</span> 为一个连续实函数的序列. 若 <span class="math inline">\(\delta_n(x)\)</span> 满足以下两个条件, 那么我们把该函数列称为狄拉克 <span class="math inline">\(\delta\)</span> 函数 (列):</p>
<p>对所有性质良好 (例如在 <span class="math inline">\(x=0\)</span> 连续) 的 <span class="math inline">\(f(x)\)</span> , 都有 <span class="math display">\[
\lim_{n \to \infty} \int_{-\infty}^\infty f(x) \delta_n(x)\,\mathrm{d}x = f(0).
\]</span></p>
</section>
</section>
<section id="example---log-contract" class="level2">
<h2 class="anchored" data-anchor-id="example---log-contract">Example - log contract</h2>
<p>Consider the log contract <span class="math inline">\(\displaystyle \varphi(s) = \log s\)</span>. Since <span class="math inline">\(\displaystyle \varphi'(s) = \frac1s\)</span> and <span class="math inline">\(\displaystyle \varphi''(s) = -\frac1{s^2}\)</span>, we obtain</p>
<p><span class="math display">\[
\log s = \log f + \frac{s - f}{f} - \int_0^f \frac{(k - s)^+}{k^2} \mathrm{d}k - \int_f^\infty \frac{(s - k)^+}{k^2} \mathrm{d}k.
\]</span></p>
<p>Thus,</p>
<p><span class="math display">\[
\Eof{\log S_T} = \log f - \int_0^f \, \frac{P(k)}{k^2} \,\mathrm{d}k - \int_f^\infty\, \frac{C(k)}{k^2} \,\mathrm{d}k.
\]</span></p>
<p>On the other hand, assume <span class="math inline">\(S_t\)</span> satisfies the SDE under risk neutral probability with zero interest and dividend rates</p>
<p><span class="math display">\[
\frac{\mathrm{d}S_t}{S_t} = \sigma_t \mathrm{d}W_t,
\]</span></p>
<p>by applying Ito’s formula to <span class="math inline">\(\log S_t\)</span>, we obtain</p>
<p><span class="math display">\[
\log S_T = \log S_0 + \int_0^T \sigma_t \, \mathrm{d}W_t - \frac{1}{2} \int_0^T \sigma_t^2 \, \mathrm{d}t.
\]</span></p>
<p>It follows by taking expectation on both sides that</p>
<p><span class="math display">\[
\Eof{\log S_T} = \log S_0 - \frac12 \Eof{\int_0^T \sigma_t^2 \mathrm{d}t}
\]</span></p>
<p>Compare the two identities we obtain</p>
<p><span class="math display">\[
\frac1T \Eof{\int_0^T \sigma_t^2 \mathrm{d}t} = \frac2T \int_0^f \, \frac{P(k)}{k^2} \,\mathrm{d}k + \frac2T \int_f^\infty\, \frac{C(k)}{k^2} \,\mathrm{d}k.
\]</span></p>
<p>注: 这个式子的左端就是 VIX 的新的定义. “The new VIX squared approximates the conditional risk-neutral expectation of the annualized return variance over the next 30 calendar days.” <span class="citation" data-cites="Carr2004">(<a href="#ref-Carr2004" role="doc-biblioref">Carr and Wu 2004</a>)</span></p>
<section id="note-2" class="level3">
<h3 class="anchored" data-anchor-id="note-2">Note</h3>
<ul>
<li>Modulo the diffusion process assumption on the underlying, the last relationship is model-free.<br>
</li>
<li>VIX is calculated based on this formula with <span class="math inline">\(T\)</span> equal to a month.</li>
</ul>
<p>注: <span class="math inline">\(\Eof{(s-k)^+} = C(k)\)</span>, <span class="math inline">\(\Eof{(k-s)^+} = P(k)\)</span>. 这里的 <span class="math inline">\(C(k)\)</span> 代表的是行权价为 <span class="math inline">\(k\)</span> 的 call 期权的价格, 而 <span class="math inline">\(P(k)\)</span> 代表的是行权价为 <span class="math inline">\(k\)</span> 的 put 期权的价格.</p>
<p>Forward price <span class="math inline">\(F\)</span> is defined as the price of a forward contract that delivers one unit of the underlying at time <span class="math inline">\(T\)</span>. It is given by <span class="math display">\[
F = S e^{-(d-r)\tau} = S e^{-r\tau} e^{-d\tau}.
\]</span></p>
<p>Here, <span class="math inline">\(S\)</span> represents the current price of the underlying, <span class="math inline">\(d\)</span> is the dividend yield, <span class="math inline">\(r\)</span> is the risk-free interest rate, and <span class="math inline">\(\tau\)</span> is the time to maturity in years.</p>
</section>
</section>
<section id="how-is-vix-calculated" class="level2">
<h2 class="anchored" data-anchor-id="how-is-vix-calculated">How is VIX calculated?</h2>
<p>VIX definition in the CBOE white paper:</p>
<p><span class="math display">\[\text{VIX}^2=\frac{2}{T}\,\sum_i\,\frac{\Delta K_i}{K_i^2}\,
Q_i(K_i)\,-\,\frac{1}{T}\,\left[\frac{F}{K_0}-1\right]^2
\]</span></p>
<p>where <span class="math inline">\(Q_i\)</span> is the price of the out-of-the-money option with strike <span class="math inline">\(K_i\)</span> and <span class="math inline">\(K_0\)</span> is the highest strike below the forward price <span class="math inline">\(F\)</span>. <span class="math inline">\(T\)</span> is one month.</p>
<p>注: 在理论上, 积分是从执行价 <span class="math inline">\(k=0\)</span> 一直走到 <span class="math inline">\(+\infty\)</span>, 以 <span class="math inline">\(F\)</span> 作为“切点”来拼接看跌和看涨期权部分. 但实际操作中, 缺乏一个连续 <span class="math inline">\(k\)</span> 的期权价格曲线, 必须离散化并使用最近的实际执行价 <span class="math inline">\(K_0\)</span> 来近似 cutting price. 由于 <span class="math inline">\(K_0\)</span> 不一定等于 <span class="math inline">\(F\)</span>, 就会产生一项偏差, 这项偏差正是: <span class="math display">\[
\frac{1}{T}\,\left(\frac{F}{K_0}-1\right)^2
\]</span></p>
<p>Simple explanation of VIX formula is that it is a square root of weighted sum of out of the money SPX options.</p>
<p>Quotes by <a href="https://www.zhihu.com/question/28856349/answer/43709559">于鹏</a></p>
<blockquote class="blockquote">
<p>期权价格反应了当前市场的供需状况. 某个到日期的期权价格反应投资者对这段期间内市场波动的预期, 用真金白银报价出来的波动预期. 而与 in-the-money (实值) 期权比起来, 虚值期权没有内在价值, 只有时间价值. 也就是说虚值期权的价格“更纯粹”的反应了这种预期的价值. 那么用虚值期权来计算 VIX, 更契合其设计目的 (VIX is a measure of expected volatility calculated as ..) 还有一个地方也反应了这点, 没有 bid 报价的虚值期权也不会被列入计算之内, “Only SPX options quoted with non-zero bid prices are used in the VIX calculation”. 意味着没有市场需求的期权没有考虑进来的必要.</p>
</blockquote>
<section id="download-vix-data-from-yfinance" class="level3">
<h3 class="anchored" data-anchor-id="download-vix-data-from-yfinance">Download VIX data from <code>yfinance</code></h3>
</section>
<section id="you-may-skip-this-part-if-you-encounter-an-error." class="level3">
<h3 class="anchored" data-anchor-id="you-may-skip-this-part-if-you-encounter-an-error.">You may skip this part if you encounter an error.</h3>
<div id="cell-103" class="cell" data-execution_count="63">
<div class="sourceCode cell-code" id="cb91"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb91-1"><a href="#cb91-1" aria-hidden="true" tabindex="-1"></a>start <span class="op">=</span> <span class="st">'2007-01-01'</span></span>
<span id="cb91-2"><a href="#cb91-2" aria-hidden="true" tabindex="-1"></a>end <span class="op">=</span> <span class="st">'2022-07-29'</span></span>
<span id="cb91-3"><a href="#cb91-3" aria-hidden="true" tabindex="-1"></a>vix <span class="op">=</span> yf.download(<span class="st">'^VIX'</span>, start<span class="op">=</span>start, end<span class="op">=</span>end)</span>
<span id="cb91-4"><a href="#cb91-4" aria-hidden="true" tabindex="-1"></a>vix <span class="op">=</span> vix.drop(<span class="st">'Volume'</span>, axis<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb91-5"><a href="#cb91-5" aria-hidden="true" tabindex="-1"></a>vix</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>C:\Windows\Temp\ipykernel_3812\3558120957.py:3: FutureWarning: YF.download() has changed argument auto_adjust default to True
  vix = yf.download('^VIX', start=start, end=end)
[*********************100%***********************]  1 of 1 completed</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="63">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">Price</th>
<th data-quarto-table-cell-role="th">Close</th>
<th data-quarto-table-cell-role="th">High</th>
<th data-quarto-table-cell-role="th">Low</th>
<th data-quarto-table-cell-role="th">Open</th>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">Ticker</th>
<th data-quarto-table-cell-role="th">^VIX</th>
<th data-quarto-table-cell-role="th">^VIX</th>
<th data-quarto-table-cell-role="th">^VIX</th>
<th data-quarto-table-cell-role="th">^VIX</th>
</tr>
<tr class="header">
<th data-quarto-table-cell-role="th">Date</th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">2007-01-03</td>
<td>12.040000</td>
<td>12.750000</td>
<td>11.530000</td>
<td>12.160000</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">2007-01-04</td>
<td>11.510000</td>
<td>12.420000</td>
<td>11.280000</td>
<td>12.400000</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2007-01-05</td>
<td>12.140000</td>
<td>12.250000</td>
<td>11.680000</td>
<td>11.840000</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">2007-01-08</td>
<td>12.000000</td>
<td>12.830000</td>
<td>11.780000</td>
<td>12.480000</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2007-01-09</td>
<td>11.910000</td>
<td>12.470000</td>
<td>11.690000</td>
<td>11.860000</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2022-07-22</td>
<td>23.030001</td>
<td>23.809999</td>
<td>22.410000</td>
<td>23.299999</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">2022-07-25</td>
<td>23.360001</td>
<td>24.570000</td>
<td>23.190001</td>
<td>24.330000</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2022-07-26</td>
<td>24.690001</td>
<td>25.309999</td>
<td>23.820000</td>
<td>23.950001</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">2022-07-27</td>
<td>23.240000</td>
<td>24.410000</td>
<td>23.020000</td>
<td>24.270000</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2022-07-28</td>
<td>22.330000</td>
<td>23.540001</td>
<td>22.219999</td>
<td>23.330000</td>
</tr>
</tbody>
</table>

<p>3920 rows × 4 columns</p>
</div>
</div>
</div>
<div id="cell-104" class="cell" data-execution_count="64">
<div class="sourceCode cell-code" id="cb93"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb93-1"><a href="#cb93-1" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">9</span>, <span class="dv">6</span>))</span>
<span id="cb93-2"><a href="#cb93-2" aria-hidden="true" tabindex="-1"></a>vix[<span class="st">'Close'</span>].plot(label<span class="op">=</span><span class="st">'VIX'</span>)</span>
<span id="cb93-3"><a href="#cb93-3" aria-hidden="true" tabindex="-1"></a><span class="co">#plt.plot(spx_vol*100, 'r-.', label='Historical Volatility')</span></span>
<span id="cb93-4"><a href="#cb93-4" aria-hidden="true" tabindex="-1"></a>plt.grid()</span>
<span id="cb93-5"><a href="#cb93-5" aria-hidden="true" tabindex="-1"></a>plt.legend()<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>&lt;Figure size 900x600 with 0 Axes&gt;</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="NSD_Lec05-Volatility_Summer2025_files/figure-html/cell-65-output-2.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<div id="cell-105" class="cell" data-execution_count="65">
<div class="sourceCode cell-code" id="cb95"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb95-1"><a href="#cb95-1" aria-hidden="true" tabindex="-1"></a><span class="co"># plot log(vix)</span></span>
<span id="cb95-2"><a href="#cb95-2" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">9</span>, <span class="dv">6</span>))</span>
<span id="cb95-3"><a href="#cb95-3" aria-hidden="true" tabindex="-1"></a>log(vix)[<span class="st">'Close'</span>].plot(label<span class="op">=</span><span class="st">'log ViX'</span>)</span>
<span id="cb95-4"><a href="#cb95-4" aria-hidden="true" tabindex="-1"></a>plt.grid()</span>
<span id="cb95-5"><a href="#cb95-5" aria-hidden="true" tabindex="-1"></a>plt.legend()<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>&lt;Figure size 900x600 with 0 Axes&gt;</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="NSD_Lec05-Volatility_Summer2025_files/figure-html/cell-66-output-2.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
</section>
</section>
<section id="volatility-derivatives" class="level2">
<h2 class="anchored" data-anchor-id="volatility-derivatives">Volatility derivatives</h2>
<ul>
<li>variance swap</li>
<li>volatility swap</li>
<li>VIX futures</li>
<li>VIX options</li>
</ul>
</section>
<section id="variance-swap" class="level2">
<h2 class="anchored" data-anchor-id="variance-swap">Variance swap</h2>
<p>Quote from the <a href="https://en.wikipedia.org/wiki/Variance_swap">Wikipage</a>:</p>
<blockquote class="blockquote">
<p>A variance swap is an over-the-counter financial derivative that allows one to speculate on or hedge risks associated with the magnitude of movement, i.e.&nbsp;volatility, of some underlying product, like an <font color="blue"> exchange rate </font>, <font color="blue">interest rate</font>, or stock index.</p>
</blockquote>
<blockquote class="blockquote">
<p>One leg of the swap will pay an amount based upon the realized variance of the price changes of the underlying product. Conventionally, these price changes will be daily log returns, based upon the most commonly used closing price. The other leg of the swap will pay a fixed amount, which is the strike, quoted at the deal’s inception. Thus the net payoff to the counterparties will be the difference between these two and will be settled in cash at the expiration of the deal, though some cash payments will likely be made along the way by one or the other counterparty to maintain agreed upon margin.</p>
</blockquote>
<p>In summary, a variance swap is a forward contract on realized (annualized) variance whose payoff function ideally is given by</p>
<p><span class="math display">\[
N \times \left(\frac1T \int_0^T \sigma_t^2 \mathrm{d}t - K \right)
\]</span></p>
<p>where <span class="math inline">\(K\)</span> is the strike and <span class="math inline">\(N\)</span> denotes the notional.</p>
</section>
<section id="volatility-swap" class="level2">
<h2 class="anchored" data-anchor-id="volatility-swap">Volatility swap</h2>
<p>Quote from the <a href="https://en.wikipedia.org/wiki/Volatility_swap">Wikipage</a>:</p>
<blockquote class="blockquote">
<p>In finance, a volatility swap is a forward contract on the future realised volatility of a given underlying asset. Volatility swaps allow investors to trade the volatility of an asset directly, much as they would trade a price index.</p>
</blockquote>
<blockquote class="blockquote">
<p>The underlying is usually a foreign exchange (FX) rate (very liquid market) but could be as well a single name equity or index. However, the variance swap is preferred in the equity market because it can be replicated with a linear combination of options and a dynamic position in futures.</p>
</blockquote>
<blockquote class="blockquote">
<p>Unlike a stock option, whose volatility exposure is contaminated by its stock price dependence, these swaps provide pure exposure to volatility alone. This is truly the case only for forward starting volatility swaps. However, once the swap has its asset fixings its mark-to-market value also depends on the current asset price. One can use these instruments to speculate on future volatility levels, to trade the spread between realized and implied volatility, or to hedge the volatility exposure of other positions or businesses.</p>
</blockquote>
<p>In summary, a volatility swap is a forward contract on realized (annualized) volatility whose payoff function ideally is given by</p>
<p><span class="math display">\[
N \times \left(\sqrt{\frac1T \int_0^T \sigma_t^2 \mathrm{d}t} - K \right)
\]</span></p>
<p>where <span class="math inline">\(K\)</span> is the strike and <span class="math inline">\(N\)</span> denotes the notional.</p>
</section>
<section id="calculating-volatility-swap-fair-strike-from-mgf" class="level2">
<h2 class="anchored" data-anchor-id="calculating-volatility-swap-fair-strike-from-mgf">Calculating volatility swap fair strike from MGF</h2>
<p>By applying the following formula</p>
<p><span class="math display">\[
\sqrt x = \frac1{2\sqrt\pi}\int_0^\infty s^{-\frac32}\left(1 - e^{-xs}\right) \mathrm{d}s,
\]</span></p>
<p>we obtain</p>
<p><span class="math display">\[
\Eof{\sqrt{\frac1T \int_0^T \sigma_t^2 \mathrm{d}t}} = \frac1{2\sqrt\pi}\int_0^\infty s^{-\frac32}\left(1 - \Eof{e^{-xs}}\right) \mathrm{d}s
\]</span></p>
<p>where apparently,</p>
<p><span class="math display">\[
x = \frac1T \int_0^T \sigma_t^2 \mathrm{d}t
\]</span></p>
<p>and <span class="math inline">\(\Eof{e^{-xs}}\)</span> the moment generating function for realized variance.</p>
</section>
<section id="vix-futures" class="level2">
<h2 class="anchored" data-anchor-id="vix-futures">VIX futures</h2>
<p>According to the <a href="https://cfe.cboe.com/cfe-products/vx-cboe-volatility-index-vix-futures">VIX page</a> on CBOE,</p>
<blockquote class="blockquote">
<p>Introduced in 2004 on Cboe Futures Exchange (CFE), VIX futures provide market participants with the ability to trade a liquid volatility product based on the VIX Index methodology. VIX futures reflect the market’s estimate of the value of the VIX Index on various expiration dates in the future. VIX futures provide market participants with a variety of opportunities to implement their view using volatility trading strategies, including risk management, alpha generation and portfolio diversification.</p>
</blockquote>
</section>
<section id="vix-option" class="level2">
<h2 class="anchored" data-anchor-id="vix-option">VIX option</h2>
<p>Quote from <a href="https://www.investopedia.com/terms/v/vixoption.asp">this page</a> in Invstopeida</p>
<blockquote class="blockquote">
<p>A VIX option is a non-equity index option that uses the CBOE Volatility Index as its underlying asset. Call and put VIX options are both available. The call options hedge portfolios against a sudden market decline, and put options hedge against a rapid reversal of short positions on the S&amp;P 500 index. These options thus allow traders and investors to speculate on future moves in volatility.</p>
</blockquote>
</section>
<section id="a-look-at-the-vix-option-chain-from-yahoo-finance" class="level2">
<h2 class="anchored" data-anchor-id="a-look-at-the-vix-option-chain-from-yahoo-finance">A look at the VIX option chain from Yahoo Finance</h2>
<p>Visit this <a href="https://finance.yahoo.com/quote/%5EVIX/options/">Yahoo Finance link for VIX option chain</a>.</p>
<section id="you-may-skip-the-next-5-cells-if-you-encounter-an-error." class="level3">
<h3 class="anchored" data-anchor-id="you-may-skip-the-next-5-cells-if-you-encounter-an-error.">You may skip the next 5 cells if you encounter an error.</h3>
<div id="cell-114" class="cell" data-execution_count="66">
<div class="sourceCode cell-code" id="cb97"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb97-1"><a href="#cb97-1" aria-hidden="true" tabindex="-1"></a>vix <span class="op">=</span> yf.Ticker(<span class="st">'^VIX'</span>)</span>
<span id="cb97-2"><a href="#cb97-2" aria-hidden="true" tabindex="-1"></a>vix_expiries <span class="op">=</span> vix.options</span>
<span id="cb97-3"><a href="#cb97-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(vix_expiries)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>('2025-07-30', '2025-08-06', '2025-08-13', '2025-08-20', '2025-08-27', '2025-09-17', '2025-10-22', '2025-11-19', '2025-12-17', '2026-01-21', '2026-02-18', '2026-03-18', '2026-04-15')</code></pre>
</div>
</div>
<div id="cell-115" class="cell" data-execution_count="67">
<div class="sourceCode cell-code" id="cb99"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb99-1"><a href="#cb99-1" aria-hidden="true" tabindex="-1"></a><span class="co"># choose an expiry </span></span>
<span id="cb99-2"><a href="#cb99-2" aria-hidden="true" tabindex="-1"></a>idx <span class="op">=</span> <span class="dv">4</span></span>
<span id="cb99-3"><a href="#cb99-3" aria-hidden="true" tabindex="-1"></a>today <span class="op">=</span> dt.strftime(dt.now(), <span class="st">'%Y-%m-</span><span class="sc">%d</span><span class="st">'</span>)</span>
<span id="cb99-4"><a href="#cb99-4" aria-hidden="true" tabindex="-1"></a>day_count <span class="op">=</span> (dt.strptime(vix_expiries[idx], <span class="st">'%Y-%m-</span><span class="sc">%d</span><span class="st">'</span>) <span class="op">-</span> dt.now()).days</span>
<span id="cb99-5"><a href="#cb99-5" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f'option expiry = </span><span class="sc">{</span>vix_expiries[idx]<span class="sc">}</span><span class="ss">, today = </span><span class="sc">{</span>today<span class="sc">}</span><span class="ss">'</span>)</span>
<span id="cb99-6"><a href="#cb99-6" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f'There are </span><span class="sc">{</span>day_count<span class="sc">}</span><span class="ss"> days to expiry'</span>)</span>
<span id="cb99-7"><a href="#cb99-7" aria-hidden="true" tabindex="-1"></a>option_chain <span class="op">=</span> vix.option_chain(vix_expiries[idx])</span>
<span id="cb99-8"><a href="#cb99-8" aria-hidden="true" tabindex="-1"></a>vix_calls, vix_puts <span class="op">=</span> option_chain.calls, option_chain.puts</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>option expiry = 2025-08-27, today = 2025-07-28
There are 29 days to expiry</code></pre>
</div>
</div>
<div id="cell-116" class="cell" data-execution_count="68">
<div class="sourceCode cell-code" id="cb101"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb101-1"><a href="#cb101-1" aria-hidden="true" tabindex="-1"></a><span class="co"># clean data</span></span>
<span id="cb101-2"><a href="#cb101-2" aria-hidden="true" tabindex="-1"></a>vix_calls <span class="op">=</span> vix_calls.drop([<span class="st">'currency'</span>, <span class="st">'contractSize'</span>], axis <span class="op">=</span> <span class="dv">1</span>).dropna()</span>
<span id="cb101-3"><a href="#cb101-3" aria-hidden="true" tabindex="-1"></a>vix_calls <span class="op">=</span> vix_calls[(vix_calls[<span class="st">'bid'</span>] <span class="op">&gt;</span> <span class="dv">0</span>) <span class="op">&amp;</span> (vix_calls[<span class="st">'ask'</span>] <span class="op">&gt;</span> <span class="dv">0</span>)]</span>
<span id="cb101-4"><a href="#cb101-4" aria-hidden="true" tabindex="-1"></a>vix_calls</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="68">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">contractSymbol</th>
<th data-quarto-table-cell-role="th">lastTradeDate</th>
<th data-quarto-table-cell-role="th">strike</th>
<th data-quarto-table-cell-role="th">lastPrice</th>
<th data-quarto-table-cell-role="th">bid</th>
<th data-quarto-table-cell-role="th">ask</th>
<th data-quarto-table-cell-role="th">change</th>
<th data-quarto-table-cell-role="th">percentChange</th>
<th data-quarto-table-cell-role="th">volume</th>
<th data-quarto-table-cell-role="th">openInterest</th>
<th data-quarto-table-cell-role="th">impliedVolatility</th>
<th data-quarto-table-cell-role="th">inTheMoney</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">5</td>
<td>VIXW250827C00018000</td>
<td>2025-07-25 19:54:01+00:00</td>
<td>18.0</td>
<td>2.0</td>
<td>0.9</td>
<td>2.35</td>
<td>0.0</td>
<td>0.0</td>
<td>103.0</td>
<td>0</td>
<td>1.535159</td>
<td>False</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">6</td>
<td>VIXW250827C00019000</td>
<td>2025-07-25 20:11:19+00:00</td>
<td>19.0</td>
<td>1.7</td>
<td>0.7</td>
<td>2.03</td>
<td>0.0</td>
<td>0.0</td>
<td>88.0</td>
<td>0</td>
<td>1.523440</td>
<td>False</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<div id="cell-117" class="cell" data-execution_count="69">
<div class="sourceCode cell-code" id="cb102"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb102-1"><a href="#cb102-1" aria-hidden="true" tabindex="-1"></a>vix_puts <span class="op">=</span> vix_puts.drop([<span class="st">'currency'</span>, <span class="st">'contractSize'</span>], axis <span class="op">=</span> <span class="dv">1</span>).dropna()</span>
<span id="cb102-2"><a href="#cb102-2" aria-hidden="true" tabindex="-1"></a>vix_puts <span class="op">=</span> vix_puts[(vix_puts[<span class="st">'bid'</span>] <span class="op">&gt;</span> <span class="dv">0</span>) <span class="op">&amp;</span> (vix_puts[<span class="st">'ask'</span>] <span class="op">&gt;</span> <span class="dv">0</span>)]</span>
<span id="cb102-3"><a href="#cb102-3" aria-hidden="true" tabindex="-1"></a>vix_puts</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="69">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">contractSymbol</th>
<th data-quarto-table-cell-role="th">lastTradeDate</th>
<th data-quarto-table-cell-role="th">strike</th>
<th data-quarto-table-cell-role="th">lastPrice</th>
<th data-quarto-table-cell-role="th">bid</th>
<th data-quarto-table-cell-role="th">ask</th>
<th data-quarto-table-cell-role="th">change</th>
<th data-quarto-table-cell-role="th">percentChange</th>
<th data-quarto-table-cell-role="th">volume</th>
<th data-quarto-table-cell-role="th">openInterest</th>
<th data-quarto-table-cell-role="th">impliedVolatility</th>
<th data-quarto-table-cell-role="th">inTheMoney</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">7</td>
<td>VIXW250827P00020000</td>
<td>2025-07-25 13:46:04+00:00</td>
<td>20.0</td>
<td>2.63</td>
<td>2.13</td>
<td>3.9</td>
<td>0.0</td>
<td>0.0</td>
<td>1.0</td>
<td>0</td>
<td>0.00001</td>
<td>True</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<div id="cell-118" class="cell" data-execution_count="70">
<div class="sourceCode cell-code" id="cb103"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb103-1"><a href="#cb103-1" aria-hidden="true" tabindex="-1"></a><span class="co"># save data</span></span>
<span id="cb103-2"><a href="#cb103-2" aria-hidden="true" tabindex="-1"></a><span class="co">#vix_calls.to_csv('vixcall_07252022.csv', index=False)</span></span>
<span id="cb103-3"><a href="#cb103-3" aria-hidden="true" tabindex="-1"></a><span class="co">#vix_puts.to_csv('vixput_07252022.csv', index=False)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="you-may-start-from-here.-2" class="level3">
<h3 class="anchored" data-anchor-id="you-may-start-from-here.-2">You may start from here.</h3>
<div id="cell-120" class="cell" data-execution_count="71">
<div class="sourceCode cell-code" id="cb104"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb104-1"><a href="#cb104-1" aria-hidden="true" tabindex="-1"></a><span class="co"># read in saved data</span></span>
<span id="cb104-2"><a href="#cb104-2" aria-hidden="true" tabindex="-1"></a>vix_calls <span class="op">=</span> pd.read_csv(<span class="st">'vixcall_07252022.csv'</span>)</span>
<span id="cb104-3"><a href="#cb104-3" aria-hidden="true" tabindex="-1"></a>vix_puts <span class="op">=</span> pd.read_csv(<span class="st">'vixput_07252022.csv'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-121" class="cell" data-execution_count="72">
<div class="sourceCode cell-code" id="cb105"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb105-1"><a href="#cb105-1" aria-hidden="true" tabindex="-1"></a>expiry, today <span class="op">=</span> <span class="st">'2022-08-24'</span>, <span class="st">'2022-07-25'</span></span>
<span id="cb105-2"><a href="#cb105-2" aria-hidden="true" tabindex="-1"></a>vix_opt <span class="op">=</span> OptionAnalytics([vix_calls, vix_puts], expiry, today)</span>
<span id="cb105-3"><a href="#cb105-3" aria-hidden="true" tabindex="-1"></a><span class="co">#vix_opt = OptionAnalytics([vix_calls, vix_puts], vix_expiries[idx], dt.now())</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>C:\Windows\Temp\ipykernel_3812\903028481.py:94: FutureWarning: Series.__getitem__ treating keys as positions is deprecated. In a future version, integer keys will always be treated as labels (consistent with DataFrame behavior). To access a value by position, use `ser.iloc[pos]`
  s_adj, pv = result.params[0], -result.params[1]</code></pre>
</div>
</div>
<div id="cell-122" class="cell" data-execution_count="73">
<div class="sourceCode cell-code" id="cb107"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb107-1"><a href="#cb107-1" aria-hidden="true" tabindex="-1"></a>vix_opt.plot_arb()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="NSD_Lec05-Volatility_Summer2025_files/figure-html/cell-74-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<div id="cell-123" class="cell" data-execution_count="74">
<div class="sourceCode cell-code" id="cb108"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb108-1"><a href="#cb108-1" aria-hidden="true" tabindex="-1"></a>vix_opt.plot_parity()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="NSD_Lec05-Volatility_Summer2025_files/figure-html/cell-75-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<div id="cell-124" class="cell" data-execution_count="75">
<div class="sourceCode cell-code" id="cb109"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb109-1"><a href="#cb109-1" aria-hidden="true" tabindex="-1"></a>vix_opt.plot_imp_vols2(), vix_opt.plot_imp_vols1()<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="NSD_Lec05-Volatility_Summer2025_files/figure-html/cell-76-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="NSD_Lec05-Volatility_Summer2025_files/figure-html/cell-76-output-2.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
</section>
</section>
<section id="gpr-fit-for-vix-option-implied-volatility-curve" class="level2">
<h2 class="anchored" data-anchor-id="gpr-fit-for-vix-option-implied-volatility-curve">GPR fit for VIX option implied volatility curve</h2>
<div id="cell-126" class="cell" data-execution_count="76">
<div class="sourceCode cell-code" id="cb110"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb110-1"><a href="#cb110-1" aria-hidden="true" tabindex="-1"></a>imp_vols <span class="op">=</span> vix_opt.ivs[<span class="dv">1</span>:]</span>
<span id="cb110-2"><a href="#cb110-2" aria-hidden="true" tabindex="-1"></a><span class="co">#imp_vols = vix_opt.ivs</span></span>
<span id="cb110-3"><a href="#cb110-3" aria-hidden="true" tabindex="-1"></a>logmnyns <span class="op">=</span> np.log(vix_opt.ks[<span class="dv">1</span>:]<span class="op">/</span>vix_opt.s_adj)</span>
<span id="cb110-4"><a href="#cb110-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-5"><a href="#cb110-5" aria-hidden="true" tabindex="-1"></a><span class="co"># set hyperparameters by guessing</span></span>
<span id="cb110-6"><a href="#cb110-6" aria-hidden="true" tabindex="-1"></a>sigma, A, l <span class="op">=</span> <span class="fl">0.05</span>, <span class="fl">0.1</span>, <span class="fl">0.1</span></span>
<span id="cb110-7"><a href="#cb110-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-8"><a href="#cb110-8" aria-hidden="true" tabindex="-1"></a><span class="co"># prior mean function</span></span>
<span id="cb110-9"><a href="#cb110-9" aria-hidden="true" tabindex="-1"></a><span class="co"># set prior mean as sample mean of implied vols</span></span>
<span id="cb110-10"><a href="#cb110-10" aria-hidden="true" tabindex="-1"></a>iv_mean <span class="op">=</span> imp_vols.mean()</span>
<span id="cb110-11"><a href="#cb110-11" aria-hidden="true" tabindex="-1"></a>mpr <span class="op">=</span> <span class="kw">lambda</span> x: iv_mean</span>
<span id="cb110-12"><a href="#cb110-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-13"><a href="#cb110-13" aria-hidden="true" tabindex="-1"></a><span class="co"># prior kernel</span></span>
<span id="cb110-14"><a href="#cb110-14" aria-hidden="true" tabindex="-1"></a>k <span class="op">=</span> <span class="kw">lambda</span> x, y: A<span class="op">*</span>np.exp(<span class="op">-</span>np.<span class="bu">abs</span>(x<span class="op">-</span>y)<span class="op">**</span><span class="dv">2</span><span class="op">/</span><span class="dv">2</span><span class="op">/</span>l<span class="op">**</span><span class="dv">2</span>)</span>
<span id="cb110-15"><a href="#cb110-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-16"><a href="#cb110-16" aria-hidden="true" tabindex="-1"></a><span class="co"># indices and observations</span></span>
<span id="cb110-17"><a href="#cb110-17" aria-hidden="true" tabindex="-1"></a>x_is <span class="op">=</span> logmnyns</span>
<span id="cb110-18"><a href="#cb110-18" aria-hidden="true" tabindex="-1"></a>n <span class="op">=</span> <span class="bu">len</span>(x_is)</span>
<span id="cb110-19"><a href="#cb110-19" aria-hidden="true" tabindex="-1"></a>y_is <span class="op">=</span> imp_vols</span>
<span id="cb110-20"><a href="#cb110-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-21"><a href="#cb110-21" aria-hidden="true" tabindex="-1"></a><span class="co"># posterior mean function for implied vol</span></span>
<span id="cb110-22"><a href="#cb110-22" aria-hidden="true" tabindex="-1"></a>mpo_iv <span class="op">=</span> pos_mean(mpr, k, y_is, x_is, sigma<span class="op">=</span>sigma)</span>
<span id="cb110-23"><a href="#cb110-23" aria-hidden="true" tabindex="-1"></a>mpo_iv <span class="op">=</span> np.vectorize(mpo_iv)</span>
<span id="cb110-24"><a href="#cb110-24" aria-hidden="true" tabindex="-1"></a>mpo_iv(x_is)</span>
<span id="cb110-25"><a href="#cb110-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-26"><a href="#cb110-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-27"><a href="#cb110-27" aria-hidden="true" tabindex="-1"></a><span class="co"># fitted values</span></span>
<span id="cb110-28"><a href="#cb110-28" aria-hidden="true" tabindex="-1"></a>iv_hat <span class="op">=</span> mpo_iv(x_is)</span>
<span id="cb110-29"><a href="#cb110-29" aria-hidden="true" tabindex="-1"></a>pd.DataFrame(y_is, iv_hat)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="76">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">0</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0.794121</td>
<td>0.823381</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">0.612930</td>
<td>0.562470</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">0.561423</td>
<td>0.581719</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">0.612908</td>
<td>0.626235</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">0.685567</td>
<td>0.651083</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">0.736006</td>
<td>0.768180</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">0.767337</td>
<td>0.752712</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">0.796917</td>
<td>0.795185</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">0.833553</td>
<td>0.833420</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">0.874426</td>
<td>0.875310</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">0.912757</td>
<td>0.919806</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">0.945017</td>
<td>0.938292</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">1.010601</td>
<td>1.014723</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1.074513</td>
<td>1.072477</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">1.127997</td>
<td>1.134668</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1.184969</td>
<td>1.182831</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">1.275277</td>
<td>1.285238</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<div id="cell-127" class="cell" data-execution_count="77">
<div class="sourceCode cell-code" id="cb111"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb111-1"><a href="#cb111-1" aria-hidden="true" tabindex="-1"></a><span class="co"># plot </span></span>
<span id="cb111-2"><a href="#cb111-2" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">9</span>, <span class="dv">6</span>))</span>
<span id="cb111-3"><a href="#cb111-3" aria-hidden="true" tabindex="-1"></a>plt.plot(x_is, y_is, <span class="st">'bo'</span>, label<span class="op">=</span><span class="st">'Market data'</span>)</span>
<span id="cb111-4"><a href="#cb111-4" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">'logmoneyness'</span>)</span>
<span id="cb111-5"><a href="#cb111-5" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">'implied vol'</span>)</span>
<span id="cb111-6"><a href="#cb111-6" aria-hidden="true" tabindex="-1"></a>x <span class="op">=</span> np.linspace(x_is.<span class="bu">min</span>(), x_is.<span class="bu">max</span>(), <span class="dv">200</span>)</span>
<span id="cb111-7"><a href="#cb111-7" aria-hidden="true" tabindex="-1"></a>plt.plot(x, mpo_iv(x), <span class="st">'r--'</span>, label<span class="op">=</span><span class="st">'GPR fit'</span>)</span>
<span id="cb111-8"><a href="#cb111-8" aria-hidden="true" tabindex="-1"></a>plt.legend()<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="NSD_Lec05-Volatility_Summer2025_files/figure-html/cell-78-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<div id="cell-128" class="cell" data-execution_count="78">
<div class="sourceCode cell-code" id="cb112"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb112-1"><a href="#cb112-1" aria-hidden="true" tabindex="-1"></a><span class="co"># analysis on absolute errors </span></span>
<span id="cb112-2"><a href="#cb112-2" aria-hidden="true" tabindex="-1"></a>abs_errs <span class="op">=</span> np.<span class="bu">abs</span>(iv_hat <span class="op">-</span> y_is)</span>
<span id="cb112-3"><a href="#cb112-3" aria-hidden="true" tabindex="-1"></a>plt.plot(x_is, abs_errs, <span class="st">'bo'</span>)</span>
<span id="cb112-4"><a href="#cb112-4" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">'logmoneyness'</span>, fontsize<span class="op">=</span><span class="dv">12</span>) </span>
<span id="cb112-5"><a href="#cb112-5" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">'errors'</span>, fontsize<span class="op">=</span><span class="dv">12</span>)</span>
<span id="cb112-6"><a href="#cb112-6" aria-hidden="true" tabindex="-1"></a>pd.DataFrame(abs_errs).describe().transpose()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="78">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">count</th>
<th data-quarto-table-cell-role="th">mean</th>
<th data-quarto-table-cell-role="th">std</th>
<th data-quarto-table-cell-role="th">min</th>
<th data-quarto-table-cell-role="th">25%</th>
<th data-quarto-table-cell-role="th">50%</th>
<th data-quarto-table-cell-role="th">75%</th>
<th data-quarto-table-cell-role="th">max</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>17.0</td>
<td>0.013887</td>
<td>0.01462</td>
<td>0.000133</td>
<td>0.002138</td>
<td>0.007049</td>
<td>0.020297</td>
<td>0.05046</td>
</tr>
</tbody>
</table>

</div>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="NSD_Lec05-Volatility_Summer2025_files/figure-html/cell-79-output-2.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="appendix-optional" class="level2">
<h2 class="anchored" data-anchor-id="appendix-optional">Appendix (Optional)</h2>
</section>
<section id="volatility-estimation-using-high-frequency-data" class="level2">
<h2 class="anchored" data-anchor-id="volatility-estimation-using-high-frequency-data">Volatility estimation using high frequency data</h2>
<ul>
<li>Market microstructure noise may contaminate the data in high frequency, resulting in inconsistency of estimators.</li>
</ul>
</section>
<section id="realized-variance" class="level2">
<h2 class="anchored" data-anchor-id="realized-variance">Realized variance</h2>
<p>The following estimator is called the <em>Realized Variance (RV)</em> estimator</p>
<p><span class="math display">\[
\sum_{i=1}^n \, \left(Y_{t_i} - Y_{t_{i-1}} \right)^2
= \sum_{i=1}^n \, \left( \Delta Y_{t_i} \right)^2,
\]</span></p>
<p>where <span class="math inline">\(Y_t = \log S_t\)</span> and <span class="math inline">\(S_t\)</span> is the price series of the asset under consideration.</p>
<section id="technical-notes" class="level3">
<h3 class="anchored" data-anchor-id="technical-notes">Technical notes</h3>
<ul>
<li>Realized variance and realized covariance <br> Given a partition <span class="math inline">\(\Pi = \{0 = t_1 &lt; \cdots &lt; t_n=T\}\)</span> of the interval <span class="math inline">\([0, T]\)</span>, the realized variance <span class="math inline">\([X]_T^\Pi\)</span> of the process <span class="math inline">\(X_t\)</span> sampled at <span class="math inline">\(\Pi\)</span> is defined by <span class="math display">\[
[X]_T^\Pi = \sum_{i=1}^n |X_{t_i} - X_{t_{i-1}}|^2.
\]</span></li>
</ul>
<p>Similiarly, the realized covariance between <span class="math inline">\(X_t\)</span> and <span class="math inline">\(Y_t\)</span> sampled at <span class="math inline">\(\Pi\)</span> is given by</p>
<p><span class="math display">\[
[X, Y]_T^\Pi = \sum_{i=1}^n (X_{t_i} - X_{t_{i-1}})(Y_{t_i} - Y_{t_{i-1}})
\]</span></p>
<ul>
<li><p>Quadratic variation (integrated variance) and covariation <br> The quadratic variation of <span class="math inline">\(X\)</span> is defined by the limit <span class="math display">\[
  \angl{X}_t = \lim_{\|\Pi_n\| \to 0} [X]_T^{\Pi_n}
  \]</span> provided the limit exists. <span class="math inline">\(\Pi_n\)</span> denotes a sequence of partitions of the interval <span class="math inline">\([0, T]\)</span> such that <span class="math inline">\(\|\Pi_n\| \to 0\)</span> as <span class="math inline">\(n \to \infty\)</span>, where <span class="math inline">\(\|\Pi_n\|\)</span> denotes the mesh of the partition <span class="math inline">\(\Pi_n\)</span>.</p>
<p>Likewise, the covariation between and <span class="math inline">\(X\)</span> and <span class="math inline">\(Y\)</span> is defined by the limit <span class="math display">\[
  \angl{X, Y}_t = \lim_{\|\Pi_n\| \to 0} [X, Y]_T^{\Pi_n}.
  \]</span></p></li>
</ul>
</section>
<section id="assumption" class="level3">
<h3 class="anchored" data-anchor-id="assumption">Assumption</h3>
<p>The log price <span class="math inline">\(X_t\)</span> follows the Ito process</p>
<p><span class="math display">\[
\mathrm{d}X_t = \mu_t \mathrm{d}t + \sigma_t \mathrm{d}W_t,
\]</span> nd where <span class="math inline">\(W_t\)</span> is a Brownian motion. Uer the assumption, <span class="math inline">\(\angl{X}_t = \int_0^t \sigma_\tau^2 \mathrm{d}\tau\)</span>.</p>
</section>
</section>
<section id="integrated-variance-or-quadratic-variation" class="level2">
<h2 class="anchored" data-anchor-id="integrated-variance-or-quadratic-variation">Integrated variance or quadratic variation</h2>
<p>Given a set of tick data, how can we measure the, say daily, variance? <br> A possibility is to estimate the <em>integrated variance</em>, also known as the <em>quadratic variation</em> in the theory of semimartingale. We shall use both terms interchangeably hereafter.</p>
<p>Recall that the <em>quadratic variation</em> <span class="math inline">\(\angl{X}_t\)</span> of the continuous stochastic process <span class="math inline">\(X_t\)</span> is defined by</p>
<p><span class="math display">\[
\angl{X}_T:= \lim_{\|\Pi_n\| \to 0} \sum_{{t_i} \in \Pi_n} |\Delta X_{t_i}|^2
\]</span></p>
<p>provided the limit exist (in probability).</p>
<p>Thus, the goal is to estimate the quadratic variation of the efficient log price from the transacted log price, i.e., tick data. However, the subtlety is that efficient is not directly observable and is contaminated by market microstructure noises.</p>
<section id="note-3" class="level4">
<h4 class="anchored" data-anchor-id="note-3">Note</h4>
<ul>
<li><p>If the process <span class="math inline">\(X\)</span> has jumps, the quadratic variation <span class="math inline">\(\angl{X}\)</span> becomes price</p>
<span class="math display">\[\begin{aligned}
  \langle X \rangle_t &amp;= \langle X^c \rangle_t + \sum_{0 &lt; s \leq t} |\Delta X_s|^2,
  \end{aligned}\]</span>
<p>where <span class="math inline">\(X^c\)</span> denotes the continuous part of <span class="math inline">\(X\)</span> and <span class="math inline">\(\Delta X_s := X_s - X_{s^-}\)</span> is the jump size at time <span class="math inline">\(s\)</span>. In this case, the integrated variance usually refers to <span class="math inline">\(\langle X^c \rangle\)</span>, i.e., the quadratic variation of the continuous part.</p></li>
<li><p>We shall always assume <span class="math inline">\(X\)</span> is a continuous process, thus no jumps, in the sequel.</p></li>
</ul>
</section>
<section id="microstructure-noise" class="level3">
<h3 class="anchored" data-anchor-id="microstructure-noise">Microstructure noise</h3>
<p>In the limit of very high sampling frequency, RV picks up mainly the market microstructure noise. To see this, suppose that the observed price <span class="math inline">\(Y_t\)</span> is given by</p>
<p><span class="math display">\[Y_t =X_t +\epsilon_t,\]</span></p>
<p>where <span class="math inline">\(X_t\)</span> is the value of the underlying (log-)price process of interest and <span class="math inline">\(\epsilon_t\)</span> is a random market microstructure-related noise term, assumed independent of <span class="math inline">\(X_t\)</span>. Suppose we sample the price series <span class="math inline">\(n+1\)</span> times (so that there are <span class="math inline">\(n\)</span> price changes) at <span class="math inline">\(\Pi=\{0=t_0 &lt; \cdots &lt; t_n = T\}\)</span> in the time interval <span class="math inline">\([0, T]\)</span>.</p>
<p>Note that, conditioned on <span class="math inline">\(\cF_T^X\)</span>, the conditional expectation of the realized variance of transacted (log) price satisties</p>
<span class="math display">\[\begin{aligned}
\E\left([Y]_T^\Pi \mid \mathcal{F}_T^X\right) &amp;:= \sum_{i=1}^n \E\left((\Delta Y_{t_i})^2 \mid \mathcal{F}_T^X\right) \\
&amp;= \sum_{i=1}^n (\Delta X_{t_i})^2 + 2 \sum_{i=1}^n \Delta X_{t_i} \E\left(\Delta \epsilon_{t_i} \mid \mathcal{F}_T^X\right) + \sum_{i=1}^n \E\left((\Delta \epsilon_{t_i})^2 \mid \mathcal{F}_T^X\right) \\
&amp;= [X]_T + 2 n \, \text{var}[\epsilon] \\
&amp;\approx \langle X \rangle_T + 2 n \, \text{var}[\epsilon].
\end{aligned}\]</span>
<section id="note-4" class="level4">
<h4 class="anchored" data-anchor-id="note-4">Note</h4>
<p>The difference between <span class="math inline">\([X]_T\)</span> and <span class="math inline">\(\angl{X}_T\)</span> is referred to as the <em>discretization error</em>, which is usually controled by the integrated quarticity <span class="math inline">\(\int_0^T \sigma_t^4 \mathrm{d}t\)</span>.</p>
</section>
</section>
<section id="asymptotic-result" class="level3">
<h3 class="anchored" data-anchor-id="asymptotic-result">Asymptotic result</h3>
<p>A more detailed, but more technical, asymptotic analysis shown in [Zhang, Mykland and Aït-Sahalia]<sup id="cite_ref-ZMA" class="reference"><a href="#cite_note-ZMA">[9]</a></sup> yields that as <span class="math inline">\(n \to \infty\)</span></p>
<p><span class="math display">\[
[Y]^{\Pi}_T \mathop{\approx}^{\mathcal L} \angl{X}_T + 2 \, n \, \text{var}[\epsilon] + \sqrt{ 4 n \Eof{\epsilon^4} + \frac{2T}{n} \int_0^T \sigma_t^4 \mathrm{d}t} \; Z,
\]</span></p>
<p>where <span class="math inline">\(Z \sim N(0,1)\)</span>.</p>
<section id="note-5" class="level4">
<h4 class="anchored" data-anchor-id="note-5">Note</h4>
<ul>
<li>The naive RV estimator <span class="math inline">\([Y]_T^\Pi\)</span> is biased by the variance of market microstructure noise <span class="math inline">\(\epsilon\)</span>. The biasedness increases as the sampling frequency <span class="math inline">\(n\)</span> increases.<br>
</li>
<li>We see that as <span class="math inline">\(n\to\infty\)</span>, the naive RV estimator <span class="math inline">\([Y]_T^\Pi\)</span> picks up mainly the microstructure noise.</li>
</ul>
</section>
</section>
<section id="the-conventional-solution" class="level3">
<h3 class="anchored" data-anchor-id="the-conventional-solution">The conventional solution</h3>
<ul>
<li><p>The conventional solution is to sample at most every five minutes or so.</p>
<ul>
<li>For high frequency data, sampling only every 5 minutes usually corresponds to throwing out more than 99% of the points!</li>
</ul></li>
<li><p>To quote [Zhang, Mykland and Aït-Sahalia]<sup id="cite_ref-ZMA" class="reference"><a href="#cite_note-ZMA">[9]</a></sup>, “It is difficult to accept that throwing away data, especially in such quantities, can be an optimal solution.”</p></li>
<li><p>From a more practical perspective, if we believe that volatility is time-varying, it makes sense to try and measure it from recent data over the last few minutes rather than from a whole day of trading.</p></li>
</ul>
</section>
<section id="subsampling" class="level3">
<h3 class="anchored" data-anchor-id="subsampling">Subsampling</h3>
<p>Let <span class="math inline">\(\Pi^{(k)} = \{0 \leq t_0^{(k)} &lt; \cdots &lt; t_{n_k}^{(k)}\leq T\}\)</span>, for <span class="math inline">\(1 \leq k \leq K\)</span>, be a collection of nonoverlapping subsampling times in <span class="math inline">\(\Pi\)</span>. That is,</p>
<p><span class="math display">\[
\bigcup_{k=1}^K \Pi^{(k)} = \Pi \quad \text{ and } \quad \Pi^{(k)} \cap \Pi^{(\ell)} = \emptyset \; \text{for } k \neq \ell.
\]</span></p>
<p>A typical example that we shall be using in the following is by sampling every <span class="math inline">\(K\)</span> ticks from the <span class="math inline">\(k\)</span>th tick on. That is,</p>
<span class="math display">\[\begin{aligned}
\Pi^{(1)} &amp;= \{t_1 &lt; t_{1+K} &lt; t_{1 + 2K} &lt; \cdots &lt; t_{1 + n_1 K} \leq T \}, \\
\Pi^{(2)} &amp;= \{t_2 &lt; t_{2+K} &lt; t_{2 + 2K}&lt; \cdots &lt; t_{2 + n_2 K} \leq T \}, \\
&amp;\quad \vdots \\
\Pi^{(K)} &amp;= \{t_0 &lt; t_K &lt; t_{2K} &lt; \cdots &lt; t_{n_K K} \leq T \}.
\end{aligned}\]</span>
<p>We denote by <span class="math inline">\([Y]_T^{\Pi^{(k)}}\)</span> the RV estimate of <span class="math inline">\(Y\)</span> using the subsamples that are sampled from the sampling times in <span class="math inline">\(\Pi^{(k)}\)</span>, for <span class="math inline">\(1 \leq k \leq K\)</span>.</p>
<p>By the same token, we have the following asymptotics for each subsample <span class="math inline">\(k \in \{1, \cdots, K\}\)</span></p>
<p><span class="math display">\[
[Y]^{\Pi^{(k)}}_T \mathop{\approx}^{\mathcal L} \angl{X}_T + 2 \, n_k \, \text{var}[\epsilon] + \sqrt{ 4 n_k \Eof{\epsilon^4} + \frac{2T}{n_k} \int_0^T \sigma_t^4 \mathrm{d}t} \; Z_k
\]</span></p>
<p>where <span class="math inline">\(Z_k \sim N(0,1)\)</span>.</p>
</section>
<section id="boosting-rv-estimator" class="level3">
<h3 class="anchored" data-anchor-id="boosting-rv-estimator">Boosting RV estimator</h3>
<p>We can boost the RV estimator by averaging over the “weak learners” <span class="math inline">\([Y]_T^{\Pi^{(k)}}\)</span></p>
<span class="math display">\[\begin{aligned}
[Y]_T^{\text{avg}} &amp;= \frac{1}{K} \sum_{k=1}^K [Y]_T^{\Pi^{(k)}} \\
&amp;\approx \langle X \rangle_T + 2 \, \bar{n}_K \, \text{var}[\epsilon] + \sqrt{ 4 \frac{\bar{n}_K}{K} \E[\epsilon^4] + \frac{4T}{3 \bar{n}_K} \int_0^T \sigma_t^4 \, \mathrm{d}t} \, Z.
\end{aligned}\]</span>
<p>where $n_K := 1K _k n_k $ is the average number of ticks in each subsample, roughly equal to <span class="math inline">\(\frac nK\)</span>.</p>
<section id="note-6" class="level4">
<h4 class="anchored" data-anchor-id="note-6">Note</h4>
<ul>
<li>Boosting reduces biasedness and variance by a factor of <span class="math inline">\(K\)</span>, but is unable to completely remove the biasedness.</li>
<li>The optimal average subsample size <span class="math inline">\(\bar n^*\)</span> is given by <span class="math display">\[
\bar n^* = \sqrt[3]{\frac T{6\text{var}^2[\epsilon]} \int_0^T \sigma_t^4 \mathrm{d}t}.
\]</span></li>
</ul>
<p>Thus, the whole sample set is splitted into roughly <span class="math inline">\(K^* \approx \frac n{\bar n^*}\)</span> sets of subsamples.</p>
</section>
</section>
<section id="the-zma-estimator" class="level3">
<h3 class="anchored" data-anchor-id="the-zma-estimator">The ZMA estimator</h3>
<p>Recall that</p>
<span class="math display">\[\begin{aligned}
[Y]_T^\Pi &amp;\approx \langle X \rangle_T + n \, \text{var}[\epsilon], \\
[Y]_T^{\text{avg}} &amp;\approx \langle X \rangle_T + \bar{n}_K \, \text{var}[\epsilon].
\end{aligned}\]</span>
<p>We can eliminate bias by forming</p>
<span class="math display">\[\begin{aligned}
\frac{1}{\bar{n}_K}[Y]_T^{\text{avg}} - \frac{1}{n} [Y]_T^\Pi &amp;\approx \left( \frac{1}{\bar{n}_K} - \frac{1}{n} \right) \langle X \rangle_T.
\end{aligned}\]</span>
<p>Thus we obtain the [Zhang, Mykland and Aït-Sahalia]<sup id="cite_ref-ZMA" class="reference"><a href="#cite_note-ZMA">[9]</a></sup> (ZMA) bias-corrected estimator of <span class="math inline">\(\angl{X}_T\)</span>:</p>
<p><span class="math display">\[
[Y]_T^{ZMA} := \frac{1}{n - \bar n_K} \, \left\{n \, [Y]_T^{avg} - \bar n_K \, [Y]^\Pi_T \right\}.
\]</span></p>
<p>Moreover, we have the asymptotic behavior for <span class="math inline">\([Y]_T^{ZMA}\)</span> as</p>
<p><span class="math display">\[
[Y]_T^{ZMA} \approx \angl{X}_T + \frac1{\sqrt[6]n}\sqrt{\frac8{c^2}\text{var}^2[\epsilon] + c \frac{4T}3 \int_0^T \sigma_t^4 \mathrm{d}t} \; Z
\]</span></p>
<p>where <span class="math inline">\(Z \sim N(0,1)\)</span>. The optimal constant <span class="math inline">\(c^*\)</span> is given by</p>
<p><span class="math display">\[
c^* = \left(\frac T{12 \, \text{var}^2[\epsilon]} \int_0^T \sigma_t^4 \mathrm{d}t \right)^{-\frac13}.
\]</span></p>
<section id="note-7" class="level4">
<h4 class="anchored" data-anchor-id="note-7">Note</h4>
<p>In the original paper [Zhang, Mykland and Aït-Sahalia]<sup id="cite_ref-ZMA" class="reference"><a href="#cite_note-ZMA">[9]</a></sup>, the authors suggested the estimator as <span class="math inline">\([Y]_T^{avg} - \frac{\bar n_K}{n}[Y]_T^\Pi\)</span>, whereas the estimator <span class="math inline">\([Y]_T^{ZMA}\)</span> obtained above is referred to as the <em>small-sample adjustment</em> in the paper.</p>
</section>
</section>
<section id="the-zhou-estimator" class="level3">
<h3 class="anchored" data-anchor-id="the-zhou-estimator">The Zhou estimator</h3>
<p>Define</p>
<p><span class="math display">\[\begin{align}
[Y]_T^{\Pi, Z} &amp;: = \sum_{i=1}^n (\Delta Y_{t_i})^2 + \sum_{i=2}^n \Delta Y_{t_i} \Delta Y_{t_{i-1}} + \sum_{i=1}^{n-1} \Delta Y_{t_i} \Delta Y_{t_{i+1}} \\
&amp;= \sum_{i=1}^n (Y_{t_i} - Y_{t_{i-1}})(Y_{t_{i+1}} - Y_{t_{i-2}}).
\end{align}\]</span></p>
<p>Thus, under the assumption <span class="math inline">\(Y = X + \epsilon\)</span> of serially uncorrelated noise independent of returns <span class="math inline">\(X\)</span>, we obtain <span class="math inline">\(\mathbb{E}\left[[Y]^{\Pi, Z}\right] = \Eof{[X]_T}\)</span>.</p>
<p>By further assume <span class="math inline">\(X_t = \sigma W_{\tau(t)}\)</span> (a time-changed Brownian motion) for some Brownian motion <span class="math inline">\(W\)</span> and deterministic increasing function <span class="math inline">\(\tau(\cdot)\)</span>, since</p>
<p><span class="math display">\[
\Eof{(\Delta X_{t_i})^2} = \sigma^2 \Eof{\left\{ W_{\tau(t_i)} - W_{\tau(t_{i-1})} \right\}^2} = \sigma^2 \{\tau(t_i) - \tau(t_{i-1})\},
\]</span></p>
<p>we have</p>
<p><span class="math display">\[
\mathbb{E}\left[[Y]^{\Pi, Z}\right] = \sigma^2 \{\tau(T) - \tau(0) \} = \angl{X}_T.
\]</span></p>
<p>In other words, in this case <span class="math inline">\([Y]^{\Pi, Z}\)</span> is an unbiased estimator of <span class="math inline">\(\angl{X}_T\)</span>.</p>
</section>
</section>
<section id="realized-library" class="level2">
<h2 class="anchored" data-anchor-id="realized-library">Realized library</h2>
<p>Realized Library at Oxford-Man Institute of Quantitative Finance publishes daily realized variances/volatilities for various indices.</p>
<p><a href="https://realized.oxford-man.ox.ac.uk/">https://realized.oxford-man.ox.ac.uk/</a></p>
<section id="note-8" class="level4">
<h4 class="anchored" data-anchor-id="note-8">Note</h4>
<p><font color="blue">Unfortunately, the Realized Library has ceased providing the service.</font></p>
</section>
</section>
<section id="spx-realized-variance" class="level2">
<h2 class="anchored" data-anchor-id="spx-realized-variance">SPX realized variance</h2>
<div id="cell-143" class="cell" data-execution_count="79">
<div class="sourceCode cell-code" id="cb113"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb113-1"><a href="#cb113-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> datetime <span class="im">import</span> datetime <span class="im">as</span> dt</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-144" class="cell" data-execution_count="80">
<div class="sourceCode cell-code" id="cb114"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb114-1"><a href="#cb114-1" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> pd.read_csv(<span class="st">'OxfordManRealizedVolatilityIndices.csv'</span>, index_col<span class="op">=</span><span class="dv">0</span>, header<span class="op">=</span><span class="dv">2</span>)</span>
<span id="cb114-2"><a href="#cb114-2" aria-hidden="true" tabindex="-1"></a>rv1 <span class="op">=</span> pd.DataFrame(index<span class="op">=</span>df.index)</span>
<span id="cb114-3"><a href="#cb114-3" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> col <span class="kw">in</span> df.columns:</span>
<span id="cb114-4"><a href="#cb114-4" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> col[<span class="op">-</span><span class="dv">3</span>:] <span class="op">==</span> <span class="st">'.rk'</span>:</span>
<span id="cb114-5"><a href="#cb114-5" aria-hidden="true" tabindex="-1"></a>        rv1[col] <span class="op">=</span> df[col]</span>
<span id="cb114-6"><a href="#cb114-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-7"><a href="#cb114-7" aria-hidden="true" tabindex="-1"></a><span class="co"># convert index into datetime</span></span>
<span id="cb114-8"><a href="#cb114-8" aria-hidden="true" tabindex="-1"></a>rv1.index <span class="op">=</span> [dt.strptime(<span class="bu">str</span>(date), <span class="st">"%Y%m</span><span class="sc">%d</span><span class="st">"</span>) <span class="cf">for</span> date <span class="kw">in</span> rv1.index.values]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-145" class="cell" data-execution_count="81">
<div class="sourceCode cell-code" id="cb115"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb115-1"><a href="#cb115-1" aria-hidden="true" tabindex="-1"></a>df</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="81">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">SPX2.rv</th>
<th data-quarto-table-cell-role="th">SPX2.rk</th>
<th data-quarto-table-cell-role="th">SPX2.r</th>
<th data-quarto-table-cell-role="th">SPX2.rv5ss</th>
<th data-quarto-table-cell-role="th">SPX2.rv10</th>
<th data-quarto-table-cell-role="th">SPX2.rv10ss</th>
<th data-quarto-table-cell-role="th">SPX2.bv5</th>
<th data-quarto-table-cell-role="th">SPX2.bv5ss</th>
<th data-quarto-table-cell-role="th">SPX2.medrv</th>
<th data-quarto-table-cell-role="th">SPX2.rs</th>
<th data-quarto-table-cell-role="th">...</th>
<th data-quarto-table-cell-role="th">FTSEMIB.rs</th>
<th data-quarto-table-cell-role="th">FTSEMIB.rs5ss</th>
<th data-quarto-table-cell-role="th">FTSEMIB.nobs</th>
<th data-quarto-table-cell-role="th">FTSEMIB.timespan</th>
<th data-quarto-table-cell-role="th">FTSEMIB.rcto</th>
<th data-quarto-table-cell-role="th">FTSEMIB.open</th>
<th data-quarto-table-cell-role="th">FTSEMIB.highlow</th>
<th data-quarto-table-cell-role="th">FTSEMIB.highopen</th>
<th data-quarto-table-cell-role="th">FTSEMIB.openprice</th>
<th data-quarto-table-cell-role="th">FTSEMIB.closeprice</th>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">DateID</th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">20000103</td>
<td>0.000157</td>
<td>0.000161</td>
<td>-0.010104</td>
<td>0.000144</td>
<td>0.000175</td>
<td>0.000170</td>
<td>0.000157</td>
<td>0.000142</td>
<td>0.000084</td>
<td>0.000099</td>
<td>...</td>
<td>0.000323</td>
<td>0.000314</td>
<td>496.0</td>
<td>29752.752</td>
<td>NaN</td>
<td>34152.212</td>
<td>0.061739</td>
<td>0.002525</td>
<td>43900.00</td>
<td>41477.00</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">20000104</td>
<td>0.000298</td>
<td>0.000264</td>
<td>-0.039292</td>
<td>0.000219</td>
<td>0.000400</td>
<td>0.000247</td>
<td>0.000206</td>
<td>0.000206</td>
<td>0.000092</td>
<td>0.000254</td>
<td>...</td>
<td>0.000144</td>
<td>0.000173</td>
<td>471.0</td>
<td>28319.096</td>
<td>NaN</td>
<td>35524.926</td>
<td>0.020667</td>
<td>0.001046</td>
<td>41072.00</td>
<td>40468.00</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">20000105</td>
<td>0.000307</td>
<td>0.000305</td>
<td>0.001749</td>
<td>0.000298</td>
<td>0.000258</td>
<td>0.000307</td>
<td>0.000292</td>
<td>0.000279</td>
<td>0.000111</td>
<td>0.000138</td>
<td>...</td>
<td>0.000144</td>
<td>0.000153</td>
<td>497.0</td>
<td>29751.621</td>
<td>NaN</td>
<td>34154.433</td>
<td>-0.029584</td>
<td>0.029584</td>
<td>39000.00</td>
<td>39449.00</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">20000106</td>
<td>0.000136</td>
<td>0.000149</td>
<td>0.001062</td>
<td>0.000136</td>
<td>0.000108</td>
<td>0.000133</td>
<td>0.000127</td>
<td>0.000127</td>
<td>0.000086</td>
<td>0.000062</td>
<td>...</td>
<td>0.000196</td>
<td>0.000216</td>
<td>496.0</td>
<td>29691.265</td>
<td>NaN</td>
<td>34154.335</td>
<td>0.032678</td>
<td>0.000276</td>
<td>39834.00</td>
<td>38736.00</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">20000107</td>
<td>0.000093</td>
<td>0.000123</td>
<td>0.026022</td>
<td>0.000112</td>
<td>0.000121</td>
<td>0.000114</td>
<td>0.000083</td>
<td>0.000095</td>
<td>0.000049</td>
<td>0.000024</td>
<td>...</td>
<td>0.000072</td>
<td>0.000081</td>
<td>497.0</td>
<td>29751.482</td>
<td>NaN</td>
<td>34153.093</td>
<td>-0.027410</td>
<td>0.026694</td>
<td>39144.00</td>
<td>40199.00</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">20171129</td>
<td>0.000016</td>
<td>0.000017</td>
<td>-0.000693</td>
<td>0.000017</td>
<td>0.000016</td>
<td>0.000016</td>
<td>0.000012</td>
<td>0.000013</td>
<td>0.000019</td>
<td>0.000009</td>
<td>...</td>
<td>0.000030</td>
<td>0.000025</td>
<td>19553.0</td>
<td>27358.791</td>
<td>NaN</td>
<td>32401.219</td>
<td>0.010438</td>
<td>0.005222</td>
<td>22391.37</td>
<td>22325.94</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">20171130</td>
<td>0.000028</td>
<td>0.000020</td>
<td>0.004886</td>
<td>0.000023</td>
<td>0.000035</td>
<td>0.000025</td>
<td>0.000024</td>
<td>0.000024</td>
<td>0.000018</td>
<td>0.000010</td>
<td>...</td>
<td>0.000021</td>
<td>0.000024</td>
<td>23672.0</td>
<td>27357.591</td>
<td>NaN</td>
<td>32402.862</td>
<td>0.008467</td>
<td>0.004035</td>
<td>22467.64</td>
<td>22368.29</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">20171201</td>
<td>0.000088</td>
<td>0.000130</td>
<td>-0.001256</td>
<td>0.000117</td>
<td>0.000120</td>
<td>0.000124</td>
<td>0.000093</td>
<td>0.000126</td>
<td>0.000138</td>
<td>0.000061</td>
<td>...</td>
<td>0.000047</td>
<td>0.000054</td>
<td>25521.0</td>
<td>27359.230</td>
<td>NaN</td>
<td>32400.969</td>
<td>-0.013862</td>
<td>0.008983</td>
<td>22168.37</td>
<td>22106.10</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">20171204</td>
<td>0.000023</td>
<td>0.000023</td>
<td>-0.006854</td>
<td>0.000021</td>
<td>0.000022</td>
<td>0.000020</td>
<td>0.000024</td>
<td>0.000022</td>
<td>0.000020</td>
<td>0.000014</td>
<td>...</td>
<td>0.000015</td>
<td>0.000015</td>
<td>21585.0</td>
<td>27359.204</td>
<td>NaN</td>
<td>32400.856</td>
<td>0.006576</td>
<td>0.003166</td>
<td>22350.63</td>
<td>22362.11</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">20171205</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>...</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
</tr>
</tbody>
</table>

<p>4683 rows × 399 columns</p>
</div>
</div>
</div>
<div id="cell-146" class="cell" data-execution_count="82">
<div class="sourceCode cell-code" id="cb116"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb116-1"><a href="#cb116-1" aria-hidden="true" tabindex="-1"></a>rv1</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="82">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">SPX2.rk</th>
<th data-quarto-table-cell-role="th">FTSE2.rk</th>
<th data-quarto-table-cell-role="th">N2252.rk</th>
<th data-quarto-table-cell-role="th">GDAXI2.rk</th>
<th data-quarto-table-cell-role="th">RUT2.rk</th>
<th data-quarto-table-cell-role="th">AORD2.rk</th>
<th data-quarto-table-cell-role="th">DJI2.rk</th>
<th data-quarto-table-cell-role="th">IXIC2.rk</th>
<th data-quarto-table-cell-role="th">FCHI2.rk</th>
<th data-quarto-table-cell-role="th">HSI2.rk</th>
<th data-quarto-table-cell-role="th">...</th>
<th data-quarto-table-cell-role="th">AEX.rk</th>
<th data-quarto-table-cell-role="th">SSMI.rk</th>
<th data-quarto-table-cell-role="th">IBEX2.rk</th>
<th data-quarto-table-cell-role="th">NSEI.rk</th>
<th data-quarto-table-cell-role="th">MXX.rk</th>
<th data-quarto-table-cell-role="th">BVSP.rk</th>
<th data-quarto-table-cell-role="th">GSPTSE.rk</th>
<th data-quarto-table-cell-role="th">STOXX50E.rk</th>
<th data-quarto-table-cell-role="th">FTSTI.rk</th>
<th data-quarto-table-cell-role="th">FTSEMIB.rk</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">2000-01-03</td>
<td>0.000161</td>
<td>NaN</td>
<td>NaN</td>
<td>0.000702</td>
<td>0.000264</td>
<td>NaN</td>
<td>0.000135</td>
<td>0.000574</td>
<td>0.000262</td>
<td>0.000261</td>
<td>...</td>
<td>0.000124</td>
<td>NaN</td>
<td>0.000168</td>
<td>NaN</td>
<td>0.000088</td>
<td>0.000404</td>
<td>NaN</td>
<td>0.000272</td>
<td>0.000158</td>
<td>0.000520</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">2000-01-04</td>
<td>0.000264</td>
<td>0.000249</td>
<td>0.000162</td>
<td>0.000591</td>
<td>0.000232</td>
<td>0.000045</td>
<td>0.000159</td>
<td>0.000575</td>
<td>0.000372</td>
<td>0.000207</td>
<td>...</td>
<td>0.000233</td>
<td>0.000102</td>
<td>0.000215</td>
<td>NaN</td>
<td>0.000214</td>
<td>0.000617</td>
<td>NaN</td>
<td>0.000252</td>
<td>0.000123</td>
<td>0.000336</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2000-01-05</td>
<td>0.000305</td>
<td>0.000198</td>
<td>0.000245</td>
<td>0.001081</td>
<td>0.000145</td>
<td>0.000256</td>
<td>0.000196</td>
<td>0.000941</td>
<td>0.000334</td>
<td>0.001597</td>
<td>...</td>
<td>0.000448</td>
<td>0.000123</td>
<td>0.000292</td>
<td>NaN</td>
<td>0.000173</td>
<td>0.000982</td>
<td>NaN</td>
<td>0.000506</td>
<td>0.000394</td>
<td>0.000422</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">2000-01-06</td>
<td>0.000149</td>
<td>0.000148</td>
<td>0.000198</td>
<td>0.000306</td>
<td>0.000056</td>
<td>0.000031</td>
<td>0.000124</td>
<td>0.000580</td>
<td>0.000248</td>
<td>0.000870</td>
<td>...</td>
<td>0.000224</td>
<td>0.000087</td>
<td>NaN</td>
<td>0.000030</td>
<td>0.000056</td>
<td>0.000501</td>
<td>NaN</td>
<td>0.000110</td>
<td>0.000586</td>
<td>0.000339</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2000-01-07</td>
<td>0.000123</td>
<td>0.000126</td>
<td>0.000157</td>
<td>0.000301</td>
<td>0.000031</td>
<td>0.000043</td>
<td>0.000096</td>
<td>0.000396</td>
<td>0.000257</td>
<td>0.000508</td>
<td>...</td>
<td>0.000107</td>
<td>0.000066</td>
<td>0.000155</td>
<td>0.000039</td>
<td>0.000082</td>
<td>0.000258</td>
<td>NaN</td>
<td>0.000149</td>
<td>0.000159</td>
<td>0.000160</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2017-11-29</td>
<td>0.000017</td>
<td>0.000018</td>
<td>0.000025</td>
<td>0.000047</td>
<td>0.000037</td>
<td>0.000016</td>
<td>0.000012</td>
<td>0.000066</td>
<td>0.000030</td>
<td>0.000039</td>
<td>...</td>
<td>0.000034</td>
<td>0.000021</td>
<td>0.000056</td>
<td>0.000009</td>
<td>0.000035</td>
<td>0.000123</td>
<td>0.000019</td>
<td>0.000040</td>
<td>NaN</td>
<td>0.000029</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">2017-11-30</td>
<td>0.000020</td>
<td>0.000020</td>
<td>0.000038</td>
<td>0.000058</td>
<td>0.000035</td>
<td>0.000031</td>
<td>0.000026</td>
<td>0.000039</td>
<td>0.000040</td>
<td>0.000040</td>
<td>...</td>
<td>0.000036</td>
<td>0.000033</td>
<td>0.000066</td>
<td>0.000025</td>
<td>0.000042</td>
<td>0.000114</td>
<td>0.000016</td>
<td>0.000044</td>
<td>NaN</td>
<td>0.000033</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2017-12-01</td>
<td>0.000130</td>
<td>0.000041</td>
<td>0.000066</td>
<td>0.000142</td>
<td>0.000208</td>
<td>0.000017</td>
<td>0.000153</td>
<td>0.000126</td>
<td>0.000110</td>
<td>0.000066</td>
<td>...</td>
<td>0.000092</td>
<td>0.000056</td>
<td>0.000090</td>
<td>0.000026</td>
<td>0.000061</td>
<td>0.000151</td>
<td>0.000034</td>
<td>0.000117</td>
<td>NaN</td>
<td>0.000073</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">2017-12-04</td>
<td>0.000023</td>
<td>0.000027</td>
<td>0.000039</td>
<td>0.000050</td>
<td>0.000104</td>
<td>0.000009</td>
<td>0.000024</td>
<td>0.000060</td>
<td>0.000028</td>
<td>0.000082</td>
<td>...</td>
<td>0.000028</td>
<td>0.000026</td>
<td>0.000048</td>
<td>0.000031</td>
<td>0.000050</td>
<td>0.000092</td>
<td>0.000012</td>
<td>0.000064</td>
<td>NaN</td>
<td>0.000029</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2017-12-05</td>
<td>NaN</td>
<td>0.000019</td>
<td>0.000027</td>
<td>0.000059</td>
<td>0.000025</td>
<td>0.000018</td>
<td>0.000023</td>
<td>0.000046</td>
<td>0.000037</td>
<td>0.000044</td>
<td>...</td>
<td>0.000026</td>
<td>0.000028</td>
<td>0.000043</td>
<td>0.000026</td>
<td>0.000045</td>
<td>0.000139</td>
<td>0.000009</td>
<td>0.000039</td>
<td>NaN</td>
<td>NaN</td>
</tr>
</tbody>
</table>

<p>4683 rows × 21 columns</p>
</div>
</div>
</div>
<div id="cell-147" class="cell" data-execution_count="83">
<div class="sourceCode cell-code" id="cb117"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb117-1"><a href="#cb117-1" aria-hidden="true" tabindex="-1"></a><span class="co"># plot spx realized variance</span></span>
<span id="cb117-2"><a href="#cb117-2" aria-hidden="true" tabindex="-1"></a><span class="co"># spx2.rk contains the rv calcuated by the realized kernel within 5-min bins</span></span>
<span id="cb117-3"><a href="#cb117-3" aria-hidden="true" tabindex="-1"></a>spx_rv <span class="op">=</span> pd.DataFrame(rv1[<span class="st">'SPX2.rk'</span>])</span>
<span id="cb117-4"><a href="#cb117-4" aria-hidden="true" tabindex="-1"></a>spx_rv.plot(color<span class="op">=</span><span class="st">'red'</span>, grid<span class="op">=</span><span class="va">True</span>, title<span class="op">=</span><span class="st">'SPX realized variance'</span>,</span>
<span id="cb117-5"><a href="#cb117-5" aria-hidden="true" tabindex="-1"></a>         figsize<span class="op">=</span>(<span class="dv">12</span>, <span class="dv">6</span>), ylim<span class="op">=</span>(<span class="dv">0</span>,<span class="fl">0.003</span>))<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="NSD_Lec05-Volatility_Summer2025_files/figure-html/cell-84-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="the-corsi-har-rv-forecast" class="level2">
<h2 class="anchored" data-anchor-id="the-corsi-har-rv-forecast">The Corsi HAR-RV forecast</h2>
<ul>
<li><p>The Corsi HAR-RV model implements a regression to fit the parameters.</p></li>
<li><p>This model can be regarded as a poor man’s version of a long memory model such as ARFIMA.</p>
<ul>
<li>True long-memory models such as ARFIMA are notoriously hard to fit.</li>
</ul></li>
<li><p>HAR-RV can also be considered an intelligent alternative to GARCH.</p></li>
<li><p>The model boils down to the regression</p>
<p><span class="math display">\[RV_{t,t+h} = \beta_0 + \beta_D\,RV_t + \beta_W\,RV_{t-5,t} + \beta_M\,RV_{t-22,t} + \epsilon_{t,t+h}.\]</span></p>
<p>In words, the RV forecast for <span class="math inline">\(h\)</span> days from now is a linear combination of the current realized variance and (aggregate) RV estimates for the last week and the last month.</p></li>
</ul>
<section id="note-9" class="level3">
<h3 class="anchored" data-anchor-id="note-9">Note</h3>
<ul>
<li><span class="math inline">\(RV\)</span> denotes the logarithm of realized variance.</li>
</ul>
<div id="cell-149" class="cell" data-execution_count="84">
<div class="sourceCode cell-code" id="cb118"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb118-1"><a href="#cb118-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> statsmodels.formula.api <span class="im">as</span> sm</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-150" class="cell" data-execution_count="85">
<div class="sourceCode cell-code" id="cb119"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb119-1"><a href="#cb119-1" aria-hidden="true" tabindex="-1"></a><span class="co"># take h = 1 in the HAR-RV model</span></span>
<span id="cb119-2"><a href="#cb119-2" aria-hidden="true" tabindex="-1"></a><span class="co"># y = RV_{t+h}</span></span>
<span id="cb119-3"><a href="#cb119-3" aria-hidden="true" tabindex="-1"></a><span class="co"># rv1 = RV_t</span></span>
<span id="cb119-4"><a href="#cb119-4" aria-hidden="true" tabindex="-1"></a><span class="co"># rv5 = RV_{t-5}</span></span>
<span id="cb119-5"><a href="#cb119-5" aria-hidden="true" tabindex="-1"></a><span class="co"># rv22 = RV_{t-22}</span></span>
<span id="cb119-6"><a href="#cb119-6" aria-hidden="true" tabindex="-1"></a>spx_rv <span class="op">=</span> spx_rv.dropna()</span>
<span id="cb119-7"><a href="#cb119-7" aria-hidden="true" tabindex="-1"></a>spx1 <span class="op">=</span> np.array(spx_rv)</span>
<span id="cb119-8"><a href="#cb119-8" aria-hidden="true" tabindex="-1"></a>y <span class="op">=</span> spx1[<span class="dv">22</span>:]</span>
<span id="cb119-9"><a href="#cb119-9" aria-hidden="true" tabindex="-1"></a>rv1 <span class="op">=</span> spx1[<span class="dv">21</span>:<span class="op">-</span><span class="dv">1</span>]</span>
<span id="cb119-10"><a href="#cb119-10" aria-hidden="true" tabindex="-1"></a>rv5 <span class="op">=</span> np.array(pd.DataFrame(spx1[<span class="dv">17</span>:]).rolling(<span class="dv">5</span>).mean()[<span class="dv">5</span><span class="op">-</span><span class="dv">1</span>:<span class="op">-</span><span class="dv">1</span>])</span>
<span id="cb119-11"><a href="#cb119-11" aria-hidden="true" tabindex="-1"></a>rv22 <span class="op">=</span> np.array(pd.DataFrame(spx1[:]).rolling(<span class="dv">22</span>).mean()[<span class="dv">22</span><span class="op">-</span><span class="dv">1</span>:<span class="op">-</span><span class="dv">1</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-151" class="cell" data-execution_count="86">
<div class="sourceCode cell-code" id="cb120"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb120-1"><a href="#cb120-1" aria-hidden="true" tabindex="-1"></a><span class="co"># regress y over rv1 + rv5 + rv22</span></span>
<span id="cb120-2"><a href="#cb120-2" aria-hidden="true" tabindex="-1"></a>data <span class="op">=</span> {<span class="st">'y'</span>: y, <span class="st">'rv1'</span>: rv1, <span class="st">'rv5'</span>: rv5, <span class="st">'rv22'</span>: rv22}</span>
<span id="cb120-3"><a href="#cb120-3" aria-hidden="true" tabindex="-1"></a>fit_har <span class="op">=</span> sm.ols(<span class="st">'y ~ rv1 + rv5 + rv22'</span>, data<span class="op">=</span>data).fit()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-152" class="cell" data-execution_count="87">
<div class="sourceCode cell-code" id="cb121"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb121-1"><a href="#cb121-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(fit_har.summary())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                            OLS Regression Results                            
==============================================================================
Dep. Variable:                      y   R-squared:                       0.506
Model:                            OLS   Adj. R-squared:                  0.506
Method:                 Least Squares   F-statistic:                     1523.
Date:                Mon, 28 Jul 2025   Prob (F-statistic):               0.00
Time:                        13:34:19   Log-Likelihood:                 32207.
No. Observations:                4459   AIC:                        -6.441e+04
Df Residuals:                    4455   BIC:                        -6.438e+04
Df Model:                           3                                         
Covariance Type:            nonrobust                                         
==============================================================================
                 coef    std err          t      P&gt;|t|      [0.025      0.975]
------------------------------------------------------------------------------
Intercept   1.046e-05   3.07e-06      3.403      0.001    4.43e-06    1.65e-05
rv1            0.2250      0.018     12.458      0.000       0.190       0.260
rv5            0.4543      0.031     14.870      0.000       0.394       0.514
rv22           0.2221      0.027      8.078      0.000       0.168       0.276
==============================================================================
Omnibus:                    10266.653   Durbin-Watson:                   2.045
Prob(Omnibus):                  0.000   Jarque-Bera (JB):        167121903.379
Skew:                          21.714   Prob(JB):                         0.00
Kurtosis:                     950.431   Cond. No.                     1.47e+04
==============================================================================

Notes:
[1] Standard Errors assume that the covariance matrix of the errors is correctly specified.
[2] The condition number is large, 1.47e+04. This might indicate that there are
strong multicollinearity or other numerical problems.</code></pre>
</div>
</div>
<div id="cell-153" class="cell" data-execution_count="88">
<div class="sourceCode cell-code" id="cb123"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb123-1"><a href="#cb123-1" aria-hidden="true" tabindex="-1"></a>fit_har.params</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="88">
<pre><code>Intercept    0.000010
rv1          0.225020
rv5          0.454300
rv22         0.222093
dtype: float64</code></pre>
</div>
</div>
<div id="cell-154" class="cell" data-execution_count="89">
<div class="sourceCode cell-code" id="cb125"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb125-1"><a href="#cb125-1" aria-hidden="true" tabindex="-1"></a><span class="co"># convert fitted values into pd.DataFrame</span></span>
<span id="cb125-2"><a href="#cb125-2" aria-hidden="true" tabindex="-1"></a>fitted <span class="op">=</span> pd.DataFrame({<span class="st">'fitted'</span>: np.array(fit_har.fittedvalues)}, index<span class="op">=</span>spx_rv[<span class="dv">22</span>:].index)</span>
<span id="cb125-3"><a href="#cb125-3" aria-hidden="true" tabindex="-1"></a>fitted.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="89">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">fitted</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">2000-02-03</td>
<td>0.000159</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">2000-02-04</td>
<td>0.000166</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2000-02-07</td>
<td>0.000124</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">2000-02-08</td>
<td>0.000105</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2000-02-09</td>
<td>0.000108</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<div id="cell-155" class="cell" data-execution_count="90">
<div class="sourceCode cell-code" id="cb126"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb126-1"><a href="#cb126-1" aria-hidden="true" tabindex="-1"></a><span class="co"># log plot</span></span>
<span id="cb126-2"><a href="#cb126-2" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">12</span>, <span class="dv">6</span>))</span>
<span id="cb126-3"><a href="#cb126-3" aria-hidden="true" tabindex="-1"></a>plt.plot(spx_rv, color<span class="op">=</span><span class="st">'red'</span>, ls<span class="op">=</span><span class="st">'dotted'</span>, label<span class="op">=</span><span class="st">'Observed RV'</span>)</span>
<span id="cb126-4"><a href="#cb126-4" aria-hidden="true" tabindex="-1"></a>plt.plot(fitted, <span class="st">'b'</span>, label<span class="op">=</span><span class="st">'Forecasted RV'</span>)</span>
<span id="cb126-5"><a href="#cb126-5" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">'Observed and forecasted RV based on HAR model'</span>, fontsize<span class="op">=</span><span class="dv">20</span>, fontweight<span class="op">=</span><span class="st">'bold'</span>)</span>
<span id="cb126-6"><a href="#cb126-6" aria-hidden="true" tabindex="-1"></a>plt.grid()</span>
<span id="cb126-7"><a href="#cb126-7" aria-hidden="true" tabindex="-1"></a>plt.legend()<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="NSD_Lec05-Volatility_Summer2025_files/figure-html/cell-91-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="references" class="level3">
<h3 class="anchored">References</h3>
<p><br></p>
<div class="reflist" style="list-style-type: decimal;">
<ol>
<li id="cite_note-Corsi">
<span class="mw-cite-backlink"><b><a href="#cite_ref-Corsi">^</a></b></span>Fulvio Corsi, A simple approximate long-memory model of realized volatility, <b>Journal of Financial Econometrics</b> <em>7</em>(2) 174–196 (2009).
</li>
<li id="cite_note-ZMA">
<span class="mw-cite-backlink"><b><a href="#cite_ref-ZMA">^</a></b></span>Lan Zhang, Per A. Mykland and Yacine Aït-Sahalia, A tale of two time scales: Determining intergrated volatility with noise high-frequency data, <b>Journal of the American Statistical Association</b>, <em>100</em>(472), 1394–1411 (2005).
</li>
<li id="cite_note-Zhou">
<span class="mw-cite-backlink"><b><a href="#cite_ref-Zhou">^</a></b></span>Bin Zhou, High-frequency data and volatility in foreign-exchange rates, <b>Journal of Business &amp; Economic Statistics</b>, <em>14</em>(1), 45–52 (1996).
</li>
</ol>
<section id="lecture-notes" class="level2">
<h2 class="anchored" data-anchor-id="lecture-notes">Lecture Notes</h2>
<p>Moneyness: Moneyness (在值程度) 是金融衍生品中用于描述期权状态的核心概念, 它反映了期权的行权价 (Strike Price) 与标的资产当前价格 (Underlying Asset Price) 之间的关系.根据这种关系, 期权可以分为: 实值期权 (In-the-Money, ITM)、平值期权 (At-the-Money, ATM) 和虚值期权 (Out-of-the-Money, OTM).</p>
<ul>
<li>In-the-Money: 行权后能活力获利.</li>
<li>At-the-Money: 行权后无利可图.</li>
<li>Out-of-the-Money: 行权后会亏损.</li>
</ul>
<p>公式:</p>
<p><span class="math display">\[
\text{Moneyness} = \frac{K e^{-r \tau}}{S e^{-d\tau}}.
\]</span></p>


</section>
</div>

</section>
</section>

<div id="quarto-appendix" class="default"><section class="quarto-appendix-contents" role="doc-bibliography" id="quarto-bibliography"><h2 class="anchored quarto-appendix-heading">References</h2><div id="refs" class="references csl-bib-body hanging-indent" data-entry-spacing="0" role="list">
<div id="ref-Carr2004" class="csl-entry" role="listitem">
Carr, Peter, and Liuren Wu. 2004. <span>“A Tale of Two Indices.”</span> <em>The Journal of Derivatives</em> 13 (March). <a href="https://doi.org/10.2139/ssrn.871729">https://doi.org/10.2139/ssrn.871729</a>.
</div>
</div></section></div></main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
        const codeEl = trigger.previousElementSibling.cloneNode(true);
        for (const childEl of codeEl.children) {
          if (isCodeAnnotation(childEl)) {
            childEl.remove();
          }
        }
        return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp('/' + window.location.host + '/');
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
</div> <!-- /content -->




</body></html>